import './polyfills.server.mjs';
import{$ as dh,A as wn,B as zn,Ba as ph,C as ve,Ca as mh,D as te,Da as WA,E as mt,Ea as jA,F as mc,G as fr,H as Gn,Ha as $A,I as Xr,J as Ci,K as kA,L as Py,La as gh,M as NA,N as OA,Na as HA,O as xA,Oa as yh,P as Jr,Pa as KA,Q as My,R as gc,S as pr,T as wi,U as Ye,V as Fy,W as Et,X as qs,Y as uh,Z as PA,_ as Ly,a as ur,aa as MA,b as CA,ba as FA,c as na,ca as LA,d as wA,da as z,e as Si,ea as K,f as Vs,fa as me,g as dr,ga as BA,h as hr,ha as zs,i as Ve,ia as VA,j as bA,ja as ne,k as fc,ka as UA,l as pc,la as qA,m as sh,ma as hh,n as TA,na as mr,o as oh,oa as By,p as Us,pa as fh,q as IA,r as Oy,ra as zA,s as AA,t as ah,u as Yr,v as xy,w as DA,wa as Vy,x as RA,y as lh,ya as GA,z as ch,za as Uy}from"./chunk-MXCXODE6.mjs";import{A as rD,B as re,C as en,D as gt,E as Wy,F as iD,G as vc,H as fe,I as cn,J as bh,K as jy,L as Tn,M as Ti,N as Gs,O as Ec,P as Th,Q as sD,R as Ws,S as Ih,T as tt,U as yt,V as mV,W as $y,a as L,b as ra,c as _h,d as QA,e as YA,f as vh,g as St,h as Eh,i as yc,j as qy,k as XA,l as gr,m as zy,n as Sh,o as JA,p as ZA,q as Ch,r as ct,s as eD,t as tD,u as bn,v as bi,w as wh,x as _c,y as Gy,z as nD}from"./chunk-JMPTLJPU.mjs";import{a as qt,b as Cn,c as Z,f as A,h as ih,i as Ny,j as b}from"./chunk-H6KHSOBK.mjs";var _r=A((i_,AD)=>{"use strict";var Nh=Z("buffer"),yr=Nh.Buffer;function ID(n,e){for(var t in n)e[t]=n[t]}yr.from&&yr.alloc&&yr.allocUnsafe&&yr.allocUnsafeSlow?AD.exports=Nh:(ID(Nh,i_),i_.Buffer=Ks);function Ks(n,e,t){return yr(n,e,t)}Ks.prototype=Object.create(yr.prototype);ID(yr,Ks);Ks.from=function(n,e,t){if(typeof n=="number")throw new TypeError("Argument must not be a number");return yr(n,e,t)};Ks.alloc=function(n,e,t){if(typeof n!="number")throw new TypeError("Argument must be a number");var r=yr(n);return e!==void 0?typeof t=="string"?r.fill(e,t):r.fill(e):r.fill(0),r};Ks.allocUnsafe=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return yr(n)};Ks.allocUnsafeSlow=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return Nh.SlowBuffer(n)}});var kD=A(s_=>{"use strict";var DD=Z("stream").Stream,RD=Z("util"),Qs=function(n){this.readable=this.writable=!0,this._paused=!1,this._driver=n};RD.inherits(Qs,DD);Qs.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0};Qs.prototype.resume=function(){this._paused=!1,this.emit("drain");var n=this._driver.messages;n._paused=!1,n.emit("drain")};Qs.prototype.write=function(n){return this.writable?(this._driver.parse(n),!this._paused):!1};Qs.prototype.end=function(n){if(this.writable){n!==void 0&&this.write(n),this.writable=!1;var e=this._driver.messages;e.readable&&(e.readable=e.writable=!1,e.emit("end"))}};Qs.prototype.destroy=function(){this.end()};var Ys=function(n){this.readable=this.writable=!0,this._paused=!1,this._driver=n};RD.inherits(Ys,DD);Ys.prototype.pause=function(){this._driver.io._paused=!0};Ys.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")};Ys.prototype.write=function(n){return this.writable?(typeof n=="string"?this._driver.text(n):this._driver.binary(n),!this._paused):!1};Ys.prototype.end=function(n){n!==void 0&&this.write(n)};Ys.prototype.destroy=function(){};s_.IO=Qs;s_.Messages=Ys});var Oh=A((qne,ND)=>{"use strict";var aa=function(){this.clear()};aa.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"];aa.prototype.clear=function(){this._sent={},this._lines=[]};aa.prototype.set=function(n,e){if(e!==void 0){n=this._strip(n),e=this._strip(e);var t=n.toLowerCase();(!this._sent.hasOwnProperty(t)||this.ALLOWED_DUPLICATES.indexOf(t)>=0)&&(this._sent[t]=!0,this._lines.push(n+": "+e+`\r
`))}};aa.prototype.toString=function(){return this._lines.join("")};aa.prototype._strip=function(n){return n.toString().replace(/^ */,"").replace(/ *$/,"")};ND.exports=aa});var xD=A((zne,OD)=>{"use strict";var xh=_r().Buffer,Ph=function(){this._queue=[],this._queueSize=0,this._offset=0};Ph.prototype.put=function(n){!n||n.length===0||(xh.isBuffer(n)||(n=xh.from(n)),this._queue.push(n),this._queueSize+=n.length)};Ph.prototype.read=function(n){if(n>this._queueSize)return null;if(n===0)return xh.alloc(0);this._queueSize-=n;var e=this._queue,t=n,r=e[0],i,s;if(r.length>=n)return r.length===n?e.shift():(s=r.slice(0,n),e[0]=r.slice(n),s);for(var o=0,a=e.length;o<a&&!(t<e[o].length);o++)t-=e[o].length;return i=e.splice(0,o),t>0&&e.length>0&&(i.push(e[0].slice(0,t)),e[0]=e[0].slice(t)),xh.concat(i,n)};Ph.prototype.eachByte=function(n,e){for(var t,r,i;this._queue.length>0;){for(t=this._queue[0],r=t.length;this._offset<r;)i=this._offset,this._offset+=1,n.call(e,t[i]);this._offset=0,this._queue.shift()}};OD.exports=Ph});var ki=A((Gne,VD)=>{"use strict";var PD=_r().Buffer,LD=Z("events").EventEmitter,sU=Z("util"),MD=kD(),BD=Oh(),oU=xD(),Gt=function(n,e,t){LD.call(this),Gt.validateOptions(t||{},["maxLength","masking","requireMasking","protocols"]),this._request=n,this._reader=new oU,this._options=t||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new BD,this.__queue=[],this.readyState=0,this.url=e,this.io=new MD.IO(this),this.messages=new MD.Messages(this),this._bindEventListeners()};sU.inherits(Gt,LD);Gt.isWebSocket=function(n){var e=n.headers.connection||"",t=n.headers.upgrade||"";return n.method==="GET"&&e.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&t.toLowerCase()==="websocket"};Gt.validateOptions=function(n,e){for(var t in n)if(e.indexOf(t)<0)throw new Error("Unrecognized option: "+t)};var FD={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var n=this;this.messages.on("error",function(){}),this.on("message",function(e){var t=n.messages;t.readable&&t.emit("data",e.data)}),this.on("error",function(e){var t=n.messages;t.readable&&t.emit("error",e)}),this.on("close",function(){var e=n.messages;e.readable&&(e.readable=e.writable=!1,e.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(n){return!1},setHeader:function(n,e){return this.readyState>0?!1:(this._headers.set(n,e),!0)},start:function(){if(this.readyState!==0)return!1;if(!Gt.isWebSocket(this._request))return this._failHandshake(new Error("Not a WebSocket request"));var n;try{n=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(n),this._stage!==-1&&this._open(),!0},_failHandshake:function(n){var e=new BD;return e.set("Content-Type","text/plain"),e.set("Content-Length",PD.byteLength(n.message,"utf8")),e=["HTTP/1.1 400 Bad Request",e.toString(),n.message],this._write(PD.from(e.join(`\r
`),"utf8")),this._fail("protocol_error",n.message),!1},text:function(n){return this.frame(n)},binary:function(n){return!1},ping:function(){return!1},pong:function(){return!1},close:function(n,e){return this.readyState!==1?!1:(this.readyState=3,this.emit("close",new Gt.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(n){this.frame.apply(this,n)},this),this.__queue=[],this.emit("open",new Gt.OpenEvent)},_queue:function(n){return this.__queue.push(n),!0},_write:function(n){var e=this.io;e.readable&&e.emit("data",n)},_fail:function(n,e){this.readyState=2,this.emit("error",new Error(e)),this.close()}};for(o_ in FD)Gt.prototype[o_]=FD[o_];var o_;Gt.ConnectEvent=function(){};Gt.OpenEvent=function(){};Gt.CloseEvent=function(n,e){this.code=n,this.reason=e};Gt.MessageEvent=function(n){this.data=n};Gt.PingEvent=function(n){this.data=n};Gt.PongEvent=function(n){this.data=n};VD.exports=Gt});var WD=A(c_=>{"use strict";c_.HTTPParser=Y;function Y(n){if(n!==void 0&&n!==Y.REQUEST&&n!==Y.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");n===void 0||this.initialize(n),this.maxHeaderSize=Y.maxHeaderSize}Y.prototype.initialize=function(n,e){if(n!==Y.REQUEST&&n!==Y.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");this.type=n,this.state=n+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1};Y.encoding="ascii";Y.maxHeaderSize=80*1024;Y.REQUEST="REQUEST";Y.RESPONSE="RESPONSE";var UD=Y.kOnHeaders=1,a_=Y.kOnHeadersComplete=2,Mh=Y.kOnBody=3,l_=Y.kOnMessageComplete=4;Y.prototype[UD]=Y.prototype[a_]=Y.prototype[Mh]=Y.prototype[l_]=function(){};var qD=!0;Object.defineProperty(Y,"kOnExecute",{get:function(){return qD=!1,99}});var zD=c_.methods=Y.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],GD=zD.indexOf("CONNECT");Y.prototype.reinitialize=Y;Y.prototype.close=Y.prototype.pause=Y.prototype.resume=Y.prototype.remove=Y.prototype.free=function(){};Y.prototype._compatMode0_11=!1;Y.prototype.getAsyncId=function(){return 0};var aU={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};Y.prototype.execute=function(n,e,t){if(!(this instanceof Y))throw new TypeError("not a HTTPParser");e=e||0,t=typeof t=="number"?t:n.length,this.chunk=n,this.offset=e;var r=this.end=e+t;try{for(;this.offset<r&&!this[this.state](););}catch(i){if(this.isUserCall)throw i;return this.hadError=!0,i}return this.chunk=null,t=this.offset-e,aU[this.state]&&(this.headerSize+=t,this.headerSize>(this.maxHeaderSize||Y.maxHeaderSize))?new Error("max header size exceeded"):t};var lU={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};Y.prototype.finish=function(){if(!this.hadError){if(!lU[this.state])return new Error("invalid state for EOF");this.state==="BODY_RAW"&&this.userCall()(this[l_]())}};Y.prototype.consume=Y.prototype.unconsume=Y.prototype.getCurrentBuffer=function(){};Y.prototype.userCall=function(){this.isUserCall=!0;var n=this;return function(e){return n.isUserCall=!1,e}};Y.prototype.nextRequest=function(){this.userCall()(this[l_]()),this.reinitialize(this.type)};Y.prototype.consumeLine=function(){for(var n=this.end,e=this.chunk,t=this.offset;t<n;t++)if(e[t]===10){var r=this.line+e.toString(Y.encoding,this.offset,t);return r.charAt(r.length-1)==="\r"&&(r=r.substr(0,r.length-1)),this.line="",this.offset=t+1,r}this.line+=e.toString(Y.encoding,this.offset,this.end),this.offset=this.end};var cU=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,uU=/^[ \t]+(.*[^ \t])/;Y.prototype.parseHeader=function(n,e){if(n.indexOf("\r")!==-1)throw Fh("HPE_LF_EXPECTED");var t=cU.exec(n),r=t&&t[1];if(r)e.push(r),e.push(t[2]);else{var i=uU.exec(n);i&&e.length&&(e[e.length-1]&&(e[e.length-1]+=" "),e[e.length-1]+=i[1])}};var dU=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;Y.prototype.REQUEST_LINE=function(){var n=this.consumeLine();if(n){var e=dU.exec(n);if(e===null)throw Fh("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?e[1]:zD.indexOf(e[1]),this.info.method===-1)throw new Error("invalid request method");this.info.url=e[2],this.info.versionMajor=+e[3],this.info.versionMinor=+e[4],this.body_bytes=0,this.state="HEADER"}};var hU=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;Y.prototype.RESPONSE_LINE=function(){var n=this.consumeLine();if(n){var e=hU.exec(n);if(e===null)throw Fh("HPE_INVALID_CONSTANT");this.info.versionMajor=+e[1],this.info.versionMinor=+e[2];var t=this.info.statusCode=+e[3];this.info.statusMessage=e[4],((t/100|0)===1||t===204||t===304)&&(this.body_bytes=0),this.state="HEADER"}};Y.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(this.connection.indexOf("close")!==-1)return!1}else if(this.connection.indexOf("keep-alive")===-1)return!1;return!!(this.body_bytes!==null||this.isChunked)};Y.prototype.HEADER=function(){var n=this.consumeLine();if(n!==void 0){var e=this.info;if(n)this.parseHeader(n,e.headers);else{for(var t=e.headers,r=!1,i,s=!1,o=0;o<t.length;o+=2)switch(t[o].toLowerCase()){case"transfer-encoding":this.isChunked=t[o+1].toLowerCase()==="chunked";break;case"content-length":if(i=+t[o+1],r){if(i!==this.body_bytes)throw Fh("HPE_UNEXPECTED_CONTENT_LENGTH")}else r=!0,this.body_bytes=i;break;case"connection":this.connection+=t[o+1].toLowerCase();break;case"upgrade":s=!0;break}this.isChunked&&r&&(r=!1,this.body_bytes=null),s&&this.connection.indexOf("upgrade")!=-1?e.upgrade=this.type===Y.REQUEST||e.statusCode===101:e.upgrade=e.method===GD,this.isChunked&&e.upgrade&&(this.isChunked=!1),e.shouldKeepAlive=this.shouldKeepAlive();var a;if(qD?a=this.userCall()(this[a_](e)):a=this.userCall()(this[a_](e.versionMajor,e.versionMinor,e.headers,e.method,e.url,e.statusCode,e.statusMessage,e.upgrade,e.shouldKeepAlive)),a===2)return this.nextRequest(),!0;if(this.isChunked&&!a)this.state="BODY_CHUNKHEAD";else{if(a||this.body_bytes===0)return this.nextRequest(),e.upgrade;this.body_bytes===null?this.state="BODY_RAW":this.state="BODY_SIZED"}}}};Y.prototype.BODY_CHUNKHEAD=function(){var n=this.consumeLine();n!==void 0&&(this.body_bytes=parseInt(n,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")};Y.prototype.BODY_CHUNK=function(){var n=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[Mh](this.chunk.slice(this.offset,this.offset+n),0,n)),this.offset+=n,this.body_bytes-=n,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")};Y.prototype.BODY_CHUNKEMPTYLINE=function(){var n=this.consumeLine();if(n!==void 0){if(n!=="")throw new Error("Expected empty line");this.state="BODY_CHUNKHEAD"}};Y.prototype.BODY_CHUNKTRAILERS=function(){var n=this.consumeLine();n!==void 0&&(n?this.parseHeader(n,this.trailers):(this.trailers.length&&this.userCall()(this[UD](this.trailers,"")),this.nextRequest()))};Y.prototype.BODY_RAW=function(){this.userCall()(this[Mh](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end};Y.prototype.BODY_SIZED=function(){var n=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[Mh](this.chunk.slice(this.offset,this.offset+n),0,n)),this.offset+=n,this.body_bytes-=n,this.body_bytes||this.nextRequest()};["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(n){var e=Y["kOn"+n];Object.defineProperty(Y.prototype,"on"+n,{get:function(){return this[e]},set:function(t){return this._compatMode0_11=!0,GD="CONNECT",this[e]=t}})});function Fh(n){var e=new Error("Parse Error");return e.code=n,e}});var Bh=A((jne,$D)=>{"use strict";var Lh=WD().HTTPParser,fU=_r().Buffer,pU={request:Lh.REQUEST||"request",response:Lh.RESPONSE||"response"},Wt=function(n){this._type=n,this._parser=new Lh(pU[n]),this._complete=!1,this.headers={};var e=null,t=this;this._parser.onHeaderField=function(r,i,s){e=r.toString("utf8",i,i+s).toLowerCase()},this._parser.onHeaderValue=function(r,i,s){var o=r.toString("utf8",i,i+s);t.headers.hasOwnProperty(e)?t.headers[e]+=", "+o:t.headers[e]=o},this._parser.onHeadersComplete=this._parser[Lh.kOnHeadersComplete]=function(r,i,s,o,a,l){var c=arguments[0];if(typeof c=="object"&&(o=c.method,a=c.url,l=c.statusCode,s=c.headers),t.method=typeof o=="number"?Wt.METHODS[o]:o,t.statusCode=l,t.url=a,!!s){for(var u=0,d=s.length,h,p;u<d;u+=2)h=s[u].toLowerCase(),p=s[u+1],t.headers.hasOwnProperty(h)?t.headers[h]+=", "+p:t.headers[h]=p;t._complete=!0}}};Wt.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var jD=process.version?process.version.match(/[0-9]+/g).map(function(n){return parseInt(n,10)}):[];jD[0]===0&&jD[1]===12&&(Wt.METHODS[16]="REPORT",Wt.METHODS[17]="MKACTIVITY",Wt.METHODS[18]="CHECKOUT",Wt.METHODS[19]="MERGE",Wt.METHODS[20]="M-SEARCH",Wt.METHODS[21]="NOTIFY",Wt.METHODS[22]="SUBSCRIBE",Wt.METHODS[23]="UNSUBSCRIBE",Wt.METHODS[24]="PATCH",Wt.METHODS[25]="PURGE");Wt.prototype.isComplete=function(){return this._complete};Wt.prototype.parse=function(n){var e=this._parser.execute(n,0,n.length);if(typeof e!="number"){this.error=e,this._complete=!0;return}this._complete&&(this.body=e<n.length?n.slice(e):fU.alloc(0))};$D.exports=Wt});var QD=A(($ne,KD)=>{"use strict";var u_=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,mU=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,gU=/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/,d_=new RegExp(u_.source+"(?:=(?:"+u_.source+"|"+gU.source+"))?"),h_=new RegExp(u_.source+"(?: *; *"+d_.source+")*","g"),yU=new RegExp("^"+h_.source+"(?: *, *"+h_.source+")*$"),_U=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,HD=Object.prototype.hasOwnProperty,vU={parseHeader:function(n){var e=new kc;if(n===""||n===void 0)return e;if(!yU.test(n))throw new SyntaxError("Invalid Sec-WebSocket-Extensions header: "+n);var t=n.match(h_);return t.forEach(function(r){var i=r.match(new RegExp(d_.source,"g")),s=i.shift(),o={};i.forEach(function(a){var l=a.match(d_),c=l[1],u;l[2]!==void 0?u=l[2]:l[3]!==void 0?u=l[3].replace(/\\/g,""):u=!0,_U.test(u)&&(u=parseFloat(u)),HD.call(o,c)?(o[c]=[].concat(o[c]),o[c].push(u)):o[c]=u},this),e.push(s,o)},this),e},serializeParams:function(n,e){var t=[],r=function(s,o){o instanceof Array?o.forEach(function(a){r(s,a)}):o===!0?t.push(s):typeof o=="number"?t.push(s+"="+o):mU.test(o)?t.push(s+'="'+o.replace(/"/g,'\\"')+'"'):t.push(s+"="+o)};for(var i in e)r(i,e[i]);return[n].concat(t).join("; ")}},kc=function(){this._byName={},this._inOrder=[]};kc.prototype.push=function(n,e){HD.call(this._byName,n)||(this._byName[n]=[]),this._byName[n].push(e),this._inOrder.push({name:n,params:e})};kc.prototype.eachOffer=function(n,e){for(var t=this._inOrder,r=0,i=t.length;r<i;r++)n.call(e,t[r].name,t[r].params)};kc.prototype.byName=function(n){return this._byName[n]||[]};kc.prototype.toArray=function(){return this._inOrder.slice()};KD.exports=vU});var f_=A((Hne,YD)=>{"use strict";var Nc=function(n){this._bufferSize=n,this.clear()};Nc.prototype.clear=function(){this._buffer=new Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0};Nc.prototype.push=function(n){var e=!1,t=!1;this._ringSize<this._bufferSize?e=this._tail===0:this._ringOffset===this._ringSize&&(e=!0,t=this._tail===0),e&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(new Array(this._bufferSize)),this._bufferSize=this._buffer.length,t&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=n,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize};Nc.prototype.peek=function(){if(this.length!==0)return this._buffer[this._head]};Nc.prototype.shift=function(){if(this.length!==0){var n=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,this._ringOffset===0&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,n}};YD.exports=Nc});var JD=A((Kne,XD)=>{"use strict";var EU=f_(),la=function(n,e){this._session=n,this._method=e,this._queue=new EU(la.QUEUE_SIZE),this._stopped=!1,this.pending=0};la.QUEUE_SIZE=8;la.prototype.call=function(n,e,t,r){if(!this._stopped){var i={error:n,message:e,callback:t,context:r,done:!1},s=!1,o=this;if(this._queue.push(i),i.error)return i.done=!0,this._stop(),this._flushQueue();var a=function(l,c){s^(s=!0)&&(l?(o._stop(),i.error=l,i.message=null):i.message=c,i.done=!0,o._flushQueue())};try{this._session[this._method](e,a)}catch(l){a(l)}}};la.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0};la.prototype._flushQueue=function(){for(var n=this._queue,e;n.length>0&&n.peek().done;)e=n.shift(),e.error?(this.pending=0,n.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)};XD.exports=la});var p_=A((Qne,ZD)=>{"use strict";var SU=f_(),Xs=function(){this._complete=!1,this._callbacks=new SU(Xs.QUEUE_SIZE)};Xs.QUEUE_SIZE=4;Xs.all=function(n){var e=new Xs,t=n.length,r=t;for(t===0&&e.done();r--;)n[r].then(function(){t-=1,t===0&&e.done()});return e};Xs.prototype.then=function(n){this._complete?n():this._callbacks.push(n)};Xs.prototype.done=function(){this._complete=!0;for(var n=this._callbacks,e;e=n.shift();)e()};ZD.exports=Xs});var nR=A((Yne,tR)=>{"use strict";var eR=JD(),CU=p_(),Js=function(n){this._ext=n[0],this._session=n[1],this._functors={incoming:new eR(this._session,"processIncomingMessage"),outgoing:new eR(this._session,"processOutgoingMessage")}};Js.prototype.pending=function(n){var e=this._functors[n];e._stopped||(e.pending+=1)};Js.prototype.incoming=function(n,e,t,r){this._exec("incoming",n,e,t,r)};Js.prototype.outgoing=function(n,e,t,r){this._exec("outgoing",n,e,t,r)};Js.prototype.close=function(){return this._closed=this._closed||new CU,this._doClose(),this._closed};Js.prototype._exec=function(n,e,t,r,i){this._functors[n].call(e,t,function(s,o){s&&(s.message=this._ext.name+": "+s.message),r.call(i,s,o),this._doClose()},this)};Js.prototype._doClose=function(){var n=this._functors.incoming,e=this._functors.outgoing;!this._closed||n.pending+e.pending!==0||(this._session&&this._session.close(),this._session=null,this._closed.done())};tR.exports=Js});var iR=A((Xne,rR)=>{"use strict";var wU=nR(),bU=p_(),Oc=function(n){this._cells=n.map(function(e){return new wU(e)}),this._stopped={incoming:!1,outgoing:!1}};Oc.prototype.processIncomingMessage=function(n,e,t){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,n,e,t)};Oc.prototype.processOutgoingMessage=function(n,e,t){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,n,e,t)};Oc.prototype.close=function(n,e){this._stopped={incoming:!0,outgoing:!0};var t=this._cells.map(function(r){return r.close()});n&&bU.all(t).then(function(){n.call(e)})};Oc.prototype._loop=function(n,e,t,r,i,s,o){for(var a=this._cells,l=a.length,c=this;l--;)a[l].pending(n);var u=function(d,h,p){if(d===t)return s.call(o,h,p);a[d][n](h,p,function(E,w){E&&(c._stopped[n]=!0),u(d+r,E,w)})};u(e,null,i)};rR.exports=Oc});var lR=A((Jne,aR)=>{"use strict";var xc=QD(),sR=iR(),Vh=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};Vh.MESSAGE_OPCODES=[1,2];var oR={add:function(n){if(typeof n.name!="string")throw new TypeError("extension.name must be a string");if(n.type!=="permessage")throw new TypeError('extension.type must be "permessage"');if(typeof n.rsv1!="boolean")throw new TypeError("extension.rsv1 must be true or false");if(typeof n.rsv2!="boolean")throw new TypeError("extension.rsv2 must be true or false");if(typeof n.rsv3!="boolean")throw new TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(n.name))throw new TypeError('An extension with name "'+n.name+'" is already registered');this._byName[n.name]=n,this._inOrder.push(n)},generateOffer:function(){var n=[],e=[],t={};return this._inOrder.forEach(function(r){var i=r.createClientSession();if(i){var s=[r,i];n.push(s),t[r.name]=s;var o=i.generateOffer();o=o?[].concat(o):[],o.forEach(function(a){e.push(xc.serializeParams(r.name,a))},this)}},this),this._sessions=n,this._index=t,e.length>0?e.join(", "):null},activate:function(n){var e=xc.parseHeader(n),t=[];e.eachOffer(function(r,i){var s=this._index[r];if(!s)throw new Error('Server sent an extension response for unknown extension "'+r+'"');var o=s[0],a=s[1],l=this._reserved(o);if(l)throw new Error("Server sent two extension responses that use the RSV"+l[0]+' bit: "'+l[1]+'" and "'+o.name+'"');if(a.activate(i)!==!0)throw new Error("Server sent unacceptable extension parameters: "+xc.serializeParams(r,i));this._reserve(o),t.push(s)},this),this._sessions=t,this._pipeline=new sR(t)},generateResponse:function(n){var e=[],t=[],r=xc.parseHeader(n);return this._inOrder.forEach(function(i){var s=r.byName(i.name);if(!(s.length===0||this._reserved(i))){var o=i.createServerSession(s);o&&(this._reserve(i),e.push([i,o]),t.push(xc.serializeParams(i.name,o.generateResponse())))}},this),this._sessions=e,this._pipeline=new sR(e),t.length>0?t.join(", "):null},validFrameRsv:function(n){var e={rsv1:!1,rsv2:!1,rsv3:!1},t;if(Vh.MESSAGE_OPCODES.indexOf(n.opcode)>=0)for(var r=0,i=this._sessions.length;r<i;r++)t=this._sessions[r][0],e.rsv1=e.rsv1||t.rsv1,e.rsv2=e.rsv2||t.rsv2,e.rsv3=e.rsv3||t.rsv3;return(e.rsv1||!n.rsv1)&&(e.rsv2||!n.rsv2)&&(e.rsv3||!n.rsv3)},processIncomingMessage:function(n,e,t){this._pipeline.processIncomingMessage(n,e,t)},processOutgoingMessage:function(n,e,t){this._pipeline.processOutgoingMessage(n,e,t)},close:function(n,e){if(!this._pipeline)return n.call(e);this._pipeline.close(n,e)},_reserve:function(n){this._rsv1=this._rsv1||n.rsv1&&n.name,this._rsv2=this._rsv2||n.rsv2&&n.name,this._rsv3=this._rsv3||n.rsv3&&n.name},_reserved:function(n){return this._rsv1&&n.rsv1?[1,this._rsv1]:this._rsv2&&n.rsv2?[2,this._rsv2]:this._rsv3&&n.rsv3?[3,this._rsv3]:!1}};for(m_ in oR)Vh.prototype[m_]=oR[m_];var m_;aR.exports=Vh});var hR=A((Zne,dR)=>{"use strict";var uR=function(){},cR={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(g_ in cR)uR.prototype[g_]=cR[g_];var g_;dR.exports=uR});var gR=A((ere,mR)=>{"use strict";var TU=_r().Buffer,pR=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},fR={read:function(){return this.data=this.data||TU.concat(this._chunks,this.length)},pushFrame:function(n){this.rsv1=this.rsv1||n.rsv1,this.rsv2=this.rsv2||n.rsv2,this.rsv3=this.rsv3||n.rsv3,this.opcode===null&&(this.opcode=n.opcode),this._chunks.push(n.payload),this.length+=n.length}};for(y_ in fR)pR.prototype[y_]=fR[y_];var y_;mR.exports=pR});var v_=A((tre,SR)=>{"use strict";var Pc=_r().Buffer,ER=Z("crypto"),IU=Z("util"),AU=lR(),Zs=ki(),yR=hR(),_R=gR(),un=function(n,e,t){if(Zs.apply(this,arguments),this._extensions=new AU,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},typeof this._protocols=="string"&&(this._protocols=this._protocols.split(/ *, */)),!!this._request){var r=this._request.headers["sec-websocket-protocol"],i=this._protocols;r!==void 0&&(typeof r=="string"&&(r=r.split(/ *, */)),this.protocol=r.filter(function(s){return i.indexOf(s)>=0})[0]),this.version="hybi-"+un.VERSION}};IU.inherits(un,Zs);un.VERSION="13";un.mask=function(n,e,t){if(!e||e.length===0)return n;t=t||0;for(var r=0,i=n.length-t;r<i;r++)n[t+r]=n[t+r]^e[r%4];return n};un.generateAccept=function(n){var e=ER.createHash("sha1");return e.update(n+un.GUID),e.digest("base64")};un.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var vR={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(n){return this._extensions.add(n),!0},parse:function(n){this._reader.put(n);for(var e=!0;e;)switch(this._stage){case 0:e=this._reader.read(1),e&&this._parseOpcode(e[0]);break;case 1:e=this._reader.read(1),e&&this._parseLength(e[0]);break;case 2:e=this._reader.read(this._frame.lengthBytes),e&&this._parseExtendedLength(e);break;case 3:e=this._reader.read(4),e&&(this._stage=4,this._frame.maskingKey=e);break;case 4:e=this._reader.read(this._frame.length),e&&(this._stage=0,this._emitFrame(e));break;default:e=null}},text:function(n){return this.readyState>1?!1:this.frame(n,"text")},binary:function(n){return this.readyState>1?!1:this.frame(n,"binary")},ping:function(n,e){return this.readyState>1?!1:(n=n||"",e&&(this._pingCallbacks[n]=e),this.frame(n,"ping"))},pong:function(n){return this.readyState>1?!1:(n=n||"",this.frame(n,"pong"))},close:function(n,e){return n=n||"",e=e||this.ERRORS.normal_closure,this.readyState<=0?(this.readyState=3,this.emit("close",new Zs.CloseEvent(e,n)),!0):this.readyState===1?(this.readyState=2,this._extensions.close(function(){this.frame(n,"close",e)},this),!0):!1},frame:function(n,e,t){if(this.readyState<=0)return this._queue([n,e,t]);if(this.readyState>2)return!1;n instanceof Array&&(n=Pc.from(n)),typeof n=="number"&&(n=n.toString());var r=new _R,i=typeof n=="string",s,o;r.rsv1=r.rsv2=r.rsv3=!1,r.opcode=this.OPCODES[e||(i?"text":"binary")],s=i?Pc.from(n,"utf8"):n,t&&(o=s,s=Pc.allocUnsafe(2+o.length),s.writeUInt16BE(t,0),o.copy(s,2)),r.data=s;var a=function(l){var c=new yR;c.final=!0,c.rsv1=l.rsv1,c.rsv2=l.rsv2,c.rsv3=l.rsv3,c.opcode=l.opcode,c.masked=!!this._masking,c.length=l.data.length,c.payload=l.data,c.masked&&(c.maskingKey=ER.randomBytes(4)),this._sendFrame(c)};return this.MESSAGE_OPCODES.indexOf(r.opcode)>=0?this._extensions.processOutgoingMessage(r,function(l,c){if(l)return this._fail("extension_error",l.message);a.call(this,c)},this):a.call(this,r),!0},_sendFrame:function(n){var e=n.length,t=e<=125?2:e<=65535?4:10,r=t+(n.masked?4:0),i=Pc.allocUnsafe(r+e),s=n.masked?this.MASK:0;i[0]=(n.final?this.FIN:0)|(n.rsv1?this.RSV1:0)|(n.rsv2?this.RSV2:0)|(n.rsv3?this.RSV3:0)|n.opcode,e<=125?i[1]=s|e:e<=65535?(i[1]=s|126,i.writeUInt16BE(e,2)):(i[1]=s|127,i.writeUInt32BE(Math.floor(e/4294967296),2),i.writeUInt32BE(e%4294967296,6)),n.payload.copy(i,r),n.masked&&(n.maskingKey.copy(i,t),un.mask(i,n.maskingKey,r)),this._write(i)},_handshakeResponse:function(){var n=this._request.headers["sec-websocket-key"],e=this._request.headers["sec-websocket-version"];if(e!==un.VERSION)throw new Error("Unsupported WebSocket version: "+e);if(typeof n!="string")throw new Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",un.generateAccept(n)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var t=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);t&&this._headers.set("Sec-WebSocket-Extensions",t);var r="HTTP/1.1 101 Switching Protocols",i=[r,this._headers.toString(),""];return Pc.from(i.join(`\r
`),"utf8")},_shutdown:function(n,e,t){delete this._frame,delete this._message,this._stage=5;var r=this.readyState===1;this.readyState=2,this._extensions.close(function(){r&&this.frame(e,"close",n),this.readyState=3,t&&this.emit("error",new Error(e)),this.emit("close",new Zs.CloseEvent(n,e))},this)},_fail:function(n,e){this.readyState>1||this._shutdown(this.ERRORS[n],e,!0)},_parseOpcode:function(n){var e=[this.RSV1,this.RSV2,this.RSV3].map(function(r){return(n&r)===r}),t=this._frame=new yR;if(t.final=(n&this.FIN)===this.FIN,t.rsv1=e[0],t.rsv2=e[1],t.rsv3=e[2],t.opcode=n&this.OPCODE,this._stage=1,!this._extensions.validFrameRsv(t))return this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(t.rsv1?1:0)+", reserved2 = "+(t.rsv2?1:0)+", reserved3 = "+(t.rsv3?1:0));if(this.OPCODE_CODES.indexOf(t.opcode)<0)return this._fail("protocol_error","Unrecognized frame opcode: "+t.opcode);if(this.MESSAGE_OPCODES.indexOf(t.opcode)<0&&!t.final)return this._fail("protocol_error","Received fragmented control frame: opcode = "+t.opcode);if(this._message&&this.OPENING_OPCODES.indexOf(t.opcode)>=0)return this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished")},_parseLength:function(n){var e=this._frame;if(e.masked=(n&this.MASK)===this.MASK,e.length=n&this.LENGTH,e.length>=0&&e.length<=125){if(this._stage=e.masked?3:4,!this._checkFrameLength())return}else this._stage=2,e.lengthBytes=e.length===126?2:8;if(this._requireMasking&&!e.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(n){var e=this._frame;if(e.length=this._readUInt(n),this._stage=e.masked?3:4,this.MESSAGE_OPCODES.indexOf(e.opcode)<0&&e.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+e.length);this._checkFrameLength()},_checkFrameLength:function(){var n=this._message?this._message.length:0;return n+this._frame.length>this._maxLength?(this._fail("too_large","WebSocket frame length too large"),!1):!0},_emitFrame:function(n){var e=this._frame,t=e.payload=un.mask(n,e.maskingKey),r=e.opcode,i,s,o,a,l;if(delete this._frame,r===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(e)}if((r===this.OPCODES.text||r===this.OPCODES.binary)&&(this._message=new _R,this._message.pushFrame(e)),e.final&&this.MESSAGE_OPCODES.indexOf(r)>=0)return this._emitMessage(this._message);r===this.OPCODES.close&&(s=t.length>=2?t.readUInt16BE(0):null,o=t.length>2?this._encode(t.slice(2)):null,t.length!==0&&!(s!==null&&s>=this.MIN_RESERVED_ERROR&&s<=this.MAX_RESERVED_ERROR)&&this.ERROR_CODES.indexOf(s)<0&&(s=this.ERRORS.protocol_error),(t.length>125||t.length>2&&!o)&&(s=this.ERRORS.protocol_error),this._shutdown(s||this.DEFAULT_ERROR_CODE,o||"")),r===this.OPCODES.ping&&(this.frame(t,"pong"),this.emit("ping",new Zs.PingEvent(t.toString()))),r===this.OPCODES.pong&&(a=this._pingCallbacks,i=this._encode(t),l=a[i],delete a[i],l&&l(),this.emit("pong",new Zs.PongEvent(t.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(t,r){if(t)return this._fail("extension_error",t.message);var i=r.data;if(r.opcode===this.OPCODES.text&&(i=this._encode(i)),i===null)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new Zs.MessageEvent(i))},this)},_encode:function(n){try{var e=n.toString("binary",0,n.length);if(!this.UTF8_MATCH.test(e))return null}catch{}return n.toString("utf8",0,n.length)},_readUInt:function(n){return n.length===2?n.readUInt16BE(0):n.readUInt32BE(0)*4294967296+n.readUInt32BE(4)}};for(__ in vR)un.prototype[__]=vR[__];var __;SR.exports=un});var IR=A((nre,TR)=>{"use strict";var bR=_r().Buffer,DU=Z("stream").Stream,CR=Z("url"),RU=Z("util"),kU=ki(),NU=Oh(),OU=Bh(),xU={"ws:":80,"wss:":443},S_=function(n,e,t){this._client=n,this._http=new OU("response"),this._origin=typeof n.url=="object"?n.url:CR.parse(n.url),this._url=typeof e=="object"?e:CR.parse(e),this._options=t||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new NU,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var r=this._url.auth&&bR.from(this._url.auth,"utf8").toString("base64");r&&this._headers.set("Proxy-Authorization","Basic "+r)};RU.inherits(S_,DU);var wR={setHeader:function(n,e){return this._state!==0?!1:(this._headers.set(n,e),!0)},start:function(){if(this._state!==0)return!1;this._state=1;var n=this._origin,e=n.port||xU[n.protocol],t="CONNECT "+n.hostname+":"+e+" HTTP/1.1",r=[t,this._headers.toString(),""];return this.emit("data",bR.from(r.join(`\r
`),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(n){if(!this.writable)return!1;if(this._http.parse(n),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this.statusCode===200)this.emit("connect",new kU.ConnectEvent);else{var e="Can't establish a connection to the server at "+this._origin.href;this.emit("error",new Error(e))}return this.end(),!this._paused},end:function(n){this.writable&&(n!==void 0&&this.write(n),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(E_ in wR)S_.prototype[E_]=wR[E_];var E_;TR.exports=S_});var kR=A((rre,RR)=>{"use strict";var DR=_r().Buffer,PU=Z("crypto"),MU=Z("url"),FU=Z("util"),LU=Bh(),BU=ki(),ca=v_(),VU=IR(),Mc=function(n,e){this.version="hybi-"+ca.VERSION,ca.call(this,null,n,e),this.readyState=-1,this._key=Mc.generateKey(),this._accept=ca.generateAccept(this._key),this._http=new LU("response");var t=MU.parse(this.url),r=t.auth&&DR.from(t.auth,"utf8").toString("base64");if(this.VALID_PROTOCOLS.indexOf(t.protocol)<0)throw new Error(this.url+" is not a valid WebSocket URL");this._pathname=(t.pathname||"/")+(t.search||""),this._headers.set("Host",t.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",ca.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),r&&this._headers.set("Authorization","Basic "+r)};FU.inherits(Mc,ca);Mc.generateKey=function(){return PU.randomBytes(16).toString("base64")};var AR={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(n,e){return new VU(this,n,e)},start:function(){return this.readyState!==-1?!1:(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(n){if(this.readyState!==3){if(this.readyState>0)return ca.prototype.parse.call(this,n);this._http.parse(n),this._http.isComplete()&&(this._validateHandshake(),this.readyState!==3&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var n=this._extensions.generateOffer();n&&this._headers.set("Sec-WebSocket-Extensions",n);var e="GET "+this._pathname+" HTTP/1.1",t=[e,this._headers.toString(),""];return DR.from(t.join(`\r
`),"utf8")},_failHandshake:function(n){n="Error during WebSocket handshake: "+n,this.readyState=3,this.emit("error",new Error(n)),this.emit("close",new BU.CloseEvent(this.ERRORS.protocol_error,n))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(this._http.statusCode!==101)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var n=this._http.headers,e=n.upgrade||"",t=n.connection||"",r=n["sec-websocket-accept"]||"",i=n["sec-websocket-protocol"]||"";if(e==="")return this._failHandshake("'Upgrade' header is missing");if(e.toLowerCase()!=="websocket")return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(t==="")return this._failHandshake("'Connection' header is missing");if(t.toLowerCase()!=="upgrade")return this._failHandshake("'Connection' header value is not 'Upgrade'");if(r!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,i!==""){if(this._protocols.indexOf(i)<0)return this._failHandshake("Sec-WebSocket-Protocol mismatch");this.protocol=i}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(s){return this._failHandshake(s.message)}}};for(C_ in AR)Mc.prototype[C_]=AR[C_];var C_;RR.exports=Mc});var T_=A((ire,OR)=>{"use strict";var Uh=_r().Buffer,qh=ki(),UU=Z("util"),b_=function(n,e,t){qh.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};UU.inherits(b_,qh);var NR={close:function(){return this.readyState===3?!1:(this.readyState=3,this.emit("close",new qh.CloseEvent(null,null)),!0)},parse:function(n){this.readyState>1||(this._reader.put(n),this._reader.eachByte(function(e){var t;switch(this._stage){case-1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(e&127)+128*this._length,this._closing&&this._length===0)return this.close();(e&128)!==128&&(this._length===0?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(e===255)this._stage=0,t=Uh.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new qh.MessageEvent(t));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close();break}},this))},frame:function(n){if(this.readyState===0)return this._queue([n]);if(this.readyState>1)return!1;typeof n!="string"&&(n=n.toString());var e=Uh.byteLength(n),t=Uh.allocUnsafe(e+2);return t[0]=0,t.write(n,1),t[t.length-1]=255,this._write(t),!0},_handshakeResponse:function(){var n="HTTP/1.1 101 Web Socket Protocol Handshake",e=[n,this._headers.toString(),""];return Uh.from(e.join(`\r
`),"utf8")},_parseLeadingByte:function(n){(n&128)===128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(w_ in NR)b_.prototype[w_]=NR[w_];var w_;OR.exports=b_});var LR=A((sre,FR)=>{"use strict";var Fc=_r().Buffer,qU=ki(),zh=T_(),zU=Z("crypto"),GU=Z("util"),xR=function(n){return parseInt((n.match(/[0-9]/g)||[]).join(""),10)},PR=function(n){return(n.match(/ /g)||[]).length},A_=function(n,e,t){zh.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};GU.inherits(A_,zh);var MR={BODY_SIZE:8,start:function(){return zh.prototype.start.call(this)?(this._started=!0,this._sendHandshakeBody(),!0):!1},close:function(){return this.readyState===3?!1:(this.readyState===1&&this._write(Fc.from([255,0])),this.readyState=3,this.emit("close",new qU.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var a=this._request.headers,n=a["sec-websocket-key1"],e=a["sec-websocket-key2"];if(!n)throw new Error("Missing required header: Sec-WebSocket-Key1");if(!e)throw new Error("Missing required header: Sec-WebSocket-Key2");var t=xR(n),r=PR(n),i=xR(e),s=PR(e);if(t%r!==0||i%s!==0)throw new Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[t/r,i/s];var o="HTTP/1.1 101 WebSocket Protocol Handshake",a=[o,this._headers.toString(),""];return Fc.from(a.join(`\r
`),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var n=zU.createHash("md5"),e=Fc.allocUnsafe(8+this.BODY_SIZE);return e.writeUInt32BE(this._keyValues[0],0),e.writeUInt32BE(this._keyValues[1],4),Fc.from(this._body).copy(e,8,0,this.BODY_SIZE),n.update(e),Fc.from(n.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var n=this._handshakeSignature();n&&(this._write(n),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(n){if(n!==255)return zh.prototype._parseLeadingByte.call(this,n);this._closing=!0,this._length=0,this._stage=1}};for(I_ in MR)A_.prototype[I_]=MR[I_];var I_;FR.exports=A_});var VR=A((ore,BR)=>{"use strict";var WU=Z("util"),jU=Bh(),k_=ki(),$U=T_(),HU=LR(),KU=v_(),eo=function(n){k_.call(this,null,null,n),this._http=new jU("request")};WU.inherits(eo,k_);var R_={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(n){if(this._delegate)return this._delegate.parse(n);if(this._http.parse(n),!!this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var e=this;this._delegate=eo.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(t){this._delegate.on(t,function(r){e.emit(t,r)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new k_.ConnectEvent)}},_open:function(){this.__queue.forEach(function(n){this._delegate[n[0]].apply(this._delegate,n[1])},this),this.__queue=[]}};["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(n){R_[n]=function(){return this._delegate?this._delegate[n].apply(this._delegate,arguments):(this.__queue.push([n,arguments]),!0)}});for(D_ in R_)eo.prototype[D_]=R_[D_];var D_;eo.isSecureRequest=function(n){if(n.connection&&n.connection.authorized!==void 0||n.socket&&n.socket.secure)return!0;var e=n.headers;return e?e.https==="on"||e["x-forwarded-ssl"]==="on"||e["x-forwarded-scheme"]==="https"||e["x-forwarded-proto"]==="https":!1};eo.determineUrl=function(n){var e=this.isSecureRequest(n)?"wss:":"ws:";return e+"//"+n.headers.host+n.url};eo.http=function(n,e){e=e||{},e.requireMasking===void 0&&(e.requireMasking=!0);var t=n.headers,r=t["sec-websocket-version"],i=t["sec-websocket-key"],s=t["sec-websocket-key1"],o=t["sec-websocket-key2"],a=this.determineUrl(n);return r||i?new KU(n,a,e):s||o?new HU(n,a,e):new $U(n,a,e)};BR.exports=eo});var Lc=A((are,qR)=>{"use strict";var UR=ki(),QU=kR(),Gh=VR(),YU={client:function(n,e){return e=e||{},e.masking===void 0&&(e.masking=!0),new QU(n,e)},server:function(n){return n=n||{},n.requireMasking===void 0&&(n.requireMasking=!0),new Gh(n)},http:function(){return Gh.http.apply(Gh,arguments)},isSecureRequest:function(n){return Gh.isSecureRequest(n)},isWebSocket:function(n){return UR.isWebSocket(n)},validateOptions:function(n,e){UR.validateOptions(n,e)}};qR.exports=YU});var Bc=A((lre,zR)=>{"use strict";var to=function(n,e){this.type=n;for(var t in e)this[t]=e[t]};to.prototype.initEvent=function(n,e,t){this.type=n,this.bubbles=e,this.cancelable=t};to.prototype.stopPropagation=function(){};to.prototype.preventDefault=function(){};to.CAPTURING_PHASE=1;to.AT_TARGET=2;to.BUBBLING_PHASE=3;zR.exports=to});var N_=A((cre,GR)=>{"use strict";var XU=Bc(),JU={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(n,e,t){this.on(n,e)},removeEventListener:function(n,e,t){this.removeListener(n,e)},dispatchEvent:function(n){n.target=n.currentTarget=this,n.eventPhase=XU.AT_TARGET,this["on"+n.type]&&this["on"+n.type](n),this.emit(n.type,n)}};GR.exports=JU});var jh=A((ure,$R)=>{"use strict";var ZU=Z("stream").Stream,eq=Z("util"),tq=Lc(),WR=N_(),Wh=Bc(),Ue=function(n){n=n||{},tq.validateOptions(n,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var e=n.headers;if(e)for(var t in e)this._driver.setHeader(t,e[t]);var r=n.extensions;r&&[].concat(r).forEach(this._driver.addExtension,this._driver),this._ping=n.ping,this._pingId=0,this.readyState=Ue.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var i=this;this._driver.on("open",function(s){i._open()}),this._driver.on("message",function(s){i._receiveMessage(s.data)}),this._driver.on("close",function(s){i._beginClose(s.reason,s.code)}),this._driver.on("error",function(s){i._emitError(s.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i._pingId+=1,i.ping(i._pingId.toString())},this._ping*1e3)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};eq.inherits(Ue,ZU);Ue.CONNECTING=0;Ue.OPEN=1;Ue.CLOSING=2;Ue.CLOSED=3;Ue.CLOSE_TIMEOUT=3e4;var jR={write:function(n){return this.send(n)},end:function(n){n!==void 0&&this.send(n),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(n){return this.readyState>Ue.OPEN?!1:(n instanceof Buffer||(n=String(n)),this._driver.messages.write(n))},ping:function(n,e){return this.readyState>Ue.OPEN?!1:this._driver.ping(n,e)},close:function(n,e){if(n===void 0&&(n=1e3),e===void 0&&(e=""),n!==1e3&&(n<3e3||n>4999))throw new Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+n+" is neither.");if(this.readyState<Ue.CLOSING){var t=this;this._closeTimer=setTimeout(function(){t._beginClose("",1006)},Ue.CLOSE_TIMEOUT)}this.readyState!==Ue.CLOSED&&(this.readyState=Ue.CLOSING),this._driver.close(e,n)},_configureStream:function(){var n=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(e){this._stream.on(e,function(){n._finalizeClose()})},this),this._stream.on("error",function(e){n._emitError("Network error: "+n.url+": "+e.message),n._finalizeClose()})},_open:function(){if(this.readyState===Ue.CONNECTING){this.readyState=Ue.OPEN,this.protocol=this._driver.protocol||"";var n=new Wh("open");n.initEvent("open",!1,!1),this.dispatchEvent(n)}},_receiveMessage:function(n){if(this.readyState>Ue.OPEN)return!1;this.readable&&this.emit("data",n);var e=new Wh("message",{data:n});e.initEvent("message",!1,!1),this.dispatchEvent(e)},_emitError:function(n){if(!(this.readyState>=Ue.CLOSING)){var e=new Wh("error",{message:n});e.initEvent("error",!1,!1),this.dispatchEvent(e)}},_beginClose:function(n,e){this.readyState!==Ue.CLOSED&&(this.readyState=Ue.CLOSING,this._closeParams=[n,e],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==Ue.CLOSED){this.readyState=Ue.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var n=this._closeParams?this._closeParams[0]:"",e=this._closeParams?this._closeParams[1]:1006,t=new Wh("close",{code:e,reason:n});t.initEvent("close",!1,!1),this.dispatchEvent(t)}}};for(O_ in jR)Ue.prototype[O_]=jR[O_];var O_;for(x_ in WR)Ue.prototype[x_]=WR[x_];var x_;$R.exports=Ue});var JR=A((hre,XR)=>{"use strict";var nq=Z("util"),rq=Z("net"),HR=Z("tls"),KR=Z("url"),iq=Lc(),QR=jh(),dre=Bc(),sq={"http:":80,"https:":443,"ws:":80,"wss:":443},YR=["https:","wss:"],$h=function(n,e,t){t=t||{},this.url=n,this._driver=iq.client(this.url,{maxLength:t.maxLength,protocols:e}),["open","error"].forEach(function(h){this._driver.on(h,function(){d.headers=d._driver.headers,d.statusCode=d._driver.statusCode})},this);var r=t.proxy||{},i=KR.parse(r.origin||this.url),s=i.port||sq[i.protocol],o=YR.indexOf(i.protocol)>=0,a=function(){d._onConnect()},l=t.net||{},c=t.tls||{},u=r.origin?r.tls||{}:c,d=this;l.host=u.host=i.hostname,l.port=u.port=s,c.ca=c.ca||t.ca,u.servername=u.servername||i.hostname,this._stream=o?HR.connect(u,a):rq.connect(l,a),r.origin&&this._configureProxy(r,c),QR.call(this,t)};nq.inherits($h,QR);$h.prototype._onConnect=function(){var n=this._proxy||this._driver;n.start()};$h.prototype._configureProxy=function(n,e){var t=KR.parse(this.url),r=YR.indexOf(t.protocol)>=0,i=this,s;if(this._proxy=this._driver.proxy(n.origin),n.headers)for(s in n.headers)this._proxy.setHeader(s,n.headers[s]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(r){var o={socket:i._stream,servername:t.hostname};for(s in e)o[s]=e[s];i._stream=HR.connect(o),i._configureStream()}i._driver.io.pipe(i._stream),i._stream.pipe(i._driver.io),i._driver.start()}),this._proxy.on("error",function(o){i._driver.emit("error",o)})};XR.exports=$h});var rk=A((fre,nk)=>{"use strict";var oq=Z("stream").Stream,aq=Z("util"),lq=Lc(),cq=Oh(),ua=jh(),ZR=N_(),ek=Bc(),Vc=function(n,e,t){this.writable=!0,t=t||{},this._stream=e.socket,this._ping=t.ping||this.DEFAULT_PING,this._retry=t.retry||this.DEFAULT_RETRY;var r=lq.isSecureRequest(n)?"https:":"http:";this.url=r+"//"+n.headers.host+n.url,this.lastEventId=n.headers["last-event-id"]||"",this.readyState=ua.CONNECTING;var i=new cq,s=this;if(t.headers)for(var o in t.headers)i.set(o,t.headers[o]);if(!(!this._stream||!this._stream.writable)){process.nextTick(function(){s._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var a=`HTTP/1.1 200 OK\r
Content-Type: text/event-stream\r
Cache-Control: no-cache, no-store\r
Connection: close\r
`+i.toString()+`\r
retry: `+Math.floor(this._retry*1e3)+`\r
\r
`;this._write(a),this._stream.on("drain",function(){s.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){s.ping()},this._ping*1e3)),["error","end"].forEach(function(l){s._stream.on(l,function(){s.close()})})}};aq.inherits(Vc,oq);Vc.isEventSource=function(n){if(n.method!=="GET")return!1;var e=(n.headers.accept||"").split(/\s*,\s*/);return e.indexOf("text/event-stream")>=0};var tk={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(n){if(!this.writable)return!1;try{return this._stream.write(n,"utf8")}catch{return!1}},_open:function(){if(this.readyState===ua.CONNECTING){this.readyState=ua.OPEN;var n=new ek("open");n.initEvent("open",!1,!1),this.dispatchEvent(n)}},write:function(n){return this.send(n)},end:function(n){n!==void 0&&this.write(n),this.close()},send:function(n,e){if(this.readyState>ua.OPEN)return!1;n=String(n).replace(/(\r\n|\r|\n)/g,"$1data: "),e=e||{};var t="";return e.event&&(t+="event: "+e.event+`\r
`),e.id&&(t+="id: "+e.id+`\r
`),t+="data: "+n+`\r
\r
`,this._write(t)},ping:function(){return this._write(`:\r
\r
`)},close:function(){if(this.readyState>ua.OPEN)return!1;this.readyState=ua.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var n=new ek("close");return n.initEvent("close",!1,!1),this.dispatchEvent(n),!0}};for(P_ in tk)Vc.prototype[P_]=tk[P_];var P_;for(M_ in ZR)Vc.prototype[M_]=ZR[M_];var M_;nk.exports=Vc});var ok=A((pre,sk)=>{"use strict";var uq=Z("util"),F_=Lc(),ik=jh(),Ni=function(n,e,t,r,i){i=i||{},this._stream=e,this._driver=F_.http(n,{maxLength:i.maxLength,protocols:r});var s=this;if(!(!this._stream||!this._stream.writable)){if(!this._stream.readable)return this._stream.end();var o=function(){s._stream.removeListener("data",o)};this._stream.on("data",o),ik.call(this,i),process.nextTick(function(){s._driver.start(),s._driver.io.write(t)})}};uq.inherits(Ni,ik);Ni.isWebSocket=function(n){return F_.isWebSocket(n)};Ni.validateOptions=function(n,e){F_.validateOptions(n,e)};Ni.WebSocket=Ni;Ni.Client=JR();Ni.EventSource=rk();sk.exports=Ni});var Te=A(Dn=>{"use strict";Object.defineProperty(Dn,"__esModule",{value:!0});Dn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=Dn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=Dn.Propagate=Dn.LogVerbosity=Dn.Status=void 0;var KN=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(KN||(Dn.Status=KN={})),QN=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(QN||(Dn.LogVerbosity=QN={})),YN=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(YN||(Dn.Propagate=YN={}));Dn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;Dn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var oS=A((pse,tG)=>{tG.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Je=A(Kt=>{"use strict";var aS,lS,cS,uS;Object.defineProperty(Kt,"__esModule",{value:!0});Kt.isTracerEnabled=Kt.trace=Kt.log=Kt.setLoggerVerbosity=Kt.setLogger=Kt.getLogger=void 0;var zi=Te(),nG=Z("process"),rG=oS().version,iG={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},fo=iG,Oa=zi.LogVerbosity.ERROR,sG=(lS=(aS=process.env.GRPC_NODE_VERBOSITY)!==null&&aS!==void 0?aS:process.env.GRPC_VERBOSITY)!==null&&lS!==void 0?lS:"";switch(sG.toUpperCase()){case"DEBUG":Oa=zi.LogVerbosity.DEBUG;break;case"INFO":Oa=zi.LogVerbosity.INFO;break;case"ERROR":Oa=zi.LogVerbosity.ERROR;break;case"NONE":Oa=zi.LogVerbosity.NONE;break;default:}var oG=()=>fo;Kt.getLogger=oG;var aG=n=>{fo=n};Kt.setLogger=aG;var lG=n=>{Oa=n};Kt.setLoggerVerbosity=lG;var cG=(n,...e)=>{let t;if(n>=Oa){switch(n){case zi.LogVerbosity.DEBUG:t=fo.debug;break;case zi.LogVerbosity.INFO:t=fo.info;break;case zi.LogVerbosity.ERROR:t=fo.error;break}t||(t=fo.error),t&&t.bind(fo)(...e)}};Kt.log=cG;var uG=(uS=(cS=process.env.GRPC_NODE_TRACE)!==null&&cS!==void 0?cS:process.env.GRPC_TRACE)!==null&&uS!==void 0?uS:"",dS=new Set,XN=new Set;for(let n of uG.split(","))n.startsWith("-")?XN.add(n.substring(1)):dS.add(n);var dG=dS.has("all");function hG(n,e,t){JN(e)&&(0,Kt.log)(n,new Date().toISOString()+" | v"+rG+" "+nG.pid+" | "+e+" | "+t)}Kt.trace=hG;function JN(n){return!XN.has(n)&&(dG||dS.has(n))}Kt.isTracerEnabled=JN});var tp=A(xa=>{"use strict";Object.defineProperty(xa,"__esModule",{value:!0});xa.getErrorCode=xa.getErrorMessage=void 0;function fG(n){return n instanceof Error?n.message:String(n)}xa.getErrorMessage=fG;function pG(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}xa.getErrorCode=pG});var nn=A(rp=>{"use strict";Object.defineProperty(rp,"__esModule",{value:!0});rp.Metadata=void 0;var mG=Je(),gG=Te(),yG=tp(),_G=/^[0-9a-z_.-]+$/,vG=/^[ -~]*$/;function EG(n){return _G.test(n)}function SG(n){return vG.test(n)}function eO(n){return n.endsWith("-bin")}function CG(n){return!n.startsWith("grpc-")}function np(n){return n.toLowerCase()}function ZN(n,e){if(!EG(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(eO(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!SG(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var hS=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=np(e),ZN(e,t),this.internalRepr.set(e,[t])}add(e,t){e=np(e),ZN(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=np(e),this.internalRepr.delete(e)}get(e){return e=np(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(wG);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{eO(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(CG(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,yG.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,mG.log)(gG.LogVerbosity.ERROR,o)}}return t}};rp.Metadata=hS;var wG=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var yS=A(ip=>{"use strict";Object.defineProperty(ip,"__esModule",{value:!0});ip.CallCredentials=void 0;var gS=nn();function bG(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var Pa=class n{static createFromMetadataGenerator(e){return new pS(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;bG(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new gS.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new mS}};ip.CallCredentials=Pa;var fS=class n extends Pa{constructor(e){super(),this.creds=e}generateMetadata(e){return b(this,null,function*(){let t=new gS.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},pS=class n extends Pa{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new fS([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},mS=class n extends Pa{generateMetadata(e){return Promise.resolve(new gS.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var vS=A(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});Ma.getDefaultRootsData=Ma.CIPHER_SUITES=void 0;var TG=Z("fs");Ma.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var tO=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,_S=null;function IG(){return tO?(_S===null&&(_S=TG.readFileSync(tO)),_S):null}Ma.getDefaultRootsData=IG});var ap=A(op=>{"use strict";Object.defineProperty(op,"__esModule",{value:!0});op.ChannelCredentials=void 0;var AG=Z("tls"),DG=yS(),nO=vS();function ES(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Fa=class{constructor(e){this.callCredentials=e||DG.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(ES(e,"Root certificate"),ES(t,"Private key"),ES(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,AG.createSecureContext)({ca:(s=e??(0,nO.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:nO.CIPHER_SUITES});return new sp(o,i??{})}static createFromSecureContext(e,t){return new sp(e,t??{})}static createInsecure(){return new SS}};op.ChannelCredentials=Fa;var SS=class n extends Fa{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},sp=class n extends Fa{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new CS(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},CS=class n extends Fa{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Wi=A(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.validateLoadBalancingConfig=Pt.getFirstUsableConfig=Pt.isLoadBalancerNameRegistered=Pt.createLoadBalancer=Pt.registerDefaultLoadBalancerType=Pt.registerLoadBalancerType=Pt.createChildChannelControlHelper=void 0;function RG(n,e){var t,r,i,s,o,a,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}Pt.createChildChannelControlHelper=RG;var Gi={},wS=null;function kG(n,e,t){Gi[n]={LoadBalancer:e,LoadBalancingConfig:t}}Pt.registerLoadBalancerType=kG;function NG(n){wS=n}Pt.registerDefaultLoadBalancerType=NG;function OG(n,e){let t=n.getLoadBalancerName();return t in Gi?new Gi[t].LoadBalancer(e):null}Pt.createLoadBalancer=OG;function xG(n){return n in Gi}Pt.isLoadBalancerNameRegistered=xG;function PG(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Gi)return t;return e&&wS?new Gi[wS].LoadBalancingConfig:null}Pt.getFirstUsableConfig=PG;function MG(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Gi)return Gi[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}Pt.validateLoadBalancingConfig=MG});var bS=A(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.extractAndSelectServiceConfig=ji.validateServiceConfig=ji.validateRetryThrottling=void 0;var FG=Z("os"),lp=Te(),LG=Wi(),cp=/^\d+(\.\d{1,9})?s$/,BG="node";function VG(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function UG(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!cp.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!cp.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(lp.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(lp.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function qG(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!cp.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(lp.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(lp.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function zG(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(VG(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&cp.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=UG(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=qG(n.hedgingPolicy));return t}function rO(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}ji.validateRetryThrottling=rO;function iO(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,LG.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(zG(r));"retryThrottling"in n&&(e.retryThrottling=rO(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}ji.validateServiceConfig=iO;function GG(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:iO(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function WG(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=GG(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===FG.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===BG&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function jG(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return WG(i,e)}return null}ji.extractAndSelectServiceConfig=jG});var Rn=A(up=>{"use strict";Object.defineProperty(up,"__esModule",{value:!0});up.ConnectivityState=void 0;var sO=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(sO||(up.ConnectivityState=sO={}))});var gn=A($i=>{"use strict";Object.defineProperty($i,"__esModule",{value:!0});$i.uriToString=$i.splitHostPort=$i.parseUri=void 0;var $G=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function HG(n){let e=$G.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}$i.parseUri=HG;var oO=/^\d+$/;function KG(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return oO.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?oO.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}$i.splitHostPort=KG;function QG(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}$i.uriToString=QG});var br=A(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.mapUriDefaultScheme=kn.getDefaultAuthority=kn.createResolver=kn.registerDefaultScheme=kn.registerResolver=void 0;var IS=gn(),La={},TS=null;function YG(n,e){La[n]=e}kn.registerResolver=YG;function XG(n){TS=n}kn.registerDefaultScheme=XG;function JG(n,e,t){if(n.scheme!==void 0&&n.scheme in La)return new La[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,IS.uriToString)(n)}`)}kn.createResolver=JG;function ZG(n){if(n.scheme!==void 0&&n.scheme in La)return La[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,IS.uriToString)(n)}`)}kn.getDefaultAuthority=ZG;function eW(n){return n.scheme===void 0||!(n.scheme in La)?TS!==null?{scheme:TS,authority:void 0,path:(0,IS.uriToString)(n)}:null:n}kn.mapUriDefaultScheme=eW});var Ki=A(Hi=>{"use strict";Object.defineProperty(Hi,"__esModule",{value:!0});Hi.QueuePicker=Hi.UnavailablePicker=Hi.PickResultType=void 0;var tW=nn(),nW=Te(),dp=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(dp||(Hi.PickResultType=dp={})),AS=class{constructor(e){this.status=Object.assign({code:nW.Status.UNAVAILABLE,details:"No connection established",metadata:new tW.Metadata},e)}pick(e){return{pickResultType:dp.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Hi.UnavailablePicker=AS;var DS=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:dp.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Hi.QueuePicker=DS});var Iu=A(hp=>{"use strict";Object.defineProperty(hp,"__esModule",{value:!0});hp.BackoffTimeout=void 0;var rW=1e3,iW=1.6,sW=12e4,oW=.2;function aW(n,e){return Math.random()*(e-n)+n}var RS=class{constructor(e,t){this.callback=e,this.initialDelay=rW,this.multiplier=iW,this.maxDelay=sW,this.jitter=oW,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+aW(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};hp.BackoffTimeout=RS});var pp=A(fp=>{"use strict";Object.defineProperty(fp,"__esModule",{value:!0});fp.ChildLoadBalancerHandler=void 0;var lW=Wi(),cW=Rn(),uW="child_load_balancer_helper",kS=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===cW.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,lW.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return uW}};fp.ChildLoadBalancerHandler=kS});var lO=A(mp=>{"use strict";Object.defineProperty(mp,"__esModule",{value:!0});mp.ResolvingLoadBalancer=void 0;var dW=Wi(),hW=bS(),rn=Rn(),fW=br(),Ba=Ki(),pW=Iu(),NS=Te(),mW=nn(),gW=Je(),yW=Te(),_W=gn(),vW=pp(),EW="resolving_load_balancer";function aO(n){gW.trace(yW.LogVerbosity.DEBUG,EW,n)}var SW=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function CW(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function wW(n,e,t,r){for(let i of t)if(CW(n,e,i,r))return i;return null}function bW(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of SW){let u=wW(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:NS.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:NS.Status.OK,dynamicFilterFactories:[]}}}var OS=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=rn.ConnectivityState.IDLE,this.latestChildPicker=new Ba.QueuePicker(this),this.currentState=rn.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,hW.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(rn.ConnectivityState.IDLE,new Ba.QueuePicker(this)),this.childLoadBalancer=new vW.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(aO("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,fW.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var h;this.backoffTimeout.stop(),this.backoffTimeout.reset();let p=null;l===null?c===null?(this.previousServiceConfig=null,p=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):p=this.previousServiceConfig:(p=l,this.previousServiceConfig=l);let E=(h=p?.loadBalancingConfig)!==null&&h!==void 0?h:[],w=(0,dW.getFirstUsableConfig)(E,!0);if(w===null){this.handleResolutionFailure({code:NS.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new mW.Metadata});return}this.childLoadBalancer.updateAddressList(a,w,d);let T=p??this.defaultServiceConfig;this.onSuccessfulResolution(T,u??bW(T))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new pW.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===rn.ConnectivityState.IDLE&&this.updateState(rn.ConnectivityState.CONNECTING,new Ba.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){aO((0,_W.uriToString)(this.target)+" "+rn.ConnectivityState[this.currentState]+" -> "+rn.ConnectivityState[e]),e===rn.ConnectivityState.IDLE&&(t=new Ba.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===rn.ConnectivityState.IDLE&&(this.updateState(rn.ConnectivityState.TRANSIENT_FAILURE,new Ba.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===rn.ConnectivityState.IDLE||this.currentState===rn.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=rn.ConnectivityState.IDLE,this.latestChildPicker=new Ba.QueuePicker(this),this.currentState=rn.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};mp.ResolvingLoadBalancer=OS});var cO=A(Va=>{"use strict";Object.defineProperty(Va,"__esModule",{value:!0});Va.channelOptionsEqual=Va.recognizedOptions=void 0;Va.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function TW(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}Va.channelOptionsEqual=TW});var Ir=A(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.stringToSubchannelAddress=Tr.subchannelAddressToString=Tr.subchannelAddressEqual=Tr.isTcpSubchannelAddress=void 0;var IW=Z("net");function Au(n){return"port"in n}Tr.isTcpSubchannelAddress=Au;function AW(n,e){return!n&&!e?!0:!n||!e?!1:Au(n)?Au(e)&&n.host===e.host&&n.port===e.port:!Au(e)&&n.path===e.path}Tr.subchannelAddressEqual=AW;function DW(n){return Au(n)?n.host+":"+n.port:n.path}Tr.subchannelAddressToString=DW;var RW=443;function kW(n,e){return(0,IW.isIP)(n)?{host:n,port:e??RW}:{path:n}}Tr.stringToSubchannelAddress=kW});var gp=A(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});Ua.addAdminServicesToServer=Ua.registerAdminService=void 0;var uO=[];function NW(n,e){uO.push({getServiceDefinition:n,getHandlers:e})}Ua.registerAdminService=NW;function OW(n){for(let{getServiceDefinition:e,getHandlers:t}of uO)n.addService(e(),t())}Ua.addAdminServicesToServer=OW});var dO=A(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.ClientDuplexStreamImpl=Nn.ClientWritableStreamImpl=Nn.ClientReadableStreamImpl=Nn.ClientUnaryCallImpl=Nn.callErrorFromStatus=void 0;var xW=Z("events"),LS=Z("stream"),Du=Te();function PW(n,e){let t=`${n.code} ${Du.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}Nn.callErrorFromStatus=PW;var xS=class extends xW.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Du.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};Nn.ClientUnaryCallImpl=xS;var PS=class extends LS.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Du.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};Nn.ClientReadableStreamImpl=PS;var MS=class extends LS.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Du.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Nn.ClientWritableStreamImpl=MS;var FS=class extends LS.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Du.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Nn.ClientDuplexStreamImpl=FS});var hO=A(qa=>{"use strict";Object.defineProperty(qa,"__esModule",{value:!0});qa.InterceptingListenerImpl=qa.isInterceptingListener=void 0;function MW(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}qa.isInterceptingListener=MW;var BS=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};qa.InterceptingListenerImpl=BS});var jS=A(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.getInterceptingCall=On.InterceptingCall=On.RequesterBuilder=On.ListenerBuilder=On.InterceptorConfigurationError=void 0;var FW=nn(),fO=hO(),pO=Te(),mO=tp(),ku=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};On.InterceptorConfigurationError=ku;var US=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};On.ListenerBuilder=US;var qS=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};On.RequesterBuilder=qS;var VS={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Ru={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},zS=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:Ru.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:Ru.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Ru.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:Ru.cancel}:this.requester=Ru}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var h,p,E;this.processingMetadata=!1;let w;if((0,fO.isInterceptingListener)(d))w=d;else{let T={onReceiveMetadata:(h=d.onReceiveMetadata)!==null&&h!==void 0?h:VS.onReceiveMetadata,onReceiveMessage:(p=d.onReceiveMessage)!==null&&p!==void 0?p:VS.onReceiveMessage,onReceiveStatus:(E=d.onReceiveStatus)!==null&&E!==void 0?E:VS.onReceiveStatus};w=new fO.InterceptingListenerImpl(T,c)}this.nextCall.start(u,w),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};On.InterceptingCall=zS;function LW(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var yp=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(pO.Status.INTERNAL,`Request message serialization failure: ${(0,mO.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:pO.Status.INTERNAL,details:`Response message parsing error: ${(0,mO.getErrorMessage)(a)}`,metadata:new FW.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},GS=class extends yp{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},WS=class extends yp{};function BW(n,e,t){let r=LW(n,t.path,e);return t.responseStream?new WS(r,t):new GS(r,t)}function VW(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new ku("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new ku("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>BW(r,a,e))(s)}On.getInterceptingCall=VW});var KS=A(vp=>{"use strict";Object.defineProperty(vp,"__esModule",{value:!0});vp.Client=void 0;var Ar=dO(),UW=QS(),qW=Rn(),Qi=Te(),za=nn(),_p=jS(),Qn=Symbol(),Ga=Symbol(),Wa=Symbol(),ri=Symbol();function $S(n){return typeof n=="function"}function ja(n){return n.stack.split(`
`).slice(1).join(`
`)}var HS=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[Ga]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[Wa]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[Ga].length>0&&this[Wa].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[ri]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[Qn]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[Qn]=o(e,t,r)}else this[Qn]=new UW.ChannelImplementation(e,t,r)}close(){this[Qn].close()}getChannel(){return this[Qn]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Qn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===qW.ConnectivityState.READY)t();else try{this[Qn].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if($S(e))return{metadata:new za.Metadata,options:{},callback:e};if($S(t))return e instanceof za.Metadata?{metadata:e,options:{},callback:t}:{metadata:new za.Metadata,options:e,callback:t};if(!(e instanceof za.Metadata&&t instanceof Object&&$S(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},h={argument:i,metadata:u.metadata,call:new Ar.ClientUnaryCallImpl,channel:this[Qn],methodDefinition:d,callOptions:u.options,callback:u.callback};this[ri]&&(h=this[ri](h));let p=h.call,E={clientInterceptors:this[Ga],clientInterceptorProviders:this[Wa],callInterceptors:(l=h.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=h.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},w=(0,_p.getInterceptingCall)(E,h.methodDefinition,h.callOptions,h.channel);p.call=w;let T=null,k=!1,R=new Error;return w.start(h.metadata,{onReceiveMetadata:O=>{p.emit("metadata",O)},onReceiveMessage(O){T!==null&&w.cancelWithStatus(Qi.Status.INTERNAL,"Too many responses received"),T=O},onReceiveStatus(O){if(!k){if(k=!0,O.code===Qi.Status.OK)if(T===null){let F=ja(R);h.callback((0,Ar.callErrorFromStatus)({code:Qi.Status.INTERNAL,details:"No message received",metadata:O.metadata},F))}else h.callback(null,T);else{let F=ja(R);h.callback((0,Ar.callErrorFromStatus)(O,F))}R=null,p.emit("status",O)}}}),w.sendMessage(i),w.halfClose(),p}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new Ar.ClientWritableStreamImpl(t),channel:this[Qn],methodDefinition:u,callOptions:c.options,callback:c.callback};this[ri]&&(d=this[ri](d));let h=d.call,p={clientInterceptors:this[Ga],clientInterceptorProviders:this[Wa],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},E=(0,_p.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);h.call=E;let w=null,T=!1,k=new Error;return E.start(d.metadata,{onReceiveMetadata:R=>{h.emit("metadata",R)},onReceiveMessage(R){w!==null&&E.cancelWithStatus(Qi.Status.INTERNAL,"Too many responses received"),w=R},onReceiveStatus(R){if(!T){if(T=!0,R.code===Qi.Status.OK)if(w===null){let O=ja(k);d.callback((0,Ar.callErrorFromStatus)({code:Qi.Status.INTERNAL,details:"No message received",metadata:R.metadata},O))}else d.callback(null,w);else{let O=ja(k);d.callback((0,Ar.callErrorFromStatus)(R,O))}k=null,h.emit("status",R)}}}),h}checkMetadataAndOptions(e,t){let r,i;return e instanceof za.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new za.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new Ar.ClientReadableStreamImpl(r),channel:this[Qn],methodDefinition:u,callOptions:c.options};this[ri]&&(d=this[ri](d));let h=d.call,p={clientInterceptors:this[Ga],clientInterceptorProviders:this[Wa],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},E=(0,_p.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);h.call=E;let w=!1,T=new Error;return E.start(d.metadata,{onReceiveMetadata(k){h.emit("metadata",k)},onReceiveMessage(k){h.push(k)},onReceiveStatus(k){if(!w){if(w=!0,h.push(null),k.code!==Qi.Status.OK){let R=ja(T);h.emit("error",(0,Ar.callErrorFromStatus)(k,R))}T=null,h.emit("status",k)}}}),E.sendMessage(i),E.halfClose(),h}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Ar.ClientDuplexStreamImpl(t,r),channel:this[Qn],methodDefinition:c,callOptions:l.options};this[ri]&&(u=this[ri](u));let d=u.call,h={clientInterceptors:this[Ga],clientInterceptorProviders:this[Wa],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},p=(0,_p.getInterceptingCall)(h,u.methodDefinition,u.callOptions,u.channel);d.call=p;let E=!1,w=new Error;return p.start(u.metadata,{onReceiveMetadata(T){d.emit("metadata",T)},onReceiveMessage(T){d.push(T)},onReceiveStatus(T){if(!E){if(E=!0,d.push(null),T.code!==Qi.Status.OK){let k=ja(w);d.emit("error",(0,Ar.callErrorFromStatus)(T,k))}w=null,d.emit("status",T)}}}),d}};vp.Client=HS});var XS=A($a=>{"use strict";Object.defineProperty($a,"__esModule",{value:!0});$a.loadPackageDefinition=$a.makeClientConstructor=void 0;var Nu=KS(),zW={unary:Nu.Client.prototype.makeUnaryRequest,server_stream:Nu.Client.prototype.makeServerStreamRequest,client_stream:Nu.Client.prototype.makeClientStreamRequest,bidi:Nu.Client.prototype.makeBidiStreamRequest};function YS(n){return["__proto__","prototype","constructor"].includes(n)}function gO(n,e,t){t||(t={});class r extends Nu.Client{}return Object.keys(n).forEach(i=>{if(YS(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=GW(zW[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!YS(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}$a.makeClientConstructor=gO;function GW(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function WW(n){return"format"in n}function jW(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>YS(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];WW(r)?o[s]=r:o[s]=gO(r,s,{})}return e}$a.loadPackageDefinition=jW});var qO=A((Use,UO)=>{"use strict";var $W=1/0,HW="[object Symbol]",KW=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,QW=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Sp="\\ud800-\\udfff",bO="\\u0300-\\u036f\\ufe20-\\ufe23",TO="\\u20d0-\\u20f0",IO="\\u2700-\\u27bf",AO="a-z\\xdf-\\xf6\\xf8-\\xff",YW="\\xac\\xb1\\xd7\\xf7",XW="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",JW="\\u2000-\\u206f",ZW=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",DO="A-Z\\xc0-\\xd6\\xd8-\\xde",RO="\\ufe0e\\ufe0f",kO=YW+XW+JW+ZW,ZS="['\u2019]",ej="["+Sp+"]",yO="["+kO+"]",Ep="["+bO+TO+"]",NO="\\d+",tj="["+IO+"]",OO="["+AO+"]",xO="[^"+Sp+kO+NO+IO+AO+DO+"]",JS="\\ud83c[\\udffb-\\udfff]",nj="(?:"+Ep+"|"+JS+")",PO="[^"+Sp+"]",eC="(?:\\ud83c[\\udde6-\\uddff]){2}",tC="[\\ud800-\\udbff][\\udc00-\\udfff]",Ha="["+DO+"]",MO="\\u200d",_O="(?:"+OO+"|"+xO+")",rj="(?:"+Ha+"|"+xO+")",vO="(?:"+ZS+"(?:d|ll|m|re|s|t|ve))?",EO="(?:"+ZS+"(?:D|LL|M|RE|S|T|VE))?",FO=nj+"?",LO="["+RO+"]?",ij="(?:"+MO+"(?:"+[PO,eC,tC].join("|")+")"+LO+FO+")*",BO=LO+FO+ij,sj="(?:"+[tj,eC,tC].join("|")+")"+BO,oj="(?:"+[PO+Ep+"?",Ep,eC,tC,ej].join("|")+")",aj=RegExp(ZS,"g"),lj=RegExp(Ep,"g"),cj=RegExp(JS+"(?="+JS+")|"+oj+BO,"g"),uj=RegExp([Ha+"?"+OO+"+"+vO+"(?="+[yO,Ha,"$"].join("|")+")",rj+"+"+EO+"(?="+[yO,Ha+_O,"$"].join("|")+")",Ha+"?"+_O+"+"+vO,Ha+"+"+EO,NO,sj].join("|"),"g"),dj=RegExp("["+MO+Sp+bO+TO+RO+"]"),hj=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,fj={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},pj=typeof global=="object"&&global&&global.Object===Object&&global,mj=typeof self=="object"&&self&&self.Object===Object&&self,gj=pj||mj||Function("return this")();function yj(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function _j(n){return n.split("")}function vj(n){return n.match(KW)||[]}function Ej(n){return function(e){return n?.[e]}}var Sj=Ej(fj);function VO(n){return dj.test(n)}function Cj(n){return hj.test(n)}function wj(n){return VO(n)?bj(n):_j(n)}function bj(n){return n.match(cj)||[]}function Tj(n){return n.match(uj)||[]}var Ij=Object.prototype,Aj=Ij.toString,SO=gj.Symbol,CO=SO?SO.prototype:void 0,wO=CO?CO.toString:void 0;function Dj(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function Rj(n){if(typeof n=="string")return n;if(Pj(n))return wO?wO.call(n):"";var e=n+"";return e=="0"&&1/n==-$W?"-0":e}function kj(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:Dj(n,e,t)}function Nj(n){return function(e){e=Cp(e);var t=VO(e)?wj(e):void 0,r=t?t[0]:e.charAt(0),i=t?kj(t,1).join(""):e.slice(1);return r[n]()+i}}function Oj(n){return function(e){return yj(Vj(Lj(e).replace(aj,"")),n,"")}}function xj(n){return!!n&&typeof n=="object"}function Pj(n){return typeof n=="symbol"||xj(n)&&Aj.call(n)==HW}function Cp(n){return n==null?"":Rj(n)}var Mj=Oj(function(n,e,t){return e=e.toLowerCase(),n+(t?Fj(e):e)});function Fj(n){return Bj(Cp(n).toLowerCase())}function Lj(n){return n=Cp(n),n&&n.replace(QW,Sj).replace(lj,"")}var Bj=Nj("toUpperCase");function Vj(n,e,t){return n=Cp(n),e=t?void 0:e,e===void 0?Cj(n)?Tj(n):vj(n):n.match(e)||[]}UO.exports=Mj});var nC=A((qse,zO)=>{"use strict";zO.exports=Uj;function Uj(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h++]=arguments[h];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var $O=A(jO=>{"use strict";var wp=jO;wp.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var Ka=new Array(64),WO=new Array(123);for(Yn=0;Yn<64;)WO[Ka[Yn]=Yn<26?Yn+65:Yn<52?Yn+71:Yn<62?Yn-4:Yn-59|43]=Yn++;var Yn;wp.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=Ka[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=Ka[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=Ka[l|c>>6],s[o++]=Ka[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=Ka[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var GO="invalid encoding";wp.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=WO[l])===void 0)throw Error(GO);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(GO);return r-i};wp.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var KO=A((Gse,HO)=>{"use strict";HO.exports=bp;function bp(){this._listeners={}}bp.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};bp.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};bp.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var tx=A((Wse,ex)=>{"use strict";ex.exports=QO(QO);function QO(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,YO),n.writeFloatBE=e.bind(null,XO);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,JO),n.readFloatBE=t.bind(null,ZO)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),r(u*4503599627370496>>>0,a,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,YO,0,4),n.writeDoubleBE=e.bind(null,XO,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,h=4294967296*(c&1048575)+l;return d===2047?h?NaN:u*(1/0):d===0?u*5e-324*h:u*Math.pow(2,d-1075)*(h+4503599627370496)}n.readDoubleLE=t.bind(null,JO,0,4),n.readDoubleBE=t.bind(null,ZO,4,0)}(),n}function YO(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function XO(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function JO(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function ZO(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var rC=A((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var rx=A(nx=>{"use strict";var iC=nx;iC.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};iC.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};iC.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var sx=A(($se,ix)=>{"use strict";ix.exports=qj;function qj(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var ax=A((Hse,ox)=>{"use strict";ox.exports=Tt;var Ou=Dr();function Tt(n,e){this.lo=n>>>0,this.hi=e>>>0}var po=Tt.zero=new Tt(0,0);po.toNumber=function(){return 0};po.zzEncode=po.zzDecode=function(){return this};po.length=function(){return 1};var zj=Tt.zeroHash="\0\0\0\0\0\0\0\0";Tt.fromNumber=function(e){if(e===0)return po;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new Tt(r,i)};Tt.from=function(e){if(typeof e=="number")return Tt.fromNumber(e);if(Ou.isString(e))if(Ou.Long)e=Ou.Long.fromString(e);else return Tt.fromNumber(parseInt(e,10));return e.low||e.high?new Tt(e.low>>>0,e.high>>>0):po};Tt.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};Tt.prototype.toLong=function(e){return Ou.Long?new Ou.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Yi=String.prototype.charCodeAt;Tt.fromHash=function(e){return e===zj?po:new Tt((Yi.call(e,0)|Yi.call(e,1)<<8|Yi.call(e,2)<<16|Yi.call(e,3)<<24)>>>0,(Yi.call(e,4)|Yi.call(e,5)<<8|Yi.call(e,6)<<16|Yi.call(e,7)<<24)>>>0)};Tt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Tt.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Tt.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Tt.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Dr=A(sC=>{"use strict";var Q=sC;Q.asPromise=nC();Q.base64=$O();Q.EventEmitter=KO();Q.float=tx();Q.inquire=rC();Q.utf8=rx();Q.pool=sx();Q.LongBits=ax();Q.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);Q.global=Q.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||sC;Q.emptyArray=Object.freeze?Object.freeze([]):[];Q.emptyObject=Object.freeze?Object.freeze({}):{};Q.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Q.isString=function(e){return typeof e=="string"||e instanceof String};Q.isObject=function(e){return e&&typeof e=="object"};Q.isset=Q.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};Q.Buffer=function(){try{var n=Q.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();Q._Buffer_from=null;Q._Buffer_allocUnsafe=null;Q.newBuffer=function(e){return typeof e=="number"?Q.Buffer?Q._Buffer_allocUnsafe(e):new Q.Array(e):Q.Buffer?Q._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Q.Array=typeof Uint8Array<"u"?Uint8Array:Array;Q.Long=Q.global.dcodeIO&&Q.global.dcodeIO.Long||Q.global.Long||Q.inquire("long");Q.key2Re=/^true|false|0|1$/;Q.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Q.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Q.longToHash=function(e){return e?Q.LongBits.from(e).toHash():Q.LongBits.zeroHash};Q.longFromHash=function(e,t){var r=Q.LongBits.fromHash(e);return Q.Long?Q.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function lx(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}Q.merge=lx;Q.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function cx(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&lx(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Q.newError=cx;Q.ProtocolError=cx("ProtocolError");Q.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Q.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};Q.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Q._configure=function(){var n=Q.Buffer;if(!n){Q._Buffer_from=Q._Buffer_allocUnsafe=null;return}Q._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},Q._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Ip=A((Qse,fx)=>{"use strict";fx.exports=Ee;var xn=Dr(),oC,Tp=xn.LongBits,ux=xn.base64,dx=xn.utf8;function xu(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function lC(){}function Gj(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function Ee(){this.len=0,this.head=new xu(lC,0,0),this.tail=this.head,this.states=null}var hx=function(){return xn.Buffer?function(){return(Ee.create=function(){return new oC})()}:function(){return new Ee}};Ee.create=hx();Ee.alloc=function(e){return new xn.Array(e)};xn.Array!==Array&&(Ee.alloc=xn.pool(Ee.alloc,xn.Array.prototype.subarray));Ee.prototype._push=function(e,t,r){return this.tail=this.tail.next=new xu(e,t,r),this.len+=t,this};function cC(n,e,t){e[t]=n&255}function Wj(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function uC(n,e){this.len=n,this.next=void 0,this.val=e}uC.prototype=Object.create(xu.prototype);uC.prototype.fn=Wj;Ee.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new uC((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Ee.prototype.int32=function(e){return e<0?this._push(dC,10,Tp.fromNumber(e)):this.uint32(e)};Ee.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function dC(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}Ee.prototype.uint64=function(e){var t=Tp.from(e);return this._push(dC,t.length(),t)};Ee.prototype.int64=Ee.prototype.uint64;Ee.prototype.sint64=function(e){var t=Tp.from(e).zzEncode();return this._push(dC,t.length(),t)};Ee.prototype.bool=function(e){return this._push(cC,1,e?1:0)};function aC(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}Ee.prototype.fixed32=function(e){return this._push(aC,4,e>>>0)};Ee.prototype.sfixed32=Ee.prototype.fixed32;Ee.prototype.fixed64=function(e){var t=Tp.from(e);return this._push(aC,4,t.lo)._push(aC,4,t.hi)};Ee.prototype.sfixed64=Ee.prototype.fixed64;Ee.prototype.float=function(e){return this._push(xn.float.writeFloatLE,4,e)};Ee.prototype.double=function(e){return this._push(xn.float.writeDoubleLE,8,e)};var jj=xn.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};Ee.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(cC,1,0);if(xn.isString(e)){var r=Ee.alloc(t=ux.length(e));ux.decode(e,r,0),e=r}return this.uint32(t)._push(jj,t,e)};Ee.prototype.string=function(e){var t=dx.length(e);return t?this.uint32(t)._push(dx.write,t,e):this._push(cC,1,0)};Ee.prototype.fork=function(){return this.states=new Gj(this),this.head=this.tail=new xu(lC,0,0),this.len=0,this};Ee.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new xu(lC,0,0),this.len=0),this};Ee.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};Ee.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};Ee._configure=function(n){oC=n,Ee.create=hx(),oC._configure()}});var gx=A((Yse,mx)=>{"use strict";mx.exports=Rr;var px=Ip();(Rr.prototype=Object.create(px.prototype)).constructor=Rr;var Xi=Dr();function Rr(){px.call(this)}Rr._configure=function(){Rr.alloc=Xi._Buffer_allocUnsafe,Rr.writeBytesBuffer=Xi.Buffer&&Xi.Buffer.prototype instanceof Uint8Array&&Xi.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Rr.prototype.bytes=function(e){Xi.isString(e)&&(e=Xi._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Rr.writeBytesBuffer,t,e),this};function $j(n,e,t){n.length<40?Xi.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Rr.prototype.string=function(e){var t=Xi.Buffer.byteLength(e);return this.uint32(t),t&&this._push($j,t,e),this};Rr._configure()});var Dp=A((Xse,Sx)=>{"use strict";Sx.exports=nt;var Xn=Dr(),fC,vx=Xn.LongBits,Hj=Xn.utf8;function Jn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function nt(n){this.buf=n,this.pos=0,this.len=n.length}var yx=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new nt(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new nt(e);throw Error("illegal buffer")},Ex=function(){return Xn.Buffer?function(t){return(nt.create=function(i){return Xn.Buffer.isBuffer(i)?new fC(i):yx(i)})(t)}:yx};nt.create=Ex();nt.prototype._slice=Xn.Array.prototype.subarray||Xn.Array.prototype.slice;nt.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Jn(this,10);return e}}();nt.prototype.int32=function(){return this.uint32()|0};nt.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function hC(){var n=new vx(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Jn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw Jn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}nt.prototype.bool=function(){return this.uint32()!==0};function Ap(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}nt.prototype.fixed32=function(){if(this.pos+4>this.len)throw Jn(this,4);return Ap(this.buf,this.pos+=4)};nt.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Jn(this,4);return Ap(this.buf,this.pos+=4)|0};function _x(){if(this.pos+8>this.len)throw Jn(this,8);return new vx(Ap(this.buf,this.pos+=4),Ap(this.buf,this.pos+=4))}nt.prototype.float=function(){if(this.pos+4>this.len)throw Jn(this,4);var e=Xn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};nt.prototype.double=function(){if(this.pos+8>this.len)throw Jn(this,4);var e=Xn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};nt.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw Jn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=Xn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};nt.prototype.string=function(){var e=this.bytes();return Hj.read(e,0,e.length)};nt.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Jn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Jn(this);while(this.buf[this.pos++]&128);return this};nt.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};nt._configure=function(n){fC=n,nt.create=Ex(),fC._configure();var e=Xn.Long?"toLong":"toNumber";Xn.merge(nt.prototype,{int64:function(){return hC.call(this)[e](!1)},uint64:function(){return hC.call(this)[e](!0)},sint64:function(){return hC.call(this).zzDecode()[e](!1)},fixed64:function(){return _x.call(this)[e](!0)},sfixed64:function(){return _x.call(this)[e](!1)}})}});var Tx=A((Jse,bx)=>{"use strict";bx.exports=mo;var wx=Dp();(mo.prototype=Object.create(wx.prototype)).constructor=mo;var Cx=Dr();function mo(n){wx.call(this,n)}mo._configure=function(){Cx.Buffer&&(mo.prototype._slice=Cx.Buffer.prototype.slice)};mo.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};mo._configure()});var Ax=A((Zse,Ix)=>{"use strict";Ix.exports=Pu;var pC=Dr();(Pu.prototype=Object.create(pC.EventEmitter.prototype)).constructor=Pu;function Pu(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");pC.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Pu.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return pC.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};Pu.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var mC=A(Dx=>{"use strict";var Kj=Dx;Kj.Service=Ax()});var gC=A((toe,Rx)=>{"use strict";Rx.exports={}});var Ox=A(Nx=>{"use strict";var sn=Nx;sn.build="minimal";sn.Writer=Ip();sn.BufferWriter=gx();sn.Reader=Dp();sn.BufferReader=Tx();sn.util=Dr();sn.rpc=mC();sn.roots=gC();sn.configure=kx;function kx(){sn.util._configure(),sn.Writer._configure(sn.BufferWriter),sn.Reader._configure(sn.BufferReader)}kx()});var Px=A((roe,xx)=>{"use strict";xx.exports=yC;function yC(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(yC.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h]=arguments[++h];if(h=0,s=s.replace(/%([%dfijs])/g,function(E,w){var T=d[h++];switch(w){case"d":case"f":return String(Number(T));case"i":return String(Math.floor(T));case"j":return JSON.stringify(T);case"s":return String(T)}return"%"}),h!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}yC.verbose=!1});var Fx=A((ioe,Mx)=>{"use strict";Mx.exports=Mu;var Qj=nC(),Yj=rC(),_C=Yj("fs");function Mu(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&_C&&_C.readFile?_C.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?Mu.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):Mu.xhr(n,e,t):Qj(Mu,this,n,e)}Mu.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var Vx=A(Bx=>{"use strict";var EC=Bx,Lx=EC.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},vC=EC.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=Lx(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};EC.resolve=function(e,t,r){return r||(t=vC(t)),Lx(t)?t:(r||(e=vC(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?vC(e+"/"+t):t)}});var go=A(Ux=>{"use strict";var Fu=Ux,Xj=It(),Jj=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Lu(n,e){var t=0,r={};for(e|=0;t<n.length;)r[Jj[t+e]]=n[t++];return r}Fu.basic=Lu([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Fu.defaults=Lu([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",Xj.emptyArray,null]);Fu.long=Lu([0,0,0,1,1],7);Fu.mapKey=Lu([0,0,0,5,5,0,0,0,1,1,0,2],2);Fu.packed=Lu([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Ji=A((aoe,Gx)=>{"use strict";Gx.exports=Pn;var Rp=yo();((Pn.prototype=Object.create(Rp.prototype)).constructor=Pn).className="Field";var qx=Zn(),zx=go(),ut=It(),SC,Zj=/^required|optional|repeated$/;Pn.fromJSON=function(e,t){return new Pn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Pn(n,e,t,r,i,s,o){if(ut.isObject(r)?(o=i,s=r,r=i=void 0):ut.isObject(i)&&(o=s,s=i,i=void 0),Rp.call(this,n,s),!ut.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!ut.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!Zj.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!ut.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=ut.Long?zx.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(Pn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Pn.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),Rp.prototype.setOption.call(this,e,t,r)};Pn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ut.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Pn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=zx.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof SC?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof qx&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof qx))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=ut.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;ut.base64.test(this.typeDefault)?ut.base64.decode(this.typeDefault,e=ut.newBuffer(ut.base64.length(this.typeDefault)),0):ut.utf8.write(this.typeDefault,e=ut.newBuffer(ut.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=ut.emptyObject:this.repeated?this.defaultValue=ut.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof SC&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Rp.prototype.resolve.call(this)};Pn.d=function(e,t,r,i){return typeof t=="function"?t=ut.decorateType(t).name:t&&typeof t=="object"&&(t=ut.decorateEnum(t).name),function(o,a){ut.decorateType(o.constructor).add(new Pn(a,e,t,r,{default:i}))}};Pn._configure=function(e){SC=e}});var Qa=A((loe,$x)=>{"use strict";$x.exports=Mn;var Np=yo();((Mn.prototype=Object.create(Np.prototype)).constructor=Mn).className="OneOf";var Wx=Ji(),kp=It();function Mn(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Np.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}Mn.fromJSON=function(e,t){return new Mn(e,t.oneof,t.options,t.comment)};Mn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return kp.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function jx(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}Mn.prototype.add=function(e){if(!(e instanceof Wx))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,jx(this),this};Mn.prototype.remove=function(e){if(!(e instanceof Wx))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};Mn.prototype.onAdd=function(e){Np.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}jx(this)};Mn.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Np.prototype.onRemove.call(this,e)};Mn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){kp.decorateType(i.constructor).add(new Mn(s,e)),Object.defineProperty(i,s,{get:kp.oneOfGetter(e),set:kp.oneOfSetter(e)})}}});var Ja=A((coe,Yx)=>{"use strict";Yx.exports=be;var CC=yo();((be.prototype=Object.create(CC.prototype)).constructor=be).className="Namespace";var Hx=Ji(),Op=It(),e9=Qa(),Ya,Bu,Xa;be.fromJSON=function(e,t){return new be(e,t.options).addJSON(t.nested)};function Kx(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}be.arrayToJSON=Kx;be.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};be.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function be(n,e){CC.call(this,n,e),this.nested=void 0,this._nestedArray=null}function Qx(n){return n._nestedArray=null,n}Object.defineProperty(be.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Op.toArray(this.nested))}});be.prototype.toJSON=function(e){return Op.toObject(["options",this.options,"nested",Kx(this.nestedArray,e)])};be.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Ya.fromJSON:s.values!==void 0?Xa.fromJSON:s.methods!==void 0?Bu.fromJSON:s.id!==void 0?Hx.fromJSON:be.fromJSON)(r[i],s));return this};be.prototype.get=function(e){return this.nested&&this.nested[e]||null};be.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Xa)return this.nested[e].values;throw Error("no such enum: "+e)};be.prototype.add=function(e){if(!(e instanceof Hx&&e.extend!==void 0||e instanceof Ya||e instanceof e9||e instanceof Xa||e instanceof Bu||e instanceof be))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof be&&e instanceof be&&!(t instanceof Ya||t instanceof Bu)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),Qx(this)};be.prototype.remove=function(e){if(!(e instanceof CC))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),Qx(this)};be.prototype.define=function(e,t){if(Op.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof be))throw Error("path conflicts with non-namespace objects")}else r.add(r=new be(i))}return t&&r.addJSON(t),r};be.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof be?e[t++].resolveAll():e[t++].resolve();return this.resolve()};be.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Op.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof be&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof be&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};be.prototype.lookupType=function(e){var t=this.lookup(e,[Ya]);if(!t)throw Error("no such type: "+e);return t};be.prototype.lookupEnum=function(e){var t=this.lookup(e,[Xa]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};be.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Ya,Xa]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};be.prototype.lookupService=function(e){var t=this.lookup(e,[Bu]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};be._configure=function(n,e,t){Ya=n,Bu=e,Xa=t}});var xp=A((uoe,Xx)=>{"use strict";Xx.exports=ii;var wC=Ji();((ii.prototype=Object.create(wC.prototype)).constructor=ii).className="MapField";var t9=go(),Vu=It();function ii(n,e,t,r,i,s){if(wC.call(this,n,e,r,void 0,void 0,i,s),!Vu.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}ii.fromJSON=function(e,t){return new ii(e,t.id,t.keyType,t.type,t.options,t.comment)};ii.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Vu.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};ii.prototype.resolve=function(){if(this.resolved)return this;if(t9.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return wC.prototype.resolve.call(this)};ii.d=function(e,t,r){return typeof r=="function"?r=Vu.decorateType(r).name:r&&typeof r=="object"&&(r=Vu.decorateEnum(r).name),function(s,o){Vu.decorateType(s.constructor).add(new ii(o,e,t,r))}}});var Pp=A((doe,Jx)=>{"use strict";Jx.exports=_o;var bC=yo();((_o.prototype=Object.create(bC.prototype)).constructor=_o).className="Method";var Za=It();function _o(n,e,t,r,i,s,o,a,l){if(Za.isObject(i)?(o=i,i=s=void 0):Za.isObject(s)&&(o=s,s=void 0),!(e===void 0||Za.isString(e)))throw TypeError("type must be a string");if(!Za.isString(t))throw TypeError("requestType must be a string");if(!Za.isString(r))throw TypeError("responseType must be a string");bC.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}_o.fromJSON=function(e,t){return new _o(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};_o.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Za.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};_o.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),bC.prototype.resolve.call(this))}});var Mp=A((hoe,eP)=>{"use strict";eP.exports=Fn;var Zi=Ja();((Fn.prototype=Object.create(Zi.prototype)).constructor=Fn).className="Service";var TC=Pp(),Uu=It(),n9=mC();function Fn(n,e){Zi.call(this,n,e),this.methods={},this._methodsArray=null}Fn.fromJSON=function(e,t){var r=new Fn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(TC.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};Fn.prototype.toJSON=function(e){var t=Zi.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Uu.toObject(["options",t&&t.options||void 0,"methods",Zi.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(Fn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=Uu.toArray(this.methods))}});function Zx(n){return n._methodsArray=null,n}Fn.prototype.get=function(e){return this.methods[e]||Zi.prototype.get.call(this,e)};Fn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return Zi.prototype.resolve.call(this)};Fn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof TC?(this.methods[e.name]=e,e.parent=this,Zx(this)):Zi.prototype.add.call(this,e)};Fn.prototype.remove=function(e){if(e instanceof TC){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,Zx(this)}return Zi.prototype.remove.call(this,e)};Fn.prototype.create=function(e,t,r){for(var i=new n9.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=Uu.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=Uu.codegen(["r","c"],Uu.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Fp=A((foe,tP)=>{"use strict";tP.exports=kr;var r9=Dr();function kr(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}kr.create=function(e){return this.$type.create(e)};kr.encode=function(e,t){return this.$type.encode(e,t)};kr.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};kr.decode=function(e){return this.$type.decode(e)};kr.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};kr.verify=function(e){return this.$type.verify(e)};kr.fromObject=function(e){return this.$type.fromObject(e)};kr.toObject=function(e,t){return this.$type.toObject(e,t)};kr.prototype.toJSON=function(){return this.$type.toObject(this,r9.toJSONOptions)}});var IC=A((poe,rP)=>{"use strict";rP.exports=o9;var i9=Zn(),si=go(),nP=It();function s9(n){return"missing required '"+n.name+"'"}function o9(n){var e=nP.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof i9?"int32":r.type,s="m"+nP.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),si.defaults[r.keyType]!==void 0?e("k=%j",si.defaults[r.keyType]):e("k=null"),si.defaults[i]!==void 0?e("value=%j",si.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),si.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),si.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),si.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),si.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):si.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",s9(o))}return e("return m")}});var RC=A((moe,iP)=>{"use strict";iP.exports=c9;var a9=Zn(),AC=It();function Ln(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function DC(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof a9){n("switch(%s){",r)("default:")("return%j",Ln(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",Ln(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",Ln(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",Ln(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",Ln(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",Ln(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",Ln(e,"buffer"));break}return n}function l9(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",Ln(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",Ln(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",Ln(e,"boolean key"));break}return n}function c9(n){var e=AC.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+AC.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",Ln(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),l9(e,s,"k[i]"),DC(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",Ln(s,"array"))("for(var i=0;i<%s.length;++i){",o),DC(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=AC.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}DC(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var OC=A(oP=>{"use strict";var sP=oP,qu=Zn(),Nr=It();function kC(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof qu){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}sP.fromObject=function(e){var t=e.fieldsArray,r=Nr.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=Nr.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),kC(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),kC(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof qu||r("if(d%s!=null){",o),kC(r,s,i,o),s.resolvedType instanceof qu||r("}"))}return r("return m")};function NC(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof qu?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}sP.toObject=function(e){var t=e.fieldsArray.slice().sort(Nr.compareFieldsById);if(!t.length)return Nr.codegen()("return {}");for(var r=Nr.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",Nr.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",Nr.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=Nr.safeProp(l.name);if(l.resolvedType instanceof qu)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],h=e._fieldsArray.indexOf(l),c=Nr.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),NC(r,l,h,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),NC(r,l,h,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),NC(r,l,h,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",Nr.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var xC=A(aP=>{"use strict";var u9=aP,d9=Fp();u9[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof d9){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var Vp=A((_oe,cP)=>{"use strict";cP.exports=xe;var er=Ja();((xe.prototype=Object.create(er.prototype)).constructor=xe).className="Type";var h9=Zn(),FC=Qa(),Lp=Ji(),f9=xp(),p9=Mp(),PC=Fp(),MC=Dp(),m9=Ip(),Mt=It(),g9=LC(),y9=IC(),_9=RC(),lP=OC(),v9=xC();function xe(n,e){er.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(xe.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Mt.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Mt.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=xe.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof PC||((n.prototype=new PC).constructor=n,Mt.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Mt.merge(n,PC,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Mt.oneOfGetter(this._oneofsArray[t].oneof),set:Mt.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});xe.generateConstructor=function(e){for(var t=Mt.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Mt.safeProp(i.name)):i.repeated&&t("this%s=[]",Mt.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Bp(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}xe.fromJSON=function(e,t){var r=new xe(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?f9.fromJSON:Lp.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(FC.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?Lp.fromJSON:o.fields!==void 0?xe.fromJSON:o.values!==void 0?h9.fromJSON:o.methods!==void 0?p9.fromJSON:er.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};xe.prototype.toJSON=function(e){var t=er.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Mt.toObject(["options",t&&t.options||void 0,"oneofs",er.arrayToJSON(this.oneofsArray,e),"fields",er.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};xe.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return er.prototype.resolveAll.call(this)};xe.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};xe.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Lp&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Bp(this)}return e instanceof FC?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Bp(this)):er.prototype.add.call(this,e)};xe.prototype.remove=function(e){if(e instanceof Lp&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Bp(this)}if(e instanceof FC){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Bp(this)}return er.prototype.remove.call(this,e)};xe.prototype.isReservedId=function(e){return er.isReservedId(this.reserved,e)};xe.prototype.isReservedName=function(e){return er.isReservedName(this.reserved,e)};xe.prototype.create=function(e){return new this.ctor(e)};xe.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=g9(this)({Writer:m9,types:t,util:Mt}),this.decode=y9(this)({Reader:MC,types:t,util:Mt}),this.verify=_9(this)({types:t,util:Mt}),this.fromObject=lP.fromObject(this)({types:t,util:Mt}),this.toObject=lP.toObject(this)({types:t,util:Mt});var i=v9[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};xe.prototype.encode=function(e,t){return this.setup().encode(e,t)};xe.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};xe.prototype.decode=function(e,t){return this.setup().decode(e,t)};xe.prototype.decodeDelimited=function(e){return e instanceof MC||(e=MC.create(e)),this.decode(e,e.uint32())};xe.prototype.verify=function(e){return this.setup().verify(e)};xe.prototype.fromObject=function(e){return this.setup().fromObject(e)};xe.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};xe.d=function(e){return function(r){Mt.decorateType(r,e)}}});var zp=A((voe,pP)=>{"use strict";pP.exports=yn;var qp=Ja();((yn.prototype=Object.create(qp.prototype)).constructor=yn).className="Root";var VC=Ji(),dP=Zn(),E9=Qa(),es=It(),hP,BC,zu;function yn(n){qp.call(this,"",n),this.deferred=[],this.files=[]}yn.fromJSON=function(e,t){return t||(t=new yn),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};yn.prototype.resolvePath=es.path.resolve;yn.prototype.fetch=es.fetch;function fP(){}yn.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return es.asPromise(n,i,e,t);var s=r===fP;function o(p,E){if(r){if(s)throw p;var w=r;r=null,w(p,E)}}function a(p){var E=p.lastIndexOf("google/protobuf/");if(E>-1){var w=p.substring(E);if(w in zu)return w}return null}function l(p,E){try{if(es.isString(E)&&E.charAt(0)==="{"&&(E=JSON.parse(E)),!es.isString(E))i.setOptions(E.options).addJSON(E.nested);else{BC.filename=p;var w=BC(E,i,t),T,k=0;if(w.imports)for(;k<w.imports.length;++k)(T=a(w.imports[k])||i.resolvePath(p,w.imports[k]))&&c(T);if(w.weakImports)for(k=0;k<w.weakImports.length;++k)(T=a(w.weakImports[k])||i.resolvePath(p,w.weakImports[k]))&&c(T,!0)}}catch(R){o(R)}!s&&!u&&o(null,i)}function c(p,E){if(p=a(p)||p,!(i.files.indexOf(p)>-1)){if(i.files.push(p),p in zu){s?l(p,zu[p]):(++u,setTimeout(function(){--u,l(p,zu[p])}));return}if(s){var w;try{w=es.fs.readFileSync(p).toString("utf8")}catch(T){E||o(T);return}l(p,w)}else++u,i.fetch(p,function(T,k){if(--u,!!r){if(T){E?u||o(null,i):o(T);return}l(p,k)}})}}var u=0;es.isString(e)&&(e=[e]);for(var d=0,h;d<e.length;++d)(h=i.resolvePath("",e[d]))&&c(h);if(s)return i;u||o(null,i)};yn.prototype.loadSync=function(e,t){if(!es.isNode)throw Error("not supported");return this.load(e,t,fP)};yn.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return qp.prototype.resolveAll.call(this)};var Up=/^[A-Z]/;function uP(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new VC(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}yn.prototype._handleAdd=function(e){if(e instanceof VC)e.extend!==void 0&&!e.extensionField&&(uP(this,e)||this.deferred.push(e));else if(e instanceof dP)Up.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof E9)){if(e instanceof hP)for(var t=0;t<this.deferred.length;)uP(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Up.test(e.name)&&(e.parent[e.name]=e)}};yn.prototype._handleRemove=function(e){if(e instanceof VC){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof dP)Up.test(e.name)&&delete e.parent[e.name];else if(e instanceof qp){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Up.test(e.name)&&delete e.parent[e.name]}};yn._configure=function(n,e,t){hP=n,BC=e,zu=t}});var It=A((Eoe,gP)=>{"use strict";var rt=gP.exports=Dr(),mP=gC(),UC,qC;rt.codegen=Px();rt.fetch=Fx();rt.path=Vx();rt.fs=rt.inquire("fs");rt.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};rt.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var S9=/\\/g,C9=/"/g;rt.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};rt.safeProp=function(e){return!/^[$\w_]+$/.test(e)||rt.isReserved(e)?'["'+e.replace(S9,"\\\\").replace(C9,'\\"')+'"]':"."+e};rt.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var w9=/_([a-z])/g;rt.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(w9,function(t,r){return r.toUpperCase()})};rt.compareFieldsById=function(e,t){return e.id-t.id};rt.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(rt.decorateRoot.remove(e.$type),e.$type.name=t,rt.decorateRoot.add(e.$type)),e.$type;UC||(UC=Vp());var r=new UC(t||e.name);return rt.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var b9=0;rt.decorateEnum=function(e){if(e.$type)return e.$type;qC||(qC=Zn());var t=new qC("Enum"+b9++,e);return rt.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};rt.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(rt,"decorateRoot",{get:function(){return mP.decorated||(mP.decorated=new(zp()))}})});var yo=A((Soe,yP)=>{"use strict";yP.exports=_n;_n.className="ReflectionObject";var Gp=It(),Wp;function _n(n,e){if(!Gp.isString(n))throw TypeError("name must be a string");if(e&&!Gp.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(_n.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});_n.prototype.toJSON=function(){throw Error()};_n.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Wp&&t._handleAdd(this)};_n.prototype.onRemove=function(e){var t=e.root;t instanceof Wp&&t._handleRemove(this),this.parent=null,this.resolved=!1};_n.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Wp&&(this.resolved=!0),this)};_n.prototype.getOption=function(e){if(this.options)return this.options[e]};_n.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};_n.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Gp.setProperty(o,r,t)}else s={},s[e]=Gp.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};_n.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};_n.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};_n._configure=function(n){Wp=n}});var Zn=A((Coe,EP)=>{"use strict";EP.exports=Or;var _P=yo();((Or.prototype=Object.create(_P.prototype)).constructor=Or).className="Enum";var vP=Ja(),jp=It();function Or(n,e,t,r,i,s){if(_P.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Or.fromJSON=function(e,t){var r=new Or(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};Or.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return jp.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Or.prototype.add=function(e,t,r,i){if(!jp.isString(e))throw TypeError("name must be a string");if(!jp.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Or.prototype.remove=function(e){if(!jp.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Or.prototype.isReservedId=function(e){return vP.isReservedId(this.reserved,e)};Or.prototype.isReservedName=function(e){return vP.isReservedName(this.reserved,e)}});var LC=A((woe,CP)=>{"use strict";CP.exports=I9;var T9=Zn(),zC=go(),GC=It();function SP(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function I9(n){for(var e=GC.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(GC.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof T9?"int32":s.type,l=zC.basic[a];r="m"+GC.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|zC.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&zC.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?SP(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?SP(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var bP=A((boe,wP)=>{"use strict";var ge=wP.exports=Ox();ge.build="light";function A9(n,e,t){return typeof e=="function"?(t=e,e=new ge.Root):e||(e=new ge.Root),e.load(n,t)}ge.load=A9;function D9(n,e){return e||(e=new ge.Root),e.loadSync(n)}ge.loadSync=D9;ge.encoder=LC();ge.decoder=IC();ge.verifier=RC();ge.converter=OC();ge.ReflectionObject=yo();ge.Namespace=Ja();ge.Root=zp();ge.Enum=Zn();ge.Type=Vp();ge.Field=Ji();ge.OneOf=Qa();ge.MapField=xp();ge.Service=Mp();ge.Method=Pp();ge.Message=Fp();ge.wrappers=xC();ge.types=go();ge.util=It();ge.ReflectionObject._configure(ge.Root);ge.Namespace._configure(ge.Type,ge.Service,ge.Enum);ge.Root._configure(ge.Type);ge.Field._configure(ge.Type)});var jC=A((Toe,AP)=>{"use strict";AP.exports=IP;var WC=/[\s{}=;:[\],'"()<>]/g,R9=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,k9=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,N9=/^ *[*/]+ */,O9=/^\s*\*?\/*/,x9=/\n/g,P9=/\s/,M9=/\\(.?)/g,F9={0:"\0",r:"\r",n:`
`,t:"	"};function TP(n){return n.replace(M9,function(e,t){switch(t){case"\\":case"":return t;default:return F9[t]||""}})}IP.unescape=TP;function IP(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(F){return Error("illegal "+F+" (line "+i+")")}function u(){var F=l==="'"?k9:R9;F.lastIndex=t-1;var W=F.exec(n);if(!W)throw c("string");return t=F.lastIndex,T(l),l=null,TP(W[1])}function d(F){return n.charAt(F)}function h(F,W,ee){var S={type:n.charAt(F++),lineEmpty:!1,leading:ee},y;e?y=2:y=3;var _=F-y,v;do if(--_<0||(v=n.charAt(_))===`
`){S.lineEmpty=!0;break}while(v===" "||v==="	");for(var m=n.substring(F,W).split(x9),C=0;C<m.length;++C)m[C]=m[C].replace(e?O9:N9,"").trim();S.text=m.join(`
`).trim(),o[i]=S,s=i}function p(F){var W=E(F),ee=n.substring(F,W),S=/^\s*\/\//.test(ee);return S}function E(F){for(var W=F;W<r&&d(W)!==`
`;)W++;return W}function w(){if(a.length>0)return a.shift();if(l)return u();var F,W,ee,S,y,_=t===0;do{if(t===r)return null;for(F=!1;P9.test(ee=d(t));)if(ee===`
`&&(_=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(S=t,y=!1,p(t-1)){y=!0;do if(t=E(t),t===r||(t++,!_))break;while(p(t))}else t=Math.min(r,E(t)+1);y&&(h(S,t,_),_=!0),i++,F=!0}else{for(y=d(S=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,y&&(h(S,t-1,_),_=!0),++i,F=!0}else if((ee=d(t))==="*"){S=t+1,y=e||d(S)==="*";do{if(ee===`
`&&++i,++t===r)throw c("comment");W=ee,ee=d(t)}while(W!=="*"||ee!=="/");++t,y&&(h(S,t-2,_),_=!0),F=!0}else return"/"}}while(F);var v=t;WC.lastIndex=0;var m=WC.test(d(v++));if(!m)for(;v<r&&!WC.test(d(v));)++v;var C=n.substring(t,t=v);return(C==='"'||C==="'")&&(l=C),C}function T(F){a.push(F)}function k(){if(!a.length){var F=w();if(F===null)return null;T(F)}return a[0]}function R(F,W){var ee=k(),S=ee===F;if(S)return w(),!0;if(!W)throw c("token '"+ee+"', '"+F+"' expected");return!1}function O(F){var W=null,ee;return F===void 0?(ee=o[i-1],delete o[i-1],ee&&(e||ee.type==="*"||ee.lineEmpty)&&(W=ee.leading?ee.text:null)):(s<F&&k(),ee=o[F],delete o[F],ee&&!ee.lineEmpty&&(e||ee.type==="/")&&(W=ee.leading?null:ee.text)),W}return Object.defineProperty({next:w,peek:k,push:T,skip:R,cmnt:O},"line",{get:function(){return i}})}});var xP=A((Ioe,OP)=>{"use strict";OP.exports=oi;oi.filename=null;oi.defaults={keepCase:!1};var L9=jC(),DP=zp(),RP=Vp(),kP=Ji(),B9=xp(),NP=Qa(),V9=Zn(),U9=Mp(),q9=Pp(),$C=go(),HC=It(),z9=/^[1-9][0-9]*$/,G9=/^-?[1-9][0-9]*$/,W9=/^0[x][0-9a-fA-F]+$/,j9=/^-?0[x][0-9a-fA-F]+$/,$9=/^0[0-7]+$/,H9=/^-?0[0-7]+$/,K9=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,xr=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Pr=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,Q9=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function oi(n,e,t){e instanceof DP||(t=e,e=new DP),t||(t=oi.defaults);var r=t.preferTrailingComment||!1,i=L9(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,d,h,p,E,w=!1,T=e,k=t.keepCase?function(x){return x}:HC.camelCase;function R(x,P,B){var J=oi.filename;return B||(oi.filename=null),Error("illegal "+(P||"token")+" '"+x+"' ("+(J?J+", ":"")+"line "+i.line+")")}function O(){var x=[],P;do{if((P=s())!=='"'&&P!=="'")throw R(P);x.push(s()),l(P),P=a()}while(P==='"'||P==="'");return x.join("")}function F(x){var P=s();switch(P){case"'":case'"':return o(P),O();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return ee(P,!0)}catch{if(x&&Pr.test(P))return P;throw R(P,"value")}}function W(x,P){var B,J;do P&&((B=a())==='"'||B==="'")?x.push(O()):x.push([J=S(s()),l("to",!0)?S(s()):J]);while(l(",",!0));var H={options:void 0};H.setOption=function(le,We){this.options===void 0&&(this.options={}),this.options[le]=We},C(H,function(We){if(We==="option")Ne(H,We),l(";");else throw R(We)},function(){Rt(H)})}function ee(x,P){var B=1;switch(x.charAt(0)==="-"&&(B=-1,x=x.substring(1)),x){case"inf":case"INF":case"Inf":return B*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(z9.test(x))return B*parseInt(x,10);if(W9.test(x))return B*parseInt(x,16);if($9.test(x))return B*parseInt(x,8);if(K9.test(x))return B*parseFloat(x);throw R(x,"number",P)}function S(x,P){switch(x){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!P&&x.charAt(0)==="-")throw R(x,"id");if(G9.test(x))return parseInt(x,10);if(j9.test(x))return parseInt(x,16);if(H9.test(x))return parseInt(x,8);throw R(x,"id")}function y(){if(d!==void 0)throw R("package");if(d=s(),!Pr.test(d))throw R(d,"name");T=T.define(d),l(";")}function _(){var x=a(),P;switch(x){case"weak":P=p||(p=[]),s();break;case"public":s();default:P=h||(h=[]);break}x=O(),l(";"),P.push(x)}function v(){if(l("="),E=O(),w=E==="proto3",!w&&E!=="proto2")throw R(E,"syntax");e.setOption("syntax",E),l(";")}function m(x,P){switch(P){case"option":return Ne(x,P),l(";"),!0;case"message":return f(x,P),!0;case"enum":return De(x,P),!0;case"service":return lt(x,P),!0;case"extend":return ta(x,P),!0}return!1}function C(x,P,B){var J=i.line;if(x&&(typeof x.comment!="string"&&(x.comment=c()),x.filename=oi.filename),l("{",!0)){for(var H;(H=s())!=="}";)P(H);l(";",!0)}else B&&B(),l(";"),x&&(typeof x.comment!="string"||r)&&(x.comment=c(J)||x.comment)}function f(x,P){if(!xr.test(P=s()))throw R(P,"type name");var B=new RP(P);C(B,function(H){if(!m(B,H))switch(H){case"map":_e(B,H);break;case"required":case"repeated":g(B,H);break;case"optional":w?g(B,"proto3_optional"):g(B,"optional");break;case"oneof":Be(B,H);break;case"extensions":W(B.extensions||(B.extensions=[]));break;case"reserved":W(B.reserved||(B.reserved=[]),!0);break;default:if(!w||!Pr.test(H))throw R(H);o(H),g(B,"optional");break}}),x.add(B)}function g(x,P,B){var J=s();if(J==="group"){q(x,P);return}for(;J.endsWith(".")||a().startsWith(".");)J+=s();if(!Pr.test(J))throw R(J,"type");var H=s();if(!xr.test(H))throw R(H,"name");H=k(H),l("=");var le=new kP(H,S(s()),J,P,B);if(C(le,function(ln){if(ln==="option")Ne(le,ln),l(";");else throw R(ln)},function(){Rt(le)}),P==="proto3_optional"){var We=new NP("_"+H);le.setOption("proto3_optional",!0),We.add(le),x.add(We)}else x.add(le);!w&&le.repeated&&($C.packed[J]!==void 0||$C.basic[J]===void 0)&&le.setOption("packed",!1,!0)}function q(x,P){var B=s();if(!xr.test(B))throw R(B,"name");var J=HC.lcFirst(B);B===J&&(B=HC.ucFirst(B)),l("=");var H=S(s()),le=new RP(B);le.group=!0;var We=new kP(J,H,B,P);We.filename=oi.filename,C(le,function(ln){switch(ln){case"option":Ne(le,ln),l(";");break;case"required":case"repeated":g(le,ln);break;case"optional":w?g(le,"proto3_optional"):g(le,"optional");break;case"message":f(le,ln);break;case"enum":De(le,ln);break;default:throw R(ln)}}),x.add(le).add(We)}function _e(x){l("<");var P=s();if($C.mapKey[P]===void 0)throw R(P,"type");l(",");var B=s();if(!Pr.test(B))throw R(B,"type");l(">");var J=s();if(!xr.test(J))throw R(J,"name");l("=");var H=new B9(k(J),S(s()),P,B);C(H,function(We){if(We==="option")Ne(H,We),l(";");else throw R(We)},function(){Rt(H)}),x.add(H)}function Be(x,P){if(!xr.test(P=s()))throw R(P,"name");var B=new NP(k(P));C(B,function(H){H==="option"?(Ne(B,H),l(";")):(o(H),g(B,"optional"))}),x.add(B)}function De(x,P){if(!xr.test(P=s()))throw R(P,"name");var B=new V9(P);C(B,function(H){switch(H){case"option":Ne(B,H),l(";");break;case"reserved":W(B.reserved||(B.reserved=[]),!0);break;default:et(B,H)}}),x.add(B)}function et(x,P){if(!xr.test(P))throw R(P,"name");l("=");var B=S(s(),!0),J={options:void 0};J.setOption=function(H,le){this.options===void 0&&(this.options={}),this.options[H]=le},C(J,function(le){if(le==="option")Ne(J,le),l(";");else throw R(le)},function(){Rt(J)}),x.add(P,B,J.comment,J.options)}function Ne(x,P){var B=l("(",!0);if(!Pr.test(P=s()))throw R(P,"name");var J=P,H=J,le;B&&(l(")"),J="("+J+")",H=J,P=a(),Q9.test(P)&&(le=P.slice(1),J+=P,s())),l("=");var We=Vt(x,J);Qe(x,H,We,le)}function Vt(x,P){if(l("{",!0)){for(var B={};!l("}",!0);){if(!xr.test(Ot=s()))throw R(Ot,"name");if(Ot===null)throw R(Ot,"end of input");var J,H=Ot;if(l(":",!0),a()==="{")J=Vt(x,P+"."+Ot);else if(a()==="["){J=[];var le;if(l("[",!0)){do le=F(!0),J.push(le);while(l(",",!0));l("]"),typeof le<"u"&&at(x,P+"."+Ot,le)}}else J=F(!0),at(x,P+"."+Ot,J);var We=B[H];We&&(J=[].concat(We).concat(J)),B[H]=J,l(",",!0),l(";",!0)}return B}var Ei=F(!0);return at(x,P,Ei),Ei}function at(x,P,B){x.setOption&&x.setOption(P,B)}function Qe(x,P,B,J){x.setParsedOption&&x.setParsedOption(P,B,J)}function Rt(x){if(l("[",!0)){do Ne(x,"option");while(l(",",!0));l("]")}return x}function lt(x,P){if(!xr.test(P=s()))throw R(P,"service name");var B=new U9(P);C(B,function(H){if(!m(B,H))if(H==="rpc")Ut(B,H);else throw R(H)}),x.add(B)}function Ut(x,P){var B=c(),J=P;if(!xr.test(P=s()))throw R(P,"name");var H=P,le,We,Ei,ln;if(l("("),l("stream",!0)&&(We=!0),!Pr.test(P=s())||(le=P,l(")"),l("returns"),l("("),l("stream",!0)&&(ln=!0),!Pr.test(P=s())))throw R(P);Ei=P,l(")");var rh=new q9(H,J,le,Ei,We,ln);rh.comment=B,C(rh,function(ky){if(ky==="option")Ne(rh,ky),l(";");else throw R(ky)}),x.add(rh)}function ta(x,P){if(!Pr.test(P=s()))throw R(P,"reference");var B=P;C(null,function(H){switch(H){case"required":case"repeated":g(x,H,B);break;case"optional":w?g(x,"proto3_optional",B):g(x,"optional",B);break;default:if(!w||!Pr.test(H))throw R(H);o(H),g(x,"optional",B);break}})}for(var Ot;(Ot=s())!==null;)switch(Ot){case"package":if(!u)throw R(Ot);y();break;case"import":if(!u)throw R(Ot);_();break;case"syntax":if(!u)throw R(Ot);v();break;case"option":Ne(T,Ot),l(";");break;default:if(m(T,Ot)){u=!1;continue}throw R(Ot)}return oi.filename=null,{package:d,imports:h,weakImports:p,syntax:E,root:e}}});var FP=A((Aoe,MP)=>{"use strict";MP.exports=tr;var Y9=/\/|\./;function tr(n,e){Y9.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),tr[n]=e}tr("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var PP;tr("duration",{Duration:PP={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});tr("timestamp",{Timestamp:PP});tr("empty",{Empty:{fields:{}}});tr("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});tr("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});tr("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});tr.get=function(e){return tr[e]||null}});var BP=A((Doe,LP)=>{"use strict";var ts=LP.exports=bP();ts.build="full";ts.tokenize=jC();ts.parse=xP();ts.common=FP();ts.Root._configure(ts.Type,ts.parse,ts.common)});var $p=A((Roe,VP)=>{"use strict";VP.exports=BP()});var KC=A((koe,X9)=>{X9.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var WP=A((he,GP)=>{"use strict";var Qt=$p();GP.exports=he=Qt.descriptor=Qt.Root.fromJSON(KC()).lookup(".google.protobuf");var UP=Qt.Namespace,Gu=Qt.Root,ai=Qt.Enum,ns=Qt.Type,rs=Qt.Field,J9=Qt.MapField,Hp=Qt.OneOf,Wu=Qt.Service,Kp=Qt.Method;Gu.fromDescriptor=function(e){typeof e.length=="number"&&(e=he.FileDescriptorSet.decode(e));var t=new Gu;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(ns.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(ai.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(rs.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(Wu.fromDescriptor(r.service[o]));var a=el(r.options,he.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};Gu.prototype.toDescriptor=function(e){var t=he.FileDescriptorSet.create();return qP(this,t.file,e),t};function qP(n,e,t){var r=he.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof Gu||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof ns?r.messageType.push(s.toDescriptor(t)):s instanceof ai?r.enumType.push(s.toDescriptor()):s instanceof rs?r.extension.push(s.toDescriptor(t)):s instanceof Wu?r.service.push(s.toDescriptor()):s instanceof UP&&qP(s,e,t);r.options=tl(n.options,he.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var Z9=0;ns.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=he.DescriptorProto.decode(e));var r=new ns(e.name.length?e.name:"Type"+Z9++,el(e.options,he.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(Hp.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=rs.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(rs.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(ns.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(ai.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};ns.prototype.toDescriptor=function(e){var t=he.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof J9){var s=QC(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=QC(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&zP(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(he.DescriptorProto.create({name:i.typeName,field:[he.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),he.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:he.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof rs?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof ns?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof ai&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(he.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(he.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=tl(this.options,he.MessageOptions),t};var e$=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;rs.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=he.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=s$(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new rs(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=el(e.options,he.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=e$.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return o$(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};rs.prototype.toDescriptor=function(e){var t=he.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Qt.util.ucFirst(this.name),t.label=3;else{switch(t.type=QC(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?zP(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=tl(this.options,he.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=he.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=he.FieldOptions.create())).packed=!0),t};var t$=0;ai.fromDescriptor=function(e){typeof e.length=="number"&&(e=he.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new ai(e.name&&e.name.length?e.name:"Enum"+t$++,t,el(e.options,he.EnumOptions))};ai.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(he.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return he.EnumDescriptorProto.create({name:this.name,value:e,options:tl(this.options,he.EnumOptions)})};var n$=0;Hp.fromDescriptor=function(e){return typeof e.length=="number"&&(e=he.OneofDescriptorProto.decode(e)),new Hp(e.name&&e.name.length?e.name:"oneof"+n$++)};Hp.prototype.toDescriptor=function(){return he.OneofDescriptorProto.create({name:this.name})};var r$=0;Wu.fromDescriptor=function(e){typeof e.length=="number"&&(e=he.ServiceDescriptorProto.decode(e));var t=new Wu(e.name&&e.name.length?e.name:"Service"+r$++,el(e.options,he.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(Kp.fromDescriptor(e.method[r]));return t};Wu.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return he.ServiceDescriptorProto.create({name:this.name,method:e,options:tl(this.options,he.ServiceOptions)})};var i$=0;Kp.fromDescriptor=function(e){return typeof e.length=="number"&&(e=he.MethodDescriptorProto.decode(e)),new Kp(e.name&&e.name.length?e.name:"Method"+i$++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,el(e.options,he.MethodOptions))};Kp.prototype.toDescriptor=function(){return he.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:tl(this.options,he.MethodOptions)})};function s$(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function o$(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function QC(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof ai)return 14;if(e instanceof ns)return e.group?10:11;throw Error("illegal type: "+n)}function el(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof ai&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(a$(s),o));return t.length?Qt.util.toObject(t):void 0}}function tl(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Qt.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Qt.util.toObject(t)):void 0}}function zP(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof Gu)&&e instanceof UP)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function a$(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var jP=A((Noe,l$)=>{l$.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var $P=A((Ooe,c$)=>{c$.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var HP=A((xoe,u$)=>{u$.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var XP=A(is=>{"use strict";Object.defineProperty(is,"__esModule",{value:!0});is.addCommonProtos=is.loadProtosWithOptionsSync=is.loadProtosWithOptions=void 0;var KP=Z("fs"),QP=Z("path"),nl=$p();function YP(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(QP.isAbsolute(i))return i;for(let s of e){let o=QP.join(s,i);try{return KP.accessSync(o,KP.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function d$(n,e){return b(this,null,function*(){let t=new nl.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));YP(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}is.loadProtosWithOptions=d$;function h$(n,e){let t=new nl.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");YP(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}is.loadProtosWithOptionsSync=h$;function f$(){let n=jP(),e=KC(),t=$P(),r=HP();nl.common("api",n.nested.google.nested.protobuf.nested),nl.common("descriptor",e.nested.google.nested.protobuf.nested),nl.common("source_context",t.nested.google.nested.protobuf.nested),nl.common("type",r.nested.google.nested.protobuf.nested)}is.addCommonProtos=f$});var eM=A((ZP,YC)=>{"use strict";var JP=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(f,g,q){this.low=f|0,this.high=g|0,this.unsigned=!!q}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(f){return(f&&f.__isLong__)===!0}function i(f){var g=Math.clz32(f&-f);return f?31-g:g}t.isLong=r;var s={},o={};function a(f,g){var q,_e,Be;return g?(f>>>=0,(Be=0<=f&&f<256)&&(_e=o[f],_e)?_e:(q=c(f,0,!0),Be&&(o[f]=q),q)):(f|=0,(Be=-128<=f&&f<128)&&(_e=s[f],_e)?_e:(q=c(f,f<0?-1:0,!1),Be&&(s[f]=q),q))}t.fromInt=a;function l(f,g){if(isNaN(f))return g?F:O;if(g){if(f<0)return F;if(f>=T)return _}else{if(f<=-k)return v;if(f+1>=k)return y}return f<0?l(-f,g).neg():c(f%w|0,f/w|0,g)}t.fromNumber=l;function c(f,g,q){return new t(f,g,q)}t.fromBits=c;var u=Math.pow;function d(f,g,q){if(f.length===0)throw Error("empty string");if(typeof g=="number"?(q=g,g=!1):g=!!g,f==="NaN"||f==="Infinity"||f==="+Infinity"||f==="-Infinity")return g?F:O;if(q=q||10,q<2||36<q)throw RangeError("radix");var _e;if((_e=f.indexOf("-"))>0)throw Error("interior hyphen");if(_e===0)return d(f.substring(1),g,q).neg();for(var Be=l(u(q,8)),De=O,et=0;et<f.length;et+=8){var Ne=Math.min(8,f.length-et),Vt=parseInt(f.substring(et,et+Ne),q);if(Ne<8){var at=l(u(q,Ne));De=De.mul(at).add(l(Vt))}else De=De.mul(Be),De=De.add(l(Vt))}return De.unsigned=g,De}t.fromString=d;function h(f,g){return typeof f=="number"?l(f,g):typeof f=="string"?d(f,g):c(f.low,f.high,typeof g=="boolean"?g:f.unsigned)}t.fromValue=h;var p=65536,E=1<<24,w=p*p,T=w*w,k=T/2,R=a(E),O=a(0);t.ZERO=O;var F=a(0,!0);t.UZERO=F;var W=a(1);t.ONE=W;var ee=a(1,!0);t.UONE=ee;var S=a(-1);t.NEG_ONE=S;var y=c(-1,2147483647,!1);t.MAX_VALUE=y;var _=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=_;var v=c(0,-2147483648,!1);t.MIN_VALUE=v;var m=t.prototype;m.toInt=function(){return this.unsigned?this.low>>>0:this.low},m.toNumber=function(){return this.unsigned?(this.high>>>0)*w+(this.low>>>0):this.high*w+(this.low>>>0)},m.toString=function(g){if(g=g||10,g<2||36<g)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(v)){var q=l(g),_e=this.div(q),Be=_e.mul(q).sub(this);return _e.toString(g)+Be.toInt().toString(g)}else return"-"+this.neg().toString(g);for(var De=l(u(g,6),this.unsigned),et=this,Ne="";;){var Vt=et.div(De),at=et.sub(Vt.mul(De)).toInt()>>>0,Qe=at.toString(g);if(et=Vt,et.isZero())return Qe+Ne;for(;Qe.length<6;)Qe="0"+Qe;Ne=""+Qe+Ne}},m.getHighBits=function(){return this.high},m.getHighBitsUnsigned=function(){return this.high>>>0},m.getLowBits=function(){return this.low},m.getLowBitsUnsigned=function(){return this.low>>>0},m.getNumBitsAbs=function(){if(this.isNegative())return this.eq(v)?64:this.neg().getNumBitsAbs();for(var g=this.high!=0?this.high:this.low,q=31;q>0&&!(g&1<<q);q--);return this.high!=0?q+33:q+1},m.isZero=function(){return this.high===0&&this.low===0},m.eqz=m.isZero,m.isNegative=function(){return!this.unsigned&&this.high<0},m.isPositive=function(){return this.unsigned||this.high>=0},m.isOdd=function(){return(this.low&1)===1},m.isEven=function(){return(this.low&1)===0},m.equals=function(g){return r(g)||(g=h(g)),this.unsigned!==g.unsigned&&this.high>>>31===1&&g.high>>>31===1?!1:this.high===g.high&&this.low===g.low},m.eq=m.equals,m.notEquals=function(g){return!this.eq(g)},m.neq=m.notEquals,m.ne=m.notEquals,m.lessThan=function(g){return this.comp(g)<0},m.lt=m.lessThan,m.lessThanOrEqual=function(g){return this.comp(g)<=0},m.lte=m.lessThanOrEqual,m.le=m.lessThanOrEqual,m.greaterThan=function(g){return this.comp(g)>0},m.gt=m.greaterThan,m.greaterThanOrEqual=function(g){return this.comp(g)>=0},m.gte=m.greaterThanOrEqual,m.ge=m.greaterThanOrEqual,m.compare=function(g){if(r(g)||(g=h(g)),this.eq(g))return 0;var q=this.isNegative(),_e=g.isNegative();return q&&!_e?-1:!q&&_e?1:this.unsigned?g.high>>>0>this.high>>>0||g.high===this.high&&g.low>>>0>this.low>>>0?-1:1:this.sub(g).isNegative()?-1:1},m.comp=m.compare,m.negate=function(){return!this.unsigned&&this.eq(v)?v:this.not().add(W)},m.neg=m.negate,m.add=function(g){r(g)||(g=h(g));var q=this.high>>>16,_e=this.high&65535,Be=this.low>>>16,De=this.low&65535,et=g.high>>>16,Ne=g.high&65535,Vt=g.low>>>16,at=g.low&65535,Qe=0,Rt=0,lt=0,Ut=0;return Ut+=De+at,lt+=Ut>>>16,Ut&=65535,lt+=Be+Vt,Rt+=lt>>>16,lt&=65535,Rt+=_e+Ne,Qe+=Rt>>>16,Rt&=65535,Qe+=q+et,Qe&=65535,c(lt<<16|Ut,Qe<<16|Rt,this.unsigned)},m.subtract=function(g){return r(g)||(g=h(g)),this.add(g.neg())},m.sub=m.subtract,m.multiply=function(g){if(this.isZero())return this;if(r(g)||(g=h(g)),e){var q=e.mul(this.low,this.high,g.low,g.high);return c(q,e.get_high(),this.unsigned)}if(g.isZero())return this.unsigned?F:O;if(this.eq(v))return g.isOdd()?v:O;if(g.eq(v))return this.isOdd()?v:O;if(this.isNegative())return g.isNegative()?this.neg().mul(g.neg()):this.neg().mul(g).neg();if(g.isNegative())return this.mul(g.neg()).neg();if(this.lt(R)&&g.lt(R))return l(this.toNumber()*g.toNumber(),this.unsigned);var _e=this.high>>>16,Be=this.high&65535,De=this.low>>>16,et=this.low&65535,Ne=g.high>>>16,Vt=g.high&65535,at=g.low>>>16,Qe=g.low&65535,Rt=0,lt=0,Ut=0,ta=0;return ta+=et*Qe,Ut+=ta>>>16,ta&=65535,Ut+=De*Qe,lt+=Ut>>>16,Ut&=65535,Ut+=et*at,lt+=Ut>>>16,Ut&=65535,lt+=Be*Qe,Rt+=lt>>>16,lt&=65535,lt+=De*at,Rt+=lt>>>16,lt&=65535,lt+=et*Vt,Rt+=lt>>>16,lt&=65535,Rt+=_e*Qe+Be*at+De*Vt+et*Ne,Rt&=65535,c(Ut<<16|ta,Rt<<16|lt,this.unsigned)},m.mul=m.multiply,m.divide=function(g){if(r(g)||(g=h(g)),g.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&g.low===-1&&g.high===-1)return this;var q=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,g.low,g.high);return c(q,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?F:O;var _e,Be,De;if(this.unsigned){if(g.unsigned||(g=g.toUnsigned()),g.gt(this))return F;if(g.gt(this.shru(1)))return ee;De=F}else{if(this.eq(v)){if(g.eq(W)||g.eq(S))return v;if(g.eq(v))return W;var et=this.shr(1);return _e=et.div(g).shl(1),_e.eq(O)?g.isNegative()?W:S:(Be=this.sub(g.mul(_e)),De=_e.add(Be.div(g)),De)}else if(g.eq(v))return this.unsigned?F:O;if(this.isNegative())return g.isNegative()?this.neg().div(g.neg()):this.neg().div(g).neg();if(g.isNegative())return this.div(g.neg()).neg();De=O}for(Be=this;Be.gte(g);){_e=Math.max(1,Math.floor(Be.toNumber()/g.toNumber()));for(var Ne=Math.ceil(Math.log(_e)/Math.LN2),Vt=Ne<=48?1:u(2,Ne-48),at=l(_e),Qe=at.mul(g);Qe.isNegative()||Qe.gt(Be);)_e-=Vt,at=l(_e,this.unsigned),Qe=at.mul(g);at.isZero()&&(at=W),De=De.add(at),Be=Be.sub(Qe)}return De},m.div=m.divide,m.modulo=function(g){if(r(g)||(g=h(g)),e){var q=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,g.low,g.high);return c(q,e.get_high(),this.unsigned)}return this.sub(this.div(g).mul(g))},m.mod=m.modulo,m.rem=m.modulo,m.not=function(){return c(~this.low,~this.high,this.unsigned)},m.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},m.clz=m.countLeadingZeros,m.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},m.ctz=m.countTrailingZeros,m.and=function(g){return r(g)||(g=h(g)),c(this.low&g.low,this.high&g.high,this.unsigned)},m.or=function(g){return r(g)||(g=h(g)),c(this.low|g.low,this.high|g.high,this.unsigned)},m.xor=function(g){return r(g)||(g=h(g)),c(this.low^g.low,this.high^g.high,this.unsigned)},m.shiftLeft=function(g){return r(g)&&(g=g.toInt()),(g&=63)===0?this:g<32?c(this.low<<g,this.high<<g|this.low>>>32-g,this.unsigned):c(0,this.low<<g-32,this.unsigned)},m.shl=m.shiftLeft,m.shiftRight=function(g){return r(g)&&(g=g.toInt()),(g&=63)===0?this:g<32?c(this.low>>>g|this.high<<32-g,this.high>>g,this.unsigned):c(this.high>>g-32,this.high>=0?0:-1,this.unsigned)},m.shr=m.shiftRight,m.shiftRightUnsigned=function(g){return r(g)&&(g=g.toInt()),(g&=63)===0?this:g<32?c(this.low>>>g|this.high<<32-g,this.high>>>g,this.unsigned):g===32?c(this.high,0,this.unsigned):c(this.high>>>g-32,0,this.unsigned)},m.shru=m.shiftRightUnsigned,m.shr_u=m.shiftRightUnsigned,m.rotateLeft=function(g){var q;return r(g)&&(g=g.toInt()),(g&=63)===0?this:g===32?c(this.high,this.low,this.unsigned):g<32?(q=32-g,c(this.low<<g|this.high>>>q,this.high<<g|this.low>>>q,this.unsigned)):(g-=32,q=32-g,c(this.high<<g|this.low>>>q,this.low<<g|this.high>>>q,this.unsigned))},m.rotl=m.rotateLeft,m.rotateRight=function(g){var q;return r(g)&&(g=g.toInt()),(g&=63)===0?this:g===32?c(this.high,this.low,this.unsigned):g<32?(q=32-g,c(this.high<<q|this.low>>>g,this.low<<q|this.high>>>g,this.unsigned)):(g-=32,q=32-g,c(this.low<<q|this.high>>>g,this.high<<q|this.low>>>g,this.unsigned))},m.rotr=m.rotateRight,m.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},m.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},m.toBytes=function(g){return g?this.toBytesLE():this.toBytesBE()},m.toBytesLE=function(){var g=this.high,q=this.low;return[q&255,q>>>8&255,q>>>16&255,q>>>24,g&255,g>>>8&255,g>>>16&255,g>>>24]},m.toBytesBE=function(){var g=this.high,q=this.low;return[g>>>24,g>>>16&255,g>>>8&255,g&255,q>>>24,q>>>16&255,q>>>8&255,q&255]},t.fromBytes=function(g,q,_e){return _e?t.fromBytesLE(g,q):t.fromBytesBE(g,q)},t.fromBytesLE=function(g,q){return new t(g[0]|g[1]<<8|g[2]<<16|g[3]<<24,g[4]|g[5]<<8|g[6]<<16|g[7]<<24,q)},t.fromBytesBE=function(g,q){return new t(g[4]<<24|g[5]<<16|g[6]<<8|g[7],g[0]<<24|g[1]<<16|g[2]<<8|g[3],q)};var C=t;return n.default=C,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return JP}):typeof YC=="object"&&typeof ZP=="object"&&(YC.exports=JP)});var ew=A(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.loadFileDescriptorSetFromObject=_t.loadFileDescriptorSetFromBuffer=_t.fromJSON=_t.loadSync=_t.load=_t.IdempotencyLevel=_t.isAnyExtension=_t.Long=void 0;var p$=qO(),Mr=$p(),JC=WP(),ZC=XP(),m$=eM();_t.Long=m$;function g$(n){return"@type"in n&&typeof n["@type"]=="string"}_t.isAnyExtension=g$;var rM;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(rM=_t.IdempotencyLevel||(_t.IdempotencyLevel={}));var iM={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function y$(n,e){return n===""?e:n+"."+e}function _$(n){return n instanceof Mr.Service||n instanceof Mr.Type||n instanceof Mr.Enum}function v$(n){return n instanceof Mr.Namespace||n instanceof Mr.Root}function sM(n,e){let t=y$(e,n.name);return _$(n)?[[t,n]]:v$(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>sM(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function tM(n,e){return function(r){return n.toObject(n.decode(r),e)}}function nM(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function E$(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:rM.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function S$(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:nM(i),requestDeserialize:tM(i,t),responseSerialize:nM(s),responseDeserialize:tM(s,t),originalName:p$(n.name),requestType:XC(i,r),responseType:XC(s,r),options:E$(n.parsedOptions)}}function C$(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=S$(s,e,t,r);return i}function XC(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,iM),fileDescriptorProtos:e}}function w$(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,iM),fileDescriptorProtos:e}}function b$(n,e,t,r){if(n instanceof Mr.Service)return C$(n,e,t,r);if(n instanceof Mr.Type)return XC(n,r);if(n instanceof Mr.Enum)return w$(n,r);throw new Error("Type mismatch in reflection object handling")}function Qp(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(JC.FileDescriptorProto.encode(s).finish()));for(let[s,o]of sM(n,""))t[s]=b$(o,s,e,i);return t}function oM(n,e){e=e||{};let t=Mr.Root.fromDescriptor(n);return t.resolveAll(),Qp(t,e)}function T$(n,e){return(0,ZC.loadProtosWithOptions)(n,e).then(t=>Qp(t,e))}_t.load=T$;function I$(n,e){let t=(0,ZC.loadProtosWithOptionsSync)(n,e);return Qp(t,e)}_t.loadSync=I$;function A$(n,e){e=e||{};let t=Mr.Root.fromJSON(n);return t.resolveAll(),Qp(t,e)}_t.fromJSON=A$;function D$(n,e){let t=JC.FileDescriptorSet.decode(n);return oM(t,e)}_t.loadFileDescriptorSetFromBuffer=D$;function R$(n,e){let t=JC.FileDescriptorSet.fromObject(n);return oM(t,e)}_t.loadFileDescriptorSetFromObject=R$;(0,ZC.addCommonProtos)()});var vo=A(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.setup=ze.getChannelzServiceDefinition=ze.getChannelzHandlers=ze.unregisterChannelzRef=ze.registerChannelzSocket=ze.registerChannelzServer=ze.registerChannelzSubchannel=ze.registerChannelzChannel=ze.ChannelzCallTracker=ze.ChannelzChildrenTracker=ze.ChannelzTrace=void 0;var aM=Z("net"),ju=Rn(),Hu=Te(),k$=Ir(),N$=gp(),O$=XS();function tw(n){return{channel_id:n.id,name:n.name}}function sw(n){return{subchannel_id:n.id,name:n.name}}function x$(n){return{server_id:n.id}}function Xp(n){return{socket_id:n.id,name:n.name}}var lM=32,nw=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=lM*2&&(this.events=this.events.slice(lM)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:li(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:li(e.timestamp),channel_ref:e.childChannel?tw(e.childChannel):null,subchannel_ref:e.childSubchannel?sw(e.childSubchannel):null}))}}};ze.ChannelzTrace=nw;var rw=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};ze.ChannelzChildrenTracker=rw;var iw=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};ze.ChannelzCallTracker=iw;var P$=1;function Jp(){return P$++}var $u=[],ow=[],ss=[],aw=[];function M$(n,e,t){let r=Jp(),i={id:r,name:n,kind:"channel"};return t&&($u[r]={ref:i,getInfo:e}),i}ze.registerChannelzChannel=M$;function F$(n,e,t){let r=Jp(),i={id:r,name:n,kind:"subchannel"};return t&&(ow[r]={ref:i,getInfo:e}),i}ze.registerChannelzSubchannel=F$;function L$(n,e){let t=Jp(),r={id:t,kind:"server"};return e&&(ss[t]={ref:r,getInfo:n}),r}ze.registerChannelzServer=L$;function B$(n,e,t){let r=Jp(),i={id:r,name:n,kind:"socket"};return t&&(aw[r]={ref:i,getInfo:e}),i}ze.registerChannelzSocket=B$;function V$(n){switch(n.kind){case"channel":delete $u[n.id];return;case"subchannel":delete ow[n.id];return;case"server":delete ss[n.id];return;case"socket":delete aw[n.id];return}}ze.unregisterChannelzRef=V$;function U$(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function cM(n){if(n==="")return[];let e=n.split(":").map(r=>U$(r));return[].concat(...e)}function q$(n){if((0,aM.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,aM.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(cM(e)),s=Buffer.from(cM(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function dM(n){switch(n){case ju.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case ju.ConnectivityState.IDLE:return{state:"IDLE"};case ju.ConnectivityState.READY:return{state:"READY"};case ju.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case ju.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function li(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function hM(n){let e=n.getInfo();return{ref:tw(n.ref),data:{target:e.target,state:dM(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:li(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>tw(t)),subchannel_ref:e.children.subchannels.map(t=>sw(t))}}function z$(n,e){let t=Number.parseInt(n.request.channel_id),r=$u[t];if(r===void 0){e({code:Hu.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:hM(r)})}function G$(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<$u.length;i++){let s=$u[i];if(s!==void 0&&(r.push(hM(s)),r.length>=t))break}e(null,{channel:r,end:i>=ss.length})}function fM(n){let e=n.getInfo();return{ref:x$(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:li(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>Xp(t))}}function W$(n,e){let t=Number.parseInt(n.request.server_id),r=ss[t];if(r===void 0){e({code:Hu.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:fM(r)})}function j$(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<ss.length;i++){let s=ss[i];if(s!==void 0&&(r.push(fM(s)),r.length>=t))break}e(null,{server:r,end:i>=ss.length})}function $$(n,e){let t=Number.parseInt(n.request.subchannel_id),r=ow[t];if(r===void 0){e({code:Hu.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:sw(r.ref),data:{target:i.target,state:dM(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:li(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>Xp(o))};e(null,{subchannel:s})}function uM(n){var e;return(0,k$.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=q$(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function H$(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=aw[a];if(l===void 0){e({code:Hu.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:Xp(l.ref),local:c.localAddress?uM(c.localAddress):null,remote:c.remoteAddress?uM(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:li(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:li(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:li(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:li(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function K$(n,e){let t=Number.parseInt(n.request.server_id),r=ss[t];if(r===void 0){e({code:Hu.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(Xp(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function pM(){return{GetChannel:z$,GetTopChannels:G$,GetServer:W$,GetServers:j$,GetSubchannel:$$,GetSocket:H$,GetServerSockets:K$}}ze.getChannelzHandlers=pM;var Yp=null;function mM(){if(Yp)return Yp;let n=ew().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Yp=(0,O$.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Yp}ze.getChannelzServiceDefinition=mM;function Q$(){(0,N$.registerAdminService)(mM,pM)}ze.setup=Q$});var gM=A(em=>{"use strict";Object.defineProperty(em,"__esModule",{value:!0});em.Subchannel=void 0;var Pe=Rn(),Y$=Iu(),lw=Je(),Zp=Te(),X$=gn(),J$=Ir(),rl=vo(),Z$="subchannel",eH=~(1<<31),cw=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=Pe.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new rl.ChannelzCallTracker,this.childrenTracker=new rl.ChannelzChildrenTracker,this.streamTracker=new rl.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new Y$.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,J$.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new rl.ChannelzTrace,this.channelzRef=(0,rl.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){lw.trace(Zp.LogVerbosity.DEBUG,Z$,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){lw.trace(Zp.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([Pe.ConnectivityState.TRANSIENT_FAILURE],Pe.ConnectivityState.CONNECTING):this.transitionToState([Pe.ConnectivityState.TRANSIENT_FAILURE],Pe.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,eH);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([Pe.ConnectivityState.CONNECTING],Pe.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([Pe.ConnectivityState.READY],Pe.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,lw.log(Zp.LogVerbosity.ERROR,`Connection to ${(0,X$.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([Pe.ConnectivityState.CONNECTING],Pe.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(Pe.ConnectivityState[this.connectivityState]+" -> "+Pe.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Pe.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case Pe.ConnectivityState.READY:this.stopBackoff();break;case Pe.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case Pe.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case Pe.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,rl.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([Pe.ConnectivityState.CONNECTING,Pe.ConnectivityState.READY],Pe.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Zp.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([Pe.ConnectivityState.IDLE],Pe.ConnectivityState.CONNECTING)||this.connectivityState===Pe.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([Pe.ConnectivityState.TRANSIENT_FAILURE],Pe.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};em.Subchannel=cw});var fw=A(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});ls.setup=ls.DEFAULT_PORT=void 0;var yM=br(),vM=Z("dns"),EM=Z("util"),tH=bS(),uw=Te(),dw=nn(),nH=Je(),rH=Te(),os=gn(),_M=Z("net"),iH=Iu(),sH="dns_resolver";function as(n){nH.trace(rH.LogVerbosity.DEBUG,sH,n)}ls.DEFAULT_PORT=443;var oH=3e4,aH=EM.promisify(vM.resolveTxt),lH=EM.promisify(vM.lookup);function cH(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var hw=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,as("Resolver constructed for target "+(0,os.uriToString)(e));let a=(0,os.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,_M.isIPv4)(a.host)||(0,_M.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:ls.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:ls.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:uw.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,os.uriToString)(this.target)}`,metadata:new dw.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new iH.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:oH,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(as("Returning IP address for target "+(0,os.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)as("Failed to parse DNS address "+(0,os.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:uw.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,os.uriToString)(this.target)}`,metadata:new dw.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;as("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=lH(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=cH(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(as("Resolved addresses for target "+(0,os.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(as("Resolution error for target "+(0,os.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=aH(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,tH.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:uw.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new dw.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?as('resolution update delayed by "min time between resolutions" rate limit'):as("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function uH(){(0,yM.registerResolver)("dns",hw),(0,yM.registerDefaultScheme)("dns")}ls.setup=uH});var pw=A(ol=>{"use strict";Object.defineProperty(ol,"__esModule",{value:!0});ol.getProxiedConnection=ol.mapProxyName=void 0;var Ku=Je(),il=Te(),dH=br(),hH=Z("http"),fH=Z("tls"),pH=Je(),SM=Ir(),sl=gn(),mH=Z("url"),gH=fw(),yH="proxy";function cs(n){pH.trace(il.LogVerbosity.DEBUG,yH,n)}function _H(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new mH.URL(n)}catch{return(0,Ku.log)(il.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,Ku.log)(il.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,Ku.log)(il.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),cs("Proxy server "+o.address+" set by environment variable "+e),o}function vH(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(cs("No proxy server list set by environment variable "+e),n.split(",")):[]}function EH(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=_H();if(!i.address)return r;let s=(0,sl.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of vH())if(l===o)return cs("Not using proxy for target in no_proxy list: "+(0,sl.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,sl.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}ol.mapProxyName=EH;function SH(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,sl.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,sl.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:gH.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,SM.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,SM.subchannelAddressToString)(n);return cs("Using proxy "+u+" to connect to "+l.path),new Promise((d,h)=>{let p=hH.request(l);p.once("connect",(E,w,T)=>{var k;if(p.removeAllListeners(),w.removeAllListeners(),E.statusCode===200)if(cs("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let R=(0,dH.getDefaultAuthority)(s),O=(0,sl.splitHostPort)(R),F=(k=O?.host)!==null&&k!==void 0?k:R,W=fH.connect(Object.assign({host:F,servername:F,socket:w},t),()=>{cs("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:W,realTarget:s})});W.on("error",ee=>{cs("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+ee.message),h()})}else cs("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:w,realTarget:s});else(0,Ku.log)(il.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+E.statusCode),h()}),p.once("error",E=>{p.removeAllListeners(),(0,Ku.log)(il.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+E.message),h()}),p.end()})}ol.getProxiedConnection=SH});var gw=A(tm=>{"use strict";Object.defineProperty(tm,"__esModule",{value:!0});tm.StreamDecoder=void 0;var ci=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(ci||{}),mw=class{constructor(e){this.maxReadMessageLength=e,this.readState=ci.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case ci.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=ci.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case ci.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=ci.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=ci.NO_DATA,i.push(s)}}break;case ci.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=ci.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};tm.StreamDecoder=mw});var CM=A(nm=>{"use strict";Object.defineProperty(nm,"__esModule",{value:!0});nm.Http2SubchannelCall=void 0;var ui=Z("http2"),CH=Z("os"),Ie=Te(),us=nn(),wH=gw(),bH=Je(),TH=Te(),IH="subchannel_call";function AH(n){for(let[e,t]of Object.entries(CH.constants.errno))if(t===n)return e;return"Unknown system error "+n}var yw=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=Ie.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:Ie.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new wH.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let d of Object.keys(l))u+="		"+d+": "+l[d]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=Ie.Status.INTERNAL;break;case 401:this.mappedStatusCode=Ie.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=Ie.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=Ie.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=Ie.Status.UNAVAILABLE;break;default:this.mappedStatusCode=Ie.Status.UNKNOWN}if(c&ui.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let d;try{d=us.Metadata.fromHttp2Headers(l)}catch(h){this.endCall({code:Ie.Status.UNKNOWN,details:h.message,metadata:new us.Metadata});return}this.listener.onReceiveMetadata(d)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(Ie.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===Ie.Status.OK)return;let c,u="";switch(e.rstCode){case ui.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=Ie.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case ui.constants.NGHTTP2_REFUSED_STREAM:c=Ie.Status.UNAVAILABLE,u="Stream refused by server";break;case ui.constants.NGHTTP2_CANCEL:c=Ie.Status.CANCELLED,u="Call cancelled";break;case ui.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=Ie.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case ui.constants.NGHTTP2_INADEQUATE_SECURITY:c=Ie.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case ui.constants.NGHTTP2_INTERNAL_ERROR:c=Ie.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=Ie.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=Ie.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new us.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+AH(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:Ie.Status.UNAVAILABLE,details:"Connection dropped",metadata:new us.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){bH.trace(TH.LogVerbosity.DEBUG,IH,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===Ie.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==Ie.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=us.Metadata.fromHttp2Headers(e)}catch{r=new us.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===Ie.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in Ie.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===Ie.Status.OK?t=ui.constants.NGHTTP2_NO_ERROR:t=ui.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new us.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==Ie.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=Ie.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=Ie.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:Ie.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new us.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};nm.Http2SubchannelCall=yw});var _w=A(rm=>{"use strict";Object.defineProperty(rm,"__esModule",{value:!0});rm.getNextCallNumber=void 0;var DH=0;function RH(){return DH++}rm.getNextCallNumber=RH});var TM=A(sm=>{"use strict";Object.defineProperty(sm,"__esModule",{value:!0});sm.Http2SubchannelConnector=void 0;var ww=Z("http2"),wM=Z("tls"),vw=vo(),Qu=Te(),kH=pw(),ll=Je(),bM=br(),im=Ir(),al=gn(),NH=Z("net"),OH=CM(),xH=_w(),Ew="transport",PH="transport_flowctrl",MH=oS().version,{HTTP2_HEADER_AUTHORITY:FH,HTTP2_HEADER_CONTENT_TYPE:LH,HTTP2_HEADER_METHOD:BH,HTTP2_HEADER_PATH:VH,HTTP2_HEADER_TE:UH,HTTP2_HEADER_USER_AGENT:qH}=ww.constants,zH=2e4,GH=Buffer.from("too_many_pings","ascii"),Sw=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=zH,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new vw.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,im.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,vw.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${MH}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===ww.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(GH)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),ll.isTracerEnabled(Ew)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,im.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,im.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),h=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:h&&"raw"in h?h.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){ll.trace(Qu.LogVerbosity.DEBUG,Ew,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){ll.trace(Qu.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){ll.trace(Qu.LogVerbosity.DEBUG,PH,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){ll.trace(Qu.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[FH]=t,o[qH]=this.userAgent,o[LH]="application/grpc",o[BH]="POST",o[VH]=r,o[UH]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new OH.Http2SubchannelCall(a,l,i,this,(0,xH.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,vw.unregisterChannelzRef)(this.channelzRef)}},Cw=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){ll.trace(Qu.LogVerbosity.DEBUG,Ew,(0,al.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,al.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,al.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,im.subchannelAddressToString)(e)));let d=(0,bM.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),h=t._getConnectionOptions()||{};h.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?h.maxSessionMemory=r["grpc-node.max_session_memory"]:h.maxSessionMemory=Number.MAX_SAFE_INTEGER;let p="http://";if("secureContext"in h){if(p="https://",r["grpc.ssl_target_name_override"]){let T=r["grpc.ssl_target_name_override"];h.checkServerIdentity=(k,R)=>(0,wM.checkServerIdentity)(T,R),h.servername=T}else{let T=(c=(l=(0,al.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";h.servername=T}i.socket&&(h.createConnection=(T,k)=>i.socket)}else h.createConnection=(T,k)=>i.socket?i.socket:NH.connect(e);h=Object.assign(Object.assign(Object.assign({},h),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let E=ww.connect(p+d,h);this.session=E;let w="Failed to connect";E.unref(),E.once("connect",()=>{E.removeAllListeners(),s(new Sw(E,e,r,u)),this.session=null}),E.once("close",()=>{this.session=null,setImmediate(()=>{o(`${w} (${new Date().toISOString()})`)})}),E.once("error",T=>{w=T.message,this.trace("connection failed with error "+w)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,wM.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,bM.getDefaultAuthority)((i=(0,al.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,al.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,kH.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};sm.Http2SubchannelConnector=Cw});var IM=A(cl=>{"use strict";Object.defineProperty(cl,"__esModule",{value:!0});cl.getSubchannelPool=cl.SubchannelPool=void 0;var WH=cO(),jH=gM(),$H=Ir(),HH=gn(),KH=TM(),QH=1e4,Yu=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},QH),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,HH.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,$H.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,WH.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new jH.Subchannel(e,t,r,i,new KH.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};cl.SubchannelPool=Yu;var YH=new Yu;function XH(n){return n?YH:new Yu}cl.getSubchannelPool=XH});var Tw=A(ul=>{"use strict";Object.defineProperty(ul,"__esModule",{value:!0});ul.FilterStackFactory=ul.FilterStack=void 0;var om=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};ul.FilterStack=om;var bw=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new om(this.factories.map(e=>e.createFilter()))}};ul.FilterStackFactory=bw});var Iw=A(am=>{"use strict";Object.defineProperty(am,"__esModule",{value:!0});am.CompressionAlgorithms=void 0;var AM=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(AM||(am.CompressionAlgorithms=AM={}))});var Dw=A(lm=>{"use strict";Object.defineProperty(lm,"__esModule",{value:!0});lm.BaseFilter=void 0;var Aw=class{sendMetadata(e){return b(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return b(this,null,function*(){return e})}receiveMessage(e){return b(this,null,function*(){return e})}receiveTrailers(e){return e}};lm.BaseFilter=Aw});var kM=A(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});hl.CompressionFilterFactory=hl.CompressionFilter=void 0;var cm=Z("zlib"),RM=Iw(),um=Te(),JH=Dw(),ZH=Je(),e5=n=>typeof n=="number"&&typeof RM.CompressionAlgorithms[n]=="string",dl=class{writeMessage(e,t){return b(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return b(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},Eo=class extends dl{compressMessage(e){return b(this,null,function*(){return e})}writeMessage(e,t){return b(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},Rw=class extends dl{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{cm.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=cm.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:um.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},kw=class extends dl{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{cm.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=cm.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:um.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},Nw=class extends dl{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function DM(n,e){switch(n){case"identity":return new Eo;case"deflate":return new Rw(e);case"gzip":return new kw(e);default:return new Nw(n)}}var dm=class extends JH.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new Eo,this.receiveCompression=new Eo,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:um.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(e5(s)){let o=RM.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=DM(this.currentCompressionAlgorithm,-1))}else ZH.log(um.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return b(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=DM(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new Eo,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return b(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof Eo?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return b(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};hl.CompressionFilter=dm;var Ow=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new dm(this.options,this.sharedFilterConfig)}};hl.CompressionFilterFactory=Ow});var hm=A(Fr=>{"use strict";Object.defineProperty(Fr,"__esModule",{value:!0});Fr.deadlineToString=Fr.getRelativeTimeout=Fr.getDeadlineTimeoutString=Fr.minDeadline=void 0;function t5(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}Fr.minDeadline=t5;var n5=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function r5(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of n5){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}Fr.getDeadlineTimeoutString=r5;var i5=2147483647;function s5(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>i5?1/0:r}Fr.getRelativeTimeout=s5;function o5(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}Fr.deadlineToString=o5});var pm=A(fm=>{"use strict";Object.defineProperty(fm,"__esModule",{value:!0});fm.restrictControlPlaneStatusCode=void 0;var Lr=Te(),a5=[Lr.Status.OK,Lr.Status.INVALID_ARGUMENT,Lr.Status.NOT_FOUND,Lr.Status.ALREADY_EXISTS,Lr.Status.FAILED_PRECONDITION,Lr.Status.ABORTED,Lr.Status.OUT_OF_RANGE,Lr.Status.DATA_LOSS];function l5(n,e){return a5.includes(n)?{code:Lr.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${Lr.Status[n]} ${e}`}:{code:n,details:e}}fm.restrictControlPlaneStatusCode=l5});var OM=A(ym=>{"use strict";Object.defineProperty(ym,"__esModule",{value:!0});ym.LoadBalancingCall=void 0;var NM=Rn(),mm=Te(),c5=hm(),gm=nn(),Xu=Ki(),u5=gn(),d5=Je(),xw=pm(),h5=Z("http2"),f5="load_balancing_call",Pw=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let h=(c=(l=(0,u5.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${h}/${d}`}trace(e){d5.trace(mm.LogVerbosity.DEBUG,f5,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+Xu.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case Xu.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:mm.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new gm.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==NM.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+NM.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,c5.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:h=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(h)},onReceiveMessage:h=>{this.trace("Received message"),this.listener.onReceiveMessage(h)},onReceiveStatus:h=>{this.trace("Received status"),h.rstCode===h5.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(h,"REFUSED"):this.outputStatus(h,"PROCESSED")}})}catch(h){this.trace("Failed to start call on picked subchannel "+i+" with error "+h.message),this.outputStatus({code:mm.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+h.message,metadata:new gm.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,xw.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:mm.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new gm.Metadata},"PROCESSED")});break;case Xu.PickResultType.DROP:let{code:s,details:o}=(0,xw.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case Xu.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,xw.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case Xu.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new gm.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};ym.LoadBalancingCall=Pw});var PM=A(vm=>{"use strict";Object.defineProperty(vm,"__esModule",{value:!0});vm.ResolvingCall=void 0;var fl=Te(),_m=hm(),xM=nn(),p5=Je(),m5=pm(),g5="resolving_call",Mw=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&fl.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(fl.Status.CANCELLED,"Cancelled by parent call")}),r.flags&fl.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,_m.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){p5.trace(fl.LogVerbosity.DEBUG,g5,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,_m.deadlineToString)(this.deadline));let e=(0,_m.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(fl.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==fl.Status.OK){let{code:r,details:i}=(0,m5.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new xM.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,_m.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new xM.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};vm.ResolvingCall=Mw});var MM=A(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.RetryingCall=ds.MessageBufferTracker=ds.RetryThrottler=void 0;var Em=Te(),y5=nn(),_5=Je(),v5="retrying_call",Lw=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};ds.RetryThrottler=Lw;var Bw=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};ds.MessageBufferTracker=Bw;var Fw="grpc-previous-rpc-attempts",Vw=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){_5.trace(Em.LogVerbosity.DEBUG,v5,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new y5.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(Em.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===Em.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===Em.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(Fw,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(Fw,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(Fw,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};ds.RetryingCall=Vw});var Cm=A(Sm=>{"use strict";Object.defineProperty(Sm,"__esModule",{value:!0});Sm.BaseSubchannelWrapper=void 0;var Uw=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};Sm.BaseSubchannelWrapper=Uw});var BM=A(Tm=>{"use strict";Object.defineProperty(Tm,"__esModule",{value:!0});Tm.InternalChannel=void 0;var E5=ap(),S5=lO(),C5=IM(),FM=Ki(),Ju=Te(),w5=Tw(),b5=kM(),LM=br(),qw=Je(),T5=pw(),wm=gn(),Br=Rn(),Zu=vo(),I5=OM(),A5=hm(),D5=PM(),zw=_w(),R5=pm(),Gw=MM(),k5=Cm(),N5=2147483647,O5=1e3,x5=30*60*1e3,bm=new Map,P5=1<<24,M5=1<<20,Ww=class extends k5.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},jw=class{constructor(e,t,r){var i,s,o,a,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=Br.ConnectivityState.IDLE,this.currentPicker=new FM.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Zu.ChannelzCallTracker,this.childrenTracker=new Zu.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof E5.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let h=(0,wm.parseUri)(e);if(h===null)throw new Error(`Could not parse target name "${e}"`);let p=(0,LM.mapUriDefaultScheme)(h);if(p===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},N5),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Zu.ChannelzTrace,this.channelzRef=(0,Zu.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,LM.getDefaultAuthority)(p);let E=(0,T5.mapProxyName)(p,r);this.target=E.target,this.options=Object.assign({},this.options,E.extraOptions),this.subchannelPool=(0,C5.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new Gw.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:P5,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:M5),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:x5,O5);let w={createSubchannel:(k,R)=>{let O=this.subchannelPool.getOrCreateSubchannel(this.target,k,Object.assign({},this.options,R),this.credentials);O.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",O.getChannelzRef());let F=new Ww(O,this);return this.wrappedSubchannels.add(F),F},updateState:(k,R)=>{this.currentPicker=R;let O=this.pickQueue.slice();this.pickQueue=[],O.length>0&&this.callRefTimerUnref();for(let F of O)F.doPick();this.updateState(k)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:k=>{this.channelzEnabled&&this.childrenTracker.refChild(k)},removeChannelzChild:k=>{this.channelzEnabled&&this.childrenTracker.unrefChild(k)}};this.resolvingLoadBalancer=new S5.ResolvingLoadBalancer(this.target,w,r,(k,R)=>{k.retryThrottling?bm.set(this.getTarget(),new Gw.RetryThrottler(k.retryThrottling.maxTokens,k.retryThrottling.tokenRatio,bm.get(this.getTarget()))):bm.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=R,this.currentResolutionError=null,process.nextTick(()=>{let O=this.configSelectionQueue;this.configSelectionQueue=[],O.length>0&&this.callRefTimerUnref();for(let F of O)F.getConfig()})},k=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+k.code+' and details "'+k.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,R5.restrictControlPlaneStatusCode)(k.code,k.details)),{metadata:k.metadata}));let R=this.configSelectionQueue;this.configSelectionQueue=[],R.length>0&&this.callRefTimerUnref();for(let O of R)O.reportResolverError(k)}),this.filterStackFactory=new w5.FilterStackFactory([new b5.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let T=new Error;(0,qw.trace)(Ju.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=T.stack)===null||d===void 0?void 0:d.substring(T.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,qw.trace)(t??Ju.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,wm.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,qw.trace)(Ju.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,wm.uriToString)(this.target)+" "+Br.ConnectivityState[this.connectivityState]+" -> "+Br.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Br.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==Br.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Br.ConnectivityState.IDLE),this.currentPicker=new FM.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==Br.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===Ju.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,zw.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new I5.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,zw.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new Gw.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,bm.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,zw.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,A5.deadlineToString)(t));let a={deadline:t,flags:s??Ju.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new D5.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Br.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Zu.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,wm.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===Br.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Br.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};Tm.InternalChannel=jw});var QS=A(Im=>{"use strict";Object.defineProperty(Im,"__esModule",{value:!0});Im.ChannelImplementation=void 0;var F5=ap(),L5=BM(),$w=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof F5.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new L5.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};Im.ChannelImplementation=$w});var HM=A(Bn=>{"use strict";Object.defineProperty(Bn,"__esModule",{value:!0});Bn.Http2ServerCallStream=Bn.ServerDuplexStreamImpl=Bn.ServerWritableStreamImpl=Bn.ServerReadableStreamImpl=Bn.ServerUnaryCallImpl=void 0;var WM=Z("events"),pl=Z("http2"),Qw=Z("stream"),VM=Z("zlib"),Fe=Te(),Yw=nn(),B5=gw(),jM=Je(),td=tp(),$M="server_call";function ed(n){jM.trace(Fe.LogVerbosity.DEBUG,$M,n)}var V5="grpc-accept-encoding",U5="grpc-encoding",UM="grpc-message",qM="grpc-status",zM="grpc-timeout",q5=/(\d{1,8})\s*([HMSmun])/,z5={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},G5={[V5]:"identity,deflate,gzip",[U5]:"identity"},GM={[pl.constants.HTTP2_HEADER_STATUS]:pl.constants.HTTP_STATUS_OK,[pl.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},W5={waitForTrailers:!0},Hw=class extends WM.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};Bn.ServerUnaryCallImpl=Hw;var Am=class extends Qw.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};Bn.ServerReadableStreamImpl=Am;var nd=class extends Qw.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new Yw.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,td.getErrorMessage)(i),code:Fe.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Fe.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};Bn.ServerWritableStreamImpl=nd;var ml=class extends Qw.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new Yw.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};Bn.ServerDuplexStreamImpl=ml;ml.prototype._read=Am.prototype._read;ml.prototype._write=nd.prototype._write;ml.prototype._final=nd.prototype._final;var Kw=class extends WM.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Fe.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Fe.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;ed("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Fe.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=VM.createInflate():i=VM.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:Fe.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:Fe.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},GM),G5),t);this.stream.respond(r,W5)}receiveMetadata(e){let t=Yw.Metadata.fromHttp2Headers(e);jM.isTracerEnabled($M)&&ed("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(zM);if(r.length>0){let i=r[0].toString().match(q5);if(i===null){let a=new Error("Invalid deadline");return a.code=Fe.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*z5[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(j5,s,this),t.remove(zM)}return t.remove(pl.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(pl.constants.HTTP2_HEADER_TE),t.remove(pl.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Fe.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:Fe.Status.INTERNAL,details:d.message});return}if(s===0){r({code:Fe.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let h=Buffer.concat(a,s),E=h.readUInt8(0)===1?e:"identity",w=o.getDecompressedMessage(h,E);if(Buffer.isBuffer(w)){t(o.deserializeMessageWithInternalError(w));return}w.then(T=>t(o.deserializeMessageWithInternalError(T)),T=>r(T.code?T:{code:Fe.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return b(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,td.getErrorMessage)(t),code:Fe.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return b(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Fe.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,td.getErrorMessage)(s),code:Fe.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Fe.Status.OK),!this.checkCancelled())if(ed("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Fe.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[qM]:e.code,[UM]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[qM]:e.code,[UM]:encodeURI(e.details)},GM),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Fe.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Fe.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new B5.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=()=>b(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>b(this,null,function*(){let c;try{c=r.write(l)}catch(u){this.sendError({code:Fe.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let h=u.readUInt8(0)===1?t:"identity",p;try{p=yield this.getDecompressedMessage(u,h)}catch(E){this.sendError(E);return}if(!p)return;yield this.pushOrBufferMessage(e,p)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>b(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return b(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return b(this,null,function*(){if(t===null){ed("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}ed("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,td.getErrorCode)(r);(i===null||i<Fe.Status.OK||i>Fe.Status.UNAUTHENTICATED)&&(i=Fe.Status.INTERNAL),e.emit("error",{details:(0,td.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};Bn.Http2ServerCallStream=Kw;function j5(n){let e=new Error("Deadline exceeded");e.code=Fe.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var Zw=A(Dm=>{"use strict";Object.defineProperty(Dm,"__esModule",{value:!0});Dm.ServerCredentials=void 0;var KM=vS(),rd=class{static createInsecure(){return new Xw}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new Jw({ca:e||(0,KM.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:KM.CIPHER_SUITES})}};Dm.ServerCredentials=rd;var Xw=class extends rd{_isSecure(){return!1}_getSettings(){return null}},Jw=class extends rd{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var XM=A(Nm=>{"use strict";Object.defineProperty(Nm,"__esModule",{value:!0});Nm.Server=void 0;var hs=Z("http2"),di=Te(),So=HM(),$5=Zw(),QM=br(),Rm=Je(),nr=Ir(),H5=gn(),on=vo(),km=~(1<<31),K5=~(1<<31),Q5=2e4,{HTTP2_HEADER_PATH:YM}=hs.constants,Y5="server";function X5(){}function eb(n){return{code:di.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function J5(n,e){let t=eb(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var tb=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new on.ChannelzTrace,this.callTracker=new on.ChannelzCallTracker,this.listenerChildrenTracker=new on.ChannelzChildrenTracker,this.sessionChildrenTracker=new on.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,on.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:km,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:km,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:K5,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:Q5,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,nr.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,nr.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,h=d.getCipher(),p=d.getCertificate(),E=d.getPeerCertificate();c={cipherSuiteStandardName:(t=h.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:h.standardName?null:h.name,localCertificate:p&&"raw"in p?p.raw:null,remoteCertificate:E&&"raw"in E?E.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){Rm.trace(di.LogVerbosity.DEBUG,Y5,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=J5(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof $5.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,H5.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,QM.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(p,E)=>{process.nextTick(()=>r(p,E))},l=()=>{let p;if(t._isSecure()){let E=Object.assign(o,t._getSettings());E.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,p=hs.createSecureServer(E),p.on("secureConnection",w=>{w.on("error",T=>{this.trace("An incoming TLS connection closed with error: "+T.message)})})}else p=hs.createServer(o);return p.setTimeout(0,X5),this._setupHandlers(p),p},c=(p,E,w)=>p.length===0?Promise.resolve({port:E,count:w}):Promise.all(p.map(T=>{this.trace("Attempting to bind "+(0,nr.subchannelAddressToString)(T));let k;(0,nr.isTcpSubchannelAddress)(T)?k={host:T.host,port:E}:k=T;let R=l();return new Promise((O,F)=>{let W=ee=>{this.trace("Failed to bind "+(0,nr.subchannelAddressToString)(T)+" with error "+ee.message),O(ee)};R.once("error",W),R.listen(k,()=>{if(this.shutdown){R.close(),O(new Error("bindAsync failed because server is shutdown"));return}let ee=R.address(),S;typeof ee=="string"?S={path:ee}:S={host:ee.address,port:ee.port};let y=(0,on.registerChannelzSocket)((0,nr.subchannelAddressToString)(S),()=>({localAddress:S,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(y),this.http2ServerList.push({server:R,channelzRef:y}),this.trace("Successfully bound "+(0,nr.subchannelAddressToString)(S)),O("port"in S?S.port:E),R.removeListener("error",W)})})})).then(T=>{let k=0;for(let R of T)if(typeof R=="number"&&(k+=1,R!==E))throw new Error("Invalid state: multiple port numbers added from single address");return{port:E,count:k+w}}),u=p=>{if(p.length===0)return Promise.resolve({port:0,count:0});let E=p[0],w=l();return new Promise((T,k)=>{let R=O=>{this.trace("Failed to bind "+(0,nr.subchannelAddressToString)(E)+" with error "+O.message),T(u(p.slice(1)))};w.once("error",R),w.listen(E,()=>{if(this.shutdown){w.close(),T({port:0,count:0});return}let O=w.address(),F={host:O.address,port:O.port},W=(0,on.registerChannelzSocket)((0,nr.subchannelAddressToString)(F),()=>({localAddress:F,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(W),this.http2ServerList.push({server:w,channelzRef:W}),this.trace("Successfully bound "+(0,nr.subchannelAddressToString)(F)),T(c(p.slice(1),O.port,1)),w.removeListener("error",R)})})},d={onSuccessfulResolution:(p,E,w)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),p.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let T;(0,nr.isTcpSubchannelAddress)(p[0])?p[0].port===0?T=u(p):T=c(p,p[0].port,0):T=c(p,1,0),T.then(k=>{if(k.count===0){let R=`No address added out of total ${p.length} resolved`;Rm.log(di.LogVerbosity.ERROR,R),a(new Error(R),0)}else k.count<p.length&&Rm.log(di.LogVerbosity.INFO,`WARNING Only ${k.count} addresses added out of total ${p.length} resolved`),a(null,k.port)},k=>{let R=`No address added out of total ${p.length} resolved`;Rm.log(di.LogVerbosity.ERROR,R),a(new Error(R),0)})},onError:p=>{a(new Error(p.details),0)}};(0,QM.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,on.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(hs.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,on.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,on.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,on.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[hs.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[hs.constants.HTTP2_HEADER_STATUS]:hs.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new So.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=di.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[YM],s=this._retrieveHandler(i);if(!s){this._respondWithError(eb(i),e,r);return}let o=new So.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===di.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:di.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[YM],i=this._retrieveHandler(r);if(!i){this._respondWithError(eb(r),e,null);return}let s=new So.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:di.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")Z5(e,t,s,o);else if(a==="clientStream")eK(e,t,s,o);else if(a==="serverStream")tK(e,t,s,o);else if(a==="bidi")nK(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,on.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),h={ref:d,streamTracker:new on.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,h);let p=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+p),this.sessionChildrenTracker.refChild(d));let E=null,w=null,T=!1;if(this.maxConnectionAgeMs!==km){let R=this.maxConnectionAgeMs/10,O=Math.random()*R*2-R;E=(l=(a=setTimeout(()=>{var F,W;T=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+p);try{s.goaway(hs.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==km&&(w=(W=(F=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||W===void 0?void 0:W.call(F))},this.maxConnectionAgeMs+O)).unref)===null||l===void 0?void 0:l.call(a)}let k=(u=(c=setInterval(()=>{var R,O;let F=(O=(R=setTimeout(()=>{T=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+p),s.close()},this.keepaliveTimeoutMs)).unref)===null||O===void 0?void 0:O.call(R);try{s.ping((W,ee,S)=>{clearTimeout(F)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(T||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+p),this.sessionChildrenTracker.unrefChild(d),(0,on.unregisterChannelzRef)(d)),E&&clearTimeout(E),w&&clearTimeout(w),k&&clearTimeout(k),this.sessions.delete(s)})})}};Nm.Server=tb;function Z5(n,e,t,r){return b(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new So.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function eK(n,e,t,r){let i=new So.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function tK(n,e,t,r){return b(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new So.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function nK(n,e,t,r){let i=new So.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var JM=A(Om=>{"use strict";Object.defineProperty(Om,"__esModule",{value:!0});Om.StatusBuilder=void 0;var nb=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Om.StatusBuilder=nb});var rb=A(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.isDuration=fs.durationToMs=fs.msToDuration=void 0;function rK(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}fs.msToDuration=rK;function iK(n){return n.seconds*1e3+n.nanos/1e6|0}fs.durationToMs=iK;function sK(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}fs.isDuration=sK});var db=A(ps=>{"use strict";var ib;Object.defineProperty(ps,"__esModule",{value:!0});ps.setup=ps.OutlierDetectionLoadBalancer=ps.OutlierDetectionLoadBalancingConfig=void 0;var Pm=Rn(),eF=Te(),Co=rb(),tF=hb(),nF=Wi(),oK=pp(),aK=Ki(),ZM=Ir(),lK=Cm(),cK=Je(),uK="outlier_detection";function At(n){cK.trace(eF.LogVerbosity.DEBUG,uK,n)}var ub="outlier_detection",dK=((ib=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&ib!==void 0?ib:"true")==="true",hK={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},fK={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function gl(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function sb(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,Co.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function xm(n,e,t){let r=t?`${t}.${e}`:e;if(gl(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var id=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},hK),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},fK),o):null}getLoadBalancerName(){return ub}toJsonObject(){return{interval:(0,Co.msToDuration)(this.intervalMs),base_ejection_time:(0,Co.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,Co.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(sb(e,"interval"),sb(e,"base_ejection_time"),sb(e,"max_ejection_time"),xm(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");gl(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),xm(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),gl(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),gl(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");xm(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),xm(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),gl(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),gl(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,Co.durationToMs)(e.interval):null,e.base_ejection_time?(0,Co.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,Co.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(nF.validateLoadBalancingConfig))}};ps.OutlierDetectionLoadBalancingConfig=id;var ab=class extends lK.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Pm.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Pm.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Pm.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function ob(){return{success:0,failure:0}}var lb=class{constructor(){this.activeBucket=ob(),this.inactiveBucket=ob()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=ob()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},cb=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===aK.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===eF.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Mm=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new oK.ChildLoadBalancerHandler((0,tF.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,ZM.subchannelAddressToString)(t)),o=new ab(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Pm.ConnectivityState.READY?e.updateState(t,new cb(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;At("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,h]of this.addressMap){let p=h.counter.getLastSuccesses(),E=h.counter.getLastFailures();At("Stats for "+d+": successes="+p+" failures="+E+" targetRequestVolume="+r),p+E>=r&&(i+=1,s.push(p/(p+E)))}if(At("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((d,h)=>d+h)/s.length,a=0;for(let d of s){let h=d-o;a+=h*h}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);At("stdev="+c+" ejectionThreshold="+u);for(let[d,h]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let p=h.counter.getLastSuccesses(),E=h.counter.getLastFailures();if(p+E<r)continue;let w=p/(p+E);if(At("Checking candidate "+d+" successRate="+w),w<u){let T=Math.random()*100;At("Candidate "+d+" randomNumber="+T+" enforcement_percentage="+t.enforcement_percentage),T<t.enforcement_percentage&&(At("Ejecting candidate "+d),this.eject(h,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;At("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(At("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;At("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(At("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(At("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(At("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof id))return;let i=new Set;for(let o of e)i.add((0,ZM.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(At("Adding map entry for "+o),this.addressMap.set(o,{counter:new lb,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(At("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,nF.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){At("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else At("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{At("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return ub}};ps.OutlierDetectionLoadBalancer=Mm;function pK(){dK&&(0,tF.registerLoadBalancerType)(ub,Mm,id)}ps.setup=pK});var hb=A(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.OutlierDetectionLoadBalancingConfig=ie.BaseSubchannelWrapper=ie.registerAdminService=ie.FilterStackFactory=ie.BaseFilter=ie.PickResultType=ie.QueuePicker=ie.UnavailablePicker=ie.ChildLoadBalancerHandler=ie.subchannelAddressToString=ie.validateLoadBalancingConfig=ie.getFirstUsableConfig=ie.registerLoadBalancerType=ie.createChildChannelControlHelper=ie.BackoffTimeout=ie.durationToMs=ie.uriToString=ie.createResolver=ie.registerResolver=ie.log=ie.trace=void 0;var rF=Je();Object.defineProperty(ie,"trace",{enumerable:!0,get:function(){return rF.trace}});Object.defineProperty(ie,"log",{enumerable:!0,get:function(){return rF.log}});var iF=br();Object.defineProperty(ie,"registerResolver",{enumerable:!0,get:function(){return iF.registerResolver}});Object.defineProperty(ie,"createResolver",{enumerable:!0,get:function(){return iF.createResolver}});var mK=gn();Object.defineProperty(ie,"uriToString",{enumerable:!0,get:function(){return mK.uriToString}});var gK=rb();Object.defineProperty(ie,"durationToMs",{enumerable:!0,get:function(){return gK.durationToMs}});var yK=Iu();Object.defineProperty(ie,"BackoffTimeout",{enumerable:!0,get:function(){return yK.BackoffTimeout}});var Fm=Wi();Object.defineProperty(ie,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Fm.createChildChannelControlHelper}});Object.defineProperty(ie,"registerLoadBalancerType",{enumerable:!0,get:function(){return Fm.registerLoadBalancerType}});Object.defineProperty(ie,"getFirstUsableConfig",{enumerable:!0,get:function(){return Fm.getFirstUsableConfig}});Object.defineProperty(ie,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Fm.validateLoadBalancingConfig}});var _K=Ir();Object.defineProperty(ie,"subchannelAddressToString",{enumerable:!0,get:function(){return _K.subchannelAddressToString}});var vK=pp();Object.defineProperty(ie,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return vK.ChildLoadBalancerHandler}});var fb=Ki();Object.defineProperty(ie,"UnavailablePicker",{enumerable:!0,get:function(){return fb.UnavailablePicker}});Object.defineProperty(ie,"QueuePicker",{enumerable:!0,get:function(){return fb.QueuePicker}});Object.defineProperty(ie,"PickResultType",{enumerable:!0,get:function(){return fb.PickResultType}});var EK=Dw();Object.defineProperty(ie,"BaseFilter",{enumerable:!0,get:function(){return EK.BaseFilter}});var SK=Tw();Object.defineProperty(ie,"FilterStackFactory",{enumerable:!0,get:function(){return SK.FilterStackFactory}});var CK=gp();Object.defineProperty(ie,"registerAdminService",{enumerable:!0,get:function(){return CK.registerAdminService}});var wK=Cm();Object.defineProperty(ie,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return wK.BaseSubchannelWrapper}});var bK=db();Object.defineProperty(ie,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return bK.OutlierDetectionLoadBalancingConfig}})});var sF=A(Lm=>{"use strict";Object.defineProperty(Lm,"__esModule",{value:!0});Lm.setup=void 0;var TK=br(),pb=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function IK(){(0,TK.registerResolver)("unix",pb)}Lm.setup=IK});var uF=A(Um=>{"use strict";Object.defineProperty(Um,"__esModule",{value:!0});Um.setup=void 0;var oF=Z("net"),Bm=Te(),mb=nn(),aF=br(),lF=gn(),AK=Je(),DK="ip_resolver";function cF(n){AK.trace(Bm.LogVerbosity.DEBUG,DK,n)}var gb="ipv4",yb="ipv6",RK=443,Vm=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,cF("Resolver constructed for target "+(0,lF.uriToString)(e));let s=[];if(!(e.scheme===gb||e.scheme===yb)){this.error={code:Bm.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new mb.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,lF.splitHostPort)(a);if(l===null){this.error={code:Bm.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new mb.Metadata};return}if(e.scheme===gb&&!(0,oF.isIPv4)(l.host)||e.scheme===yb&&!(0,oF.isIPv6)(l.host)){this.error={code:Bm.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new mb.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:RK})}this.addresses=s,cF("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function kK(){(0,aF.registerResolver)(gb,Vm),(0,aF.registerResolver)(yb,Vm)}Um.setup=kK});var fF=A(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.setup=Vr.PickFirstLoadBalancer=Vr.shuffled=Vr.PickFirstLoadBalancingConfig=void 0;var dF=Wi(),Ft=Rn(),qm=Ki(),NK=Je(),OK=Te(),xK="pick_first";function _b(n){NK.trace(OK.LogVerbosity.DEBUG,xK,n)}var sd="pick_first",PK=250,od=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return sd}toJsonObject(){return{[sd]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};Vr.PickFirstLoadBalancingConfig=od;var vb=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:qm.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function hF(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}Vr.shuffled=hF;var zm=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=Ft.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(Ft.ConnectivityState.READY,new vb(this.currentPick)):this.children.length===0?this.updateState(Ft.ConnectivityState.IDLE,new qm.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Ft.ConnectivityState.TRANSIENT_FAILURE,new qm.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Ft.ConnectivityState.CONNECTING,new qm.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==Ft.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===Ft.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===Ft.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===Ft.ConnectivityState.IDLE||i===Ft.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Ft.ConnectivityState.IDLE&&(_b("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},PK)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(_b("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){_b(Ft.ConnectivityState[this.currentState]+" -> "+Ft.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===Ft.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===Ft.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof od&&(t.getShuffleAddressList()&&(e=hF(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===Ft.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return sd}};Vr.PickFirstLoadBalancer=zm;function MK(){(0,dF.registerLoadBalancerType)(sd,zm,od),(0,dF.registerDefaultLoadBalancerType)(sd)}Vr.setup=MK});var mF=A(yl=>{"use strict";Object.defineProperty(yl,"__esModule",{value:!0});yl.setup=yl.RoundRobinLoadBalancer=void 0;var FK=Wi(),Lt=Rn(),Gm=Ki(),LK=Ir(),BK=Je(),VK=Te(),UK="round_robin";function pF(n){BK.trace(VK.LogVerbosity.DEBUG,UK,n)}var Wm="round_robin",Eb=class n{getLoadBalancerName(){return Wm}constructor(){}toJsonObject(){return{[Wm]:{}}}static createFromJson(e){return new n}},Sb=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Gm.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},jm=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=Lt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===Lt.ConnectivityState.TRANSIENT_FAILURE||i===Lt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(Lt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===Lt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(Lt.ConnectivityState.READY,new Sb(e,t))}else this.countSubchannelsWithState(Lt.ConnectivityState.CONNECTING)>0?this.updateState(Lt.ConnectivityState.CONNECTING,new Gm.QueuePicker(this)):this.countSubchannelsWithState(Lt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(Lt.ConnectivityState.TRANSIENT_FAILURE,new Gm.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Lt.ConnectivityState.IDLE,new Gm.QueuePicker(this))}updateState(e,t){pF(Lt.ConnectivityState[this.currentState]+" -> "+Lt.ConnectivityState[e]),e===Lt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),pF("Connect to address list "+e.map(r=>(0,LK.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===Lt.ConnectivityState.IDLE||i===Lt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Wm}};yl.RoundRobinLoadBalancer=jm;function qK(){(0,FK.registerLoadBalancerType)(Wm,jm,Eb)}yl.setup=qK});var vF=A(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.experimental=j.addAdminServicesToServer=j.getChannelzHandlers=j.getChannelzServiceDefinition=j.InterceptorConfigurationError=j.InterceptingCall=j.RequesterBuilder=j.ListenerBuilder=j.StatusBuilder=j.getClientChannel=j.ServerCredentials=j.Server=j.setLogVerbosity=j.setLogger=j.load=j.loadObject=j.CallCredentials=j.ChannelCredentials=j.waitForClientReady=j.closeClient=j.Channel=j.makeGenericClientConstructor=j.makeClientConstructor=j.loadPackageDefinition=j.Client=j.compressionAlgorithms=j.propagate=j.connectivityState=j.status=j.logVerbosity=j.Metadata=j.credentials=void 0;var $m=yS();Object.defineProperty(j,"CallCredentials",{enumerable:!0,get:function(){return $m.CallCredentials}});var zK=QS();Object.defineProperty(j,"Channel",{enumerable:!0,get:function(){return zK.ChannelImplementation}});var GK=Iw();Object.defineProperty(j,"compressionAlgorithms",{enumerable:!0,get:function(){return GK.CompressionAlgorithms}});var WK=Rn();Object.defineProperty(j,"connectivityState",{enumerable:!0,get:function(){return WK.ConnectivityState}});var Hm=ap();Object.defineProperty(j,"ChannelCredentials",{enumerable:!0,get:function(){return Hm.ChannelCredentials}});var gF=KS();Object.defineProperty(j,"Client",{enumerable:!0,get:function(){return gF.Client}});var Cb=Te();Object.defineProperty(j,"logVerbosity",{enumerable:!0,get:function(){return Cb.LogVerbosity}});Object.defineProperty(j,"status",{enumerable:!0,get:function(){return Cb.Status}});Object.defineProperty(j,"propagate",{enumerable:!0,get:function(){return Cb.Propagate}});var yF=Je(),wb=XS();Object.defineProperty(j,"loadPackageDefinition",{enumerable:!0,get:function(){return wb.loadPackageDefinition}});Object.defineProperty(j,"makeClientConstructor",{enumerable:!0,get:function(){return wb.makeClientConstructor}});Object.defineProperty(j,"makeGenericClientConstructor",{enumerable:!0,get:function(){return wb.makeClientConstructor}});var jK=nn();Object.defineProperty(j,"Metadata",{enumerable:!0,get:function(){return jK.Metadata}});var $K=XM();Object.defineProperty(j,"Server",{enumerable:!0,get:function(){return $K.Server}});var HK=Zw();Object.defineProperty(j,"ServerCredentials",{enumerable:!0,get:function(){return HK.ServerCredentials}});var KK=JM();Object.defineProperty(j,"StatusBuilder",{enumerable:!0,get:function(){return KK.StatusBuilder}});j.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:Hm.ChannelCredentials.createInsecure,createSsl:Hm.ChannelCredentials.createSsl,createFromSecureContext:Hm.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:$m.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:$m.CallCredentials.createFromGoogleCredential,createEmpty:$m.CallCredentials.createEmpty};var QK=n=>n.close();j.closeClient=QK;var YK=(n,e,t)=>n.waitForReady(e,t);j.waitForClientReady=YK;var XK=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};j.loadObject=XK;var JK=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};j.load=JK;var ZK=n=>{yF.setLogger(n)};j.setLogger=ZK;var e8=n=>{yF.setLoggerVerbosity(n)};j.setLogVerbosity=e8;var t8=n=>gF.Client.prototype.getChannel.call(n);j.getClientChannel=t8;var Km=jS();Object.defineProperty(j,"ListenerBuilder",{enumerable:!0,get:function(){return Km.ListenerBuilder}});Object.defineProperty(j,"RequesterBuilder",{enumerable:!0,get:function(){return Km.RequesterBuilder}});Object.defineProperty(j,"InterceptingCall",{enumerable:!0,get:function(){return Km.InterceptingCall}});Object.defineProperty(j,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Km.InterceptorConfigurationError}});var _F=vo();Object.defineProperty(j,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return _F.getChannelzServiceDefinition}});Object.defineProperty(j,"getChannelzHandlers",{enumerable:!0,get:function(){return _F.getChannelzHandlers}});var n8=gp();Object.defineProperty(j,"addAdminServicesToServer",{enumerable:!0,get:function(){return n8.addAdminServicesToServer}});var r8=hb();j.experimental=r8;var i8=fw(),s8=sF(),o8=uF(),a8=fF(),l8=mF(),c8=db(),u8=vo();i8.setup(),s8.setup(),o8.setup(),a8.setup(),l8.setup(),c8.setup(),u8.setup()});var oD=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=fr({type:n,selectors:[["app-navbar"]],standalone:!0,features:[mr],decls:19,vars:0,consts:[[1,"text-center"],[1,"navbar","navbar-expand-lg","bg-body-tertiary"],[1,"container-fluid","justify-content-center"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarSupportedContent",1,"collapse","navbar-collapse"],[1,"navbar-nav","mx-auto","mb-2","mb-lg-0","justify-content-center"],[1,"nav-item"],["aria-current","page","routerLink","home",1,"nav-link","active","text-center"],["routerLink","makeupproducts",1,"nav-link"],["routerLink","shades",1,"nav-link"]],template:function(r,i){r&1&&(z(0,"div",0)(1,"h1")(2,"b"),ne(3,"MAYBELLINE"),K()()(),z(4,"nav",1)(5,"div",2)(6,"button",3),me(7,"span",4),K(),z(8,"div",5)(9,"ul",6)(10,"li",7)(11,"a",8),ne(12,"Home"),K()(),z(13,"li",7)(14,"a",9),ne(15,"Products"),K()(),z(16,"li",7)(17,"a",10),ne(18,"Shades"),K()()()()()())},dependencies:[yh],styles:[".navbar[_ngcontent-%COMP%]{background-color:#000!important}.navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#fff!important}.navbar-toggler-icon[_ngcontent-%COMP%]{background-color:#fff}"]})}}return n})();var aD=(()=>{class n{constructor(){this.title="zuu-makup-shop"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=fr({type:n,selectors:[["app-root"]],standalone:!0,features:[mr],decls:2,vars:0,template:function(r,i){r&1&&me(0,"app-navbar")(1,"router-outlet")},dependencies:[gh,oD]})}}return n})();var Hy=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=fr({type:n,selectors:[["app-home"]],standalone:!0,features:[mr],decls:81,vars:0,consts:[["id","carouselExample",1,"carousel","slide"],[1,"carousel-inner"],[1,"carousel-item","active"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/homepage/product-carousel/iar-concealer/mny-iarcorrectingconcealer-homepage-still-desktop-1440x540-(1).jpg?rev=90d926dfd51d40588d3a8212bb2d76ad&cx=0.45&cy=0.38&cw=1440&ch=540&hash=5FBB2B102A09B06D1FBEF7571C83077E","alt","...",1,"d-block","w-100"],[1,"carousel-item"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/homepage/product-carousel/tips-and-trends/hp-banner-desktop-2160x810-v2.jpg?rev=27f54ccbe7474639a516c0a7a9f040ca&cx=0.66&cy=0.42&cw=768&ch=288&hash=60DB5BBB7ABC8B04983B095BFD4FC695","alt","...",1,"d-block","w-100"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/homepage/product-carousel/super-stay-teddy-tint/homepagestill-mny-makl-ssteddytint-developed-1440x540.jpg?rev=64a1b0b180b94129a1a7f95e65b562a2&cx=0&cy=0&cw=768&ch=288&hash=1F3219BFE7E72D821DB62DABB756D233","alt","...",1,"d-block","w-100"],["type","button","data-bs-target","#carouselExample","data-bs-slide","prev",1,"carousel-control-prev"],["aria-hidden","true",1,"carousel-control-prev-icon"],[1,"visually-hidden"],["type","button","data-bs-target","#carouselExample","data-bs-slide","next",1,"carousel-control-next"],["aria-hidden","true",1,"carousel-control-next-icon"],[1,"text-center"],[1,"ms-5"],[1,"row","ms-5","mt-5"],[1,"col-3"],[1,"card",2,"width","18rem"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/homepage/transporter-module/makeup-studio/maybelline-hp-vrtual-try-on-315x472.jpg?rev=3c085c9c9d1f4cc4b88392f78fa46ba7","alt","...",1,"card-img-top"],[1,"card-body"],[1,"card-text"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/homepage/transporter-module/makeup-studio/virtualbeautystudio_mny_maky_fitmefinder_developed_315x472v2.jpg?rev=4a58aac2422c47738df140beb2198352","alt","...",1,"card-img-top"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/homepage/transporter-module/makeup-studio/makeupstudio_foundationfinderv2.png?rev=13883497c29e41838e30f4b0383c0ba6","alt","...",1,"card-img-top"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/homepage/transporter-module/makeup-studio/virtualbeautystudiomnymakymascaraquiz315x4722x-1.jpg?rev=2feb4ab8028b482f8888db9fe97d4db7","alt","...",1,"card-img-top"],[1,"ms-5","text-center"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/homepage/product-carousel/super-stay-teddy-tint/transporter-mny-makl-ssteddytint-developed-630x944.jpg?rev=efa8788f05c741859c4f1951364245d4","alt","...",1,"card-img-top"],["href","https://www.maybelline.com/lip-makeup/lipstick/superstay-teddy-tint-liquid-lip-tint?variant=Knee+High",1,"btn","btn-danger"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/homepage/new-products-module/maybelline-new-arrivals-sky-high-space-diamond-630x944.jpg?rev=8d6307f83c684bbe88a4cc33d55eec75","alt","...",1,"card-img-top"],["href","https://www.maybelline.com/eye-makeup/mascara/lash-sensational-sky-high-space-diamond-glitter-mascara?variant=Space+Diamond",1,"btn","btn-danger"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/homepage/new-products-module/mny-iarcorrectingconcealer-transporter-630x944.jpg?rev=ec0c9ffe61c74ed888d1398ed194132b","alt","...",1,"card-img-top"],["href","https://www.maybelline.com/face-makeup/concealer/instant-age-rewind-eraser-color-correcting-concealer?variant=Green",1,"btn","btn-danger"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/homepage/new-products-module/transporter_mny_maky_ttduochrome_developed_630x944.jpg?rev=678855e585914a5c9ec09b5ada28350e","alt","...",1,"card-img-top"],["href","https://www.maybelline.com/eye-makeup/eyeliner/tattoostudio-sharpenable-gel-pencil-longwear-eyeliner-makeup?variant=Stardust+Chrome",1,"btn","btn-danger"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/makeup-tips/modules/hero/makeup-decoded/tips-and-trends-makeup-decoded-hero-desktop.jpg?rev=36e255c18b354d94833e6c5535b55cea&cx=0.46&cy=0.39&cw=1440&ch=540&hash=DDEA25FA1F3C267993DE59B2C326672B","alt",""]],template:function(r,i){r&1&&(z(0,"div",0)(1,"div",1)(2,"div",2),me(3,"img",3),K(),z(4,"div",4),me(5,"img",5),K(),z(6,"div",4),me(7,"img",6),K()(),z(8,"button",7),me(9,"span",8),z(10,"span",9),ne(11,"Previous"),K()(),z(12,"button",10),me(13,"span",11),z(14,"span",9),ne(15,"Next"),K()()(),me(16,"hr"),z(17,"div",12)(18,"h1")(19,"b"),ne(20,"BEAUTY-STUDIO"),K()()(),z(21,"div",13)(22,"div",14)(23,"div",15)(24,"div",16),me(25,"img",17),z(26,"div",18)(27,"p",19),ne(28," Time to makeup your mind! Experience your perfect makeup shades or try a bold new look with Maybelline\u2019s virtual try-on tool. "),K()()()(),z(29,"div",15)(30,"div",16),me(31,"img",20),z(32,"div",18)(33,"p",19),ne(34," Find your perfect fit! Complete the quiz to find your Fit Me foundation and shade from our Fit Me Collection. "),K()()()(),z(35,"div",15)(36,"div",16),me(37,"img",21),z(38,"div",18)(39,"p",19),ne(40," An easy-to-use mobile experience that helps you find the right product for your skintone and undertone "),K()()()(),z(41,"div",15)(42,"div",16),me(43,"img",22),z(44,"div",18)(45,"p",19),ne(46," Complete the quiz to discover your personalized mascara recommendation! "),K()()()()()(),me(47,"hr"),z(48,"div",12)(49,"h1")(50,"b"),ne(51,"NEW ARRIVALS"),K()()(),z(52,"div",23)(53,"div",14)(54,"div",15)(55,"div",16),me(56,"img",24),z(57,"div",18)(58,"a",25),ne(59,"LIP TINT->"),K()()()(),z(60,"div",15)(61,"div",16),me(62,"img",26),z(63,"div",18)(64,"a",27),ne(65,"GLITTER MASCARA->"),K()()()(),z(66,"div",15)(67,"div",16),me(68,"img",28),z(69,"div",18)(70,"a",29),ne(71,"AGE REWIND->"),K()()()(),z(72,"div",15)(73,"div",16),me(74,"img",30),z(75,"div",18)(76,"a",31),ne(77,"TATTO EYELINER->"),K()()()()()(),me(78,"hr"),z(79,"div",12),me(80,"img",32),K())},styles:["hr[_ngcontent-%COMP%]{border:0;height:4px;background-color:#000}.carousel[_ngcontent-%COMP%]{width:70%;margin:0 auto}"]})}}return n})();var gV="firebase",yV="10.14.1";tt(gV,yV,"app");var Ct=new By("ANGULARFIRE2_VERSION");function sa(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var $s=(n,e)=>{let t=e?[e]:Ih(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},zt=class{constructor(){return $s(_V)}},_V="app-check";function ia(){}var Ah=class{zone;delegate;constructor(e,t=wA){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Ky=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ia,{},ia,ia)),t.pipe(DA({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},tn=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Ah(Zone.current)),this.insideAngular=t.run(()=>new Ah(Zone.current,na)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(te(Et))};static \u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Dh(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function vV(n){return Dh().ngZone.runOutsideAngular(()=>n())}function js(n){return Dh().ngZone.run(()=>n())}function Xe(n){return EV(Dh())(n)}function EV(n){return function(t){return t=t.lift(new Ky(n.ngZone)),t.pipe(Vs(n.outsideAngular),Si(n.insideAngular))}}var SV=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),js(()=>n.apply(void 0,r))},Ii=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=js(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ia,{},ia,ia))),r[s]=SV(r[s],t));let i=vV(()=>n.apply(this,r));if(!e)if(i instanceof ur){let s=Dh();return i.pipe(Vs(s.outsideAngular),Si(s.insideAngular))}else return js(()=>i);return i instanceof ur?i.pipe(Xe):i instanceof Promise?js(()=>new Promise((s,o)=>i.then(a=>js(()=>s(a)),a=>js(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:js(()=>i)};var jn=class{constructor(e){return e}},Zr=class{constructor(){return Ih()}};function CV(n){return n&&n.length===1?n[0]:new jn(Ws())}var Yy=new ve("angularfire2._apps"),wV={provide:jn,useFactory:CV,deps:[[new mt,Yy]]},bV={provide:Zr,deps:[[new mt,Yy]]};function TV(n){return(e,t)=>{let r=t.get(pr);tt("angularfire",Ct.full,"core"),tt("angularfire",Ct.full,"app"),tt("angular",fh.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new jn(i)}}function lD(n,...e){return Ci([wV,bV,{provide:Yy,useFactory:TV(n),multi:!0,deps:[Et,Jr,tn,...e]}])}var cD=Ii(sD,!0);var IV=new Map,AV={activated:!1,tokenObservers:[]},DV={initialized:!1,enabled:!1};function $n(n){return IV.get(n)||Object.assign({},AV)}function pD(){return DV}var RV="https://content-firebaseappcheck.googleapis.com/v1";var kV="exchangeDebugToken",uD={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},rne=24*60*60*1e3;var Jy=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return b(this,null,function*(){this.stop();try{this.pending=new St,this.pending.promise.catch(t=>{}),yield NV(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new St,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function NV(n){return new Promise(e=>{setTimeout(e,n)})}var OV={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Ai=new ZA("appCheck","AppCheck",OV);function mD(n){if(!$n(n).activated)throw Ai.create("use-before-activation",{appName:n.name})}function gD(r,i){return b(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let p=yield o.getHeartbeatsHeader();p&&(s["X-Firebase-Client"]=p)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(p){throw Ai.create("fetch-network-error",{originalErrorMessage:p?.message})}if(l.status!==200)throw Ai.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(p){throw Ai.create("fetch-parse-error",{originalErrorMessage:p?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Ai.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,h=Date.now();return{token:c.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}})}function yD(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${RV}/projects/${t}/apps/${r}:${kV}?key=${i}`,body:{debug_token:e}}}var xV="firebase-app-check-database",PV=1,Zy="firebase-app-check-store";var Rh=null;function MV(){return Rh||(Rh=new Promise((n,e)=>{try{let t=indexedDB.open(xV,PV);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Ai.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Zy,{keyPath:"compositeKey"})}}}catch(t){e(Ai.create("storage-open",{originalErrorMessage:t?.message}))}}),Rh)}function FV(n,e){return LV(BV(n),e)}function LV(n,e){return b(this,null,function*(){let r=(yield MV()).transaction(Zy,"readwrite"),s=r.objectStore(Zy).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(Ai.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function BV(n){return`${n.options.appId}-${n.name}`}var e_=new Ti("@firebase/app-check");function Xy(n,e){return Sh()?FV(n,e).catch(t=>{e_.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function _D(){return pD().enabled}function vD(){return b(this,null,function*(){let n=pD();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var VV={error:"UNKNOWN_ERROR"};function UV(n){return _h.encodeString(JSON.stringify(n),!1)}function t_(n,e=!1){return b(this,null,function*(){let t=n.app;mD(t);let r=$n(t),i=r.token,s;if(i&&!Sc(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(Sc(l)?i=l:yield Xy(t,void 0))}if(!e&&i&&Sc(i))return{token:i.token};let o=!1;if(_D()){r.exchangeTokenPromise||(r.exchangeTokenPromise=gD(yD(t,yield vD()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield Xy(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield $n(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?e_.warn(l.message):e_.error(l),s=l}let a;return i?s?Sc(i)?a={token:i.token,internalError:s}:a=hD(s):(a={token:i.token},r.token=i,yield Xy(t,i)):a=hD(s),o&&WV(t,a),a})}function qV(n){return b(this,null,function*(){let e=n.app;mD(e);let{provider:t}=$n(e);if(_D()){let r=yield vD(),{token:i}=yield gD(yD(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function zV(n,e,t,r){let{app:i}=n,s=$n(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Sc(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),dD(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>dD(n))}function ED(n,e){let t=$n(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function dD(n){let{app:e}=n,t=$n(e),r=t.tokenRefresher;r||(r=GV(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function GV(n){let{app:e}=n;return new Jy(()=>b(this,null,function*(){let t=$n(e),r;if(t.token?r=yield t_(n,!0):r=yield t_(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=$n(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},uD.RETRIAL_MIN_WAIT,uD.RETRIAL_MAX_WAIT)}function WV(n,e){let t=$n(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Sc(n){return n.expireTimeMillis-Date.now()>0}function hD(n){return{token:UV(VV),error:n}}var n_=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=$n(this.app);for(let t of e)ED(this.app,t.next);return Promise.resolve()}};function jV(n,e){return new n_(n,e)}function $V(n){return{getToken:e=>t_(n,e),getLimitedUseToken:()=>qV(n),addTokenListener:e=>zV(n,"INTERNAL",e),removeTokenListener:e=>ED(n.app,e)}}var HV="@firebase/app-check",KV="0.8.8";var QV="app-check",fD="app-check-internal";function YV(){Gs(new cn(QV,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return jV(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(fD).initialize()})),Gs(new cn(fD,n=>{let e=n.getProvider("app-check").getImmediate();return $V(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),tt(HV,KV)}YV();var XV=["localhost","0.0.0.0","127.0.0.1"],mne=typeof window<"u"&&XV.includes(window.location.hostname);var JV="firebase",ZV="10.14.1";yt.registerVersion(JV,ZV,"app-compat");var eU=["ngOnDestroy"],CD=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(eU.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,d),d})})})});var kh=class{constructor(e){return e}},Di=new ve("angularfire2.app.options"),Ri=new ve("angularfire2.app.name");function Hs(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=yt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>yt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;tU("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new kh(o)}var tU=(n,...e)=>{Vy()&&typeof console<"u"&&console[n](...e)},nU={provide:kh,useFactory:Hs,deps:[Di,Et,[new mt,Ri]]},wD=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Di,useValue:t},{provide:Ri,useValue:r}]}}constructor(t){yt.registerVersion("angularfire",Ct.full,"core"),yt.registerVersion("angularfire",Ct.full,"app-compat"),yt.registerVersion("angular",fh.full,t.toString())}static \u0275fac=function(r){return new(r||n)(te(pr))};static \u0275mod=Gn({type:n});static \u0275inj=zn({providers:[nU]})}return n})();function oa(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return rU(i,o)||(SD("error",`${e} was already initialized on the ${t} Firebase App with different settings.${iU?" You may need to reload as Firebase is not HMR aware.":""}`),SD("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function rU(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var iU=typeof module<"u"&&!!module.hot,SD=(n,...e)=>{Vy()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Cc=new ve("angularfire2.auth.use-emulator"),wc=new ve("angularfire2.auth.settings"),bc=new ve("angularfire2.auth.tenant-id"),Tc=new ve("angularfire2.auth.langugage-code"),Ic=new ve("angularfire2.auth.use-device-language"),Ac=new ve("angularfire.auth.persistence"),Dc=(n,e,t,r,i,s,o,a)=>oa(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),Rc=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,d,h,p){let E=new CA,w=hr(void 0).pipe(Si(o.outsideAngular),Yr(()=>s.runOutsideAngular(()=>import("./chunk-FSYHEBWN.mjs"))),Ve(()=>Hs(t,s,r)),Ve(T=>Dc(T,s,a,c,u,d,l,h)),Oy({bufferSize:1,refCount:!1}));if(mh(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=hr(null);else{w.pipe(TA()).subscribe();let T=w.pipe(Yr(O=>O.getRedirectResult().then(F=>F,()=>null)),Xe,Oy({bufferSize:1,refCount:!1})),k=w.pipe(Yr(O=>new ur(F=>({unsubscribe:s.runOutsideAngular(()=>O.onAuthStateChanged(W=>F.next(W),W=>F.error(W),()=>F.complete()))})))),R=w.pipe(Yr(O=>new ur(F=>({unsubscribe:s.runOutsideAngular(()=>O.onIdTokenChanged(W=>F.next(W),W=>F.error(W),()=>F.complete()))}))));this.authState=T.pipe(xy(k),Vs(o.outsideAngular),Si(o.insideAngular)),this.user=T.pipe(xy(R),Vs(o.outsideAngular),Si(o.insideAngular)),this.idToken=this.user.pipe(Yr(O=>O?dr(O.getIdToken()):hr(null))),this.idTokenResult=this.user.pipe(Yr(O=>O?dr(O.getIdTokenResult()):hr(null))),this.credential=fc(T,E,this.authState.pipe(pc(O=>!O))).pipe(Ve(O=>O?.user?O:null),Vs(o.outsideAngular),Si(o.insideAngular))}return CD(this,w,s,{spy:{apply:(T,k,R)=>{(T.startsWith("signIn")||T.startsWith("createUser"))&&R.then(O=>E.next(O))}}})}static \u0275fac=function(r){return new(r||n)(te(Di),te(Ri,8),te(pr),te(Et),te(tn),te(Cc,8),te(wc,8),te(bc,8),te(Tc,8),te(Ic,8),te(Ac,8),te(zt,8))};static \u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),bD=(()=>{class n{constructor(){yt.registerVersion("angularfire",Ct.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Gn({type:n});static \u0275inj=zn({providers:[Rc]})}return n})();var Vk=ih(ok(),1);var Kh="5",Uk="v",qk="s",zk="r",Gk="f",Wk=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,jk="ls",$k="p",W_="ac",Hk="websocket",Kk="long_polling";var j_=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ct(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ch(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var $_=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return bn(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var Qk=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new j_(e)}}catch{}return new $_},ro=Qk("localStorage"),H_=Qk("sessionStorage");var pa=new Ti("@firebase/database"),Yk=function(){let n=1;return function(){return n++}}(),Xk=function(n){let e=iD(n),t=new rD;t.update(e);let r=t.digest();return _h.encodeByteArray(r)},uu=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=uu.apply(null,r):typeof r=="object"?e+=ct(r):e+=r,e+=" "}return e},io=null,ak=!0,Jk=function(n,e){L(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(pa.logLevel=Tn.VERBOSE,io=pa.log.bind(pa),e&&H_.set("logging_enabled",!0)):typeof n=="function"?io=n:(io=null,H_.remove("logging_enabled"))},wt=function(...n){if(ak===!0&&(ak=!1,io===null&&H_.get("logging_enabled")===!0&&Jk(!0)),io){let e=uu.apply(null,n);io(e)}},du=function(n){return function(...e){wt(n,...e)}},K_=function(...n){let e="FIREBASE INTERNAL ERROR: "+uu(...n);pa.error(e)},Sr=function(...n){let e=`FIREBASE FATAL ERROR: ${uu(...n)}`;throw pa.error(e),new Error(e)},xt=function(...n){let e="FIREBASE WARNING: "+uu(...n);pa.warn(e)},dq=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&xt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ef=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},hq=function(n){if(gr()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Mi="[MIN_NAME]",ei="[MAX_NAME]",oo=function(n,e){if(n===e)return 0;if(n===Mi||e===ei)return-1;if(e===Mi||n===ei)return 1;{let t=lk(n),r=lk(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},fq=function(n,e){return n===e?0:n<e?-1:1},Uc=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+ct(e))},Kv=function(n){if(typeof n!="object"||n===null)return ct(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=ct(e[r]),t+=":",t+=Kv(n[e[r]]);return t+="}",t},Zk=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function bt(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var e1=function(n){L(!Ef(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,a,l;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(i?1:0),c.reverse();let u=c.join(""),d="";for(l=0;l<64;l+=8){let h=parseInt(u.substr(l,8),2).toString(16);h.length===1&&(h="0"+h),d=d+h}return d.toLowerCase()},pq=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},mq=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function gq(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var yq=new RegExp("^-?(0*)\\d{1,10}$"),_q=-2147483648,vq=2147483647,lk=function(n){if(yq.test(n)){let e=Number(n);if(e>=_q&&e<=vq)return e}return null},wa=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw xt("Exception was thrown by user callback.",t),e},Math.floor(0))}},Eq=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Wc=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Qh=class{constructor(e,t,r,i,s=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ro.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ro.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function Sq(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function t1(n,e,t){L(typeof e=="string","typeof type must == string"),L(typeof t=="object","typeof params must == object");let r;if(e===Hk)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Kk)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Sq(n)&&(t.ns=n.namespace);let i=[];return bt(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var Q_=class{constructor(){this.counters_={}}incrementCounter(e,t=1){bn(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return YA(this.counters_)}};var L_={},B_={};function Qv(n){let e=n.toString();return L_[e]||(L_[e]=new Q_),L_[e]}function Cq(n,e){let t=n.toString();return B_[t]||(B_[t]=e()),B_[t]}var Yv="";function Xv(n){Yv=n}var wq=16384,bq=45e3,Qc=null;typeof MozWebSocket<"u"?Qc=MozWebSocket:typeof WebSocket<"u"&&(Qc=WebSocket);function Tq(n){Qc=n}var ha=(()=>{class n{constructor(t,r,i,s,o,a,l){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=du(this.connId),this.stats_=Qv(r),this.connURL=n.connectionURL_(r,a,l,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let a={};return a[Uk]=Kh,!gr()&&typeof location<"u"&&location.hostname&&Wk.test(location.hostname)&&(a[zk]=Gk),r&&(a[qk]=r),i&&(a[jk]=i),s&&(a[W_]=s),o&&(a[$k]=o),t1(t,Hk,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ro.set("previous_websocket_failure",!0);try{let i;if(gr()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${Kh}/${Yv}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new Qc(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&Qc!==null&&!n.forceDisallow_}static previouslyFailed(){return ro.isInMemoryStorage||ro.get("previous_websocket_failure")===!0}markConnectionHealthy(){ro.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=Ch(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(L(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=ct(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=Zk(r,wq);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(bq))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),ck="@firebase/database",uk="1.0.8";var Y_=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){xt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var X_=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(wt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',xt(e)}},jc=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),J_=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&wa(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var dk="start",Iq="close",Aq="pLPCommand",Dq="pRTLPCB",n1="id",r1="pw",i1="ser",Rq="cb",kq="seg",Nq="ts",Oq="d",xq="dframe",s1=1870,o1=30,Pq=s1-o1,Mq=25e3,Fq=3e4,Yc=class n{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=du(e),this.stats_=Qv(t),this.urlFn=l=>(this.appCheckToken&&(l[W_]=this.appCheckToken),t1(t,Kk,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new J_(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Fq)),hq(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Z_((...s)=>{let[o,a,l,c,u]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===dk)this.id=a,this.password=l;else if(o===Iq)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[dk]="t",r[i1]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Rq]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Uk]=Kh,this.transportSessionId&&(r[qk]=this.transportSessionId),this.lastSessionId&&(r[jk]=this.lastSessionId),this.applicationId&&(r[$k]=this.applicationId),this.appCheckToken&&(r[W_]=this.appCheckToken),typeof location<"u"&&location.hostname&&Wk.test(location.hostname)&&(r[zk]=Gk);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return gr()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!pq()&&!mq()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ct(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=QA(t),i=Zk(r,Pq);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(gr())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[xq]="t",r[n1]=e,r[r1]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ct(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Z_=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,gr())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Yk(),window[Aq+this.uniqueCallbackIdentifier]=e,window[Dq+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";</script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){wt("frame writing exception"),a.stack&&wt(a.stack),wt(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||wt("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[n1]=this.myID,e[r1]=this.myPW,e[i1]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+o1+r.length<=s1;){let o=this.pendingSegs.shift();r=r+"&"+kq+i+"="+o.seg+"&"+Nq+i+"="+o.ts+"&"+Oq+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(Mq)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){gr()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{wt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var a1=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Yc,ha]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=ha&&ha.isAvailable(),i=r&&!ha.previouslyFailed();if(t.webSocketOnly&&(r||xt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[ha];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Lq=6e4,Bq=5e3,Vq=10*1024,Uq=100*1024,V_="t",hk="d",qq="s",fk="r",zq="e",pk="o",mk="a",gk="n",yk="p",Gq="h",ev=class{constructor(e,t,r,i,s,o,a,l,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=du("c:"+this.id+":"),this.transportManager_=new a1(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Wc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Uq?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Vq?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(V_ in e){let t=e[V_];t===mk?this.upgradeIfSecondaryHealthy_():t===fk?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===pk&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Uc("t",e),r=Uc("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:yk,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:mk,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:gk,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Uc("t",e),r=Uc("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Uc(V_,e);if(hk in e){let r=e[hk];if(t===Gq){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===gk){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===qq?this.onConnectionShutdown_(r):t===fk?this.onReset_(r):t===zq?K_("Server Error: "+r):t===pk?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):K_("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Kh!==r&&xt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Wc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Lq))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Wc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Bq))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:yk,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ro.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Yh=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var Xh=class{constructor(e){this.allowedEvents_=e,this.listeners_={},L(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){L(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Jh=class n extends Xh{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!qy()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return L(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var _k=32,vk=768,we=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function Ce(){return new we("")}function ce(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Fi(n){return n.pieces_.length-n.pieceNum_}function Re(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new we(n.pieces_,e)}function Jv(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Wq(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Xc(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function l1(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new we(e,0)}function qe(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof we)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new we(t,0)}function ue(n){return n.pieceNum_>=n.pieces_.length}function jt(n,e){let t=ce(n),r=ce(e);if(t===null)return e;if(t===r)return jt(Re(n),Re(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function jq(n,e){let t=Xc(n,0),r=Xc(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=oo(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function Zv(n,e){if(Fi(n)!==Fi(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function In(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Fi(n)>Fi(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var tv=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Xc(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=vc(this.parts_[r]);c1(this)}};function $q(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=vc(e),c1(n)}function Hq(n){let e=n.parts_.pop();n.byteLength_-=vc(e),n.parts_.length>0&&(n.byteLength_-=1)}function c1(n){if(n.byteLength_>vk)throw new Error(n.errorPrefix_+"has a key path longer than "+vk+" bytes ("+n.byteLength_+").");if(n.parts_.length>_k)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+_k+") or object contains a cycle "+no(n))}function no(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var nv=class n extends Xh{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return L(e==="visible","Unknown event type: "+e),[this.visible_]}};var qc=1e3,Kq=60*5*1e3,Ek=30*1e3,Qq=1.3,Yq=3e4,Xq="server_kill",Sk=3,eE=(()=>{class n extends Yh{constructor(t,r,i,s,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=du("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=qc,this.maxReconnectDelay_=Kq,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!gr())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");nv.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Jh.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(ct(o)),L(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new St,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?r.resolve(l):r.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),L(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),L(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;n.warnOnListenWarnings_(c,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(u,c))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&bn(t,"w")){let i=bi(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();xt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||tD(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Ek)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=eD(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),L(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+ct(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):K_("Unrecognized action received from server: "+ct(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){L(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=qc,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=qc,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Yq&&(this.reconnectDelay_=qc),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Qq)}this.onConnectStatus_(!1)}establishConnection_(){return b(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,i())},u=function(h){L(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:u};let d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,p]=yield Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);a?wt("getToken() completed but was canceled"):(wt("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=p&&p.token,l=new ev(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,E=>{xt(E+" ("+this.repoInfo_.toString()+")"),this.interrupt(Xq)},o))}catch(h){this.log_("Failed to get token: "+h),a||(this.repoInfo_.nodeAdmin&&xt(h),c())}}})}interrupt(t){wt("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){wt("Resuming connection for reason: "+t),delete this.interruptReasons_[t],wh(this.interruptReasons_)&&(this.reconnectDelay_=qc,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>Kv(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new we(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){wt("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Sk&&(this.reconnectDelay_=Ek,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){wt("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Sk&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";gr()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+Yv.replace(/\./g,"-")]=1,qy()?t["framework.cordova"]=1:XA()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Jh.getInstance().currentlyOnline();return wh(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),de=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var ma=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new de(Mi,e),i=new de(Mi,t);return this.compare(r,i)!==0}minPost(){return de.MIN}};var Hh,Zh=class extends ma{static get __EMPTY_NODE(){return Hh}static set __EMPTY_NODE(e){Hh=e}compare(e,t){return oo(e.name,t.name)}isDefinedOn(e){throw ra("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return de.MIN}maxPost(){return new de(ei,Hh)}makePost(e,t){return L(typeof e=="string","KeyIndex indexValue must always be a string."),new de(e,Hh)}toString(){return".key"}},Er=new Zh;var fa=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Hn=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??An.EMPTY_NODE,this.right=o??An.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return An.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return An.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),rv=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new Hn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},An=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Hn.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Hn.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new fa(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new fa(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new fa(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new fa(this.root_,null,this.comparator_,!0,e)}};An.EMPTY_NODE=new rv;function Jq(n,e){return oo(n.name,e.name)}function tE(n,e){return oo(n,e)}var iv;function Zq(n){iv=n}var u1=function(n){return typeof n=="number"?"number:"+e1(n):"string:"+n},d1=function(n){if(n.isLeafNode()){let e=n.val();L(typeof e=="string"||typeof e=="number"||typeof e=="object"&&bn(e,".sv"),"Priority must be a string or number.")}else L(n===iv||n.isEmpty(),"priority of unexpected type.");L(n===iv||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Ck,ga=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,L(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),d1(this.priorityNode_)}static set __childrenNodeConstructor(t){Ck=t}static get __childrenNodeConstructor(){return Ck}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ue(t)?this:ce(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=ce(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(L(i!==".priority"||Fi(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(Re(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+u1(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=e1(this.value_):t+=this.value_,this.lazyHash_=Xk(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(L(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return L(s>=0,"Unknown leaf type: "+r),L(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),h1,f1;function e4(n){h1=n}function t4(n){f1=n}var sv=class extends ma{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?oo(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return de.MIN}maxPost(){return new de(ei,new ga("[PRIORITY-POST]",f1))}makePost(e,t){let r=h1(e);return new de(t,new ga("[PRIORITY-POST]",r))}toString(){return".priority"}},Oe=new sv;var n4=Math.log(2),ov=class{constructor(e){let t=s=>parseInt(Math.log(s)/n4,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},ef=function(n,e,t,r){n.sort(e);let i=function(l,c){let u=c-l,d,h;if(u===0)return null;if(u===1)return d=n[l],h=t?t(d):d,new Hn(h,d.node,Hn.BLACK,null,null);{let p=parseInt(u/2,10)+l,E=i(l,p),w=i(p+1,c);return d=n[p],h=t?t(d):d,new Hn(h,d.node,Hn.BLACK,E,w)}},s=function(l){let c=null,u=null,d=n.length,h=function(E,w){let T=d-E,k=d;d-=E;let R=i(T+1,k),O=n[T],F=t?t(O):O;p(new Hn(F,O.node,w,null,R))},p=function(E){c?(c.left=E,c=E):(u=E,c=E)};for(let E=0;E<l.count;++E){let w=l.nextBitIsOne(),T=Math.pow(2,l.count-(E+1));w?h(T,Hn.BLACK):(h(T,Hn.BLACK),h(T,Hn.RED))}return u},o=new ov(n.length),a=s(o);return new An(r||e,a)};var U_,da={},ya=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return L(da&&Oe,"ChildrenNode.ts has not been loaded"),U_=U_||new n({".priority":da},{".priority":Oe}),U_}get(e){let t=bi(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof An?t:null}hasIndex(e){return bn(this.indexSet_,e.toString())}addIndex(e,t){L(e!==Er,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(de.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=ef(r,e.getCompare()):a=da;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new n(u,c)}addToIndexes(e,t){let r=_c(this.indexes_,(i,s)=>{let o=bi(this.indexSet_,s);if(L(o,"Missing index implementation for "+s),i===da)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(de.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),ef(a,o.getCompare())}else return da;else{let a=t.get(e.name),l=i;return a&&(l=l.remove(new de(e.name,a))),l.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=_c(this.indexes_,i=>{if(i===da)return i;{let s=t.get(e.name);return s?i.remove(new de(e.name,s)):i}});return new n(r,this.indexSet_)}};var zc,oe=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&d1(this.priorityNode_),this.children_.isEmpty()&&L(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return zc||(zc=new n(new An(tE),null,ya.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||zc}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?zc:r}}getChild(t){let r=ce(t);return r===null?this:this.getImmediateChild(r).getChild(Re(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(L(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new de(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?zc:this.priorityNode_;return new n(s,a,o)}}updateChild(t,r){let i=ce(t);if(i===null)return r;{L(ce(t)!==".priority"||Fi(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(Re(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(Oe,(a,l)=>{r[a]=l.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let l in r)a[l]=r[l];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+u1(this.getPriority().val())+":"),this.forEachChild(Oe,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":Xk(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new de(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new de(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new de(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,de.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,de.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===hu?-1:0}withIndex(t){if(t===Er||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===Er||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(Oe),s=r.getIterator(Oe),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Er?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),av=class extends oe{constructor(){super(new An(tE),oe.EMPTY_NODE,ya.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return oe.EMPTY_NODE}isEmpty(){return!1}},hu=new av;Object.defineProperties(de,{MIN:{value:new de(Mi,oe.EMPTY_NODE)},MAX:{value:new de(ei,hu)}});Zh.__EMPTY_NODE=oe.EMPTY_NODE;ga.__childrenNodeConstructor=oe;Zq(hu);t4(hu);var r4=!0;function je(n,e=null){if(n===null)return oe.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),L(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new ga(t,je(e))}if(!(n instanceof Array)&&r4){let t=[],r=!1;if(bt(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=je(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new de(o,l)))}}),t.length===0)return oe.EMPTY_NODE;let s=ef(t,Jq,o=>o.name,tE);if(r){let o=ef(t,Oe.getCompare());return new oe(s,je(e),new ya({".priority":o},{".priority":Oe}))}else return new oe(s,je(e),ya.Default)}else{let t=oe.EMPTY_NODE;return bt(n,(r,i)=>{if(bn(n,r)&&r.substring(0,1)!=="."){let s=je(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(je(e))}}e4(je);var Jc=class extends ma{constructor(e){super(),this.indexPath_=e,L(!ue(e)&&ce(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?oo(e.name,t.name):s}makePost(e,t){let r=je(e),i=oe.EMPTY_NODE.updateChild(this.indexPath_,r);return new de(t,i)}maxPost(){let e=oe.EMPTY_NODE.updateChild(this.indexPath_,hu);return new de(ei,e)}toString(){return Xc(this.indexPath_,0).join("/")}};var lv=class extends ma{compare(e,t){let r=e.node.compareTo(t.node);return r===0?oo(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return de.MIN}maxPost(){return de.MAX}makePost(e,t){let r=je(e);return new de(t,r)}toString(){return".value"}},nE=new lv;function p1(n){return{type:"value",snapshotNode:n}}function _a(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Zc(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function eu(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function i4(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var tu=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){L(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Zc(t,a)):L(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(_a(t,r)):o.trackChildChange(eu(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Oe,(i,s)=>{t.hasChild(i)||r.trackChildChange(Zc(i,s))}),t.isLeafNode()||t.forEachChild(Oe,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(eu(i,s,o))}else r.trackChildChange(_a(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?oe.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var tf=class n{constructor(e){this.indexedFilter_=new tu(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new de(t,r))||(r=oe.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=oe.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(oe.EMPTY_NODE);let s=this;return t.forEachChild(Oe,(o,a)=>{s.matches(new de(o,a))||(i=i.updateImmediateChild(o,oe.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var cv=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new tf(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new de(t,r))||(r=oe.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=oe.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=oe.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(oe.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,oe.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let d=this.index_.getCompare();o=(h,p)=>d(p,h)}else o=this.index_.getCompare();let a=e;L(a.numChildren()===this.limit_,"");let l=new de(t,r),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){let d=a.getImmediateChild(t),h=i.getChildAfterChild(this.index_,c,this.reverse_);for(;h!=null&&(h.name===t||a.hasChild(h.name));)h=i.getChildAfterChild(this.index_,h,this.reverse_);let p=h==null?1:o(h,l);if(u&&!r.isEmpty()&&p>=0)return s?.trackChildChange(eu(t,r,d)),a.updateImmediateChild(t,r);{s?.trackChildChange(Zc(t,d));let w=a.updateImmediateChild(t,oe.EMPTY_NODE);return h!=null&&this.rangedFilter_.matches(h)?(s?.trackChildChange(_a(h.name,h.node)),w.updateImmediateChild(h.name,h.node)):w}}else return r.isEmpty()?e:u&&o(c,l)>=0?(s!=null&&(s.trackChildChange(Zc(c.name,c.node)),s.trackChildChange(_a(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(c.name,oe.EMPTY_NODE)):e}};var nu=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Oe}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return L(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return L(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Mi}hasEnd(){return this.endSet_}getIndexEndValue(){return L(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return L(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ei}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return L(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Oe}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function s4(n){return n.loadsAllData()?new tu(n.getIndex()):n.hasLimit()?new cv(n):new tf(n)}function o4(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function a4(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function uv(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function l4(n,e,t){let r;return n.index_===Er||t?r=uv(n,e,t):r=uv(n,e,ei),r.startAfterSet_=!0,r}function dv(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function c4(n,e,t){let r;return n.index_===Er||t?r=dv(n,e,t):r=dv(n,e,Mi),r.endBeforeSet_=!0,r}function Sf(n,e){let t=n.copy();return t.index_=e,t}function wk(n){let e={};if(n.isDefault())return e;let t;if(n.index_===Oe?t="$priority":n.index_===nE?t="$value":n.index_===Er?t="$key":(L(n.index_ instanceof Jc,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=ct(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=ct(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+ct(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=ct(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+ct(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function bk(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Oe&&(e.i=n.index_.toString()),e}var hv=class n extends Yh{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=du("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(L(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),a={};this.listens_[o]=a;let l=wk(e._queryParams);this.restRequest_(s+".json",l,(c,u)=>{let d=u;if(c===404&&(d=null,c=null),c===null&&this.onDataUpdate_(s,d,!1,r),bi(this.listens_,o)===a){let h;c?c===401?h="permission_denied":h="rest_error:"+c:h="ok",i(h,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=wk(e._queryParams),r=e._path.toString(),i=new St;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+nD(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Ch(a.responseText)}catch{xt("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&xt("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var fv=class{constructor(){this.rootNode_=oe.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function nf(){return{value:null,children:new Map}}function ba(n,e,t){if(ue(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=ce(e);n.children.has(r)||n.children.set(r,nf());let i=n.children.get(r);e=Re(e),ba(i,e,t)}}function pv(n,e){if(ue(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(Oe,(r,i)=>{ba(n,new we(r),i)}),pv(n,e)}}else if(n.children.size>0){let t=ce(e);return e=Re(e),n.children.has(t)&&pv(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function mv(n,e,t){n.value!==null?t(e,n.value):u4(n,(r,i)=>{let s=new we(e.toString()+"/"+r);mv(i,s,t)})}function u4(n,e){n.children.forEach((t,r)=>{e(r,t)})}var gv=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&bt(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var Tk=10*1e3,d4=30*1e3,h4=5*60*1e3,yv=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new gv(e);let r=Tk+(d4-Tk)*Math.random();Wc(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;bt(e,(i,s)=>{s>0&&bn(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),Wc(this.reportStats_.bind(this),Math.floor(Math.random()*2*h4))}};var vr=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(vr||{});function rE(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function iE(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function sE(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var _v=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=vr.ACK_USER_WRITE,this.source=rE()}operationForChild(e){if(ue(this.path)){if(this.affectedTree.value!=null)return L(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new we(e));return new n(Ce(),t,this.revert)}}else return L(ce(this.path)===e,"operationForChild called for unrelated child."),new n(Re(this.path),this.affectedTree,this.revert)}};var rf=class n{constructor(e,t){this.source=e,this.path=t,this.type=vr.LISTEN_COMPLETE}operationForChild(e){return ue(this.path)?new n(this.source,Ce()):new n(this.source,Re(this.path))}};var va=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=vr.OVERWRITE}operationForChild(e){return ue(this.path)?new n(this.source,Ce(),this.snap.getImmediateChild(e)):new n(this.source,Re(this.path),this.snap)}};var ru=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=vr.MERGE}operationForChild(e){if(ue(this.path)){let t=this.children.subtree(new we(e));return t.isEmpty()?null:t.value?new va(this.source,Ce(),t.value):new n(this.source,Ce(),t)}else return L(ce(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,Re(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Cr=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ue(e))return this.isFullyInitialized()&&!this.filtered_;let t=ce(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var vv=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function f4(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(i4(o.childName,o.snapshotNode))}),Gc(n,i,"child_removed",e,r,t),Gc(n,i,"child_added",e,r,t),Gc(n,i,"child_moved",s,r,t),Gc(n,i,"child_changed",e,r,t),Gc(n,i,"value",e,r,t),i}function Gc(n,e,t,r,i,s){let o=r.filter(a=>a.type===t);o.sort((a,l)=>m4(n,a,l)),o.forEach(a=>{let l=p4(n,a,s);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function p4(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function m4(n,e,t){if(e.childName==null||t.childName==null)throw ra("Should only compare child_ events.");let r=new de(e.childName,e.snapshotNode),i=new de(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function Cf(n,e){return{eventCache:n,serverCache:e}}function $c(n,e,t,r){return Cf(new Cr(e,t,r),n.serverCache)}function m1(n,e,t,r){return Cf(n.eventCache,new Cr(e,t,r))}function sf(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function so(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var q_,g4=()=>(q_||(q_=new An(fq)),q_),$t=class n{constructor(e,t=g4()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return bt(e,(r,i)=>{t=t.set(new we(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ce(),value:this.value};if(ue(e))return null;{let r=ce(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(Re(e),t);return s!=null?{path:qe(new we(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ue(e))return this;{let t=ce(e),r=this.children.get(t);return r!==null?r.subtree(Re(e)):new n(null)}}set(e,t){if(ue(e))return new n(t,this.children);{let r=ce(e),s=(this.children.get(r)||new n(null)).set(Re(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(ue(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=ce(e),r=this.children.get(t);if(r){let i=r.remove(Re(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ue(e))return this.value;{let t=ce(e),r=this.children.get(t);return r?r.get(Re(e)):null}}setTree(e,t){if(ue(e))return t;{let r=ce(e),s=(this.children.get(r)||new n(null)).setTree(Re(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(Ce(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(qe(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Ce(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(ue(e))return null;{let s=ce(e),o=this.children.get(s);return o?o.findOnPath_(Re(e),qe(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ce(),t)}foreachOnPath_(e,t,r){if(ue(e))return this;{this.value&&r(t,this.value);let i=ce(e),s=this.children.get(i);return s?s.foreachOnPath_(Re(e),qe(t,i),r):new n(null)}}foreach(e){this.foreach_(Ce(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(qe(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var Kn=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new $t(null))}};function Hc(n,e,t){if(ue(e))return new Kn(new $t(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=jt(i,e);return s=s.updateChild(o,t),new Kn(n.writeTree_.set(i,s))}else{let i=new $t(t),s=n.writeTree_.setTree(e,i);return new Kn(s)}}}function Ev(n,e,t){let r=n;return bt(t,(i,s)=>{r=Hc(r,qe(e,i),s)}),r}function Ik(n,e){if(ue(e))return Kn.empty();{let t=n.writeTree_.setTree(e,new $t(null));return new Kn(t)}}function Sv(n,e){return ao(n,e)!=null}function ao(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(jt(t.path,e)):null}function Ak(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Oe,(r,i)=>{e.push(new de(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new de(r,i.value))}),e}function xi(n,e){if(ue(e))return n;{let t=ao(n,e);return t!=null?new Kn(new $t(t)):new Kn(n.writeTree_.subtree(e))}}function Cv(n){return n.writeTree_.isEmpty()}function Ea(n,e){return g1(Ce(),n.writeTree_,e)}function g1(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(L(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=g1(qe(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(qe(n,".priority"),r)),t}}function wf(n,e){return E1(e,n)}function y4(n,e,t,r,i){L(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=Hc(n.visibleWrites,e,t)),n.lastWriteId=r}function _4(n,e,t,r){L(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=Ev(n.visibleWrites,e,t),n.lastWriteId=r}function v4(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function E4(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);L(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&S4(a,r.path)?i=!1:In(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return C4(n),!0;if(r.snap)n.visibleWrites=Ik(n.visibleWrites,r.path);else{let a=r.children;bt(a,l=>{n.visibleWrites=Ik(n.visibleWrites,qe(r.path,l))})}return!0}else return!1}function S4(n,e){if(n.snap)return In(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&In(qe(n.path,t),e))return!0;return!1}function C4(n){n.visibleWrites=y1(n.allWrites,w4,Ce()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function w4(n){return n.visible}function y1(n,e,t){let r=Kn.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,a;if(s.snap)In(t,o)?(a=jt(t,o),r=Hc(r,a,s.snap)):In(o,t)&&(a=jt(o,t),r=Hc(r,Ce(),s.snap.getChild(a)));else if(s.children){if(In(t,o))a=jt(t,o),r=Ev(r,a,s.children);else if(In(o,t))if(a=jt(o,t),ue(a))r=Ev(r,Ce(),s.children);else{let l=bi(s.children,ce(a));if(l){let c=l.getChild(Re(a));r=Hc(r,Ce(),c)}}}else throw ra("WriteRecord should have .snap or .children")}}return r}function _1(n,e,t,r,i){if(!r&&!i){let s=ao(n.visibleWrites,e);if(s!=null)return s;{let o=xi(n.visibleWrites,e);if(Cv(o))return t;if(t==null&&!Sv(o,Ce()))return null;{let a=t||oe.EMPTY_NODE;return Ea(o,a)}}}else{let s=xi(n.visibleWrites,e);if(!i&&Cv(s))return t;if(!i&&t==null&&!Sv(s,Ce()))return null;{let o=function(c){return(c.visible||i)&&(!r||!~r.indexOf(c.writeId))&&(In(c.path,e)||In(e,c.path))},a=y1(n.allWrites,o,e),l=t||oe.EMPTY_NODE;return Ea(a,l)}}}function b4(n,e,t){let r=oe.EMPTY_NODE,i=ao(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Oe,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=xi(n.visibleWrites,e);return t.forEachChild(Oe,(o,a)=>{let l=Ea(xi(s,new we(o)),a);r=r.updateImmediateChild(o,l)}),Ak(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=xi(n.visibleWrites,e);return Ak(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function T4(n,e,t,r,i){L(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=qe(e,t);if(Sv(n.visibleWrites,s))return null;{let o=xi(n.visibleWrites,s);return Cv(o)?i.getChild(t):Ea(o,i.getChild(t))}}function I4(n,e,t,r){let i=qe(e,t),s=ao(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=xi(n.visibleWrites,i);return Ea(o,r.getNode().getImmediateChild(t))}else return null}function A4(n,e){return ao(n.visibleWrites,e)}function D4(n,e,t,r,i,s,o){let a,l=xi(n.visibleWrites,e),c=ao(l,Ce());if(c!=null)a=c;else if(t!=null)a=Ea(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],d=o.getCompare(),h=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),p=h.getNext();for(;p&&u.length<i;)d(p,r)!==0&&u.push(p),p=h.getNext();return u}else return[]}function R4(){return{visibleWrites:Kn.empty(),allWrites:[],lastWriteId:-1}}function of(n,e,t,r){return _1(n.writeTree,n.treePath,e,t,r)}function oE(n,e){return b4(n.writeTree,n.treePath,e)}function Dk(n,e,t,r){return T4(n.writeTree,n.treePath,e,t,r)}function af(n,e){return A4(n.writeTree,qe(n.treePath,e))}function k4(n,e,t,r,i,s){return D4(n.writeTree,n.treePath,e,t,r,i,s)}function aE(n,e,t){return I4(n.writeTree,n.treePath,e,t)}function v1(n,e){return E1(qe(n.treePath,e),n.writeTree)}function E1(n,e){return{treePath:n,writeTree:e}}var wv=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;L(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),L(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,eu(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,Zc(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,_a(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,eu(r,e.snapshotNode,i.oldSnap));else throw ra("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var bv=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},S1=new bv,iu=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new Cr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return aE(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:so(this.viewCache_),s=k4(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function N4(n){return{filter:n}}function O4(n,e){L(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),L(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function x4(n,e,t,r,i){let s=new wv,o,a;if(t.type===vr.OVERWRITE){let c=t;c.source.fromUser?o=Tv(n,e,c.path,c.snap,r,i,s):(L(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!ue(c.path),o=lf(n,e,c.path,c.snap,r,i,a,s))}else if(t.type===vr.MERGE){let c=t;c.source.fromUser?o=M4(n,e,c.path,c.children,r,i,s):(L(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Iv(n,e,c.path,c.children,r,i,a,s))}else if(t.type===vr.ACK_USER_WRITE){let c=t;c.revert?o=B4(n,e,c.path,r,i,s):o=F4(n,e,c.path,c.affectedTree,r,i,s)}else if(t.type===vr.LISTEN_COMPLETE)o=L4(n,e,t.path,r,s);else throw ra("Unknown operation type: "+t.type);let l=s.getChanges();return P4(e,o,l),{viewCache:o,changes:l}}function P4(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=sf(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(p1(sf(e)))}}function C1(n,e,t,r,i,s){let o=e.eventCache;if(af(r,t)!=null)return e;{let a,l;if(ue(t))if(L(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=so(e),u=c instanceof oe?c:oe.EMPTY_NODE,d=oE(r,u);a=n.filter.updateFullNode(e.eventCache.getNode(),d,s)}else{let c=of(r,so(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=ce(t);if(c===".priority"){L(Fi(t)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let d=Dk(r,t,u,l);d!=null?a=n.filter.updatePriority(u,d):a=o.getNode()}else{let u=Re(t),d;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let h=Dk(r,t,o.getNode(),l);h!=null?d=o.getNode().getImmediateChild(c).updateChild(u,h):d=o.getNode().getImmediateChild(c)}else d=aE(r,c,e.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),c,d,u,i,s):a=o.getNode()}}return $c(e,a,o.isFullyInitialized()||ue(t),n.filter.filtersNodes())}}function lf(n,e,t,r,i,s,o,a){let l=e.serverCache,c,u=o?n.filter:n.filter.getIndexedFilter();if(ue(t))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){let p=l.getNode().updateChild(t,r);c=u.updateFullNode(l.getNode(),p,null)}else{let p=ce(t);if(!l.isCompleteForPath(t)&&Fi(t)>1)return e;let E=Re(t),T=l.getNode().getImmediateChild(p).updateChild(E,r);p===".priority"?c=u.updatePriority(l.getNode(),T):c=u.updateChild(l.getNode(),p,T,E,S1,null)}let d=m1(e,c,l.isFullyInitialized()||ue(t),u.filtersNodes()),h=new iu(i,d,s);return C1(n,d,t,i,h,a)}function Tv(n,e,t,r,i,s,o){let a=e.eventCache,l,c,u=new iu(i,e,s);if(ue(t))c=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=$c(e,c,!0,n.filter.filtersNodes());else{let d=ce(t);if(d===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),r),l=$c(e,c,a.isFullyInitialized(),a.isFiltered());else{let h=Re(t),p=a.getNode().getImmediateChild(d),E;if(ue(h))E=r;else{let w=u.getCompleteChild(d);w!=null?Jv(h)===".priority"&&w.getChild(l1(h)).isEmpty()?E=w:E=w.updateChild(h,r):E=oe.EMPTY_NODE}if(p.equals(E))l=e;else{let w=n.filter.updateChild(a.getNode(),d,E,h,u,o);l=$c(e,w,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function Rk(n,e){return n.eventCache.isCompleteForChild(e)}function M4(n,e,t,r,i,s,o){let a=e;return r.foreach((l,c)=>{let u=qe(t,l);Rk(e,ce(u))&&(a=Tv(n,a,u,c,i,s,o))}),r.foreach((l,c)=>{let u=qe(t,l);Rk(e,ce(u))||(a=Tv(n,a,u,c,i,s,o))}),a}function kk(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function Iv(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;ue(t)?c=r:c=new $t(null).setTree(t,r);let u=e.serverCache.getNode();return c.children.inorderTraversal((d,h)=>{if(u.hasChild(d)){let p=e.serverCache.getNode().getImmediateChild(d),E=kk(n,p,h);l=lf(n,l,new we(d),E,i,s,o,a)}}),c.children.inorderTraversal((d,h)=>{let p=!e.serverCache.isCompleteForChild(d)&&h.value===null;if(!u.hasChild(d)&&!p){let E=e.serverCache.getNode().getImmediateChild(d),w=kk(n,E,h);l=lf(n,l,new we(d),w,i,s,o,a)}}),l}function F4(n,e,t,r,i,s,o){if(af(i,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(ue(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return lf(n,e,t,l.getNode().getChild(t),i,s,a,o);if(ue(t)){let c=new $t(null);return l.getNode().forEachChild(Er,(u,d)=>{c=c.set(new we(u),d)}),Iv(n,e,t,c,i,s,a,o)}else return e}else{let c=new $t(null);return r.foreach((u,d)=>{let h=qe(t,u);l.isCompleteForPath(h)&&(c=c.set(u,l.getNode().getChild(h)))}),Iv(n,e,t,c,i,s,a,o)}}function L4(n,e,t,r,i){let s=e.serverCache,o=m1(e,s.getNode(),s.isFullyInitialized()||ue(t),s.isFiltered());return C1(n,o,t,r,S1,i)}function B4(n,e,t,r,i,s){let o;if(af(r,t)!=null)return e;{let a=new iu(r,e,i),l=e.eventCache.getNode(),c;if(ue(t)||ce(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=of(r,so(e));else{let d=e.serverCache.getNode();L(d instanceof oe,"serverChildren would be complete if leaf node"),u=oE(r,d)}u=u,c=n.filter.updateFullNode(l,u,s)}else{let u=ce(t),d=aE(r,u,e.serverCache);d==null&&e.serverCache.isCompleteForChild(u)&&(d=l.getImmediateChild(u)),d!=null?c=n.filter.updateChild(l,u,d,Re(t),a,s):e.eventCache.getNode().hasChild(u)?c=n.filter.updateChild(l,u,oe.EMPTY_NODE,Re(t),a,s):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=of(r,so(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||af(r,Ce())!=null,$c(e,c,o,n.filter.filtersNodes())}}var Av=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new tu(r.getIndex()),s=s4(r);this.processor_=N4(s);let o=t.serverCache,a=t.eventCache,l=i.updateFullNode(oe.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(oe.EMPTY_NODE,a.getNode(),null),u=new Cr(l,o.isFullyInitialized(),i.filtersNodes()),d=new Cr(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Cf(d,u),this.eventGenerator_=new vv(this.query_)}get query(){return this.query_}};function V4(n){return n.viewCache_.serverCache.getNode()}function U4(n){return sf(n.viewCache_)}function q4(n,e){let t=so(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ue(e)&&!t.getImmediateChild(ce(e)).isEmpty())?t.getChild(e):null}function Nk(n){return n.eventRegistrations_.length===0}function z4(n,e){n.eventRegistrations_.push(e)}function Ok(n,e,t){let r=[];if(t){L(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function xk(n,e,t,r){e.type===vr.MERGE&&e.source.queryId!==null&&(L(so(n.viewCache_),"We should always have a full cache before handling merges"),L(sf(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=x4(n.processor_,i,e,t,r);return O4(n.processor_,s.viewCache),L(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,w1(n,s.changes,s.viewCache.eventCache.getNode(),null)}function G4(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Oe,(s,o)=>{r.push(_a(s,o))}),t.isFullyInitialized()&&r.push(p1(t.getNode())),w1(n,r,t.getNode(),e)}function w1(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return f4(n.eventGenerator_,e,t,i)}var cf,uf=class{constructor(){this.views=new Map}};function W4(n){L(!cf,"__referenceConstructor has already been defined"),cf=n}function j4(){return L(cf,"Reference.ts has not been loaded"),cf}function $4(n){return n.views.size===0}function lE(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return L(s!=null,"SyncTree gave us an op for an invalid query."),xk(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(xk(o,e,t,r));return s}}function b1(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=of(t,i?r:null),l=!1;a?l=!0:r instanceof oe?(a=oE(t,r),l=!1):(a=oe.EMPTY_NODE,l=!1);let c=Cf(new Cr(a,l,!1),new Cr(r,i,!1));return new Av(e,c)}return o}function H4(n,e,t,r,i,s){let o=b1(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),z4(o,t),G4(o,t)}function K4(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],a=Li(n);if(i==="default")for(let[l,c]of n.views.entries())o=o.concat(Ok(c,t,r)),Nk(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{let l=n.views.get(i);l&&(o=o.concat(Ok(l,t,r)),Nk(l)&&(n.views.delete(i),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!Li(n)&&s.push(new(j4())(e._repo,e._path)),{removed:s,events:o}}function T1(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Pi(n,e){let t=null;for(let r of n.views.values())t=t||q4(r,e);return t}function I1(n,e){if(e._queryParams.loadsAllData())return bf(n);{let r=e._queryIdentifier;return n.views.get(r)}}function A1(n,e){return I1(n,e)!=null}function Li(n){return bf(n)!=null}function bf(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var df;function Q4(n){L(!df,"__referenceConstructor has already been defined"),df=n}function Y4(){return L(df,"Reference.ts has not been loaded"),df}var X4=1,hf=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new $t(null),this.pendingWriteTree_=R4(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function cE(n,e,t,r,i){return y4(n.pendingWriteTree_,e,t,r,i),i?Ta(n,new va(rE(),e,t)):[]}function J4(n,e,t,r){_4(n.pendingWriteTree_,e,t,r);let i=$t.fromObject(t);return Ta(n,new ru(rE(),e,i))}function Oi(n,e,t=!1){let r=v4(n.pendingWriteTree_,e);if(E4(n.pendingWriteTree_,e)){let s=new $t(null);return r.snap!=null?s=s.set(Ce(),!0):bt(r.children,o=>{s=s.set(new we(o),!0)}),Ta(n,new _v(r.path,s,t))}else return[]}function fu(n,e,t){return Ta(n,new va(iE(),e,t))}function Z4(n,e,t){let r=$t.fromObject(t);return Ta(n,new ru(iE(),e,r))}function e3(n,e){return Ta(n,new rf(iE(),e))}function t3(n,e,t){let r=uE(n,t);if(r){let i=dE(r),s=i.path,o=i.queryId,a=jt(s,e),l=new rf(sE(o),a);return hE(n,s,l)}else return[]}function ff(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||A1(o,e))){let l=K4(o,e,t,r);$4(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let c=l.removed;if(a=l.events,!i){let u=c.findIndex(h=>h._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(s,(h,p)=>Li(p));if(u&&!d){let h=n.syncPointTree_.subtree(s);if(!h.isEmpty()){let p=i3(h);for(let E=0;E<p.length;++E){let w=p[E],T=w.query,k=N1(n,w);n.listenProvider_.startListening(Kc(T),su(n,T),k.hashFn,k.onComplete)}}}!d&&c.length>0&&!r&&(u?n.listenProvider_.stopListening(Kc(e),null):c.forEach(h=>{let p=n.queryToTagMap.get(If(h));n.listenProvider_.stopListening(Kc(h),p)}))}s3(n,c)}return a}function D1(n,e,t,r){let i=uE(n,r);if(i!=null){let s=dE(i),o=s.path,a=s.queryId,l=jt(o,e),c=new va(sE(a),l,t);return hE(n,o,c)}else return[]}function n3(n,e,t,r){let i=uE(n,r);if(i){let s=dE(i),o=s.path,a=s.queryId,l=jt(o,e),c=$t.fromObject(t),u=new ru(sE(a),l,c);return hE(n,o,u)}else return[]}function Dv(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(h,p)=>{let E=jt(h,i);s=s||Pi(p,E),o=o||Li(p)});let a=n.syncPointTree_.get(i);a?(o=o||Li(a),s=s||Pi(a,Ce())):(a=new uf,n.syncPointTree_=n.syncPointTree_.set(i,a));let l;s!=null?l=!0:(l=!1,s=oe.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((p,E)=>{let w=Pi(E,Ce());w&&(s=s.updateImmediateChild(p,w))}));let c=A1(a,e);if(!c&&!e._queryParams.loadsAllData()){let h=If(e);L(!n.queryToTagMap.has(h),"View does not exist, but we have a tag");let p=o3();n.queryToTagMap.set(h,p),n.tagToQueryMap.set(p,h)}let u=wf(n.pendingWriteTree_,i),d=H4(a,e,t,u,s,l);if(!c&&!o&&!r){let h=I1(a,e);d=d.concat(a3(n,e,h))}return d}function Tf(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=jt(o,e),c=Pi(a,l);if(c)return c});return _1(i,e,s,t,!0)}function r3(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(c,u)=>{let d=jt(c,t);r=r||Pi(u,d)});let i=n.syncPointTree_.get(t);i?r=r||Pi(i,Ce()):(i=new uf,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new Cr(r,!0,!1):null,a=wf(n.pendingWriteTree_,e._path),l=b1(i,e,a,s?o.getNode():oe.EMPTY_NODE,s);return U4(l)}function Ta(n,e){return R1(e,n.syncPointTree_,null,wf(n.pendingWriteTree_,Ce()))}function R1(n,e,t,r){if(ue(n.path))return k1(n,e,t,r);{let i=e.get(Ce());t==null&&i!=null&&(t=Pi(i,Ce()));let s=[],o=ce(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,u=v1(r,o);s=s.concat(R1(a,l,c,u))}return i&&(s=s.concat(lE(i,n,r,t))),s}}function k1(n,e,t,r){let i=e.get(Ce());t==null&&i!=null&&(t=Pi(i,Ce()));let s=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=v1(r,o),u=n.operationForChild(o);u&&(s=s.concat(k1(u,a,l,c)))}),i&&(s=s.concat(lE(i,n,r,t))),s}function N1(n,e){let t=e.query,r=su(n,t);return{hashFn:()=>(V4(e)||oe.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?t3(n,t._path,r):e3(n,t._path);{let s=gq(i,t);return ff(n,t,null,s)}}}}function su(n,e){let t=If(e);return n.queryToTagMap.get(t)}function If(n){return n._path.toString()+"$"+n._queryIdentifier}function uE(n,e){return n.tagToQueryMap.get(e)}function dE(n){let e=n.indexOf("$");return L(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new we(n.substr(0,e))}}function hE(n,e,t){let r=n.syncPointTree_.get(e);L(r,"Missing sync point for query tag that we're tracking");let i=wf(n.pendingWriteTree_,e);return lE(r,t,i,null)}function i3(n){return n.fold((e,t,r)=>{if(t&&Li(t))return[bf(t)];{let i=[];return t&&(i=T1(t)),bt(r,(s,o)=>{i=i.concat(o)}),i}})}function Kc(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Y4())(n._repo,n._path):n}function s3(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=If(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function o3(){return X4++}function a3(n,e,t){let r=e._path,i=su(n,e),s=N1(n,t),o=n.listenProvider_.startListening(Kc(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)L(!Li(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,d)=>{if(!ue(c)&&u&&Li(u))return[bf(u).query];{let h=[];return u&&(h=h.concat(T1(u).map(p=>p.query))),bt(d,(p,E)=>{h=h.concat(E)}),h}});for(let c=0;c<l.length;++c){let u=l[c];n.listenProvider_.stopListening(Kc(u),su(n,u))}}return o}var Rv=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},kv=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=qe(this.path_,e);return new n(this.syncTree_,t)}node(){return Tf(this.syncTree_,this.path_)}},l3=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Pk=function(n,e,t){if(!n||typeof n!="object")return n;if(L(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return c3(n[".sv"],e,t);if(typeof n[".sv"]=="object")return u3(n[".sv"],e);L(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},c3=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:L(!1,"Unexpected server value: "+n)}},u3=function(n,e,t){n.hasOwnProperty("increment")||L(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&L(!1,"Unexpected increment value: "+r);let i=e.node();if(L(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},O1=function(n,e,t,r){return pE(e,new kv(t,n),r)},fE=function(n,e,t){return pE(n,new Rv(e),t)};function pE(n,e,t){let r=n.getPriority().val(),i=Pk(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=Pk(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new ga(a,je(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new ga(i))),o.forEachChild(Oe,(a,l)=>{let c=pE(l,e.getImmediateChild(a),t);c!==l&&(s=s.updateImmediateChild(a,c))}),s}}var ou=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function Af(n,e){let t=e instanceof we?e:new we(e),r=n,i=ce(t);for(;i!==null;){let s=bi(r.node.children,i)||{children:{},childCount:0};r=new ou(i,r,s),t=Re(t),i=ce(t)}return r}function lo(n){return n.node.value}function mE(n,e){n.node.value=e,Nv(n)}function x1(n){return n.node.childCount>0}function d3(n){return lo(n)===void 0&&!x1(n)}function Df(n,e){bt(n.node.children,(t,r)=>{e(new ou(t,n,r))})}function P1(n,e,t,r){t&&!r&&e(n),Df(n,i=>{P1(i,e,!0,r)}),t&&r&&e(n)}function h3(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function pu(n){return new we(n.parent===null?n.name:pu(n.parent)+"/"+n.name)}function Nv(n){n.parent!==null&&f3(n.parent,n.name,n)}function f3(n,e,t){let r=d3(t),i=bn(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,Nv(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,Nv(n))}var p3=/[\[\].#$\/\u0000-\u001F\u007F]/,m3=/[\[\].#$\u0000-\u001F\u007F]/,z_=10*1024*1024,Rf=function(n){return typeof n=="string"&&n.length!==0&&!p3.test(n)},M1=function(n){return typeof n=="string"&&n.length!==0&&!m3.test(n)},g3=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),M1(n)},au=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Ef(n)||n&&typeof n=="object"&&bn(n,".sv")},wr=function(n,e,t,r){r&&e===void 0||mu(en(n,"value"),e,t)},mu=function(n,e,t){let r=t instanceof we?new tv(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+no(r));if(typeof e=="function")throw new Error(n+"contains a function "+no(r)+" with contents = "+e.toString());if(Ef(e))throw new Error(n+"contains "+e.toString()+" "+no(r));if(typeof e=="string"&&e.length>z_/3&&vc(e)>z_)throw new Error(n+"contains a string greater than "+z_+" utf8 bytes "+no(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(bt(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Rf(o)))throw new Error(n+" contains an invalid key ("+o+") "+no(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);$q(r,o),mu(n,a,r),Hq(r)}),i&&s)throw new Error(n+' contains ".value" child '+no(r)+" in addition to actual children.")}},y3=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=Xc(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Rf(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(jq);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&In(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},F1=function(n,e,t,r){if(r&&e===void 0)return;let i=en(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];bt(e,(o,a)=>{let l=new we(o);if(mu(i,a,qe(t,l)),Jv(l)===".priority"&&!au(a))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(l)}),y3(i,s)},gE=function(n,e,t){if(!(t&&e===void 0)){if(Ef(e))throw new Error(en(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!au(e))throw new Error(en(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},gu=function(n,e,t,r){if(!(r&&t===void 0)&&!Rf(t))throw new Error(en(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Ia=function(n,e,t,r){if(!(r&&t===void 0)&&!M1(t))throw new Error(en(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},_3=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ia(n,e,t,r)},dn=function(n,e){if(ce(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},L1=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Rf(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!g3(t))throw new Error(en(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Ov=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function kf(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!Zv(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function B1(n,e,t){kf(n,t),V1(n,r=>Zv(r,e))}function hn(n,e,t){kf(n,t),V1(n,r=>In(r,e)||In(e,r))}function V1(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(v3(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function v3(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();io&&wt("event: "+t.toString()),wa(r)}}}var U1="repo_interrupt",E3=25,xv=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ov,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=nf(),this.transactionQueueTree_=new ou,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function S3(n,e,t){if(n.stats_=Qv(n.repoInfo_),n.forceRestClient_||Eq())n.server_=new hv(n.repoInfo_,(r,i,s,o)=>{Mk(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Fk(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ct(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new eE(n.repoInfo_,e,(r,i,s,o)=>{Mk(n,r,i,s,o)},r=>{Fk(n,r)},r=>{C3(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=Cq(n.repoInfo_,()=>new yv(n.stats_,n.server_)),n.infoData_=new fv,n.infoSyncTree_=new hf({startListening:(r,i,s,o)=>{let a=[],l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=fu(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),yE(n,"connected",!1),n.serverSyncTree_=new hf({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,l)=>{let c=o(a,l);hn(n.eventQueue_,r._path,c)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function q1(n){let t=n.infoData_.getNode(new we(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function yu(n){return l3({timestamp:q1(n)})}function Mk(n,e,t,r,i){n.dataUpdateCount++;let s=new we(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let l=_c(t,c=>je(c));o=n3(n.serverSyncTree_,s,l,i)}else{let l=je(t);o=D1(n.serverSyncTree_,s,l,i)}else if(r){let l=_c(t,c=>je(c));o=Z4(n.serverSyncTree_,s,l)}else{let l=je(t);o=fu(n.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=Sa(n,s)),hn(n.eventQueue_,a,o)}function Fk(n,e){yE(n,"connected",e),e===!1&&T3(n)}function C3(n,e){bt(e,(t,r)=>{yE(n,t,r)})}function yE(n,e,t){let r=new we("/.info/"+e),i=je(t);n.infoData_.updateSnapshot(r,i);let s=fu(n.infoSyncTree_,r,i);hn(n.eventQueue_,r,s)}function Nf(n){return n.nextWriteId_++}function w3(n,e,t){let r=r3(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=je(i).withIndex(e._queryParams.getIndex());Dv(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=fu(n.serverSyncTree_,e._path,s);else{let a=su(n.serverSyncTree_,e);o=D1(n.serverSyncTree_,e._path,s,a)}return hn(n.eventQueue_,e._path,o),ff(n.serverSyncTree_,e,t,null,!0),s},i=>(Aa(n,"get for query "+ct(e)+" failed: "+i),Promise.reject(new Error(i))))}function _E(n,e,t,r,i){Aa(n,"set",{path:e.toString(),value:t,priority:r});let s=yu(n),o=je(t,r),a=Tf(n.serverSyncTree_,e),l=fE(o,a,s),c=Nf(n),u=cE(n.serverSyncTree_,e,l,c,!0);kf(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(h,p)=>{let E=h==="ok";E||xt("set at "+e+" failed: "+h);let w=Oi(n.serverSyncTree_,c,!E);hn(n.eventQueue_,e,w),Bi(n,i,h,p)});let d=EE(n,e);Sa(n,d),hn(n.eventQueue_,d,[])}function b3(n,e,t,r){Aa(n,"update",{path:e.toString(),value:t});let i=!0,s=yu(n),o={};if(bt(t,(a,l)=>{i=!1,o[a]=O1(qe(e,a),je(l),n.serverSyncTree_,s)}),i)wt("update() called with empty data.  Don't do anything."),Bi(n,r,"ok",void 0);else{let a=Nf(n),l=J4(n.serverSyncTree_,e,o,a);kf(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,u)=>{let d=c==="ok";d||xt("update at "+e+" failed: "+c);let h=Oi(n.serverSyncTree_,a,!d),p=h.length>0?Sa(n,e):e;hn(n.eventQueue_,p,h),Bi(n,r,c,u)}),bt(t,c=>{let u=EE(n,qe(e,c));Sa(n,u)}),hn(n.eventQueue_,e,[])}}function T3(n){Aa(n,"onDisconnectEvents");let e=yu(n),t=nf();mv(n.onDisconnect_,Ce(),(i,s)=>{let o=O1(i,s,n.serverSyncTree_,e);ba(t,i,o)});let r=[];mv(t,Ce(),(i,s)=>{r=r.concat(fu(n.serverSyncTree_,i,s));let o=EE(n,i);Sa(n,o)}),n.onDisconnect_=nf(),hn(n.eventQueue_,Ce(),r)}function I3(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&pv(n.onDisconnect_,e),Bi(n,t,r,i)})}function Lk(n,e,t,r){let i=je(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&ba(n.onDisconnect_,e,i),Bi(n,r,s,o)})}function A3(n,e,t,r,i){let s=je(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&ba(n.onDisconnect_,e,s),Bi(n,i,o,a)})}function D3(n,e,t,r){if(wh(t)){wt("onDisconnect().update() called with empty data.  Don't do anything."),Bi(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&bt(t,(o,a)=>{let l=je(a);ba(n.onDisconnect_,qe(e,o),l)}),Bi(n,r,i,s)})}function R3(n,e,t){let r;ce(e._path)===".info"?r=Dv(n.infoSyncTree_,e,t):r=Dv(n.serverSyncTree_,e,t),B1(n.eventQueue_,e._path,r)}function Pv(n,e,t){let r;ce(e._path)===".info"?r=ff(n.infoSyncTree_,e,t):r=ff(n.serverSyncTree_,e,t),B1(n.eventQueue_,e._path,r)}function z1(n){n.persistentConnection_&&n.persistentConnection_.interrupt(U1)}function k3(n){n.persistentConnection_&&n.persistentConnection_.resume(U1)}function Aa(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),wt(t,...e)}function Bi(n,e,t,r){e&&wa(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function N3(n,e,t,r,i,s){Aa(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:Yk(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=vE(n,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{mu("transaction failed: Data returned ",l,o.path),o.status=0;let c=Af(n.transactionQueueTree_,e),u=lo(c)||[];u.push(o),mE(c,u);let d;typeof l=="object"&&l!==null&&bn(l,".priority")?(d=bi(l,".priority"),L(au(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):d=(Tf(n.serverSyncTree_,e)||oe.EMPTY_NODE).getPriority().val();let h=yu(n),p=je(l,d),E=fE(p,a,h);o.currentOutputSnapshotRaw=p,o.currentOutputSnapshotResolved=E,o.currentWriteId=Nf(n);let w=cE(n.serverSyncTree_,e,E,o.currentWriteId,o.applyLocally);hn(n.eventQueue_,e,w),Of(n,n.transactionQueueTree_)}}function vE(n,e,t){return Tf(n.serverSyncTree_,e,t)||oe.EMPTY_NODE}function Of(n,e=n.transactionQueueTree_){if(e||xf(n,e),lo(e)){let t=W1(n,e);L(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&O3(n,pu(e),t)}else x1(e)&&Df(e,t=>{Of(n,t)})}function O3(n,e,t){let r=t.map(c=>c.currentWriteId),i=vE(n,e,r),s=i,o=i.hash();for(let c=0;c<t.length;c++){let u=t[c];L(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let d=jt(e,u.path);s=s.updateChild(d,u.currentOutputSnapshotRaw)}let a=s.val(!0),l=e;n.server_.put(l.toString(),a,c=>{Aa(n,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let d=[];for(let h=0;h<t.length;h++)t[h].status=2,u=u.concat(Oi(n.serverSyncTree_,t[h].currentWriteId)),t[h].onComplete&&d.push(()=>t[h].onComplete(null,!0,t[h].currentOutputSnapshotResolved)),t[h].unwatcher();xf(n,Af(n.transactionQueueTree_,e)),Of(n,n.transactionQueueTree_),hn(n.eventQueue_,e,u);for(let h=0;h<d.length;h++)wa(d[h])}else{if(c==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{xt("transaction at "+l.toString()+" failed: "+c);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=c}Sa(n,e)}},o)}function Sa(n,e){let t=G1(n,e),r=pu(t),i=W1(n,t);return x3(n,i,r),r}function x3(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=jt(t,l.path),u=!1,d;if(L(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,d=l.abortReason,i=i.concat(Oi(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=E3)u=!0,d="maxretry",i=i.concat(Oi(n.serverSyncTree_,l.currentWriteId,!0));else{let h=vE(n,l.path,o);l.currentInputSnapshot=h;let p=e[a].update(h.val());if(p!==void 0){mu("transaction failed: Data returned ",p,l.path);let E=je(p);typeof p=="object"&&p!=null&&bn(p,".priority")||(E=E.updatePriority(h.getPriority()));let T=l.currentWriteId,k=yu(n),R=fE(E,h,k);l.currentOutputSnapshotRaw=E,l.currentOutputSnapshotResolved=R,l.currentWriteId=Nf(n),o.splice(o.indexOf(T),1),i=i.concat(cE(n.serverSyncTree_,l.path,R,l.currentWriteId,l.applyLocally)),i=i.concat(Oi(n.serverSyncTree_,T,!0))}else u=!0,d="nodata",i=i.concat(Oi(n.serverSyncTree_,l.currentWriteId,!0))}hn(n.eventQueue_,t,i),i=[],u&&(e[a].status=2,function(h){setTimeout(h,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(d),!1,null))))}xf(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)wa(r[a]);Of(n,n.transactionQueueTree_)}function G1(n,e){let t,r=n.transactionQueueTree_;for(t=ce(e);t!==null&&lo(r)===void 0;)r=Af(r,t),e=Re(e),t=ce(e);return r}function W1(n,e){let t=[];return j1(n,e,t),t.sort((r,i)=>r.order-i.order),t}function j1(n,e,t){let r=lo(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);Df(e,i=>{j1(n,i,t)})}function xf(n,e){let t=lo(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,mE(e,t.length>0?t:void 0)}Df(e,r=>{xf(n,r)})}function EE(n,e){let t=pu(G1(n,e)),r=Af(n.transactionQueueTree_,e);return h3(r,i=>{G_(n,i)}),G_(n,r),P1(r,i=>{G_(n,i)}),t}function G_(n,e){let t=lo(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(L(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(L(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Oi(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?mE(e,void 0):t.length=s+1,hn(n.eventQueue_,pu(e),i);for(let o=0;o<r.length;o++)wa(r[o])}}function P3(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function M3(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):xt(`Invalid query segment '${t}' in query '${n}'`)}return e}var Mv=function(n,e){let t=F3(n),r=t.namespace;t.domain==="firebase.com"&&Sr(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Sr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||dq();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Qh(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new we(t.pathString)}},F3=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let u=n.indexOf("/");u===-1&&(u=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(u,d)),u<d&&(i=P3(n.substring(u,d)));let h=M3(n.substring(Math.min(n.length,d)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let p=e.slice(0,c);if(p.toLowerCase()==="localhost")t="localhost";else if(p.split(".").length<=2)t=p;else{let E=e.indexOf(".");r=e.substring(0,E).toLowerCase(),t=e.substring(E+1),s=r}"ns"in h&&(s=h.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var Bk="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",L3=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=Bk.charAt(t%64),t=Math.floor(t/64);L(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=Bk.charAt(e[i]);return L(o.length===20,"nextPushId: Length should be 20."),o}}();var pf=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ct(this.snapshot.exportVal())}},mf=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var lu=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return L(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var gf=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new St;return I3(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){dn("OnDisconnect.remove",this._path);let e=new St;return Lk(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){dn("OnDisconnect.set",this._path),wr("OnDisconnect.set",e,this._path,!1);let t=new St;return Lk(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){dn("OnDisconnect.setWithPriority",this._path),wr("OnDisconnect.setWithPriority",e,this._path,!1),gE("OnDisconnect.setWithPriority",t,!1);let r=new St;return A3(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){dn("OnDisconnect.update",this._path),F1("OnDisconnect.update",e,this._path,!1);let t=new St;return D3(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var Ht=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return ue(this._path)?null:Jv(this._path)}get ref(){return new fn(this._repo,this._path)}get _queryIdentifier(){let e=bk(this._queryParams),t=Kv(e);return t==="{}"?"default":t}get _queryObject(){return bk(this._queryParams)}isEqual(e){if(e=fe(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=Zv(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Wq(this._path)}};function Pf(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Vi(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Er){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Mi)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==ei)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===Oe){if(e!=null&&!au(e)||t!=null&&!au(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(L(n.getIndex()instanceof Jc||n.getIndex()===nE,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Mf(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var fn=class n extends Ht{constructor(e,t){super(e,t,new nu,!1)}get parent(){let e=l1(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Ca=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new we(e),r=ti(this.ref,e);return new n(this._node.getChild(t),r,Oe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,ti(this.ref,r),Oe)))}hasChild(e){let t=new we(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Ff(n,e){return n=fe(n),n._checkNotDeleted("ref"),e!==void 0?ti(n._root,e):n._root}function Lf(n,e){n=fe(n),n._checkNotDeleted("refFromURL");let t=Mv(e,n._repo.repoInfo_.nodeAdmin);L1("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Sr("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),Ff(n,t.path.toString())}function ti(n,e){return n=fe(n),ce(n._path)===null?_3("child","path",e,!1):Ia("child","path",e,!1),new fn(n._repo,qe(n._path,e))}function SE(n,e){n=fe(n),dn("push",n._path),wr("push",e,n._path,!0);let t=q1(n._repo),r=L3(t),i=ti(n,r),s=ti(n,r),o;return e!=null?o=_u(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function CE(n){return dn("remove",n._path),_u(n,null)}function _u(n,e){n=fe(n),dn("set",n._path),wr("set",e,n._path,!1);let t=new St;return _E(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function wE(n,e){n=fe(n),dn("setPriority",n._path),gE("setPriority",e,!1);let t=new St;return _E(n._repo,qe(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function bE(n,e,t){if(dn("setWithPriority",n._path),wr("setWithPriority",e,n._path,!1),gE("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new St;return _E(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function TE(n,e){F1("update",e,n._path,!1);let t=new St;return b3(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function IE(n){n=fe(n);let e=new lu(()=>{}),t=new cu(e);return w3(n._repo,n,t).then(r=>new Ca(r,new fn(n._repo,n._path),n._queryParams.getIndex()))}var cu=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new pf("value",this,new Ca(e.snapshotNode,new fn(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new mf(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},yf=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new mf(this,e,t):null}createEvent(e,t){L(e.childName!=null,"Child events should have a childName.");let r=ti(new fn(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new pf(e.type,this,new Ca(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function vu(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let l=t,c=(u,d)=>{Pv(n._repo,n,a),l(u,d)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new lu(t,s||void 0),a=e==="value"?new cu(o):new yf(e,o);return R3(n._repo,n,a),()=>Pv(n._repo,n,a)}function Eu(n,e,t,r){return vu(n,"value",e,t,r)}function Bf(n,e,t,r){return vu(n,"child_added",e,t,r)}function Vf(n,e,t,r){return vu(n,"child_changed",e,t,r)}function Uf(n,e,t,r){return vu(n,"child_moved",e,t,r)}function qf(n,e,t,r){return vu(n,"child_removed",e,t,r)}function zf(n,e,t){let r=null,i=t?new lu(t):null;e==="value"?r=new cu(i):e&&(r=new yf(e,i)),Pv(n._repo,n,r)}var pn=class{},_f=class extends pn{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){wr("endAt",this._value,e._path,!0);let t=dv(e._queryParams,this._value,this._key);if(Mf(t),Vi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ht(e._repo,e._path,t,e._orderByCalled)}};function AE(n,e){return gu("endAt","key",e,!0),new _f(n,e)}var Fv=class extends pn{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){wr("endBefore",this._value,e._path,!1);let t=c4(e._queryParams,this._value,this._key);if(Mf(t),Vi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ht(e._repo,e._path,t,e._orderByCalled)}};function DE(n,e){return gu("endBefore","key",e,!0),new Fv(n,e)}var vf=class extends pn{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){wr("startAt",this._value,e._path,!0);let t=uv(e._queryParams,this._value,this._key);if(Mf(t),Vi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Ht(e._repo,e._path,t,e._orderByCalled)}};function RE(n=null,e){return gu("startAt","key",e,!0),new vf(n,e)}var Lv=class extends pn{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){wr("startAfter",this._value,e._path,!1);let t=l4(e._queryParams,this._value,this._key);if(Mf(t),Vi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Ht(e._repo,e._path,t,e._orderByCalled)}};function kE(n,e){return gu("startAfter","key",e,!0),new Lv(n,e)}var Bv=class extends pn{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ht(e._repo,e._path,o4(e._queryParams,this._limit),e._orderByCalled)}};function NE(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Bv(n)}var Vv=class extends pn{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ht(e._repo,e._path,a4(e._queryParams,this._limit),e._orderByCalled)}};function OE(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Vv(n)}var Uv=class extends pn{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Pf(e,"orderByChild");let t=new we(this._path);if(ue(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new Jc(t),i=Sf(e._queryParams,r);return Vi(i),new Ht(e._repo,e._path,i,!0)}};function xE(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ia("orderByChild","path",n,!1),new Uv(n)}var qv=class extends pn{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Pf(e,"orderByKey");let t=Sf(e._queryParams,Er);return Vi(t),new Ht(e._repo,e._path,t,!0)}};function PE(){return new qv}var zv=class extends pn{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Pf(e,"orderByPriority");let t=Sf(e._queryParams,Oe);return Vi(t),new Ht(e._repo,e._path,t,!0)}};function ME(){return new zv}var Gv=class extends pn{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Pf(e,"orderByValue");let t=Sf(e._queryParams,nE);return Vi(t),new Ht(e._repo,e._path,t,!0)}};function FE(){return new Gv}var Wv=class extends pn{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(wr("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new _f(this._value,this._key)._apply(new vf(this._value,this._key)._apply(e))}};function LE(n,e){return gu("equalTo","key",e,!0),new Wv(n,e)}function mn(n,...e){let t=fe(n);for(let r of e)t=r._apply(t);return t}W4(fn);Q4(fn);var B3="FIREBASE_DATABASE_EMULATOR_HOST",jv={},V3=!1;function U3(n,e,t,r){n.repoInfo_=new Qh(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function BE(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||Sr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),wt("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Mv(s,i),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[B3]),c?(l=!0,s=`http://${c}?ns=${a.namespace}`,o=Mv(s,i),a=o.repoInfo):l=!o.repoInfo.secure;let u=i&&l?new jc(jc.OWNER):new X_(n.name,n.options,e);L1("Invalid Firebase Database URL",o),ue(o.path)||Sr("Database URL must point to the root of a Firebase Database (not including a child path).");let d=z3(a,n,u,new Y_(n.name,t));return new $v(d,n)}function q3(n,e){let t=jv[e];(!t||t[n.key]!==n)&&Sr(`Database ${e}(${n.repoInfo_}) has already been deleted.`),z1(n),delete t[n.key]}function z3(n,e,t,r){let i=jv[e.name];i||(i={},jv[e.name]=i);let s=i[n.toURLString()];return s&&Sr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new xv(n,V3,t,r),i[n.toURLString()]=s,s}var $v=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(S3(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new fn(this._repo,Ce())),this._rootInternal}_delete(){return this._rootInternal!==null&&(q3(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Sr("Cannot call "+e+" on a deleted database.")}};function $1(){a1.IS_TRANSPORT_INITIALIZED&&xt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function VE(){$1(),Yc.forceDisallow()}function UE(){$1(),ha.forceDisallow(),Yc.forceAllow()}function H1(n=Ws(),e){let t=Ec(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){let r=vh("database");r&&Gf(t,...r)}return t}function Gf(n,e,t,r={}){n=fe(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Sr("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Sr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new jc(jc.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:Eh(r.mockUserToken,n.app.options.projectId);s=new jc(o)}U3(i,e,t,s)}function qE(n){n=fe(n),n._checkNotDeleted("goOffline"),z1(n._repo)}function zE(n){n=fe(n),n._checkNotDeleted("goOnline"),k3(n._repo)}function GE(n,e){Jk(n,e)}function G3(n){Xv(Th),Gs(new cn("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return BE(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),tt(ck,uk,n),tt(ck,uk,"esm2017")}var W3={".sv":"timestamp"};function WE(){return W3}function jE(n){return{".sv":{increment:n}}}var Hv=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function $E(n,e,t){var r;if(n=fe(n),dn("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new St,o=(l,c,u)=>{let d=null;l?s.reject(l):(d=new Ca(u,new fn(n._repo,n._path),Oe),s.resolve(new Hv(c,d)))},a=Eu(n,()=>{});return N3(n._repo,n._path,e,o,a,i),s.promise}eE.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};eE.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Tq(Vk.default.Client);G3("node");var j3="@firebase/database-compat",$3="1.0.8";var H3=new Ti("@firebase/database-compat"),K1=function(n){let e="FIREBASE WARNING: "+n;H3.warn(e)};var K3=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(en(n,e)+"must be a boolean.")},Q3=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(en(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var HE=class{constructor(e){this._delegate=e}cancel(e){re("OnDisconnect.cancel",0,1,arguments.length),gt("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){re("OnDisconnect.remove",0,1,arguments.length),gt("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){re("OnDisconnect.set",1,2,arguments.length),gt("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){re("OnDisconnect.setWithPriority",2,3,arguments.length),gt("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if(re("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,K1("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}gt("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var KE=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return re("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var co=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return re("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return re("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return re("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return re("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return re("DataSnapshot.child",0,1,arguments.length),e=String(e),Ia("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return re("DataSnapshot.hasChild",1,1,arguments.length),Ia("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return re("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return re("DataSnapshot.forEach",1,1,arguments.length),gt("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return re("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return re("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return re("DataSnapshot.ref",0,0,arguments.length),new ni(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Wf=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;re("Query.on",2,4,arguments.length),gt("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),a=(c,u)=>{t.call(o.context,new co(this.database,c),u)};a.userCallback=t,a.context=o.context;let l=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return Eu(this._delegate,a,l),t;case"child_added":return Bf(this._delegate,a,l),t;case"child_removed":return qf(this._delegate,a,l),t;case"child_changed":return Vf(this._delegate,a,l),t;case"child_moved":return Uf(this._delegate,a,l),t;default:throw new Error(en("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if(re("Query.off",0,3,arguments.length),Q3("Query.off",e,!0),gt("Query.off","callback",t,!0),Wy("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,zf(this._delegate,e,i)}else zf(this._delegate,e)}get(){return IE(this._delegate).then(e=>new co(this.database,e))}once(e,t,r,i){re("Query.once",1,4,arguments.length),gt("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new St,a=(c,u)=>{let d=new co(this.database,c);t&&t.call(s.context,d,u),o.resolve(d)};a.userCallback=t,a.context=s.context;let l=c=>{s.cancel&&s.cancel.call(s.context,c),o.reject(c)};switch(e){case"value":Eu(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":Bf(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":qf(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":Vf(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":Uf(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(en("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return re("Query.limitToFirst",1,1,arguments.length),new n(this.database,mn(this._delegate,NE(e)))}limitToLast(e){return re("Query.limitToLast",1,1,arguments.length),new n(this.database,mn(this._delegate,OE(e)))}orderByChild(e){return re("Query.orderByChild",1,1,arguments.length),new n(this.database,mn(this._delegate,xE(e)))}orderByKey(){return re("Query.orderByKey",0,0,arguments.length),new n(this.database,mn(this._delegate,PE()))}orderByPriority(){return re("Query.orderByPriority",0,0,arguments.length),new n(this.database,mn(this._delegate,ME()))}orderByValue(){return re("Query.orderByValue",0,0,arguments.length),new n(this.database,mn(this._delegate,FE()))}startAt(e=null,t){return re("Query.startAt",0,2,arguments.length),new n(this.database,mn(this._delegate,RE(e,t)))}startAfter(e=null,t){return re("Query.startAfter",0,2,arguments.length),new n(this.database,mn(this._delegate,kE(e,t)))}endAt(e=null,t){return re("Query.endAt",0,2,arguments.length),new n(this.database,mn(this._delegate,AE(e,t)))}endBefore(e=null,t){return re("Query.endBefore",0,2,arguments.length),new n(this.database,mn(this._delegate,DE(e,t)))}equalTo(e,t){return re("Query.equalTo",1,2,arguments.length),new n(this.database,mn(this._delegate,LE(e,t)))}toString(){return re("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return re("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(re("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,gt(e,"cancel",i.cancel,!0),i.context=r,Wy(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(en(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new ni(this.database,new fn(this._delegate._repo,this._delegate._path))}},ni=class n extends Wf{constructor(e,t){super(e,new Ht(t._repo,t._path,new nu,!1)),this.database=e,this._delegate=t}getKey(){return re("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return re("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,ti(this._delegate,e))}getParent(){re("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return re("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){re("Reference.set",1,2,arguments.length),gt("Reference.set","onComplete",t,!0);let r=_u(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if(re("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,K1("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}dn("Reference.update",this._delegate._path),gt("Reference.update","onComplete",t,!0);let r=TE(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){re("Reference.setWithPriority",2,3,arguments.length),gt("Reference.setWithPriority","onComplete",r,!0);let i=bE(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){re("Reference.remove",0,1,arguments.length),gt("Reference.remove","onComplete",e,!0);let t=CE(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){re("Reference.transaction",1,3,arguments.length),gt("Reference.transaction","transactionUpdate",e,!1),gt("Reference.transaction","onComplete",t,!0),K3("Reference.transaction","applyLocally",r,!0);let i=$E(this._delegate,e,{applyLocally:r}).then(s=>new KE(s.committed,new co(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){re("Reference.setPriority",1,2,arguments.length),gt("Reference.setPriority","onComplete",t,!0);let r=wE(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){re("Reference.push",0,2,arguments.length),gt("Reference.push","onComplete",t,!0);let r=SE(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return dn("Reference.onDisconnect",this._delegate._path),new HE(new gf(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var uo=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:VE,forceLongPolling:UE}}useEmulator(e,t,r={}){Gf(this._delegate,e,t,r)}ref(e){if(re("database.ref",0,1,arguments.length),e instanceof ni){let t=Lf(this._delegate,e.toString());return new ni(this,t)}else{let t=Ff(this._delegate,e);return new ni(this,t)}}refFromURL(e){re("database.refFromURL",1,1,arguments.length);let r=Lf(this._delegate,e);return new ni(this,r)}goOffline(){return re("database.goOffline",0,0,arguments.length),qE(this._delegate)}goOnline(){return re("database.goOnline",0,0,arguments.length),zE(this._delegate)}};uo.ServerValue={TIMESTAMP:WE(),increment:n=>jE(n)};function Y3({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){Xv(t);let a=new jy("database-standalone"),l=new bh("auth-internal",a);l.setComponent(new cn("auth-internal",()=>r,"PRIVATE"));let c;return i&&(c=new bh("app-check-internal",a),c.setComponent(new cn("app-check-internal",()=>i,"PRIVATE"))),{instance:new uo(BE(n,l,c,e,o),n),namespace:s}}var X3=Object.freeze({__proto__:null,initStandalone:Y3});var J3=uo.ServerValue;function Z3(n){n.INTERNAL.registerComponent(new cn("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new uo(i,r)},"PUBLIC").setServiceProps({Reference:ni,Query:Wf,Database:uo,DataSnapshot:co,enableLogging:GE,INTERNAL:X3,ServerValue:J3}).setMultipleInstances(!0)),n.registerVersion(j3,$3,"node")}Z3(yt);function Su(n,e,t="on",r=na){return new ur(i=>{let s=null;return s=n[t](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(Ve(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),IA())}function ez(n){return typeof n=="string"}function tz(n){return typeof n.exportVal=="function"}function Z1(n){return n==null}function eN(n){return typeof n.set=="function"}function Q1(n,e){return eN(e)?e:n.ref(e)}function tN(n,e){if(ez(n))return e.stringCase();if(eN(n))return e.firebaseCase();if(tz(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function nN(n){return(Z1(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function rN(n,e,t){e=nN(e);let r=e.map(i=>Su(n,i,"on",t));return fc(...r)}function nz(n,e,t){let r=rN(n,e).pipe(Us((i,s)=>[...i,s],[]));return iz(n,r,t)}function rz(n,e){return Su(n,"value","on",e).pipe(Ve(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function iz(n,e,t){return rz(n,t).pipe(RA(e),Ve(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(l=>l.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),AA(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),Ve(i=>i.actions))}function Y1(n,e){return function(r,i){return tN(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function sz(n){return function(t){return t?tN(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function oz(n,e,t){return Su(n,"value","once",t).pipe(Yr(r=>{let i=[hr(r)];return e.forEach(s=>i.push(Su(n,s,"on",t))),fc(...i).pipe(Us(lz,[]))}),sh())}function iN(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function az(n,e){if(Z1(e))return 0;{let t=iN(n,e);return t===-1?n.length:t+1}}function lz(n,e){let{payload:t,prevKey:r,key:i}=e,s=iN(n,i),o=az(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function X1(n,e,t){return e=nN(e),oz(n,e,t)}function cz(n,e){let t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Y1(r,"update"),set:Y1(r,"set"),push:i=>r.push(i),remove:sz(r),snapshotChanges(i){return X1(n,i,t).pipe(Xe)},stateChanges(i){return rN(n,i,t).pipe(Xe)},auditTrail(i){return nz(n,i,t).pipe(Xe)},valueChanges(i,s){return X1(n,i,t).pipe(Ve(a=>a.map(l=>s&&s.idField?Cn(qt({},l.payload.val()),{[s.idField]:l.key}):l.payload.val())),Xe)}}}function J1(n,e){return function(){return Su(n,"value","on",e)}}function uz(n,e){return{query:n,snapshotChanges(){return J1(n,e.schedulers.outsideAngular)().pipe(Xe)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return J1(n,e.schedulers.outsideAngular)().pipe(Xe,Ve(r=>r.payload.exists()?r.payload.val():null))}}}var dz=new ve("angularfire2.realtimeDatabaseURL"),hz=new ve("angularfire2.database.use-emulator"),QE=(()=>{class n{schedulers;database;constructor(t,r,i,s,o,a,l,c,u,d,h,p,E,w,T){this.schedulers=a;let k=l,R=Hs(t,o,r);c&&Dc(R,o,u,h,p,E,d,w),this.database=oa(`${R.name}.database.${i}`,"AngularFireDatabase",R.name,()=>{let O=o.runOutsideAngular(()=>R.database(i||void 0));return k&&O.useEmulator(...k),O},[k])}list(t,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>Q1(this.database,t)),s=i;return r&&(s=r(i)),cz(s,this)}object(t){let r=this.schedulers.ngZone.runOutsideAngular(()=>Q1(this.database,t));return uz(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(te(Di),te(Ri,8),te(dz,8),te(pr),te(Et),te(tn),te(hz,8),te(Rc,8),te(Cc,8),te(wc,8),te(bc,8),te(Tc,8),te(Ic,8),te(Ac,8),te(zt,8))};static \u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),sN=(()=>{class n{constructor(){yt.registerVersion("angularfire",Ct.full,"rtdb-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Gn({type:n});static \u0275inj=zn({providers:[QE]})}return n})();var jf=(()=>{class n{constructor(t){this.db=t,this.dbPath="/products",this.productsRef=t.list(this.dbPath)}getAllProducts(){return this.productsRef}getProduct(t){return this.db.object(`${this.dbPath}/${t}`)}addProduct(t){this.productsRef.push(t)}updateProduct(t,r){this.productsRef.update(t,r)}deleteProduct(t){return this.productsRef.remove(t)}static{this.\u0275fac=function(r){return new(r||n)(te(QE))}}static{this.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function pz(n,e){if(n&1){let t=BA();z(0,"div",16)(1,"div",6)(2,"h5",7),ne(3),K(),z(4,"p",8),ne(5),K(),z(6,"button",18),zs("click",function(){let i=NA(t).$implicit,s=VA();return OA(s.removeProduct(i.key))}),ne(7," remove "),K()()()}if(n&2){let t=e.$implicit;wi(3),UA(t.name),wi(2),qA(" ",t.description," ")}}var aN=(()=>{class n{constructor(t,r){this.productService=t,this.router=r,this.products=[],this.totalProducts=0}ngOnInit(){this.getAllProducts()}getAllProducts(){this.productService.getAllProducts().snapshotChanges().subscribe({next:t=>{this.products=[],t.forEach(r=>{let i=r.payload.toJSON();this.totalProducts++,this.products.push({key:r.key||"",id:i.id,name:i.name,description:i.description})})}})}editProduct(t){this.router.navigate(["/addmakeup/"+t])}removeProduct(t){window.confirm("Are You Sure ??")&&this.productService.deleteProduct(t)}static{this.\u0275fac=function(r){return new(r||n)(Ye(jf),Ye(HA))}}static{this.\u0275cmp=fr({type:n,selectors:[["app-makeupproducts"]],standalone:!0,features:[mr],decls:74,vars:0,consts:[[1,"text-center","heading","mt-3","text-danger"],[1,"text-center","mt-5",2,"margin-left","10%"],[1,"row"],[1,"col-4"],[1,"card",2,"width","18rem"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/products/lip-makeup/lip-color/super-stay-teddy-tint/alt-pics/maybelline-superstay-teddy-tint-55-kneehigh-041554089059-primary_760x1138.jpg?rev=d6a639391b62404bac9261c3837784a1&cx=0.52&cy=0.48&cw=315&ch=472&hash=0AA5FBA4B28B6B2119D345E9104A3BEB","alt","...",1,"card-img-top"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["href","#",1,"btn","btn-danger"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/eye-makeup/mascara/lash-sensational-sky-high-space-diamond-glitter-mascara/atf/maybelline-sky-high-lash-sensational-mascara-eye-791-space-diamond-041554094374-open-p.jpg?rev=eee43192b4dd4c2da7034d32a068c9d7&cx=0&cy=0&cw=315&ch=472&hash=563205AE02C29BA0C317E9A649B3DAD4","alt","...",1,"card-img-top"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/face-makeup/foundation/super-stay-24hr-skin-tint-with-vitamin-c/maybelline-super-stay-24h-skin-tint-129-041554083804-o.jpg?rev=7e248d490a57476dac1074307594bc37&cx=0.64&cy=0.52&cw=315&ch=472&hash=D195ACF2108871376E67BD61DA14A6CF","alt","...",1,"card-img-top"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/lips-makeup/lip-stick/color-sensational-the-mattes-matte-finish-lipstick-makeup/maybelline-lipstick-color-sensational-mattes-660-touch-of-spice-041554429893-o.jpg?rev=ff75b0a5d3394bf38839adeea7e6d637&cx=0&cy=0&cw=315&ch=472&hash=F670F1B9EB8952CB2DB851F183ACF2C3","alt","...",1,"card-img-top"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/eye-makeup/mascara/lash-sensational-sky-high-tinted-primer-mascara-makeup/maybelline-sky-high-tinted-primer-041554081336-o.jpg?rev=e1bbd86d826843c0b082cde4d36e82b5&cx=0&cy=0&cw=315&ch=472&hash=394BA53AEF95BAB0776F3BF3F4C5FE5E","alt","...",1,"card-img-top"],["src","https://www.maybelline.com/-/media/project/loreal/brand-sites/mny/americas/us/face-makeup/concealer/instant-age-rewind-eraser-dark-circles-concealer-treatment/maybelline-face-instant-age-rewind-eraser-concealer-packshot-sand.jpg?rev=3c118fabf9374ae7a9ebd1aa2bfbac84&cx=0&cy=0&cw=315&ch=472&hash=14E85B1D25BDFA8F79CF85DBE6C82B64","alt","...",1,"card-img-top"],[1,"container","my-4"],[1,"card","ms-5","mt-5",2,"width","70rem"],["type","button","routerLink","/makeupproducts/addmakeup",1,"btn","btn-primary","mt-5"],[1,"btn","btn-danger","ms-3",3,"click"]],template:function(r,i){r&1&&(z(0,"div",0)(1,"h1")(2,"b"),ne(3,"PRODUCTS"),K()()(),z(4,"div",1)(5,"div",2)(6,"div",3)(7,"div",4),me(8,"img",5),z(9,"div",6)(10,"h5",7),ne(11,"Super Stay Teddy Tint"),K(),z(12,"p",8),ne(13," A teddy-soft tint that lasts. Plush, light feel. Super Stay Teddy Tint lasts for up to 12 hours. "),K(),z(14,"a",9),ne(15,"VIEW PRODUCT"),K()()()(),z(16,"div",3)(17,"div",4),me(18,"img",10),z(19,"div",6)(20,"h5",7),ne(21,"Space Glitter Mascara"),K(),z(22,"p",8),ne(23," Use on lashes and brows to instantly elevate your look . Formulated suitable for sensitive "),K(),z(24,"a",9),ne(25,"VIEW PRODUCT"),K()()()(),z(26,"div",3)(27,"div",4),me(28,"img",11),z(29,"div",6)(30,"h5",7),ne(31,"24HR Skin Tint"),K(),z(32,"p",8),ne(33," Resists sweat, humidity and fading. Suitable for all skin types, including sensitive skin. "),K(),z(34,"a",9),ne(35,"VIEW PRODUCT"),K()()()()()(),z(36,"div",1)(37,"div",2)(38,"div",3)(39,"div",4),me(40,"img",12),z(41,"div",6)(42,"h5",7),ne(43,"Matte Finish Lipstick"),K(),z(44,"p",8),ne(45," Lipstick Makeup delivers crisp, vibrant lip color and smooth, supple lips. Infused with a caring oil "),K(),z(46,"a",9),ne(47,"VIEW PRODUCT"),K()()()(),z(48,"div",3)(49,"div",4),me(50,"img",13),z(51,"div",6)(52,"h5",7),ne(53,"Mascara Makeup"),K(),z(54,"p",8),ne(55," The Lash Sensational Sky High Tinted Primer is Maybelline New York's 1st tinted primer for extreme "),K(),z(56,"a",9),ne(57,"VIEW PRODUCT"),K()()()(),z(58,"div",3)(59,"div",4),me(60,"img",14),z(61,"div",6)(62,"h5",7),ne(63,"Multi-Use Concealer"),K(),z(64,"p",8),ne(65," Get up to 12 hours of moisturizing wear for crease-resistant coverage and a sponge tip applicator. "),K(),z(66,"a",9),ne(67,"VIEW PRODUCT"),K()()()()()(),z(68,"div",15),FA(69,pz,8,2,"div",16,MA),z(71,"button",17),ne(72," Add makeup "),K(),me(73,"router-outlet"),K()),r&2&&(wi(69),LA(i.products))},dependencies:[ph,gh,yh],styles:[".heading[_ngcontent-%COMP%]{background-color:#000;color:#fff}"]})}}return n})();var gN=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(r){return new(r||n)(Ye(Fy),Ye(My))}}static{this.\u0275dir=Xr({type:n})}}return n})(),mz=(()=>{class n extends gN{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=xA(n)))(i||n)}})()}static{this.\u0275dir=Xr({type:n,features:[qs]})}}return n})(),yN=new ve("");var gz={provide:yN,useExisting:ch(()=>Zf),multi:!0};function yz(){let n=Uy()?Uy().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var _z=new ve(""),Zf=(()=>{class n extends gN{constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!yz())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(r){return new(r||n)(Ye(Fy),Ye(My),Ye(_z,8))}}static{this.\u0275dir=Xr({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){r&1&&zs("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[hh([gz]),qs]})}}return n})();function qi(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function _N(n){return n!=null&&typeof n.length=="number"}var vN=new ve(""),EN=new ve(""),vz=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Ra=class{static min(e){return Ez(e)}static max(e){return Sz(e)}static required(e){return Cz(e)}static requiredTrue(e){return wz(e)}static email(e){return bz(e)}static minLength(e){return Tz(e)}static maxLength(e){return Iz(e)}static pattern(e){return Az(e)}static nullValidator(e){return SN(e)}static compose(e){return AN(e)}static composeAsync(e){return RN(e)}};function Ez(n){return e=>{if(qi(e.value)||qi(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function Sz(n){return e=>{if(qi(e.value)||qi(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function Cz(n){return qi(n.value)?{required:!0}:null}function wz(n){return n.value===!0?null:{required:!0}}function bz(n){return qi(n.value)||vz.test(n.value)?null:{email:!0}}function Tz(n){return e=>qi(e.value)||!_N(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function Iz(n){return e=>_N(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function Az(n){if(!n)return SN;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(qi(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function SN(n){return null}function CN(n){return n!=null}function wN(n){return zA(n)?dr(n):n}function bN(n){let e={};return n.forEach(t=>{e=t!=null?qt(qt({},e),t):e}),Object.keys(e).length===0?null:e}function TN(n,e){return e.map(t=>t(n))}function Dz(n){return!n.validate}function IN(n){return n.map(e=>Dz(e)?e:t=>e.validate(t))}function AN(n){if(!n)return null;let e=n.filter(CN);return e.length==0?null:function(t){return bN(TN(t,e))}}function DN(n){return n!=null?AN(IN(n)):null}function RN(n){if(!n)return null;let e=n.filter(CN);return e.length==0?null:function(t){let r=TN(t,e).map(wN);return bA(r).pipe(Ve(bN))}}function kN(n){return n!=null?RN(IN(n)):null}function lN(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function NN(n){return n._rawValidators}function ON(n){return n._rawAsyncValidators}function YE(n){return n?Array.isArray(n)?n:[n]:[]}function Hf(n,e){return Array.isArray(n)?n.includes(e):n===e}function cN(n,e){let t=YE(e);return YE(n).forEach(i=>{Hf(t,i)||t.push(i)}),t}function uN(n,e){return YE(e).filter(t=>!Hf(n,t))}var Kf=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=DN(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=kN(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},ka=class extends Kf{get formDirective(){return null}get path(){return null}},bu=class extends Kf{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Qf=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},Rz={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},uie=Cn(qt({},Rz),{"[class.ng-submitted]":"isSubmitted"}),xN=(()=>{class n extends Qf{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(Ye(bu,2))}}static{this.\u0275dir=Xr({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){r&2&&Ly("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[qs]})}}return n})(),PN=(()=>{class n extends Qf{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(Ye(ka,10))}}static{this.\u0275dir=Xr({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){r&2&&Ly("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[qs]})}}return n})();var Cu="VALID",$f="INVALID",Da="PENDING",wu="DISABLED";function ZE(n){return(ep(n)?n.validators:n)||null}function kz(n){return Array.isArray(n)?DN(n):n||null}function eS(n,e){return(ep(e)?e.asyncValidators:n)||null}function Nz(n){return Array.isArray(n)?kN(n):n||null}function ep(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function MN(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new lh(1e3,"");if(!r[t])throw new lh(1001,"")}function FN(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new lh(1002,"")})}var Na=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Cu}get invalid(){return this.status===$f}get pending(){return this.status==Da}get disabled(){return this.status===wu}get enabled(){return this.status!==wu}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(cN(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(cN(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(uN(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(uN(e,this._rawAsyncValidators))}hasValidator(e){return Hf(this._rawValidators,e)}hasAsyncValidator(e){return Hf(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Da,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=wu,this.errors=null,this._forEachChild(r=>{r.disable(Cn(qt({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Cn(qt({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Cu,this._forEachChild(r=>{r.enable(Cn(qt({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Cn(qt({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Cu||this.status===Da)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?wu:Cu}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Da,this._hasOwnPendingAsyncValidator=!0;let t=wN(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new gc,this.statusChanges=new gc}_calculateStatus(){return this._allControlsDisabled()?wu:this.errors?$f:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Da)?Da:this._anyControlsHaveStatus($f)?$f:Cu}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ep(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=kz(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=Nz(this._rawAsyncValidators)}},Yf=class extends Na{constructor(e,t,r){super(ZE(t),eS(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){FN(this,!0,e),Object.keys(e).forEach(r=>{MN(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var XE=class extends Yf{};var LN=new ve("CallSetDisabledState",{providedIn:"root",factory:()=>tS}),tS="always";function Oz(n,e){return[...e.path,n]}function dN(n,e,t=tS){nS(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),Pz(n,e),Fz(n,e),Mz(n,e),xz(n,e)}function hN(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),Jf(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Xf(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function xz(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function nS(n,e){let t=NN(n);e.validator!==null?n.setValidators(lN(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=ON(n);e.asyncValidator!==null?n.setAsyncValidators(lN(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();Xf(e._rawValidators,i),Xf(e._rawAsyncValidators,i)}function Jf(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=NN(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=ON(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return Xf(e._rawValidators,r),Xf(e._rawAsyncValidators,r),t}function Pz(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&BN(n,e)})}function Mz(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&BN(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function BN(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Fz(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function Lz(n,e){n==null,nS(n,e)}function Bz(n,e){return Jf(n,e)}function Vz(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function Uz(n){return Object.getPrototypeOf(n.constructor)===mz}function qz(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function zz(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===Zf?t=s:Uz(s)?r=s:i=s}),i||r||t||null}function Gz(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function fN(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function pN(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Ui=class extends Na{constructor(e=null,t,r){super(ZE(t),eS(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ep(t)&&(t.nonNullable||t.initialValueIsDefault)&&(pN(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){fN(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){fN(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){pN(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Wz=n=>n instanceof Ui;var VN=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=Xr({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return n})();var UN=new ve("");var jz={provide:ka,useExisting:ch(()=>rS)},rS=(()=>{class n extends ka{constructor(t,r,i){super(),this.callSetDisabledState=i,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new gc,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Jf(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){let r=this.form.get(t.path);return dN(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){hN(t.control||null,t,!1),Gz(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this.submitted=!0,qz(this.form,this.directives),this.ngSubmit.emit(t),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{let r=t.control,i=this.form.get(t.path);r!==i&&(hN(r||null,t),Wz(i)&&(dN(i,t,this.callSetDisabledState),t.control=i))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){let r=this.form.get(t.path);Lz(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){let r=this.form.get(t.path);r&&Bz(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){nS(this.form,this),this._oldForm&&Jf(this._oldForm,this)}_checkFormPresent(){this.form}static{this.\u0275fac=function(r){return new(r||n)(Ye(vN,10),Ye(EN,10),Ye(LN,8))}}static{this.\u0275dir=Xr({type:n,selectors:[["","formGroup",""]],hostBindings:function(r,i){r&1&&zs("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{form:[mc.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[hh([jz]),qs,Py]})}}return n})();var $z={provide:bu,useExisting:ch(()=>iS)},iS=(()=>{class n extends bu{set isDisabled(t){}static{this._ngModelWarningSentOnce=!1}constructor(t,r,i,s,o){super(),this._ngModelWarningConfig=o,this._added=!1,this.name=null,this.update=new gc,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=zz(this,s)}ngOnChanges(t){this._added||this._setUpControl(),Vz(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return Oz(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(r){return new(r||n)(Ye(ka,13),Ye(vN,10),Ye(EN,10),Ye(yN,10),Ye(UN,8))}}static{this.\u0275dir=Xr({type:n,selectors:[["","formControlName",""]],inputs:{name:[mc.None,"formControlName","name"],isDisabled:[mc.None,"disabled","isDisabled"],model:[mc.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[hh([$z]),qs,Py]})}}return n})();var Hz=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Gn({type:n})}static{this.\u0275inj=zn({})}}return n})(),JE=class extends Na{constructor(e,t,r){super(ZE(t),eS(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){FN(this,!1,e),e.forEach((r,i)=>{MN(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function mN(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var qN=(()=>{class n{constructor(){this.useNonNullable=!1}get nonNullable(){let t=new n;return t.useNonNullable=!0,t}group(t,r=null){let i=this._reduceControls(t),s={};return mN(r)?s=r:r!==null&&(s.validators=r.validator,s.asyncValidators=r.asyncValidator),new Yf(i,s)}record(t,r=null){let i=this._reduceControls(t);return new XE(i,r)}control(t,r,i){let s={};return this.useNonNullable?(mN(r)?s=r:(s.validators=r,s.asyncValidators=i),new Ui(t,Cn(qt({},s),{nonNullable:!0}))):new Ui(t,r,i)}array(t,r,i){let s=t.map(o=>this._createControl(o));return new JE(s,r,i)}_reduceControls(t){let r={};return Object.keys(t).forEach(i=>{r[i]=this._createControl(t[i])}),r}_createControl(t){if(t instanceof Ui)return t;if(t instanceof Na)return t;if(Array.isArray(t)){let r=t[0],i=t.length>1?t[1]:null,s=t.length>2?t[2]:null;return this.control(r,i,s)}else return this.control(t)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var zN=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:UN,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:LN,useValue:t.callSetDisabledState??tS}]}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Gn({type:n})}static{this.\u0275inj=zn({imports:[Hz]})}}return n})();function Qz(n,e){n&1&&(z(0,"div",4),ne(1,"Id is required"),K())}function Yz(n,e){n&1&&(z(0,"div",4),ne(1,"name is required"),K())}function Xz(n,e){n&1&&(z(0,"div",4),ne(1,"description is required"),K())}var GN=(()=>{class n{constructor(t,r){this.fb=t,this.productService=r,this.makeupForm=this.fb.group({id:new Ui("",[Ra.required]),name:new Ui("",[Ra.required]),description:new Ui("",[Ra.required])})}ngOnInit(){}onSubmit(){this.makeupForm.valid?this.productService.addProduct(this.makeupForm.value):this.makeupForm.markAllAsTouched()}static{this.\u0275fac=function(r){return new(r||n)(Ye(qN),Ye(jf))}}static{this.\u0275cmp=fr({type:n,selectors:[["app-addmakeup"]],standalone:!0,features:[mr],decls:18,vars:4,consts:[[1,"ms-4",3,"submit","formGroup"],[1,"mb-3","mt-4"],["for","id",1,"form-label"],["type","text","formControlName","id","id","id",1,"form-control"],[1,"form-text","text-danger"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","formControlName","name","id","name",1,"form-control"],["for","description",1,"form-label"],["formControlName","description","id","description","rows","3",1,"form-control"],["type","submit",1,"btn","btn-primary"]],template:function(r,i){if(r&1&&(z(0,"form",0),zs("submit",function(){return i.onSubmit()}),z(1,"div",1)(2,"label",2),ne(3,"Product Id"),K(),me(4,"input",3),uh(5,Qz,2,0,"div",4),K(),z(6,"div",5)(7,"label",6),ne(8,"Product Name"),K(),me(9,"input",7),uh(10,Yz,2,0,"div",4),K(),z(11,"div",5)(12,"label",8),ne(13,"Description"),K(),me(14,"textarea",9),uh(15,Xz,2,0,"div",4),K(),z(16,"button",10),ne(17,"SAVE"),K()()),r&2){let s,o,a;PA("formGroup",i.makeupForm),wi(5),dh(5,(s=i.makeupForm.get("id"))!=null&&s.hasError("required")&&((s=i.makeupForm.get("id"))!=null&&s.touched)?5:-1),wi(5),dh(10,(o=i.makeupForm.get("name"))!=null&&o.hasError("required")&&((o=i.makeupForm.get("name"))!=null&&o.touched)?10:-1),wi(5),dh(15,(a=i.makeupForm.get("description"))!=null&&a.hasError("required")&&((a=i.makeupForm.get("description"))!=null&&a.touched)?15:-1)}},dependencies:[ph,zN,VN,Zf,xN,PN,rS,iS]})}}return n})();var WN=[{path:"",component:Hy},{path:"home",component:Hy},{path:"makeupproducts",component:aN,children:[{path:"addmakeup",component:GN}]}];var Zie=ih(mV(),1);var jN="auth",Tu=class{constructor(e){return e}},ho=class{constructor(){return $s(jN)}};var sS=new ve("angularfire2.auth-instances");function X6(n,e){let t=sa(jN,n,e);return t&&new Tu(t)}function J6(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Tu(r)}}var Z6={provide:ho,deps:[[new mt,sS]]},eG={provide:Tu,useFactory:X6,deps:[[new mt,sS],jn]};function $N(n,...e){return tt("angularfire",Ct.full,"auth"),Ci([eG,Z6,{provide:sS,useFactory:J6(n),multi:!0,deps:[Et,Jr,tn,Zr,[new mt,zt],...e]}])}var HN=Ii($y,!0);import{inspect as d8,TextEncoder as h8,TextDecoder as f8}from"util";import{randomBytes as p8}from"crypto";var EF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},SF={};var ms,bb;(function(){var n;function e(S,y){function _(){}_.prototype=y.prototype,S.D=y.prototype,S.prototype=new _,S.prototype.constructor=S,S.C=function(v,m,C){for(var f=Array(arguments.length-2),g=2;g<arguments.length;g++)f[g-2]=arguments[g];return y.prototype[m].apply(v,f)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(S,y,_){_||(_=0);var v=Array(16);if(typeof y=="string")for(var m=0;16>m;++m)v[m]=y.charCodeAt(_++)|y.charCodeAt(_++)<<8|y.charCodeAt(_++)<<16|y.charCodeAt(_++)<<24;else for(m=0;16>m;++m)v[m]=y[_++]|y[_++]<<8|y[_++]<<16|y[_++]<<24;y=S.g[0],_=S.g[1],m=S.g[2];var C=S.g[3],f=y+(C^_&(m^C))+v[0]+3614090360&4294967295;y=_+(f<<7&4294967295|f>>>25),f=C+(m^y&(_^m))+v[1]+3905402710&4294967295,C=y+(f<<12&4294967295|f>>>20),f=m+(_^C&(y^_))+v[2]+606105819&4294967295,m=C+(f<<17&4294967295|f>>>15),f=_+(y^m&(C^y))+v[3]+3250441966&4294967295,_=m+(f<<22&4294967295|f>>>10),f=y+(C^_&(m^C))+v[4]+4118548399&4294967295,y=_+(f<<7&4294967295|f>>>25),f=C+(m^y&(_^m))+v[5]+1200080426&4294967295,C=y+(f<<12&4294967295|f>>>20),f=m+(_^C&(y^_))+v[6]+2821735955&4294967295,m=C+(f<<17&4294967295|f>>>15),f=_+(y^m&(C^y))+v[7]+4249261313&4294967295,_=m+(f<<22&4294967295|f>>>10),f=y+(C^_&(m^C))+v[8]+1770035416&4294967295,y=_+(f<<7&4294967295|f>>>25),f=C+(m^y&(_^m))+v[9]+2336552879&4294967295,C=y+(f<<12&4294967295|f>>>20),f=m+(_^C&(y^_))+v[10]+4294925233&4294967295,m=C+(f<<17&4294967295|f>>>15),f=_+(y^m&(C^y))+v[11]+2304563134&4294967295,_=m+(f<<22&4294967295|f>>>10),f=y+(C^_&(m^C))+v[12]+1804603682&4294967295,y=_+(f<<7&4294967295|f>>>25),f=C+(m^y&(_^m))+v[13]+4254626195&4294967295,C=y+(f<<12&4294967295|f>>>20),f=m+(_^C&(y^_))+v[14]+2792965006&4294967295,m=C+(f<<17&4294967295|f>>>15),f=_+(y^m&(C^y))+v[15]+1236535329&4294967295,_=m+(f<<22&4294967295|f>>>10),f=y+(m^C&(_^m))+v[1]+4129170786&4294967295,y=_+(f<<5&4294967295|f>>>27),f=C+(_^m&(y^_))+v[6]+3225465664&4294967295,C=y+(f<<9&4294967295|f>>>23),f=m+(y^_&(C^y))+v[11]+643717713&4294967295,m=C+(f<<14&4294967295|f>>>18),f=_+(C^y&(m^C))+v[0]+3921069994&4294967295,_=m+(f<<20&4294967295|f>>>12),f=y+(m^C&(_^m))+v[5]+3593408605&4294967295,y=_+(f<<5&4294967295|f>>>27),f=C+(_^m&(y^_))+v[10]+38016083&4294967295,C=y+(f<<9&4294967295|f>>>23),f=m+(y^_&(C^y))+v[15]+3634488961&4294967295,m=C+(f<<14&4294967295|f>>>18),f=_+(C^y&(m^C))+v[4]+3889429448&4294967295,_=m+(f<<20&4294967295|f>>>12),f=y+(m^C&(_^m))+v[9]+568446438&4294967295,y=_+(f<<5&4294967295|f>>>27),f=C+(_^m&(y^_))+v[14]+3275163606&4294967295,C=y+(f<<9&4294967295|f>>>23),f=m+(y^_&(C^y))+v[3]+4107603335&4294967295,m=C+(f<<14&4294967295|f>>>18),f=_+(C^y&(m^C))+v[8]+1163531501&4294967295,_=m+(f<<20&4294967295|f>>>12),f=y+(m^C&(_^m))+v[13]+2850285829&4294967295,y=_+(f<<5&4294967295|f>>>27),f=C+(_^m&(y^_))+v[2]+4243563512&4294967295,C=y+(f<<9&4294967295|f>>>23),f=m+(y^_&(C^y))+v[7]+1735328473&4294967295,m=C+(f<<14&4294967295|f>>>18),f=_+(C^y&(m^C))+v[12]+2368359562&4294967295,_=m+(f<<20&4294967295|f>>>12),f=y+(_^m^C)+v[5]+4294588738&4294967295,y=_+(f<<4&4294967295|f>>>28),f=C+(y^_^m)+v[8]+2272392833&4294967295,C=y+(f<<11&4294967295|f>>>21),f=m+(C^y^_)+v[11]+1839030562&4294967295,m=C+(f<<16&4294967295|f>>>16),f=_+(m^C^y)+v[14]+4259657740&4294967295,_=m+(f<<23&4294967295|f>>>9),f=y+(_^m^C)+v[1]+2763975236&4294967295,y=_+(f<<4&4294967295|f>>>28),f=C+(y^_^m)+v[4]+1272893353&4294967295,C=y+(f<<11&4294967295|f>>>21),f=m+(C^y^_)+v[7]+4139469664&4294967295,m=C+(f<<16&4294967295|f>>>16),f=_+(m^C^y)+v[10]+3200236656&4294967295,_=m+(f<<23&4294967295|f>>>9),f=y+(_^m^C)+v[13]+681279174&4294967295,y=_+(f<<4&4294967295|f>>>28),f=C+(y^_^m)+v[0]+3936430074&4294967295,C=y+(f<<11&4294967295|f>>>21),f=m+(C^y^_)+v[3]+3572445317&4294967295,m=C+(f<<16&4294967295|f>>>16),f=_+(m^C^y)+v[6]+76029189&4294967295,_=m+(f<<23&4294967295|f>>>9),f=y+(_^m^C)+v[9]+3654602809&4294967295,y=_+(f<<4&4294967295|f>>>28),f=C+(y^_^m)+v[12]+3873151461&4294967295,C=y+(f<<11&4294967295|f>>>21),f=m+(C^y^_)+v[15]+530742520&4294967295,m=C+(f<<16&4294967295|f>>>16),f=_+(m^C^y)+v[2]+3299628645&4294967295,_=m+(f<<23&4294967295|f>>>9),f=y+(m^(_|~C))+v[0]+4096336452&4294967295,y=_+(f<<6&4294967295|f>>>26),f=C+(_^(y|~m))+v[7]+1126891415&4294967295,C=y+(f<<10&4294967295|f>>>22),f=m+(y^(C|~_))+v[14]+2878612391&4294967295,m=C+(f<<15&4294967295|f>>>17),f=_+(C^(m|~y))+v[5]+4237533241&4294967295,_=m+(f<<21&4294967295|f>>>11),f=y+(m^(_|~C))+v[12]+1700485571&4294967295,y=_+(f<<6&4294967295|f>>>26),f=C+(_^(y|~m))+v[3]+2399980690&4294967295,C=y+(f<<10&4294967295|f>>>22),f=m+(y^(C|~_))+v[10]+4293915773&4294967295,m=C+(f<<15&4294967295|f>>>17),f=_+(C^(m|~y))+v[1]+2240044497&4294967295,_=m+(f<<21&4294967295|f>>>11),f=y+(m^(_|~C))+v[8]+1873313359&4294967295,y=_+(f<<6&4294967295|f>>>26),f=C+(_^(y|~m))+v[15]+4264355552&4294967295,C=y+(f<<10&4294967295|f>>>22),f=m+(y^(C|~_))+v[6]+2734768916&4294967295,m=C+(f<<15&4294967295|f>>>17),f=_+(C^(m|~y))+v[13]+1309151649&4294967295,_=m+(f<<21&4294967295|f>>>11),f=y+(m^(_|~C))+v[4]+4149444226&4294967295,y=_+(f<<6&4294967295|f>>>26),f=C+(_^(y|~m))+v[11]+3174756917&4294967295,C=y+(f<<10&4294967295|f>>>22),f=m+(y^(C|~_))+v[2]+718787259&4294967295,m=C+(f<<15&4294967295|f>>>17),f=_+(C^(m|~y))+v[9]+3951481745&4294967295,S.g[0]=S.g[0]+y&4294967295,S.g[1]=S.g[1]+(m+(f<<21&4294967295|f>>>11))&4294967295,S.g[2]=S.g[2]+m&4294967295,S.g[3]=S.g[3]+C&4294967295}r.prototype.u=function(S,y){y===void 0&&(y=S.length);for(var _=y-this.blockSize,v=this.B,m=this.h,C=0;C<y;){if(m==0)for(;C<=_;)i(this,S,C),C+=this.blockSize;if(typeof S=="string"){for(;C<y;)if(v[m++]=S.charCodeAt(C++),m==this.blockSize){i(this,v),m=0;break}}else for(;C<y;)if(v[m++]=S[C++],m==this.blockSize){i(this,v),m=0;break}}this.h=m,this.o+=y},r.prototype.v=function(){var S=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);S[0]=128;for(var y=1;y<S.length-8;++y)S[y]=0;var _=8*this.o;for(y=S.length-8;y<S.length;++y)S[y]=_&255,_/=256;for(this.u(S),S=Array(16),y=_=0;4>y;++y)for(var v=0;32>v;v+=8)S[_++]=this.g[y]>>>v&255;return S};function s(S,y){var _=a;return Object.prototype.hasOwnProperty.call(_,S)?_[S]:_[S]=y(S)}function o(S,y){this.h=y;for(var _=[],v=!0,m=S.length-1;0<=m;m--){var C=S[m]|0;v&&C==y||(_[m]=C,v=!1)}this.g=_}var a={};function l(S){return-128<=S&&128>S?s(S,function(y){return new o([y|0],0>y?-1:0)}):new o([S|0],0>S?-1:0)}function c(S){if(isNaN(S)||!isFinite(S))return d;if(0>S)return T(c(-S));for(var y=[],_=1,v=0;S>=_;v++)y[v]=S/_|0,_*=4294967296;return new o(y,0)}function u(S,y){if(S.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(S.charAt(0)=="-")return T(u(S.substring(1),y));if(0<=S.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=c(Math.pow(y,8)),v=d,m=0;m<S.length;m+=8){var C=Math.min(8,S.length-m),f=parseInt(S.substring(m,m+C),y);8>C?(C=c(Math.pow(y,C)),v=v.j(C).add(c(f))):(v=v.j(_),v=v.add(c(f)))}return v}var d=l(0),h=l(1),p=l(16777216);n=o.prototype,n.m=function(){if(w(this))return-T(this).m();for(var S=0,y=1,_=0;_<this.g.length;_++){var v=this.i(_);S+=(0<=v?v:4294967296+v)*y,y*=4294967296}return S},n.toString=function(S){if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(E(this))return"0";if(w(this))return"-"+T(this).toString(S);for(var y=c(Math.pow(S,6)),_=this,v="";;){var m=F(_,y).g;_=k(_,m.j(y));var C=((0<_.g.length?_.g[0]:_.h)>>>0).toString(S);if(_=m,E(_))return C+v;for(;6>C.length;)C="0"+C;v=C+v}},n.i=function(S){return 0>S?0:S<this.g.length?this.g[S]:this.h};function E(S){if(S.h!=0)return!1;for(var y=0;y<S.g.length;y++)if(S.g[y]!=0)return!1;return!0}function w(S){return S.h==-1}n.l=function(S){return S=k(this,S),w(S)?-1:E(S)?0:1};function T(S){for(var y=S.g.length,_=[],v=0;v<y;v++)_[v]=~S.g[v];return new o(_,~S.h).add(h)}n.abs=function(){return w(this)?T(this):this},n.add=function(S){for(var y=Math.max(this.g.length,S.g.length),_=[],v=0,m=0;m<=y;m++){var C=v+(this.i(m)&65535)+(S.i(m)&65535),f=(C>>>16)+(this.i(m)>>>16)+(S.i(m)>>>16);v=f>>>16,C&=65535,f&=65535,_[m]=f<<16|C}return new o(_,_[_.length-1]&-2147483648?-1:0)};function k(S,y){return S.add(T(y))}n.j=function(S){if(E(this)||E(S))return d;if(w(this))return w(S)?T(this).j(T(S)):T(T(this).j(S));if(w(S))return T(this.j(T(S)));if(0>this.l(p)&&0>S.l(p))return c(this.m()*S.m());for(var y=this.g.length+S.g.length,_=[],v=0;v<2*y;v++)_[v]=0;for(v=0;v<this.g.length;v++)for(var m=0;m<S.g.length;m++){var C=this.i(v)>>>16,f=this.i(v)&65535,g=S.i(m)>>>16,q=S.i(m)&65535;_[2*v+2*m]+=f*q,R(_,2*v+2*m),_[2*v+2*m+1]+=C*q,R(_,2*v+2*m+1),_[2*v+2*m+1]+=f*g,R(_,2*v+2*m+1),_[2*v+2*m+2]+=C*g,R(_,2*v+2*m+2)}for(v=0;v<y;v++)_[v]=_[2*v+1]<<16|_[2*v];for(v=y;v<2*y;v++)_[v]=0;return new o(_,0)};function R(S,y){for(;(S[y]&65535)!=S[y];)S[y+1]+=S[y]>>>16,S[y]&=65535,y++}function O(S,y){this.g=S,this.h=y}function F(S,y){if(E(y))throw Error("division by zero");if(E(S))return new O(d,d);if(w(S))return y=F(T(S),y),new O(T(y.g),T(y.h));if(w(y))return y=F(S,T(y)),new O(T(y.g),y.h);if(30<S.g.length){if(w(S)||w(y))throw Error("slowDivide_ only works with positive integers.");for(var _=h,v=y;0>=v.l(S);)_=W(_),v=W(v);var m=ee(_,1),C=ee(v,1);for(v=ee(v,2),_=ee(_,2);!E(v);){var f=C.add(v);0>=f.l(S)&&(m=m.add(_),C=f),v=ee(v,1),_=ee(_,1)}return y=k(S,m.j(y)),new O(m,y)}for(m=d;0<=S.l(y);){for(_=Math.max(1,Math.floor(S.m()/y.m())),v=Math.ceil(Math.log(_)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),C=c(_),f=C.j(y);w(f)||0<f.l(S);)_-=v,C=c(_),f=C.j(y);E(C)&&(C=h),m=m.add(C),S=k(S,f)}return new O(m,S)}n.A=function(S){return F(this,S).h},n.and=function(S){for(var y=Math.max(this.g.length,S.g.length),_=[],v=0;v<y;v++)_[v]=this.i(v)&S.i(v);return new o(_,this.h&S.h)},n.or=function(S){for(var y=Math.max(this.g.length,S.g.length),_=[],v=0;v<y;v++)_[v]=this.i(v)|S.i(v);return new o(_,this.h|S.h)},n.xor=function(S){for(var y=Math.max(this.g.length,S.g.length),_=[],v=0;v<y;v++)_[v]=this.i(v)^S.i(v);return new o(_,this.h^S.h)};function W(S){for(var y=S.g.length+1,_=[],v=0;v<y;v++)_[v]=S.i(v)<<1|S.i(v-1)>>>31;return new o(_,S.h)}function ee(S,y){var _=y>>5;y%=32;for(var v=S.g.length-_,m=[],C=0;C<v;C++)m[C]=0<y?S.i(C+_)>>>y|S.i(C+_+1)<<32-y:S.i(C+_);return new o(m,S.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,bb=SF.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,ms=SF.Integer=o}).apply(typeof EF<"u"?EF:typeof self<"u"?self:typeof window<"u"?window:{});var Oo=ih(vF(),1),OL=ih(ew(),1);var CF="@firebase/firestore",wF="4.7.3";var pt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};pt.UNAUTHENTICATED=new pt(null);pt.GOOGLE_CREDENTIALS=new pt("google-credentials-uid");pt.FIRST_PARTY=new pt("first-party-uid");pt.MOCK_USER=new pt("mock-user");var m8="10.14.0";var Jl=m8;function g8(n){Jl=n}function y8(n){return d8(n,{depth:100})}var ws=new Ti("@firebase/firestore");function Tl(){return ws.logLevel}function L0(n){ws.setLogLevel(n)}function M(n,...e){if(ws.logLevel<=Tn.DEBUG){let t=e.map(B0);ws.debug(`Firestore (${Jl}): ${n}`,...t)}}function $e(n,...e){if(ws.logLevel<=Tn.ERROR){let t=e.map(B0);ws.error(`Firestore (${Jl}): ${n}`,...t)}}function ir(n,...e){if(ws.logLevel<=Tn.WARN){let t=e.map(B0);ws.warn(`Firestore (${Jl}): ${n}`,...t)}}function B0(n){if(typeof n=="string")return n;try{return y8(n)}catch{return n}}function G(n="Unexpected state"){let e=`FIRESTORE (${Jl}) INTERNAL ASSERTION FAILED: `+n;throw $e(e),new Error(e)}function $(n,e){n||G()}function xL(n,e){n||G()}function U(n,e){return n}var D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},N=class extends JA{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ht=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var ig=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Fb=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(pt.UNAUTHENTICATED))}shutdown(){}},Lb=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Bb=class{constructor(e){this.authProvider=e,this.currentUser=pt.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){$(this.tokenListener===void 0);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new ht;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new ht,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>b(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),o())};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ht)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?($(typeof r.accessToken=="string"),new ig(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return $(e===null||typeof e=="string"),new pt(e)}},Vb=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=pt.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Ub=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new Vb(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(pt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},qb=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},zb=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){$(this.tokenListener===void 0);let r=s=>{s.error!=null&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,M("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?($(typeof t.token=="string"),this.latestAppCheckToken=t.token,new qb(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function _8(n){if(!n)return new Fb;switch(n.type){case"firstParty":return new Ub(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new N(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function v8(n){return p8(n)}var sg=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=v8(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function se(n,e){return n<e?-1:n>e?1:0}function xo(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function PL(n){return n+"\0"}var bF=-62135596800,TF=1e6,He=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new N(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new N(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<bF)throw new N(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new N(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*TF);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/TF}_compareTo(e){return this.seconds===e.seconds?se(this.nanoseconds,e.nanoseconds):se(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-bF,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var X=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new He(0,0))}static max(){return new n(new He(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var IF="__name__",og=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&G(),r===void 0?r=e.length-t:r>e.length-t&&G(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ye=class n extends og{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new N(D.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},E8=/^[_a-zA-Z][_a-zA-Z0-9]*$/,st=class n extends og{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return E8.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===IF}static keyField(){return new n([IF])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new N(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new N(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new N(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new N(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var V=class n{constructor(e){this.path=e}static fromPath(e){return new n(ye.fromString(e))}static fromName(e){return new n(ye.fromString(e).popFirst(5))}static empty(){return new n(ye.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ye.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ye.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new ye(e.slice()))}};var Pl=-1,S8=0,Gb=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function V0(n){return n.fields.find(e=>e.kind===2)}function Po(n){return n.fields.filter(e=>e.kind!==2)}function C8(n){let e=Po(n);return e.length===0?0:e[e.length-1].kind}function w8(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var Nl=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var vd=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(S8,Un.min())}};function ML(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=X.fromTimestamp(r===1e9?new He(t+1,0):new He(t,r));return new Un(i,V.empty(),e)}function FL(n){return new Un(n.readTime,n.key,Pl)}var Un=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(X.min(),V.empty(),Pl)}static max(){return new n(X.max(),V.empty(),Pl)}};function U0(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=V.comparator(n.documentKey,e.documentKey),t!==0)?t:se(n.largestBatchId,e.largestBatchId)}var LL="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ag=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Ps(n){return b(this,null,function*(){if(n.code===D.FAILED_PRECONDITION&&n.message===LL)M("LocalStore","Unexpectedly lost primary lease");else throw n})}var I=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&G(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var vn="SimpleDb",b8=3,lg=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new ht,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new No(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=q0(r.target.error);this.completionDeferred.reject(new No(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new No(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(M(vn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new jb(t)}},bs=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(yc())===12.2&&$e("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return M(vn,"Removing database:",e),bo(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!Sh())return!1;if(n.isMockPersistence())return!0;let e=yc(),t=n.getIOSVersion(e),r=0<t&&t<10,i=BL(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return b(this,null,function*(){return this.db||(M(vn,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new No(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new N(D.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new N(D.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new No(e,o))},i.onupgradeneeded=s=>{M(vn,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{M(vn,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return b(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=lg.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),I.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<b8;if(M(vn,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function BL(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Wb=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return bo(this.dbCursor.delete())}},No=class extends N{constructor(e,t){super(D.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Ms(n){return n.name==="IndexedDbTransactionError"}var jb=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(M(vn,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(M(vn,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),bo(r)}add(e){M(vn,"ADD",this.store.name,e,e);let t=this.store.add(e);return bo(t)}get(e){let t=this.store.get(e);return bo(t).next(r=>(r===void 0&&(r=null),M(vn,"GET",this.store.name,e,r),r))}delete(e){M(vn,"DELETE",this.store.name,e);let t=this.store.delete(e);return bo(t)}count(){M(vn,"COUNT",this.store.name);let e=this.store.count();return bo(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new I((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new I((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){M(vn,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new I((r,i)=>{t.onerror=s=>{let o=q0(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new I((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new Wb(a),c=t(a.primaryKey,a.value,l);if(c instanceof I){let u=c.catch(d=>(l.done(),I.reject(d)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>I.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function bo(n){return new I((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=q0(r.target.error);t(i)}})}var AF=!1;function q0(n){let e=bs.getIOSVersion(yc());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return AF||(AF=!0,setTimeout(()=>{throw r},0)),r}}return n}var fd="IndexBackfiller",T8=15*1e3,I8=60*1e3,A8=50,$b=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(T8)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){M(fd,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>b(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();M(fd,`Documents written: ${t}`)}catch(t){Ms(t)?M(fd,"Ignoring IndexedDB error during index backfill: ",t):yield Ps(t)}yield this.schedule(I8)}))}},Hb=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return b(this,arguments,function*(e=A8){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return I.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return M(fd,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(M(fd,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=FL(s);U0(o,r)>0&&(r=o)}),new Un(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var En=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Ol="",Kb="",VL="",UL="";function Xt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=DF(e)),e=D8(n.get(t),e);return DF(e)}function D8(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=Ol+VL;break;case Ol:t+=Ol+UL;break;default:t+=s}}return t}function DF(n){return n+Ol+Kb}function qr(n){let e=n.length;if($(e>=2),e===2)return $(n.charAt(0)===Ol&&n.charAt(1)===Kb),ye.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(Ol,s);switch((o<0||o>t)&&G(),n.charAt(o+1)){case Kb:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case VL:i+=n.substring(s,o),i+="\0";break;case UL:i+=n.substring(s,o+1);break;default:G()}s=o+2}return new ye(r)}var To="remoteDocuments";var Gd="owner",_l="owner",Wd="mutationQueues",R8="userId",rr="mutations",qL="batchId",Ro="userMutationsIndex",zL=["userId","batchId"];function k8(n){return[n]}function Zm(n,e){return[n,Xt(e)]}function GL(n,e,t){return[n,Xt(e),t]}var N8={},Zl="documentMutations",Xg="remoteDocumentsV14",O8=["prefixPath","collectionGroup","readTime","documentId"],eg="documentKeyIndex",x8=["prefixPath","collectionGroup","documentId"],WL="collectionGroupIndex",P8=["collectionGroup","readTime","prefixPath","documentId"],jd="remoteDocumentGlobal",Qb="remoteDocumentGlobalKey",ec="targets",M8="targetId",jL="queryTargetsIndex",F8=["canonicalId","targetId"],tc="targetDocuments",L8=["targetId","path"],z0="documentTargetsIndex",B8=["path","targetId"],cg="targetGlobalKey",Ho="targetGlobal",Ed="collectionParents",V8=["collectionId","parent"],Ml="clientMetadata",U8="clientId",Jg="bundles",q8="bundleId",Zg="namedQueries",z8="name",G0="indexConfiguration",G8="indexId",Yb="collectionGroupIndex",W8="collectionGroup",ey="indexState",j8=["indexId","uid"],$L="sequenceNumberIndex",$8=["uid","sequenceNumber"],ty="indexEntries",H8=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],HL="documentKeyIndex",K8=["indexId","uid","orderedDocumentKey"],ny="documentOverlays",Q8=["userId","collectionPath","documentId"],Xb="collectionPathOverlayIndex",Y8=["userId","collectionPath","largestBatchId"],KL="collectionGroupOverlayIndex",X8=["userId","collectionGroup","largestBatchId"],W0="globals",J8="name",Z8=[Wd,rr,Zl,To,ec,Gd,Ho,tc],e7=Z8,t7=[...e7,Ml],n7=[...t7,jd],r7=[...n7,Ed],QL=[...r7,Jg,Zg],i7=[...QL,ny],YL=[Wd,rr,Zl,Xg,ec,Gd,Ho,tc,Ml,jd,Ed,Jg,Zg,ny],XL=YL,j0=[...XL,G0,ey,ty],s7=j0,o7=[...j0,W0];function a7(n){if(n===17)return o7;if(n===16)return s7;if(n===15)return j0;if(n===14)return XL;if(n===13)return YL;if(n===12)return i7;if(n===11)return QL;G()}var Sd=class extends ag{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function vt(n,e){let t=U(n);return bs.getStore(t.simpleDbTransaction,e)}function RF(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ko(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function JL(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Le=class n{constructor(e,t){this.comparator=e,this.root=t||pd.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,pd.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,pd.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Rl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Rl(this.root,e,this.comparator,!1)}getReverseIterator(){return new Rl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Rl(this.root,e,this.comparator,!0)}},Rl=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},pd=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw G();let t=this.left.check();if(t!==this.right.check())throw G();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),Jb=class{constructor(){this.size=0}get key(){throw G()}get value(){throw G()}get color(){throw G()}get left(){throw G()}get right(){throw G()}copy(e,t,r,i,s){return this}insert(e,t,r){return new pd(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};pd.EMPTY=new Jb;var ke=class n{constructor(e){this.comparator=e,this.data=new Le(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ug(this.data.getIterator())}getIteratorFrom(e){return new ug(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},ug=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function l7(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=vl(s),l=vl(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=vl(o)):u?(i(a),a=vl(s)):(a=vl(s),l=vl(o))}}function vl(n){return n.hasNext()?n.getNext():void 0}var Sn=class n{constructor(e){this.fields=e,e.sort(st.comparator)}static empty(){return new n([])}unionWith(e){let t=new ke(st.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return xo(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function c7(n){return Buffer.from(n,"base64").toString("binary")}function u7(n){return Buffer.from(n,"binary").toString("base64")}function ZL(){return!0}var ot=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=c7(e);return new n(t)}static fromUint8Array(e){let t=d7(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return u7(this.binaryString)}toUint8Array(){return h7(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return se(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ot.EMPTY_BYTE_STRING=new ot("");function d7(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function h7(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var f7=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fi(n){if($(!!n),typeof n=="string"){let e=0,t=f7.exec(n);if($(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Ge(n.seconds),t=Ge(n.nanos);return{seconds:e,nanos:t}}}function Ge(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ts(n){return typeof n=="string"?ot.fromBase64String(n):ot.fromUint8Array(n)}var e2="server_timestamp",t2="__type__",n2="__previous_value__",r2="__local_write_time__";function ry(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[t2])===null||t===void 0?void 0:t.stringValue)===e2}function p7(n,e){let t={fields:{[t2]:{stringValue:e2},[r2]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&ry(e)&&(e=$0(e)),e&&(t.fields[n2]=e),{mapValue:t}}function $0(n){let e=n.mapValue.fields[n2];return ry(e)?$0(e):e}function Cd(n){let e=fi(n.mapValue.fields[r2].timestampValue);return new He(e.seconds,e.nanos)}var Zb=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},eT="(default)",Is=class n{constructor(e,t){this.projectId=e,this.database=t||eT}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===eT}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function m7(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new N(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Is(n.options.projectId,e)}var Cs=-1;function $d(n){return n==null}function wd(n){return n===0&&1/n===-1/0}function i2(n){return typeof n=="number"&&Number.isInteger(n)&&!wd(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var H0="__type__",s2="__max__",Es={mapValue:{fields:{__type__:{stringValue:s2}}}},K0="__vector__",Fl="value",tg={nullValue:"NULL_VALUE"};function Mo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ry(n)?4:a2(n)?9007199254740991:iy(n)?10:11:G()}function sr(n,e){if(n===e)return!0;let t=Mo(n),r=Mo(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Cd(n).isEqual(Cd(e));case 3:return g7(n,e);case 5:return n.stringValue===e.stringValue;case 6:return _7(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return y7(n,e);case 2:return v7(n,e);case 9:return xo(n.arrayValue.values||[],e.arrayValue.values||[],sr);case 10:case 11:return E7(n,e);case 9007199254740991:return!0;default:return G()}}function g7(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=fi(n.timestampValue),r=fi(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function y7(n,e){return Ge(n.geoPointValue.latitude)===Ge(e.geoPointValue.latitude)&&Ge(n.geoPointValue.longitude)===Ge(e.geoPointValue.longitude)}function _7(n,e){return Ts(n.bytesValue).isEqual(Ts(e.bytesValue))}function v7(n,e){if("integerValue"in n&&"integerValue"in e)return Ge(n.integerValue)===Ge(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Ge(n.doubleValue),r=Ge(e.doubleValue);return t===r?wd(t)===wd(r):isNaN(t)&&isNaN(r)}return!1}function E7(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(RF(t)!==RF(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!sr(t[i],r[i])))return!1;return!0}function bd(n,e){return(n.values||[]).find(t=>sr(t,e))!==void 0}function As(n,e){if(n===e)return 0;let t=Mo(n),r=Mo(e);if(t!==r)return se(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return se(n.booleanValue,e.booleanValue);case 2:return S7(n,e);case 3:return kF(n.timestampValue,e.timestampValue);case 4:return kF(Cd(n),Cd(e));case 5:return se(n.stringValue,e.stringValue);case 6:return b7(n.bytesValue,e.bytesValue);case 7:return C7(n.referenceValue,e.referenceValue);case 8:return w7(n.geoPointValue,e.geoPointValue);case 9:return o2(n.arrayValue,e.arrayValue);case 10:return T7(n.mapValue,e.mapValue);case 11:return I7(n.mapValue,e.mapValue);default:throw G()}}function S7(n,e){let t=Ge(n.integerValue||n.doubleValue),r=Ge(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function kF(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return se(n,e);let t=fi(n),r=fi(e),i=se(t.seconds,r.seconds);return i!==0?i:se(t.nanos,r.nanos)}function C7(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=se(t[i],r[i]);if(s!==0)return s}return se(t.length,r.length)}function w7(n,e){let t=se(Ge(n.latitude),Ge(e.latitude));return t!==0?t:se(Ge(n.longitude),Ge(e.longitude))}function b7(n,e){let t=Ts(n),r=Ts(e);return t.compareTo(r)}function o2(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=As(t[i],r[i]);if(s)return s}return se(t.length,r.length)}function T7(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Fl])===null||t===void 0?void 0:t.arrayValue,c=(r=a[Fl])===null||r===void 0?void 0:r.arrayValue,u=se(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:o2(l,c)}function I7(n,e){if(n===Es.mapValue&&e===Es.mapValue)return 0;if(n===Es.mapValue)return 1;if(e===Es.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=se(r[o],s[o]);if(a!==0)return a;let l=As(t[r[o]],i[s[o]]);if(l!==0)return l}return se(r.length,s.length)}function Ll(n){return Q0(n)}function Q0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?D7(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?A7(n.bytesValue):"referenceValue"in n?k7(n.referenceValue):"geoPointValue"in n?R7(n.geoPointValue):"arrayValue"in n?O7(n.arrayValue):"mapValue"in n?N7(n.mapValue):G()}function A7(n){return Ts(n).toBase64()}function D7(n){let e=fi(n);return`time(${e.seconds},${e.nanos})`}function R7(n){return`geo(${n.latitude},${n.longitude})`}function k7(n){return V.fromName(n).toString()}function N7(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${Q0(n.fields[i])}`;return t+"}"}function O7(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=Q0(r);return e+"]"}function Fo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function tT(n){return!!n&&"integerValue"in n}function x7(n){return!!n&&"doubleValue"in n}function P7(n){return tT(n)||x7(n)}function Td(n){return!!n&&"arrayValue"in n}function NF(n){return!!n&&"nullValue"in n}function OF(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ng(n){return!!n&&"mapValue"in n}function iy(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[H0])===null||t===void 0?void 0:t.stringValue)===K0}function md(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Ko(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=md(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=md(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function a2(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===s2}var l2={mapValue:{fields:{[H0]:{stringValue:K0},[Fl]:{arrayValue:{}}}}};function M7(n){return"nullValue"in n?tg:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Fo(Is.empty(),V.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?iy(n)?l2:{mapValue:{}}:G()}function F7(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Fo(Is.empty(),V.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?l2:"mapValue"in n?iy(n)?{mapValue:{}}:Es:G()}function xF(n,e){let t=As(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function PF(n,e){let t=As(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Bt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ng(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=md(t)}setAll(e){let t=st.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=md(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());ng(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!ng(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Ko(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(md(this.value))}};function c2(n){let e=[];return Ko(n.fields,(t,r)=>{let i=new st([t]);if(ng(r)){let o=c2(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Sn(e)}var ft=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,X.min(),X.min(),X.min(),Bt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,X.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,X.min(),X.min(),Bt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,X.min(),X.min(),Bt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(X.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Bt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Bt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=X.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function L7(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?As(r,i):G()}var jr=class{constructor(e,t){this.position=e,this.inclusive=t}};function u2(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=V.comparator(V.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=As(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function B7(n,e,t){let r=u2(n,e,t);return n.inclusive?r>=0:r>0}function V7(n,e,t){let r=u2(n,e,t);return n.inclusive?r<=0:r<0}function MF(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!sr(r,i))return!1}return!0}var Lo=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function U7(n){return n.field.canonicalString()+n.dir}function q7(n){return`${n.field.canonicalString()} (${n.dir})`}function z7(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var dg=class{},pe=class n extends dg{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new iT(e,t,r):t==="array-contains"?new aT(e,r):t==="in"?new hg(e,r):t==="not-in"?new lT(e,r):t==="array-contains-any"?new cT(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new sT(e,r):new oT(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(As(t,this.value)):t!==null&&Mo(this.value)===Mo(t)&&this.matchesComparison(As(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return G()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Ae=class n extends dg{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return Bl(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function Bl(n){return n.op==="and"}function nT(n){return n.op==="or"}function Y0(n){return d2(n)&&Bl(n)}function d2(n){for(let e of n.filters)if(e instanceof Ae)return!1;return!0}function rT(n){if(n instanceof pe)return n.field.canonicalString()+n.op.toString()+Ll(n.value);if(Y0(n))return n.filters.map(e=>rT(e)).join(",");{let e=n.filters.map(t=>rT(t)).join(",");return`${n.op}(${e})`}}function h2(n,e){if(n instanceof pe)return G7(n,e);if(n instanceof Ae)return W7(n,e);G()}function G7(n,e){return e instanceof pe&&n.op===e.op&&n.field.isEqual(e.field)&&sr(n.value,e.value)}function W7(n,e){return e instanceof Ae&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&h2(i,e.filters[s]),!0):!1}function f2(n,e){let t=n.filters.concat(e);return Ae.create(t,n.op)}function p2(n){return n instanceof pe?$7(n):n instanceof Ae?j7(n):"Filter"}function j7(n){return n.op.toString()+" {"+n.getFilters().map(p2).join(" ,")+"}"}function $7(n){return`${n.field.canonicalString()} ${n.op} ${Ll(n.value)}`}var iT=class extends pe{constructor(e,t,r){super(e,t,r),this.key=V.fromName(r.referenceValue)}matches(e){let t=V.comparator(e.key,this.key);return this.matchesComparison(t)}},sT=class extends pe{constructor(e,t){super(e,"in",t),this.keys=m2("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},oT=class extends pe{constructor(e,t){super(e,"not-in",t),this.keys=m2("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function m2(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>V.fromName(r.referenceValue))}var aT=class extends pe{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Td(t)&&bd(t.arrayValue,this.value)}},hg=class extends pe{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&bd(this.value.arrayValue,t)}},lT=class extends pe{constructor(e,t){super(e,"not-in",t)}matches(e){if(bd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!bd(this.value.arrayValue,t)}},cT=class extends pe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Td(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>bd(this.value.arrayValue,r))}};var uT=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function dT(n,e=null,t=[],r=[],i=null,s=null,o=null){return new uT(n,e,t,r,i,s,o)}function Bo(n){let e=U(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>rT(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>U7(r)).join(","),$d(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ll(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ll(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function H7(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>p2(t)).join(", ")}]`),$d(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>q7(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Ll(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Ll(t)).join(",")),`Target(${e})`}function Hd(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!z7(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!h2(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!MF(n.startAt,e.startAt)?!1:MF(n.endAt,e.endAt)}function fg(n){return V.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function sy(n,e){return n.filters.filter(t=>t instanceof pe&&t.field.isEqual(e))}function K7(n,e){let t=V0(e);if(t===void 0)return null;for(let r of sy(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function Q7(n,e){let t=new Map;for(let r of Po(e))for(let i of sy(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function Y7(n,e){let t=[],r=!0;for(let i of Po(e)){let s=i.kind===0?g2(n,i.fieldPath,n.startAt):y2(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new jr(t,r)}function X7(n,e){let t=[],r=!0;for(let i of Po(e)){let s=i.kind===0?y2(n,i.fieldPath,n.endAt):g2(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new jr(t,r)}function g2(n,e,t){let r=tg,i=!0;for(let s of sy(n,e)){let o=tg,a=!0;switch(s.op){case"<":case"<=":o=M7(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=tg;break}xF({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];xF({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function y2(n,e,t){let r=Es,i=!0;for(let s of sy(n,e)){let o=Es,a=!0;switch(s.op){case">=":case">":o=F7(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Es;break}PF({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];PF({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function J7(n){let e=new ke(st.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function Z7(n){return n.limit!==null}var or=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function _2(n,e,t,r,i,s,o,a){return new or(n,e,t,r,i,s,o,a)}function nc(n){return new or(n)}function eQ(n,e){return new or(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function FF(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function tQ(n){let e=new ke(st.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function nQ(n){return new or(ye.emptyPath(),n)}function rQ(n){return V.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function X0(n){return n.collectionGroup!==null}function Vl(n){let e=U(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";tQ(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new Lo(s,r))}),t.has(st.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new Lo(st.keyField(),r))}return e.memoizedNormalizedOrderBy}function Jt(n){let e=U(n);return e.memoizedTarget||(e.memoizedTarget=iQ(e,Vl(n))),e.memoizedTarget}function iQ(n,e){if(n.limitType==="F")return dT(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Lo(i.field,s)});let t=n.endAt?new jr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new jr(n.startAt.position,n.startAt.inclusive):null;return dT(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function J0(n,e){let t=n.filters.concat([e]);return new or(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function sQ(n,e){let t=n.explicitOrderBy.concat([e]);return new or(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function pg(n,e,t){return new or(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function oQ(n,e){return new or(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function aQ(n,e){return new or(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function Kd(n,e){return Hd(Jt(n),Jt(e))&&n.limitType===e.limitType}function v2(n){return`${Bo(Jt(n))}|lt:${n.limitType}`}function Il(n){return`Query(target=${H7(Jt(n))}; limitType=${n.limitType})`}function Qd(n,e){return e.isFoundDocument()&&lQ(n,e)&&cQ(n,e)&&uQ(n,e)&&dQ(n,e)}function lQ(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):V.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function cQ(n,e){for(let t of Vl(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function uQ(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function dQ(n,e){return!(n.startAt&&!V7(n.startAt,Vl(n),e)||n.endAt&&!B7(n.endAt,Vl(n),e))}function E2(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function S2(n){return(e,t)=>{let r=!1;for(let i of Vl(n)){let s=hQ(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function hQ(n,e,t){let r=n.field.isKeyField()?V.comparator(e.key,t.key):L7(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return G()}}var $r=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ko(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return JL(this.inner)}size(){return this.innerSize}};var fQ=new Le(V.comparator);function an(){return fQ}var C2=new Le(V.comparator);function dd(...n){let e=C2;for(let t of n)e=e.insert(t.key,t);return e}function pQ(){return Id()}function w2(n){let e=C2;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function zr(){return Id()}function b2(){return Id()}function Id(){return new $r(n=>n.toString(),(n,e)=>n.isEqual(e))}var mQ=new Le(V.comparator);function gQ(){return mQ}var yQ=new ke(V.comparator);function ae(...n){let e=yQ;for(let t of n)e=e.add(t);return e}var _Q=new ke(se);function Z0(){return _Q}function eI(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wd(e)?"-0":e}}function T2(n){return{integerValue:""+n}}function I2(n,e){return i2(e)?T2(e):eI(n,e)}var Ul=class{constructor(){this._=void 0}};function vQ(n,e,t){return n instanceof Ds?p7(t,e):n instanceof pi?D2(n,e):n instanceof mi?R2(n,e):CQ(n,e)}function EQ(n,e,t){return n instanceof pi?D2(n,e):n instanceof mi?R2(n,e):t}function A2(n,e){return n instanceof Rs?P7(e)?e:{integerValue:0}:null}function SQ(n,e){return n instanceof pi&&e instanceof pi||n instanceof mi&&e instanceof mi?xo(n.elements,e.elements,sr):n instanceof Rs&&e instanceof Rs?sr(n.operand,e.operand):n instanceof Ds&&e instanceof Ds}var Ds=class extends Ul{},pi=class extends Ul{constructor(e){super(),this.elements=e}};function D2(n,e){let t=k2(e);for(let r of n.elements)t.some(i=>sr(i,r))||t.push(r);return{arrayValue:{values:t}}}var mi=class extends Ul{constructor(e){super(),this.elements=e}};function R2(n,e){let t=k2(e);for(let r of n.elements)t=t.filter(i=>!sr(i,r));return{arrayValue:{values:t}}}var Rs=class extends Ul{constructor(e,t){super(),this.serializer=e,this.operand=t}};function CQ(n,e){let t=A2(n,e),r=LF(t)+LF(n.operand);return tT(t)&&tT(n.operand)?T2(r):eI(n.serializer,r)}function LF(n){return Ge(n.integerValue||n.doubleValue)}function k2(n){return Td(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Vo=class{constructor(e,t){this.field=e,this.transform=t}};function wQ(n,e){return n.field.isEqual(e.field)&&SQ(n.transform,e.transform)}function bQ(n,e){return n===void 0&&e===void 0?!0:n&&e?xo(n,e,(t,r)=>wQ(t,r)):!1}var hT=class{constructor(e,t){this.version=e,this.transformResults=t}},Ze=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function oy(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var ql=class{};function N2(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ns(n.key,Ze.none()):new ks(n.key,n.data,Ze.none());{let t=n.data,r=Bt.empty(),i=new ke(st.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new ar(n.key,r,new Sn(i.toArray()),Ze.none())}}function TQ(n,e,t){n instanceof ks?AQ(n,e,t):n instanceof ar?RQ(n,e,t):NQ(n,e,t)}function gd(n,e,t,r){return n instanceof ks?DQ(n,e,t,r):n instanceof ar?kQ(n,e,t,r):OQ(n,e,t)}function IQ(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=A2(r.transform,i||null);s!=null&&(t===null&&(t=Bt.empty()),t.set(r.field,s))}return t||null}function BF(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!bQ(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var ks=class extends ql{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function AQ(n,e,t){let r=n.value.clone(),i=x2(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function DQ(n,e,t,r){if(!oy(n.precondition,e))return t;let i=n.value.clone(),s=P2(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var ar=class extends ql{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function RQ(n,e,t){if(!oy(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=x2(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(O2(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function kQ(n,e,t,r){if(!oy(n.precondition,e))return t;let i=P2(n.fieldTransforms,r,e),s=e.data;return s.setAll(O2(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function O2(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function x2(n,e,t){let r=new Map;$(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,EQ(o,a,t[i]))}return r}function P2(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,vQ(s,o,e))}return r}var Ns=class extends ql{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function NQ(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function OQ(n,e,t){return oy(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Ad=class extends ql{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Dd=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];TQ(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=gd(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=gd(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=b2();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=N2(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(X.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ae())}isEqual(e){return this.batchId===e.batchId&&xo(this.mutations,e.mutations,(t,r)=>BF(t,r))&&xo(this.baseMutations,e.baseMutations,(t,r)=>BF(t,r))}},fT=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){$(e.mutations.length===r.length);let i=gQ(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Rd=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var pT=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Dt=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(Dt||{});function M2(n){switch(n){case D.OK:return G();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0;default:return G()}}function xQ(n){return M2(n)&&n!==D.ABORTED}function rg(n){if(n===void 0)return $e("GRPC error has no .code"),D.UNKNOWN;switch(n){case Dt.OK:return D.OK;case Dt.CANCELLED:return D.CANCELLED;case Dt.UNKNOWN:return D.UNKNOWN;case Dt.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case Dt.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case Dt.INTERNAL:return D.INTERNAL;case Dt.UNAVAILABLE:return D.UNAVAILABLE;case Dt.UNAUTHENTICATED:return D.UNAUTHENTICATED;case Dt.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case Dt.NOT_FOUND:return D.NOT_FOUND;case Dt.ALREADY_EXISTS:return D.ALREADY_EXISTS;case Dt.PERMISSION_DENIED:return D.PERMISSION_DENIED;case Dt.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case Dt.ABORTED:return D.ABORTED;case Dt.OUT_OF_RANGE:return D.OUT_OF_RANGE;case Dt.UNIMPLEMENTED:return D.UNIMPLEMENTED;case Dt.DATA_LOSS:return D.DATA_LOSS;default:return G()}}var mT=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Tb=null;function F2(){return new h8}function PQ(){return new f8("utf-8")}var MQ=new ms([4294967295,4294967295],0);function VF(n){let e=F2().encode(n),t=new bb;return t.update(e),new Uint8Array(t.digest())}function UF(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new ms([t,r],0),a=new ms([i,s],0);return[o,a]}var gT=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ko(`Invalid padding: ${t}`);if(r<0)throw new ko(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ko(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ko(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=ms.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(ms.fromNumber(r)));return i.compare(MQ)===1&&(i=new ms([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=VF(e),[r,i]=UF(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=VF(e),[r,i]=UF(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},ko=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var kd=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Nd.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(X.min(),i,new Le(se),an(),ae())}},Nd=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,ae(),ae(),ae())}};var xl=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},mg=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},gg=class{constructor(e,t,r=ot.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},yg=class{constructor(){this.pendingResponses=0,this.documentChanges=zF(),this._resumeToken=ot.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=ae(),t=ae(),r=ae();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:G()}}),new Nd(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=zF()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,$(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},FQ="WatchChangeAggregator",yT=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=an(),this.pendingDocumentTargetMapping=qF(),this.pendingTargetResets=new Le(se)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:G()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(fg(s))if(r===0){let o=new V(s.path);this.removeDocumentFromTarget(t,o,ft.newNoDocument(o,X.min()))}else $(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}Tb?.notifyOnExistenceFilterMismatch(LQ(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Ts(r).toUint8Array()}catch(l){if(l instanceof mT)return ir("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new gT(o,i,s)}catch(l){return l instanceof ko?ir("BloomFilter error: ",l):ir("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&fg(a.target)){let l=new V(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,ft.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=ae();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new kd(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=an(),this.pendingDocumentTargetMapping=qF(),this.pendingTargetResets=new Le(se),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new yg,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new ke(se),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||M(FQ,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new yg),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function qF(){return new Le(V.comparator)}function zF(){return new Le(V.comparator)}function LQ(n,e,t,r,i){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},h=e.unchangedNames;return h&&(d.bloomFilter={applied:i===0,hashCount:(s=h?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=h?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=h?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:p=>{var E;return(E=r?.mightContain(p))!==null&&E!==void 0?E:!1}}),d}var BQ=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),VQ=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),UQ=(()=>{let n={};return n.and="AND",n.or="OR",n})();var _T=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function qQ(n){let e=n.code===void 0?D.UNKNOWN:rg(n.code);return new N(e,n.message||"")}function vT(n,e){return n.useProto3Json||$d(e)?e:{value:e}}function zQ(n){let e;return typeof n=="object"?e=n.value:e=n,$d(e)?null:e}function zl(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function GQ(n){let e=fi(n);return new He(e.seconds,e.nanos)}function L2(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function WQ(n,e){return n.useProto3Json?($(e===void 0||typeof e=="string"),ot.fromBase64String(e||"")):($(e===void 0||e instanceof Buffer||e instanceof Uint8Array),ot.fromUint8Array(e||new Uint8Array))}function jQ(n,e){return zl(n,e.toTimestamp())}function it(n){return $(!!n),X.fromTimestamp(GQ(n))}function tI(n,e){return ET(n,e).canonicalString()}function ET(n,e){let t=$Q(n).child("documents");return e===void 0?t:t.child(e)}function B2(n){let e=ye.fromString(n);return $(K2(e)),e}function Od(n,e){return tI(n.databaseId,e.path)}function Gr(n,e){let t=B2(e);if(t.get(1)!==n.databaseId.projectId)throw new N(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new N(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new V(q2(t))}function V2(n,e){return tI(n.databaseId,e)}function U2(n){let e=B2(n);return e.length===4?ye.emptyPath():q2(e)}function ST(n){return new ye(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function $Q(n){return new ye(["projects",n.projectId,"databases",n.database])}function q2(n){return $(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function GF(n,e,t){return{name:Od(n,e),fields:t.value.mapValue.fields}}function HQ(n,e){return{name:Od(n,e.key),fields:e.data.value.mapValue.fields,updateTime:zl(n,e.version.toTimestamp()),createTime:zl(n,e.createTime.toTimestamp())}}function z2(n,e,t){let r=Gr(n,e.name),i=it(e.updateTime),s=e.createTime?it(e.createTime):X.min(),o=new Bt({mapValue:{fields:e.fields}}),a=ft.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function KQ(n,e){$(!!e.found),e.found.name,e.found.updateTime;let t=Gr(n,e.found.name),r=it(e.found.updateTime),i=e.found.createTime?it(e.found.createTime):X.min(),s=new Bt({mapValue:{fields:e.found.fields}});return ft.newFoundDocument(t,r,i,s)}function QQ(n,e){$(!!e.missing),$(!!e.readTime);let t=Gr(n,e.missing),r=it(e.readTime);return ft.newNoDocument(t,r)}function YQ(n,e){return"found"in e?KQ(n,e):"missing"in e?QQ(n,e):G()}function XQ(n,e){let t;if("targetChange"in e){e.targetChange;let r=JQ(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=WQ(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&qQ(o);t=new gg(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Gr(n,r.document.name),s=it(r.document.updateTime),o=r.document.createTime?it(r.document.createTime):X.min(),a=new Bt({mapValue:{fields:r.document.fields}}),l=ft.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new xl(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Gr(n,r.document),s=r.readTime?it(r.readTime):X.min(),o=ft.newNoDocument(i,s),a=r.removedTargetIds||[];t=new xl([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Gr(n,r.document),s=r.removedTargetIds||[];t=new xl([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new pT(i,s),a=r.targetId;t=new mg(a,o)}else return G();return t}function JQ(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:G()}function ZQ(n){if(!("targetChange"in n))return X.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?X.min():it(e.readTime)}function xd(n,e){let t;if(e instanceof ks)t={update:GF(n,e.key,e.value)};else if(e instanceof Ns)t={delete:Od(n,e.key)};else if(e instanceof ar)t={update:GF(n,e.key,e.data),updateMask:OY(e.fieldMask)};else if(e instanceof Ad)t={verify:Od(n,e.key)};else return G();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>iY(n,r))),e.precondition.isNone||(t.currentDocument=eY(n,e.precondition)),t}function CT(n,e){let t=e.currentDocument?tY(e.currentDocument):Ze.none(),r=e.updateTransforms?e.updateTransforms.map(i=>sY(n,i)):[];if(e.update){e.update.name;let i=Gr(n,e.update.name),s=new Bt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=xY(e.updateMask);return new ar(i,s,o,t,r)}else return new ks(i,s,t,r)}else if(e.delete){let i=Gr(n,e.delete);return new Ns(i,t)}else if(e.verify){let i=Gr(n,e.verify);return new Ad(i,t)}else return G()}function eY(n,e){return e.updateTime!==void 0?{updateTime:jQ(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:G()}function tY(n){return n.updateTime!==void 0?Ze.updateTime(it(n.updateTime)):n.exists!==void 0?Ze.exists(n.exists):Ze.none()}function nY(n,e){let t=n.updateTime?it(n.updateTime):it(e);return t.isEqual(X.min())&&(t=it(e)),new hT(t,n.transformResults||[])}function rY(n,e){return n&&n.length>0?($(e!==void 0),n.map(t=>nY(t,e))):[]}function iY(n,e){let t=e.transform;if(t instanceof Ds)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof pi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof mi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Rs)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw G()}function sY(n,e){let t=null;if("setToServerValue"in e)$(e.setToServerValue==="REQUEST_TIME"),t=new Ds;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new pi(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new mi(i)}else"increment"in e?t=new Rs(n,e.increment):G();let r=st.fromServerFormat(e.fieldPath);return new Vo(r,t)}function G2(n,e){return{documents:[V2(n,e.path)]}}function oY(n){let e=n.documents.length;$(e===1);let t=n.documents[0];return Jt(nc(U2(t)))}function W2(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=V2(n,i);let s=dY(e.filters);s&&(t.structuredQuery.where=s);let o=fY(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=vT(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=mY(e.startAt)),e.endAt&&(t.structuredQuery.endAt=gY(e.endAt)),{queryTarget:t,parent:i}}function j2(n){let e=U2(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){$(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=hY(t.where));let o=[];t.orderBy&&(o=pY(t.orderBy));let a=null;t.limit&&(a=zQ(t.limit));let l=null;t.startAt&&(l=yY(t.startAt));let c=null;return t.endAt&&(c=_Y(t.endAt)),_2(e,i,o,s,a,"F",l,c)}function aY(n){return Jt(j2(n))}function lY(n,e){let t=cY(e.purpose);return t==null?null:{"goog-listen-tags":t}}function cY(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return G()}}function uY(n,e){let t,r=e.target;if(fg(r)?t={documents:G2(n,r)}:t={query:W2(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=L2(n,e.resumeToken);let i=vT(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(X.min())>0){t.readTime=zl(n,e.snapshotVersion.toTimestamp());let i=vT(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function dY(n){if(n.length!==0)return H2(Ae.create(n,"and"))}function hY(n){let e=$2(n);return e instanceof Ae&&Y0(e)?e.getFilters():[e]}function $2(n){return n.unaryFilter!==void 0?RY(n):n.fieldFilter!==void 0?kY(n):n.compositeFilter!==void 0?NY(n):G()}function fY(n){if(n.length!==0)return n.map(e=>TY(e))}function pY(n){return n.map(e=>IY(e))}function mY(n){return{before:n.inclusive,values:n.position}}function gY(n){return{before:!n.inclusive,values:n.position}}function yY(n){let e=!!n.before,t=n.values||[];return new jr(t,e)}function _Y(n){let e=!n.before,t=n.values||[];return new jr(t,e)}function vY(n){return BQ[n]}function EY(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function SY(n){return VQ[n]}function CY(n){return UQ[n]}function wY(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return G();default:return G()}}function bY(n){switch(n){case"AND":return"and";case"OR":return"or";default:return G()}}function Al(n){return{fieldPath:n.canonicalString()}}function kl(n){return st.fromServerFormat(n.fieldPath)}function TY(n){return{field:Al(n.field),direction:vY(n.dir)}}function IY(n){return new Lo(kl(n.field),EY(n.direction))}function H2(n){return n instanceof pe?DY(n):n instanceof Ae?AY(n):G()}function AY(n){let e=n.getFilters().map(t=>H2(t));return e.length===1?e[0]:{compositeFilter:{op:CY(n.op),filters:e}}}function DY(n){if(n.op==="=="){if(OF(n.value))return{unaryFilter:{field:Al(n.field),op:"IS_NAN"}};if(NF(n.value))return{unaryFilter:{field:Al(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(OF(n.value))return{unaryFilter:{field:Al(n.field),op:"IS_NOT_NAN"}};if(NF(n.value))return{unaryFilter:{field:Al(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Al(n.field),op:SY(n.op),value:n.value}}}function RY(n){switch(n.unaryFilter.op){case"IS_NAN":let e=kl(n.unaryFilter.field);return pe.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=kl(n.unaryFilter.field);return pe.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=kl(n.unaryFilter.field);return pe.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=kl(n.unaryFilter.field);return pe.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return G();default:return G()}}function kY(n){return pe.create(kl(n.fieldFilter.field),wY(n.fieldFilter.op),n.fieldFilter.value)}function NY(n){return Ae.create(n.compositeFilter.filters.map(e=>$2(e)),bY(n.compositeFilter.op))}function OY(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function xY(n){let e=n.fieldPaths||[];return new Sn(e.map(t=>st.fromServerFormat(t)))}function K2(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Gl=class n{constructor(e,t,r,i,s=X.min(),o=X.min(),a=ot.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var _g=class{constructor(e){this.remoteSerializer=e}};function PY(n,e){let t;if(e.document)t=z2(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=V.fromSegments(e.noDocument.path),i=qo(e.noDocument.readTime);t=ft.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=V.fromSegments(e.unknownDocument.path),i=qo(e.unknownDocument.version);t=ft.newUnknownDocument(r,i)}else return G();return e.readTime&&t.setReadTime(MY(e.readTime)),t}function WF(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ay(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=HQ(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Uo(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:Uo(e.version)};else return G();return r}function ay(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function MY(n){let e=new He(n[0],n[1]);return X.fromTimestamp(e)}function Uo(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function qo(n){let e=new He(n.seconds,n.nanoseconds);return X.fromTimestamp(e)}function FY(n,e,t){let r=t.baseMutations.map(s=>xd(n.remoteSerializer,s)),i=t.mutations.map(s=>xd(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function Io(n,e){let t=(e.baseMutations||[]).map(s=>CT(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>CT(n.remoteSerializer,s)),i=He.fromMillis(e.localWriteTimeMs);return new Dd(e.batchId,i,t,r)}function hd(n){let e=qo(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?qo(n.lastLimboFreeSnapshotVersion):X.min(),r;return LY(n.query)?r=oY(n.query):r=aY(n.query),new Gl(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,ot.fromBase64String(n.resumeToken))}function Q2(n,e){let t=Uo(e.snapshotVersion),r=Uo(e.lastLimboFreeSnapshotVersion),i;fg(e.target)?i=G2(n.remoteSerializer,e.target):i=W2(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Bo(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function LY(n){return n.documents!==void 0}function BY(n){return{id:n.bundleId,createTime:qo(n.createTime),version:n.version}}function VY(n){return{bundleId:n.id,createTime:Uo(it(n.createTime)),version:n.version}}function UY(n){return{name:n.name,query:nI(n.bundledQuery),readTime:qo(n.readTime)}}function qY(n){return{name:n.name,readTime:Uo(it(n.readTime)),bundledQuery:n.bundledQuery}}function nI(n){let e=j2({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?pg(e,e.limit,"L"):e}function zY(n){return{name:n.name,query:nI(n.bundledQuery),readTime:it(n.readTime)}}function GY(n){return{id:n.id,version:n.version,createTime:it(n.createTime)}}function Ib(n,e){return new Rd(e.largestBatchId,CT(n.remoteSerializer,e.overlayMutation))}function WY(n,e,t){let[r,i,s]=Y2(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:xd(n.remoteSerializer,t.mutation)}}function Y2(n,e){let t=e.path.lastSegment(),r=Xt(e.path.popLast());return[n,r,t]}function jY(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function $Y(n,e){let t=e?new vd(e.sequenceNumber,new Un(qo(e.readTime),new V(qr(e.documentKey)),e.largestBatchId)):vd.empty(),r=n.fields.map(([i,s])=>new Nl(st.fromServerFormat(i),s));return new Gb(n.indexId,n.collectionGroup,r,t)}function jF(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Uo(r.readTime),documentKey:Xt(r.documentKey.path),largestBatchId:r.largestBatchId}}var wT=class{getBundleMetadata(e,t){return $F(e).get(t).next(r=>{if(r)return BY(r)})}saveBundleMetadata(e,t){return $F(e).put(VY(t))}getNamedQuery(e,t){return HF(e).get(t).next(r=>{if(r)return UY(r)})}saveNamedQuery(e,t){return HF(e).put(qY(t))}};function $F(n){return vt(n,Jg)}function HF(n){return vt(n,Zg)}var vg=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return ad(e).get(Y2(this.userId,t)).next(r=>r?Ib(this.serializer,r):null)}getOverlays(e,t){let r=zr();return I.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Rd(t,o);i.push(this.saveOverlay(e,a))}),I.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Xt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(ad(e).deleteAll(Xb,a))}),I.waitFor(s)}getOverlaysForCollection(e,t,r){let i=zr(),s=Xt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ad(e).loadAll(Xb,o).next(a=>{for(let l of a){let c=Ib(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=zr(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ad(e).iterate({index:KL,range:a},(l,c,u)=>{let d=Ib(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return ad(e).put(WY(this.serializer,this.userId,t))}};function ad(n){return vt(n,ny)}var bT=class{globalsStore(e){return vt(e,W0)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(r=>{let i=r?.value;return i?ot.fromUint8Array(i):ot.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}};var HY=5,KY=10,QY=13,Ab=15,YY=20,XY=25,JY=30,ZY=37,eX=45,tX=50,nX=53,rX=55,iX=60,sX=2,hi=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,HY);else if("booleanValue"in e)this.writeValueTypeLabel(t,KY),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,Ab),t.writeNumber(Ge(e.integerValue));else if("doubleValue"in e){let r=Ge(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,QY):(this.writeValueTypeLabel(t,Ab),wd(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,YY),typeof r=="string"&&(r=fi(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,JY),t.writeBytes(Ts(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,eX),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?a2(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):iy(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):G()}writeIndexString(e,t){this.writeValueTypeLabel(t,XY),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,rX);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,nX);let o=Fl,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,Ab),t.writeNumber(Ge(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,tX);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,ZY),V.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,iX),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(sX)}};hi.INSTANCE=new hi;var KF="\uD800",QF="\uDBFF",El=0,YF=255,XF=1,Sl=255,JF=255,ZF=0,oX=64,aX=8,lX=1024;function cX(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function uX(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function dX(n){let e=0;for(let t=0;t<8;++t){let r=uX(n[t]&255);if(e+=r,r!==8)break}return e}function eL(n){let e=oX-dX(n);return Math.ceil(e/aX)}var TT=class{constructor(){this.buffer=new Uint8Array(lX),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<KF||QF<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<KF||QF<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=eL(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=eL(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(Sl),this.writeEscapedByteAscending(JF)}writeInfinityDescending(){this.writeEscapedByteDescending(Sl),this.writeEscapedByteDescending(JF)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=cX(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===El?(this.writeEscapedByteAscending(El),this.writeEscapedByteAscending(YF)):t===Sl?(this.writeEscapedByteAscending(Sl),this.writeEscapedByteAscending(ZF)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===El?(this.writeEscapedByteDescending(El),this.writeEscapedByteDescending(YF)):t===Sl?(this.writeEscapedByteDescending(Sl),this.writeEscapedByteDescending(ZF)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(El),this.writeEscapedByteAscending(XF)}writeSeparatorDescending(){this.writeEscapedByteDescending(El),this.writeEscapedByteDescending(XF)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},IT=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},AT=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},Ao=class{constructor(){this.orderedCode=new TT,this.ascending=new IT(this.orderedCode),this.descending=new AT(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var Do=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function gs(n,e){let t=n.indexId-e.indexId;return t!==0||(t=tL(n.arrayValue,e.arrayValue),t!==0)||(t=tL(n.directionalValue,e.directionalValue),t!==0)?t:V.comparator(n.documentKey,e.documentKey)}function tL(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Eg=class{constructor(e){this.inequalityFilters=new ke((t,r)=>st.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if($(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=V0(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=Po(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new ke(st.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Nl(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Nl(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Nl(r.field,r.dir==="asc"?0:1)));return new Gb(Gb.UNKNOWN_ID,this.collectionId,t,vd.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function X2(n){var e,t;if($(n instanceof pe||n instanceof Ae),n instanceof pe)if(n instanceof hg){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>pe.create(n.field,"==",s)))||[];return Ae.create(i,"or")}else return n;let r=n.filters.map(i=>X2(i));return Ae.create(r,n.op)}function hX(n){if(n.getFilters().length===0)return[];let e=DT(X2(n));return $(J2(e)),rI(e)||iI(e)?[e]:e.getFilters()}function rI(n){return n instanceof pe}function iI(n){return n instanceof Ae&&Y0(n)}function J2(n){return rI(n)||iI(n)||fX(n)}function fX(n){if(n instanceof Ae&&nT(n)){for(let e of n.getFilters())if(!rI(e)&&!iI(e))return!1;return!0}return!1}function DT(n){if($(n instanceof pe||n instanceof Ae),n instanceof pe)return n;if(n.filters.length===1)return DT(n.filters[0]);let e=n.filters.map(r=>DT(r)),t=Ae.create(e,n.op);return t=Sg(t),J2(t)?t:($(t instanceof Ae),$(Bl(t)),$(t.filters.length>1),t.filters.reduce((r,i)=>sI(r,i)))}function sI(n,e){$(n instanceof pe||n instanceof Ae),$(e instanceof pe||e instanceof Ae);let t;return n instanceof pe?e instanceof pe?t=pX(n,e):t=nL(n,e):e instanceof pe?t=nL(e,n):t=mX(n,e),Sg(t)}function pX(n,e){return Ae.create([n,e],"and")}function mX(n,e){if($(n.filters.length>0&&e.filters.length>0),Bl(n)&&Bl(e))return f2(n,e.getFilters());let t=nT(n)?n:e,r=nT(n)?e:n,i=t.filters.map(s=>sI(s,r));return Ae.create(i,"or")}function nL(n,e){if(Bl(e))return f2(e,n.getFilters());{let t=e.filters.map(r=>sI(n,r));return Ae.create(t,"or")}}function Sg(n){if($(n instanceof pe||n instanceof Ae),n instanceof pe)return n;let e=n.getFilters();if(e.length===1)return Sg(e[0]);if(d2(n))return n;let t=e.map(i=>Sg(i)),r=[];return t.forEach(i=>{i instanceof pe?r.push(i):i instanceof Ae&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Ae.create(r,n.op)}var RT=class{constructor(){this.collectionParentIndex=new Pd}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),I.resolve()}getCollectionParents(e,t){return I.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return I.resolve()}deleteFieldIndex(e,t){return I.resolve()}deleteAllFieldIndexes(e){return I.resolve()}createTargetIndexes(e,t){return I.resolve()}getDocumentsMatchingTarget(e,t){return I.resolve(null)}getIndexType(e,t){return I.resolve(0)}getFieldIndexes(e,t){return I.resolve([])}getNextCollectionGroupToUpdate(e){return I.resolve(null)}getMinOffset(e,t){return I.resolve(Un.min())}getMinOffsetFromCollectionGroup(e,t){return I.resolve(Un.min())}updateCollectionGroup(e,t,r){return I.resolve()}updateIndexEntries(e,t){return I.resolve()}},Pd=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ke(ye.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ke(ye.comparator)).toArray()}};var rL="IndexedDbIndexManager",Qm=new Uint8Array(0),kT=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new Pd,this.targetToDnfSubTargets=new $r(r=>Bo(r),(r,i)=>Hd(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:Xt(i)};return iL(e).put(s)}return I.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[PL(t),""],!1,!0);return iL(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(qr(o.parent))}return r})}addFieldIndex(e,t){let r=ld(e),i=jY(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=wl(e);return s.next(a=>{o.put(jF(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=ld(e),i=wl(e),s=Cl(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=ld(e),r=Cl(e),i=wl(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return I.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new Eg(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=Cl(e),i=!0,s=new Map;return I.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=ae(),a=[];return I.forEach(s,(l,c)=>{M(rL,`Using index ${w8(l)} to execute ${Bo(t)}`);let u=K7(c,l),d=Q7(c,l),h=Y7(c,l),p=X7(c,l),E=this.encodeBound(l,c,h),w=this.encodeBound(l,c,p),T=this.encodeValues(l,c,d),k=this.generateIndexRanges(l.indexId,u,E,h.inclusive,w,p.inclusive,T);return I.forEach(k,R=>r.loadFirst(R,t.limit).next(O=>{O.forEach(F=>{let W=V.fromSegments(F.documentKey);o.has(W)||(o=o.add(W),a.push(W))})}))}).next(()=>a)}else return I.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=hX(Ae.create(e.filters,"and")).map(i=>dT(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let h=t?this.encodeSingleElement(t[d/c]):Qm,p=this.generateLowerBound(e,h,r[d%c],i),E=this.generateUpperBound(e,h,s[d%c],o),w=a.map(T=>this.generateLowerBound(e,h,T,!0));u.push(...this.createRange(p,E,w))}return u}generateLowerBound(e,t,r,i){let s=new Do(e,V.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new Do(e,V.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new Eg(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return I.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<J7(s)&&(r=1):r=0})).next(()=>Z7(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new Ao;for(let i of Po(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);hi.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new Ao;return hi.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new Ao;return hi.INSTANCE.writeIndexValue(Fo(this.databaseId,t),r.forKind(C8(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new Ao);let s=0;for(let o of Po(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&Td(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);hi.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new Ao;l.seed(a.encodedBytes()),hi.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof pe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=ld(e),i=wl(e);return(t?r.loadAll(Yb,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return I.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push($Y(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:se(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=ld(e),s=wl(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(Yb,IDBKeyRange.bound(t,t)).next(a=>I.forEach(a,l=>s.put(jF(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return I.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?I.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),I.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?I.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,r,i){return Cl(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return Cl(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=Cl(e),s=new ke(gs);return i.iterate({index:HL,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new Do(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new ke(gs),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=V0(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Td(o))for(let a of o.arrayValue.values||[])r=r.add(new Do(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new Do(t.indexId,e.key,Qm,i));return r}updateEntries(e,t,r,i,s){M(rL,"Updating index entries for document '%s'",t.key);let o=[];return l7(i,s,gs,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),I.waitFor(o)}getNextSequenceNumber(e){let t=1;return wl(e).iterate({index:$L,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>gs(o,a)).filter((o,a,l)=>!a||gs(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=gs(o,e),l=gs(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Qm,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Qm,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return gs(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sL)}getMinOffset(e,t){return I.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||G())).next(sL)}};function iL(n){return vt(n,Ed)}function Cl(n){return vt(n,ty)}function ld(n){return vt(n,G0)}function wl(n){return vt(n,ey)}function sL(n){$(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;U0(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Un(e.readTime,e.documentKey,t)}function Z2(n,e,t){let r=n.store(rr),i=n.store(Zl),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,d,h)=>(a++,h.delete()));s.push(l.next(()=>{$(a===1)}));let c=[];for(let u of t.mutations){let d=GL(e,u.key.path,t.batchId);s.push(i.delete(d)),c.push(u.key)}return I.waitFor(s).next(()=>c)}function Cg(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw G();return JSON.stringify(e).length}var wg=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){$(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ys(e).iterate({index:Ro,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Dl(e),o=ys(e);return o.add({}).next(a=>{$(typeof a=="number");let l=new Dd(a,t,r,i),c=FY(this.serializer,this.userId,l),u=[],d=new ke((h,p)=>se(h.canonicalString(),p.canonicalString()));for(let h of i){let p=GL(this.userId,h.key.path,a);d=d.add(h.key.path.popLast()),u.push(o.put(c)),u.push(s.put(p,N8))}return d.forEach(h=>{u.push(this.indexManager.addToCollectionParentIndex(e,h))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),I.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return ys(e).get(t).next(r=>r?($(r.userId===this.userId),Io(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?I.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return ys(e).iterate({index:Ro,range:i},(o,a,l)=>{a.userId===this.userId&&($(a.batchId>=r),s=Io(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Cs;return ys(e).iterate({index:Ro,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Cs],[this.userId,Number.POSITIVE_INFINITY]);return ys(e).loadAll(Ro,t).next(r=>r.map(i=>Io(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Zm(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Dl(e).iterate({range:i},(o,a,l)=>{let[c,u,d]=o,h=qr(u);if(c!==this.userId||!t.path.isEqual(h)){l.done();return}return ys(e).get(d).next(p=>{if(!p)throw G();$(p.userId===this.userId),s.push(Io(this.serializer,p))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ke(se),i=[];return t.forEach(s=>{let o=Zm(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=Dl(e).iterate({range:a},(c,u,d)=>{let[h,p,E]=c,w=qr(p);if(h!==this.userId||!s.path.isEqual(w)){d.done();return}r=r.add(E)});i.push(l)}),I.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Zm(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new ke(se);return Dl(e).iterate({range:o},(l,c,u)=>{let[d,h,p]=l,E=qr(h);if(d!==this.userId||!r.isPrefixOf(E)){u.done();return}E.length===i&&(a=a.add(p))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(ys(e).get(s).next(o=>{if(o===null)throw G();$(o.userId===this.userId),r.push(Io(this.serializer,o))}))}),I.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Z2(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),I.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return I.resolve();let r=IDBKeyRange.lowerBound(k8(this.userId)),i=[];return Dl(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=qr(s[1]);i.push(c)}}).next(()=>{$(i.length===0)})})}containsKey(e,t){return eB(e,this.userId,t)}getMutationQueueMetadata(e){return tB(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Cs,lastStreamToken:""})}};function eB(n,e,t){let r=Zm(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Dl(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,h]=a;u===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function gX(n,e){let t=!1;return tB(n).iterateSerial(r=>eB(n,r,e).next(i=>(i&&(t=!0),I.resolve(!i)))).next(()=>t)}function ys(n){return vt(n,rr)}function Dl(n){return vt(n,Zl)}function tB(n){return vt(n,Wd)}var Db=2,Wl=class n{constructor(e){this.lastId=e}next(){return this.lastId+=Db,this.lastId}static forTargetCache(){return new n(2-Db)}static forSyncEngine(){return new n(1-Db)}};var NT=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new Wl(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>X.fromTimestamp(new He(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>bl(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>($(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return bl(e).iterate((o,a)=>{let l=hd(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>I.waitFor(s)).next(()=>i)}forEachTarget(e,t){return bl(e).iterate((r,i)=>{let s=hd(i);t(s)})}retrieveMetadata(e){return oL(e).get(cg).next(t=>($(t!==null),t))}saveMetadata(e,t){return oL(e).put(cg,t)}saveTargetData(e,t){return bl(e).put(Q2(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Bo(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return bl(e).iterate({range:i,index:jL},(o,a,l)=>{let c=hd(a);Hd(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=vs(e);return t.forEach(o=>{let a=Xt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),I.waitFor(i)}removeMatchingKeys(e,t,r){let i=vs(e);return I.forEach(t,s=>{let o=Xt(s.path);return I.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=vs(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=vs(e),s=ae();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=qr(o[1]),u=new V(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=Xt(t.path),i=IDBKeyRange.bound([r],[PL(r)],!1,!0),s=0;return vs(e).iterate({index:z0,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return bl(e).get(t).next(r=>r?hd(r):null)}};function bl(n){return vt(n,ec)}function oL(n){return vt(n,Ho)}function vs(n){return vt(n,tc)}var aL={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Yd=-1,nB=40*1024*1024,Vn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Vn.DEFAULT_COLLECTION_PERCENTILE=10;Vn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;Vn.DEFAULT=new Vn(nB,Vn.DEFAULT_COLLECTION_PERCENTILE,Vn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);Vn.DISABLED=new Vn(Yd,0,0);var lL="LruGarbageCollector",cL=1*1024*1024,yX=1*60*1e3,_X=5*60*1e3;function uL([n,e],[t,r]){let i=se(n,t);return i===0?se(e,r):i}var OT=class{constructor(e){this.maxElements=e,this.buffer=new ke(uL),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();uL(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},xT=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==Yd&&this.scheduleGC(yX)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){M(lL,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>b(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ms(t)?M(lL,"Ignoring IndexedDB error during garbage collection: ",t):yield Ps(t)}yield this.scheduleGC(_X)}))}},PT=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return I.resolve(En.INVALID);let r=new OT(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===Yd?(M("LruGarbageCollector","Garbage collection skipped; disabled"),I.resolve(aL)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),aL):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>{if(c=Date.now(),Tl()<=Tn.DEBUG){let h=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;M("LruGarbageCollector",h)}return I.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})})}};function vX(n,e){return new PT(n,e)}var MT=class{constructor(e,t){this.db=e,this.garbageCollector=vX(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return Ym(e,r)}removeReference(e,t,r){return Ym(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Ym(e,t)}isPinned(e,t){return gX(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,X.min()),vs(e).delete(EX(l))))});s.push(u)}}).next(()=>I.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Ym(e,t)}forEachOrphanedDocument(e,t){let r=vs(e),i=En.INVALID,s;return r.iterate({index:z0},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==En.INVALID&&t(new V(qr(s)),i),i=c,s=l):i=En.INVALID}).next(()=>{i!==En.INVALID&&t(new V(qr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function EX(n){return[0,Xt(n.path)]}function SX(n,e){return{targetId:0,path:Xt(n.path),sequenceNumber:e}}function Ym(n,e){return vs(n).put(SX(e,n.currentSequenceNumber))}var bg=class{constructor(){this.changes=new $r(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ft.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?I.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var FT=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return wo(e).put(r)}removeEntry(e,t,r){return wo(e).delete(CX(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=ft.newInvalidDocument(t);return wo(e).iterate({index:eg,range:IDBKeyRange.only(cd(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:ft.newInvalidDocument(t)};return wo(e).iterate({index:eg,range:IDBKeyRange.only(cd(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:Cg(s)}}).next(()=>r)}getEntries(e,t){let r=an();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=an(),i=new Le(V.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,Cg(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return I.resolve();let i=new ke(fL);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(cd(i.first()),cd(i.last())),o=i.getIterator(),a=o.getNext();return wo(e).iterate({index:eg,range:s},(l,c,u)=>{let d=V.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&fL(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(cd(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),ay(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return wo(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=an();for(let d of c){let h=this.maybeDecodeDocument(V.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);h.isFoundDocument()&&(Qd(t,h)||i.has(h.key))&&(u=u.insert(h.key,h))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=an(),o=hL(t,r),a=hL(t,Un.max());return wo(e).iterate({index:WL,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(V.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new LT(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return dL(e).get(Qb).next(t=>($(!!t),t))}setMetadata(e,t){return dL(e).put(Qb,t)}maybeDecodeDocument(e,t){if(t){let r=PY(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(X.min())))return r}return ft.newInvalidDocument(e)}};function rB(n){return new FT(n)}var LT=class extends bg{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new $r(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new ke((s,o)=>se(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=WF(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=Cg(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=WF(this.documentCache.serializer,o.convertToNoDocument(X.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),I.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function dL(n){return vt(n,jd)}function wo(n){return vt(n,Xg)}function cd(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function CX(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],ay(e),t[t.length-1]]}function hL(n,e){let t=e.documentKey.path.toArray();return[n,ay(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function fL(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=se(t[s],r[s]),i)return i;return i=se(t.length,r.length),i||(i=se(t[t.length-2],r[r.length-2]),i)?i:se(t[t.length-1],r[r.length-1])}var wX=17;var BT=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Tg=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&gd(r.mutation,i,Sn.empty(),He.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ae()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ae()){let i=zr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=dd();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=zr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ae()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=an(),o=Id(),a=pQ();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof ar)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),gd(u.mutation,c,u.mutation.getFieldMask(),He.now())):o.set(c.key,Sn.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new BT(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Id(),i=new Le((o,a)=>o-a),s=ae();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||Sn.empty();u=a.applyToLocalView(c,u),r.set(l,u);let d=(i.get(a.batchId)||ae()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=b2();u.forEach(h=>{if(!s.has(h)){let p=N2(t.get(h),r.get(h));p!==null&&d.set(h,p),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return I.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return rQ(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):X0(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):I.resolve(zr()),a=Pl,l=s;return o.next(c=>I.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?I.resolve():this.remoteDocumentCache.getEntry(e,u).next(h=>{l=l.insert(u,h)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,ae())).next(u=>({batchId:a,changes:w2(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new V(t)).next(r=>{let i=dd();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=dd();return this.indexManager.getCollectionParents(e,s).next(a=>I.forEach(a,l=>{let c=eQ(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,h)=>{o=o.insert(d,h)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,ft.newInvalidDocument(u)))});let a=dd();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&gd(u.mutation,c,Sn.empty(),He.now()),Qd(t,c)&&(a=a.insert(l,c))}),a})}};var VT=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return I.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,GY(t)),I.resolve()}getNamedQuery(e,t){return I.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,zY(t)),I.resolve()}};var UT=class{constructor(){this.overlays=new Le(V.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return I.resolve(this.overlays.get(t))}getOverlays(e,t){let r=zr();return I.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),I.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),I.resolve()}getOverlaysForCollection(e,t,r){let i=zr(),s=t.length+1,o=new V(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return I.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Le((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=s.get(u.largestBatchId);h===null&&(h=zr(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}let a=zr(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,h)=>a.set(d,h)),!(a.size()>=i)););return I.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Rd(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=ae(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var qT=class{constructor(){this.sessionToken=ot.EMPTY_BYTE_STRING}getSessionToken(e){return I.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,I.resolve()}};var Md=class{constructor(){this.refsByKey=new ke(dt.compareByKey),this.refsByTarget=new ke(dt.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new dt(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new dt(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new V(new ye([])),r=new dt(t,e),i=new dt(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new V(new ye([])),r=new dt(t,e),i=new dt(t,e+1),s=ae();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new dt(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},dt=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return V.comparator(e.key,t.key)||se(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return se(e.targetOrBatchId,t.targetOrBatchId)||V.comparator(e.key,t.key)}};var zT=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new ke(dt.compareByKey)}checkEmpty(e){return I.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Dd(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new dt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return I.resolve(o)}lookupMutationBatch(e,t){return I.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return I.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return I.resolve(this.mutationQueue.length===0?Cs:this.nextBatchId-1)}getAllMutationBatches(e){return I.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new dt(t,0),i=new dt(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),I.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ke(se);return t.forEach(i=>{let s=new dt(i,0),o=new dt(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),I.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;V.isDocumentKey(s)||(s=s.child(""));let o=new dt(new V(s),0),a=new ke(se);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),I.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");$(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return I.forEach(t.mutations,s=>{let o=new dt(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new dt(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return I.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,I.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function bX(){return new Le(V.comparator)}var GT=class{constructor(e){this.sizer=e,this.docs=bX(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return I.resolve(r?r.document.mutableCopy():ft.newInvalidDocument(t))}getEntries(e,t){let r=an();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ft.newInvalidDocument(i))}),I.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=an(),o=t.path,a=new V(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||U0(FL(u),r)<=0||!i.has(u.key)&&!Qd(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return I.resolve(s)}getAllFromCollectionGroup(e,t,r,i){G()}forEachDocumentKey(e,t){return I.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new WT(this)}getSize(e){return I.resolve(this.size)}};function TX(n){return new GT(n)}var WT=class extends bg{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),I.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var jT=class{constructor(e){this.persistence=e,this.targets=new $r(t=>Bo(t),Hd),this.lastRemoteSnapshotVersion=X.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Md,this.targetCount=0,this.targetIdGenerator=Wl.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),I.resolve()}getLastRemoteSnapshotVersion(e){return I.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return I.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),I.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),I.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new Wl(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,I.resolve()}updateTargetData(e,t){return this.saveTargetData(t),I.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,I.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),I.waitFor(s).next(()=>i)}getTargetCount(e){return I.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return I.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),I.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),I.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),I.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return I.resolve(r)}containsKey(e,t){return I.resolve(this.references.containsKey(t))}};var IX="MemoryPersistence",Ig=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new En(0),this._started=!1,this._started=!0,this.globalsCache=new qT,this.referenceDelegate=e(this),this.targetCache=new jT(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new RT,this.remoteDocumentCache=TX(r),this.serializer=new _g(t),this.bundleCache=new VT(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new UT,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new zT(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){M(IX,"Starting transaction:",e);let i=new $T(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return I.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},$T=class extends ag{constructor(e){super(),this.currentSequenceNumber=e}},Ag=class n{constructor(e){this.persistence=e,this.localViewReferences=new Md,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw G()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),I.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),I.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),I.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return I.forEach(this.orphanedDocuments,i=>{let s=V.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,X.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return I.or([()=>I.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var HT=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new lg("createOrUpgrade",t);r<1&&i>=1&&(DX(e),RX(e),pL(e),NX(e));let o=I.resolve();return r<3&&i>=3&&(r!==0&&(PX(e),pL(e)),o=o.next(()=>FX(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>kX(e,s))),o=o.next(()=>{LX(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(xX(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{MX(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{BX(e),VX(e)})),r<12&&i>=12&&(o=o.next(()=>{qX(e)})),r<13&&i>=13&&(o=o.next(()=>OX(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(To))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>UX(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(ey).clear()}).next(()=>{t.objectStore(ty).clear()})),r<17&&i>=17&&(o=o.next(()=>{zX(e)})),o}addDocumentGlobal(e){let t=0;return e.store(To).iterate((r,i)=>{t+=Cg(i)}).next(()=>{let r={byteSize:t};return e.store(jd).put(Qb,r)})}removeAcknowledgedMutations(e){let t=e.store(Wd),r=e.store(rr);return t.loadAll().next(i=>I.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,Cs],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(Ro,o).next(a=>I.forEach(a,l=>{$(l.userId===s.userId);let c=Io(this.serializer,l);return Z2(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(tc),r=e.store(To);return e.store(Ho).get(cg).next(s=>{let o=l=>t.put({targetId:0,path:Xt(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new ye(l),d=AX(u);a.push(t.get(d).next(h=>h?I.resolve():o(u)))}).next(()=>I.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Ed,{keyPath:V8});let r=t.store(Ed),i=new Pd,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Xt(l)})}};return t.store(To).iterate({keysOnly:!0},(o,a)=>{let l=new ye(o);return s(l.popLast())}).next(()=>t.store(Zl).iterate({keysOnly:!0},([o,a,l],c)=>{let u=qr(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(ec);return t.iterate((r,i)=>{let s=hd(i),o=Q2(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(To),i=[];return r.iterate((s,o)=>{let a=t.store(Xg),l=GX(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>I.waitFor(i))}runOverlayMigration(e,t){let r=t.store(rr),i=rB(this.serializer),s=new Ig(Ag.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:ae();Io(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),I.forEach(a,(l,c)=>{let u=new pt(c),d=vg.forUser(this.serializer,u),h=s.getIndexManager(u),p=wg.forUser(u,this.serializer,h,s.referenceDelegate);return new Tg(i,p,d,h).recalculateAndSaveOverlaysForDocumentKeys(new Sd(t,En.INVALID),l).next()})})}};function AX(n){return[0,Xt(n)]}function DX(n){n.createObjectStore(Gd)}function RX(n){n.createObjectStore(Wd,{keyPath:R8}),n.createObjectStore(rr,{keyPath:qL,autoIncrement:!0}).createIndex(Ro,zL,{unique:!0}),n.createObjectStore(Zl)}function kX(n,e){return e.store(rr).loadAll().next(r=>{n.deleteObjectStore(rr),n.createObjectStore(rr,{keyPath:qL,autoIncrement:!0}).createIndex(Ro,zL,{unique:!0});let s=e.store(rr),o=r.map(a=>s.put(a));return I.waitFor(o)})}function NX(n){n.createObjectStore(To)}function OX(n){let e=n.createObjectStore(Xg,{keyPath:O8});e.createIndex(eg,x8),e.createIndex(WL,P8)}function xX(n){n.createObjectStore(jd)}function pL(n){n.createObjectStore(tc,{keyPath:L8}).createIndex(z0,B8,{unique:!0}),n.createObjectStore(ec,{keyPath:M8}).createIndex(jL,F8,{unique:!0}),n.createObjectStore(Ho)}function PX(n){n.deleteObjectStore(tc),n.deleteObjectStore(ec),n.deleteObjectStore(Ho)}function MX(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function FX(n){let e=n.store(Ho),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:X.min().toTimestamp(),targetCount:0};return e.put(cg,t)}function LX(n){n.createObjectStore(Ml,{keyPath:U8})}function BX(n){n.createObjectStore(Jg,{keyPath:q8})}function VX(n){n.createObjectStore(Zg,{keyPath:z8})}function UX(n){n.createObjectStore(G0,{keyPath:G8,autoIncrement:!0}).createIndex(Yb,W8,{unique:!1}),n.createObjectStore(ey,{keyPath:j8}).createIndex($L,$8,{unique:!1}),n.createObjectStore(ty,{keyPath:H8}).createIndex(HL,K8,{unique:!1})}function qX(n){let e=n.createObjectStore(ny,{keyPath:Q8});e.createIndex(Xb,Y8,{unique:!1}),e.createIndex(KL,X8,{unique:!1})}function zX(n){n.createObjectStore(W0,{keyPath:J8})}function GX(n){return n.document?new V(ye.fromString(n.document.name).popFirst(5)):n.noDocument?V.fromSegments(n.noDocument.path):n.unknownDocument?V.fromSegments(n.unknownDocument.path):G()}var _s="IndexedDbPersistence",Rb=30*60*1e3,kb=5e3,WX=4e3,Nb="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",jX="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",$X="firestore_zombie",iB="main",KT=class n{constructor(e,t,r,i,s,o,a,l,c,u,d=wX){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=h=>Promise.resolve(),!n.isAvailable())throw new N(D.UNIMPLEMENTED,jX);this.referenceDelegate=new MT(this,i),this.dbName=t+iB,this.serializer=new _g(l),this.simpleDb=new bs(this.dbName,this.schemaVersion,new HT(this.serializer)),this.globalsCache=new bT,this.targetCache=new NT(this.referenceDelegate,this.serializer),this.remoteDocumentCache=rB(this.serializer),this.bundleCache=new wT,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&$e(_s,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(D.FAILED_PRECONDITION,Nb);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new En(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>b(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>b(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>b(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Xm(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Ms(e))return M(_s,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return M(_s,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return ud(e).get(_l).next(r=>I.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return Xm(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return b(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,Rb)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=vt(t,Ml);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,Rb),o=i.filter(a=>s.indexOf(a)===-1);return I.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",WX,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?I.resolve(!0):ud(e).get(_l).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,kb)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new N(D.FAILED_PRECONDITION,Nb);return!1}}return this.networkEnabled&&this.inForeground?!0:Xm(e).loadAll().next(s=>this.filterActiveClients(s,kb).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&M(_s,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return b(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[Gd,Ml],e=>{let t=new Sd(e,En.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>Xm(e).loadAll().next(t=>this.filterActiveClients(t,Rb).map(r=>r.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return wg.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new kT(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return vg.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){M(_s,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=a7(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new Sd(a,this.listenSequence?this.listenSequence.next():En.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw $e(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new N(D.FAILED_PRECONDITION,LL);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return ud(e).get(_l).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,kb)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new N(D.FAILED_PRECONDITION,Nb)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ud(e).put(_l,t)}static isAvailable(){return bs.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=ud(e);return t.get(_l).next(r=>this.isLocalClient(r)?(M(_s,"Releasing primary lease."),t.delete(_l)):I.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?($e(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;zy()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return M(_s,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return $e(_s,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){$e("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${$X}_${this.persistenceKey}_${e}`}};function ud(n){return vt(n,Gd)}function Xm(n){return vt(n,Ml)}function oI(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function HX(n){return b(this,null,function*(){if(!bs.isAvailable())return Promise.resolve();let e=n+iB;yield bs.delete(e)})}function KX(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var aI="LocalStore",QX=5*60*1e6,Fd=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Le(se),this.targetIdByTarget=new $r(s=>Bo(s),Hd),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Tg(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function sB(n,e,t,r){return new Fd(n,e,t,r)}function oB(n,e){return b(this,null,function*(){let t=U(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=ae();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function YX(n,e){let t=U(n),r=He.now(),i=e.reduce((a,l)=>a.add(l.key),ae()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=an(),c=ae();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((d,h)=>{h.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let h of e){let p=IQ(h,s.get(h.key).overlayedDocument);p!=null&&d.push(new ar(h.key,p,c2(p.value.mapValue),Ze.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:w2(s)}))}function XX(n,e){let t=U(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return aJ(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,JX(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function JX(n){let e=ae();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function ZX(n,e){let t=U(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>($(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function eJ(n){let e=U(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function aB(n){let e=U(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function tJ(n,e){let t=U(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let h=i.get(d);if(!h)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let p=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?p=p.withResumeToken(ot.EMPTY_BYTE_STRING,X.min()).withLastLimboFreeSnapshotVersion(X.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),i=i.insert(d,p),nJ(h,p,u)&&a.push(t.targetCache.updateTargetData(s,p))});let l=an(),c=ae();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(lB(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(X.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return I.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function lB(n,e,t){let r=ae(),i=ae();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=an();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(X.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):M(aI,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function nJ(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=QX?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function rJ(n,e){return b(this,null,function*(){let t=U(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>I.forEach(e,i=>I.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>I.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Ms(r))M(aI,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function iJ(n,e){let t=U(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Cs),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function sJ(n,e){let t=U(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function jl(n,e){let t=U(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,I.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new Gl(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function oJ(n,e,t){let r=U(n),i=r.targetIdByTarget.get(t);return i!==void 0?I.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function $l(n,e,t){return b(this,null,function*(){let r=U(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Ms(o))M(aI,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function ly(n,e,t){let r=U(n),i=X.min(),s=ae();return r.persistence.runTransaction("Execute query","readwrite",o=>oJ(r,o,Jt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:X.min(),t?s:ae())).next(a=>(dB(r,E2(e),a),{documents:a,remoteKeys:s})))}function aJ(n,e,t,r){let i=t.batch,s=i.keys(),o=I.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);$(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function lJ(n,e){let t=U(n),r=U(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):I.resolve(null)))}function cJ(n,e){U(U(n,Fd).mutationQueue).removeCachedMutationKeys(e)}function uJ(n){return U(U(n,Fd).persistence).getActiveClients()}function cB(n,e){let t=U(n),r=U(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function uB(n,e){let t=U(n),r=t.collectionGroupReadTime.get(e)||X.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,ML(r,Pl),Number.MAX_SAFE_INTEGER)).then(i=>(dB(t,e,i),i))}function dB(n,e,t){let r=n.collectionGroupReadTime.get(e)||X.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function dJ(n){return Jt(nc(ye.fromString(`__bundle__/docs/${n}`)))}function hJ(n,e,t,r){return b(this,null,function*(){let i=U(n),s=ae(),o=an();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield jl(i,dJ(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>lB(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function fJ(n,e){let t=U(n),r=it(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function pJ(n,e){let t=U(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function mJ(n,e){let t=U(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function gJ(r,i){return b(this,arguments,function*(n,e,t=ae()){let s=yield jl(n,Jt(nI(e.bundledQuery))),o=U(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=it(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(ot.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var QT=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var yJ=100;function _J(){return zy()?8:BL(yc())>0?6:4}var Dg=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=yJ,this.relativeIndexReadCostPerDocument=_J()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new QT;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(Tl()<=Tn.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",Il(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),I.resolve()):(Tl()<=Tn.DEBUG&&M("QueryEngine","Query:",Il(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(Tl()<=Tn.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",Il(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Jt(t))):I.resolve())}performQueryUsingIndex(e,t){if(FF(t))return I.resolve(null);let r=Jt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=pg(t,null,"F"),r=Jt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=ae(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,pg(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return FF(t)||i.isEqual(X.min())?I.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?I.resolve(null):(Tl()<=Tn.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Il(t)),this.appendRemainingResults(e,o,t,ML(i,Pl)).next(a=>a))})}applyQuery(e,t){let r=new ke(S2(e));return t.forEach((i,s)=>{Qd(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return Tl()<=Tn.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",Il(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Un.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var hB="firestore_clients";function mL(n,e){return`${hB}_${n}_${e}`}var fB="firestore_mutations";function gL(n,e,t){let r=`${fB}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var pB="firestore_targets";function Ob(n,e){return`${pB}_${n}_${e}`}var vJ="firestore_online_state";function EJ(n){return`${vJ}_${n}`}var SJ="firestore_bundle_loaded_v2";function CJ(n){return`${SJ}_${n}`}var wJ="firestore_sequence_number";function bJ(n){return`${wJ}_${n}`}var Ur="SharedClientState",Rg=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new N(i.error.code,i.error.message))),s?new n(e,t,i.state,o):($e(Ur,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},yd=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new N(r.error.code,r.error.message))),i?new n(e,r.state,s):($e(Ur,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},kg=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Z0();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=i2(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):($e(Ur,`Failed to parse client data for instance '${e}': ${t}`),null)}},YT=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):($e(Ur,`Failed to parse online state: ${e}`),null)}},Ld=class{constructor(){this.activeTargetIds=Z0()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},_d=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Le(se),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=mL(this.persistenceKey,this.localClientId),this.sequenceNumberKey=bJ(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Ld),this.clientStateKeyRe=new RegExp(`^${hB}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${fB}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${pB}_${o}_(\\d+)$`),this.onlineStateKey=EJ(this.persistenceKey),this.bundleLoadedKey=CJ(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return b(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(mL(this.persistenceKey,r));if(i){let s=kg.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(Ob(this.persistenceKey,e));if(i){let s=yd.fromWebStorageEntry(e,i);s&&(r=s.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ob(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return M(Ur,"READ",e,t),t}setItem(e,t){M(Ur,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){M(Ur,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(M(Ur,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){$e("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>b(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=TJ(t.newValue);r!==En.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new Rg(this.currentUser,e,t,r),s=gL(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=gL(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=Ob(this.persistenceKey,e),s=new yd(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return kg.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Rg.fromWebStorageEntry(new pt(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return yd.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return YT.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return b(this,null,function*(){if(e.user.uid!==this.currentUser.uid){M(Ur,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=Z0();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function TJ(n){let e=En.INVALID;if(n!=null)try{let t=JSON.parse(n);$(typeof t=="number"),e=t}catch(t){$e(Ur,"Failed to read sequence number from WebStorage",t)}return e}var Ng=class{constructor(){this.localState=new Ld,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Ld,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var XT=class{addCallback(e){}shutdown(){}};var JT=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var Jm=null;function IJ(){return 268435456+Math.round(2147483648*Math.random())}function xb(){return Jm===null?Jm=IJ():Jm++,"0x"+Jm.toString(16)}function AJ(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var DJ="1.9.1",Yt="GrpcConnection",RJ=`gl-node/${process.versions.node} fire/${Jl} grpc/${DJ}`;function Pb(n,e,t,r){$(e===null||e.type==="OAuth");let i=new Oo.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",RJ),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var ZT=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){M(Yt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?Oo.credentials.createSsl():Oo.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=xb(),a=this.ensureActiveStub(),l=Pb(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return AJ(u=>(M(Yt,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(d,h)=>{d?(M(Yt,`RPC '${e}' ${o} failed with error:`,d),u(new N(rg(d.code),d.message))):(M(Yt,`RPC '${e}' ${o} completed with response:`,h),u(void 0,h))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=xb(),l=[],c=new ht;M(Yt,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=Pb(this.databasePath,i,s,this.databaseInfo.appId),h=Object.assign(Object.assign({},r),{database:this.databasePath}),p=u[e](h,d),E=!1;return p.on("data",w=>{M(Yt,`RPC ${e} ${a} received result:`,w),l.push(w),o!==void 0&&l.length===o&&(E=!0,c.resolve(l))}),p.on("end",()=>{M(Yt,`RPC '${e}' ${a} completed.`),E||(E=!0,c.resolve(l))}),p.on("error",w=>{M(Yt,`RPC '${e}' ${a} failed with error:`,w);let T=rg(w.code);c.reject(new N(T,w.message))}),c.promise}openStream(e,t,r){let i=xb(),s=this.ensureActiveStub(),o=Pb(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=h=>{l||(l=!0,u.callOnClose(h),a.end())},u=new JT({sendFn:h=>{if(l)M(Yt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,h);else{M(Yt,`RPC '${e}' stream ${i} sending:`,h);try{a.write(h)}catch(p){throw $e("Failure sending:",h),$e("Error:",p),p}}},closeFn:()=>{M(Yt,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),d=!1;return a.on("data",h=>{l||(M(Yt,`RPC '${e}' stream ${i} received:`,h),d||(u.callOnConnected(),d=!0),u.callOnMessage(h))}),a.on("end",()=>{M(Yt,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",h=>{if(!l){ir(Yt,`RPC '${e}' stream ${i} error. Code:`,h.code,"Message:",h.message);let p=rg(h.code);c(new N(p,h.message))}}),M(Yt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},mB={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},kJ={nested:mB},NJ=Object.freeze({__proto__:null,nested:mB,default:kJ});var OJ={longs:String,enums:String,defaults:!0,oneofs:!1};function xJ(){let n=OL.fromJSON(NJ,OJ);return Oo.loadPackageDefinition(n)}function PJ(n){let e=xJ();return new ZT(e,n)}function MJ(){return new XT}function gB(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function FJ(){return null}function Xd(n){return new _T(n,!1)}var LJ="ExponentialBackoff",BJ=1e3,VJ=1.5,UJ=60*1e3,Bd=class{constructor(e,t,r=BJ,i=VJ,s=UJ){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&M(LJ,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var yL="PersistentStream",qJ=60*1e3,zJ=10*1e3,Og=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new Bd(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return b(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,qJ,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return b(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return b(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===D.RESOURCE_EXHAUSTED?($e(t.toString()),$e("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new N(D.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,zJ,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>b(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return M(yL,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(M(yL,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},e0=class extends Og{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=XQ(this.serializer,e),r=ZQ(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=ST(this.serializer),t.addTarget=uY(this.serializer,e);let r=lY(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=ST(this.serializer),t.removeTarget=e,this.sendRequest(t)}},t0=class extends Og{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return $(!!e.streamToken),this.lastStreamToken=e.streamToken,$(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){$(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=rY(e.writeResults,e.commitTime),r=it(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=ST(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>xd(this.serializer,r))};this.sendRequest(t)}};var n0=class{},r0=class extends n0{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new N(D.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,ET(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new N(D.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,ET(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new N(D.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function GJ(n,e,t,r){return new r0(n,e,t,r)}function WJ(n,e){return b(this,null,function*(){let t=U(n),r={writes:e.map(i=>xd(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,ye.emptyPath(),r)})}function jJ(n,e){return b(this,null,function*(){let t=U(n),r={documents:e.map(a=>Od(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,ye.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=YQ(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());$(!!l),o.push(l)}),o})}function $J(n,e,t){let r=U(n);return r.verifyInitialized(),new t0(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function HJ(n,e,t){let r=U(n);return r.verifyInitialized(),new e0(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var KJ="OnlineStateTracker",_L=1,vL=10*1e3,i0=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",vL,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${vL/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=_L&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${_L} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?($e(t),this.shouldWarnClientIsOffline=!1):M(KJ,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var zo="RemoteStore",QJ=10,s0=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>b(this,null,function*(){Fs(this)&&(M(zo,"Restarting streams for network reachability change."),yield fZ(this))}))}),this.onlineStateTracker=new i0(r,i)}};function YJ(n,e,t,r,i){return new s0(n,e,t,r,i)}function XJ(n){let e=U(n);return e.offlineCauses.delete(0),Jd(e)}function Jd(n){return b(this,null,function*(){if(Fs(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function JJ(n){return b(this,null,function*(){let e=U(n);e.offlineCauses.add(0),yield rc(e),e.onlineStateTracker.set("Offline")})}function rc(n){return b(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function ZJ(n){return b(this,null,function*(){let e=U(n);M(zo,"RemoteStore shutting down."),e.offlineCauses.add(5),yield rc(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function cy(n,e){let t=U(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),uI(t)?cI(t):oc(t).isOpen()&&lI(t,e))}function ic(n,e){let t=U(n),r=oc(t);t.listenTargets.delete(e),r.isOpen()&&yB(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Fs(t)&&t.onlineStateTracker.set("Unknown"))}function lI(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(X.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}oc(n).watch(e)}function yB(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),oc(n).unwatch(e)}function cI(n){n.watchChangeAggregator=new yT({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),oc(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function uI(n){return Fs(n)&&!oc(n).isStarted()&&n.listenTargets.size>0}function Fs(n){return U(n).offlineCauses.size===0}function _B(n){n.watchChangeAggregator=void 0}function eZ(n){return b(this,null,function*(){n.onlineStateTracker.set("Online")})}function tZ(n){return b(this,null,function*(){n.listenTargets.forEach((e,t)=>{lI(n,e)})})}function nZ(n,e){return b(this,null,function*(){_B(n),uI(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),cI(n)):n.onlineStateTracker.set("Unknown")})}function rZ(n,e,t){return b(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof gg&&e.state===2&&e.cause){try{yield sZ(n,e)}catch(r){M(zo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield xg(n,r)}return}if(e instanceof xl?n.watchChangeAggregator.handleDocumentChange(e):e instanceof mg?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(X.min()))try{let r=yield aB(n.localStore);t.compareTo(r)>=0&&(yield iZ(n,t))}catch(r){M(zo,"Failed to raise snapshot:",r),yield xg(n,r)}})}function xg(n,e,t){return b(this,null,function*(){if(Ms(e))n.offlineCauses.add(1),yield rc(n),n.onlineStateTracker.set("Offline"),t||(t=()=>aB(n.localStore)),n.asyncQueue.enqueueRetryable(()=>b(this,null,function*(){M(zo,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield Jd(n)}));else throw e})}function vB(n,e){return e().catch(t=>xg(n,t,e))}function iZ(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(ot.EMPTY_BYTE_STRING,s.snapshotVersion)),yB(n,r);let o=new Gl(s.target,r,i,s.sequenceNumber);lI(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function sZ(n,e){return b(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function sc(n){return b(this,null,function*(){let e=U(n),t=Ls(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:Cs;for(;oZ(e);)try{let i=yield iJ(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,aZ(e,i)}catch(i){yield xg(e,i)}EB(e)&&SB(e)})}function oZ(n){return Fs(n)&&n.writePipeline.length<QJ}function aZ(n,e){n.writePipeline.push(e);let t=Ls(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function EB(n){return Fs(n)&&!Ls(n).isStarted()&&n.writePipeline.length>0}function SB(n){Ls(n).start()}function lZ(n){return b(this,null,function*(){Ls(n).writeHandshake()})}function cZ(n){return b(this,null,function*(){let e=Ls(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function uZ(n,e,t){return b(this,null,function*(){let r=n.writePipeline.shift(),i=fT.from(r,e,t);yield vB(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield sc(n)})}function dZ(n,e){return b(this,null,function*(){e&&Ls(n).handshakeComplete&&(yield hZ(n,e)),EB(n)&&SB(n)})}function hZ(n,e){return b(this,null,function*(){if(xQ(e.code)){let t=n.writePipeline.shift();Ls(n).inhibitBackoff(),yield vB(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield sc(n)}})}function fZ(n){return b(this,null,function*(){let e=U(n);e.offlineCauses.add(4),yield rc(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield Jd(e)})}function EL(n,e){return b(this,null,function*(){let t=U(n);t.asyncQueue.verifyOperationInProgress(),M(zo,"RemoteStore received new credentials");let r=Fs(t);t.offlineCauses.add(3),yield rc(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield Jd(t)})}function o0(n,e){return b(this,null,function*(){let t=U(n);e?(t.offlineCauses.delete(2),yield Jd(t)):e||(t.offlineCauses.add(2),yield rc(t),t.onlineStateTracker.set("Unknown"))})}function oc(n){return n.watchStream||(n.watchStream=HJ(n.datastore,n.asyncQueue,{onConnected:eZ.bind(null,n),onOpen:tZ.bind(null,n),onClose:nZ.bind(null,n),onWatchChange:rZ.bind(null,n)}),n.onNetworkStatusChange.push(e=>b(this,null,function*(){e?(n.watchStream.inhibitBackoff(),uI(n)?cI(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),_B(n))}))),n.watchStream}function Ls(n){return n.writeStream||(n.writeStream=$J(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:lZ.bind(null,n),onClose:dZ.bind(null,n),onHandshakeComplete:cZ.bind(null,n),onMutationResult:uZ.bind(null,n)}),n.onNetworkStatusChange.push(e=>b(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield sc(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(M(zo,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var pZ="AsyncQueue",a0=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ht,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new N(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ac(n,e){if($e(pZ,`${e}: ${n}`),Ms(n))return new N(D.UNAVAILABLE,`${e}: ${n}`);throw n}var Pg=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||V.comparator(t.key,r.key):this.comparator=(t,r)=>V.comparator(t.key,r.key),this.keyedMap=dd(),this.sortedSet=new Le(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Mg=class{constructor(){this.changeMap=new Le(V.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):G()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},Hl=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Pg.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Kd(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var l0=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function mZ(){return new c0}var c0=class{constructor(){this.queries=CB(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){SZ(this,new N(D.ABORTED,"Firestore shutting down"))}};function CB(){return new $r(n=>v2(n),Kd)}function dI(n,e){return b(this,null,function*(){let t=U(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new l0,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=ac(o,`Initialization of query '${Il(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&fI(t)})}function hI(n,e){return b(this,null,function*(){let t=U(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function gZ(n,e){let t=U(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&fI(t)}function yZ(n,e,t){let r=U(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function _Z(n,e){let t=U(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&fI(t)}function vZ(n,e){U(n).snapshotsInSyncListeners.add(e),e.next()}function EZ(n,e){U(n).snapshotsInSyncListeners.delete(e)}function SZ(n,e){let t=U(n),r=t.queries;t.queries=CB(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function fI(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var wB=function(n){return n.Default="default",n.Cache="cache",n}(wB||{}),Vd=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Hl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=Hl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==wB.Cache}};var u0=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=ae(),i=ae();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Fg=class{constructor(e){this.serializer=e}toDocumentKey(e){return Gr(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?z2(this.serializer,e.document,!1):ft.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return it(e)}},d0=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=bB(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=ye.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Fg(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||ae()).add(s);t.set(o,a)}}return t}complete(){return b(this,null,function*(){let e=yield hJ(this.localStore,new Fg(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield gJ(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function bB(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function CZ(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Lg=class{constructor(e){this.key=e}},Bg=class{constructor(e){this.key=e}},Vg=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=ae(),this.mutatedKeys=ae(),this.docComparator=S2(e),this.documentSet=new Pg(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new Mg,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let h=i.get(u),p=Qd(this.query,d)?d:null,E=h?this.mutatedKeys.has(h.key):!1,w=p?p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations:!1,T=!1;h&&p?h.data.isEqual(p.data)?E!==w&&(r.track({type:3,doc:p}),T=!0):this.shouldWaitForSyncedDocument(h,p)||(r.track({type:2,doc:p}),T=!0,(l&&this.docComparator(p,l)>0||c&&this.docComparator(p,c)<0)&&(a=!0)):!h&&p?(r.track({type:0,doc:p}),T=!0):h&&!p&&(r.track({type:1,doc:h}),T=!0,(l||c)&&(a=!0)),T&&(p?(o=o.add(p),w?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,h)=>wZ(d.type,h.type)||this.docComparator(d.doc,h.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new Hl(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Mg,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=ae(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Bg(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new Lg(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=ae();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return Hl.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function wZ(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return G()}};return t(n)-t(e)}var Bs="SyncEngine",h0=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},f0=class{constructor(e){this.key=e,this.receivedDocument=!1}},p0=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new $r(a=>v2(a),Kd),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Le(V.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Md,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Wl.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function bZ(n,e,t,r,i,s,o){let a=new p0(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function TZ(n,e,t=!0){return b(this,null,function*(){let r=uy(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield TB(r,e,t,!0),i})}function IZ(n,e){return b(this,null,function*(){let t=uy(n);yield TB(t,e,!0,!1)})}function TB(n,e,t,r){return b(this,null,function*(){let i=yield jl(n.localStore,Jt(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield pI(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&cy(n.remoteStore,i),a})}function pI(n,e,t,r,i){return b(this,null,function*(){n.applyDocChanges=(d,h,p)=>LZ(n,d,h,p);let s=yield ly(n.localStore,e,!0),o=new Vg(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Nd.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);yI(n,t,c.limboChanges);let u=new h0(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function AZ(n,e,t){return b(this,null,function*(){let r=U(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!Kd(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield $l(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&ic(r.remoteStore,i.targetId),Kl(r,i.targetId)}).catch(Ps))):(Kl(r,i.targetId),yield $l(r.localStore,i.targetId,!0))})}function DZ(n,e){return b(this,null,function*(){let t=U(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ic(t.remoteStore,r.targetId))})}function RZ(n,e,t){return b(this,null,function*(){let r=vI(n);try{let i=yield YX(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),MZ(r,i.batchId,t),yield vi(r,i.changes),yield sc(r.remoteStore)}catch(i){let s=ac(i,"Failed to persist write");t.reject(s)}})}function IB(n,e){return b(this,null,function*(){let t=U(n);try{let r=yield tJ(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&($(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?$(o.receivedDocument):i.removedDocuments.size>0&&($(o.receivedDocument),o.receivedDocument=!1))}),yield vi(t,r,e)}catch(r){yield Ps(r)}})}function SL(n,e,t){let r=U(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),_Z(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function kZ(n,e,t){return b(this,null,function*(){let r=U(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Le(V.comparator);o=o.insert(s,ft.newNoDocument(s,X.min()));let a=ae().add(s),l=new kd(X.min(),new Map,new Le(se),o,a);yield IB(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),_I(r)}else yield $l(r.localStore,e,!1).then(()=>Kl(r,e,t)).catch(Ps)})}function NZ(n,e){return b(this,null,function*(){let t=U(n),r=e.batch.batchId;try{let i=yield XX(t.localStore,e);gI(t,r,null),mI(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield vi(t,i)}catch(i){yield Ps(i)}})}function OZ(n,e,t){return b(this,null,function*(){let r=U(n);try{let i=yield ZX(r.localStore,e);gI(r,e,t),mI(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield vi(r,i)}catch(i){yield Ps(i)}})}function xZ(n,e){return b(this,null,function*(){let t=U(n);Fs(t.remoteStore)||M(Bs,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield eJ(t.localStore);if(r===Cs){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=ac(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function mI(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function PZ(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new N(D.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function MZ(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Le(se)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function gI(n,e,t){let r=U(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function Kl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||AB(n,i)})}function AB(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(ic(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),_I(n))}function yI(n,e,t){for(let r of t)r instanceof Lg?(n.limboDocumentRefs.addReference(r.key,e),FZ(n,r)):r instanceof Bg?(M(Bs,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||AB(n,r.key)):G()}function FZ(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(M(Bs,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),_I(n))}function _I(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new V(ye.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new f0(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),cy(n.remoteStore,new Gl(Jt(nc(t.path)),r,"TargetPurposeLimboResolution",En.INVALID))}}function vi(n,e,t){return b(this,null,function*(){let r=U(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let d=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(c){i.push(c);let d=u0.fromSnapshot(l.targetId,c);s.push(d)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield rJ(r.localStore,s))})}function LZ(n,e,t,r){return b(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield ly(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return yI(n,e.targetId,a.limboChanges),a.snapshot})}function BZ(n,e){return b(this,null,function*(){let t=U(n);if(!t.currentUser.isEqual(e)){M(Bs,"User change. New user:",e.toKey());let i=yield oB(t.localStore,e);t.currentUser=e,PZ(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield vi(t,i.affectedDocuments)}})}function VZ(n,e){let t=U(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return ae().add(r.key);{let i=ae(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function UZ(n,e){return b(this,null,function*(){let t=U(n),r=yield ly(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&yI(t,e.targetId,i.limboChanges),i})}function qZ(n,e){return b(this,null,function*(){let t=U(n);return uB(t.localStore,e).then(r=>vi(t,r))})}function zZ(n,e,t,r){return b(this,null,function*(){let i=U(n),s=yield lJ(i.localStore,e);if(s===null){M(Bs,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield sc(i.remoteStore):t==="acknowledged"||t==="rejected"?(gI(i,e,r||null),mI(i,e),cJ(i.localStore,e)):G(),yield vi(i,s)})}function GZ(n,e){return b(this,null,function*(){let t=U(n);if(uy(t),vI(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield CL(t,r.toArray());t._isPrimaryClient=!0,yield o0(t.remoteStore,!0);for(let s of i)cy(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Kl(t,o),$l(t.localStore,o,!0))),ic(t.remoteStore,o)}),yield i,yield CL(t,r),WZ(t),t._isPrimaryClient=!1,yield o0(t.remoteStore,!1)}})}function WZ(n){let e=U(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{ic(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new Le(V.comparator)}function CL(n,e,t){return b(this,null,function*(){let r=U(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield jl(r.localStore,Jt(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),d=yield UZ(r,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield cB(r.localStore,o);a=yield jl(r.localStore,c),yield pI(r,DB(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function DB(n){return _2(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function jZ(n){let e=U(n);return uJ(e.localStore)}function $Z(n,e,t,r){return b(this,null,function*(){let i=U(n);if(i._isPrimaryClient){M(Bs,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield uB(i.localStore,E2(s[0])),a=kd.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ot.EMPTY_BYTE_STRING);yield vi(i,o,a);break}case"rejected":{yield $l(i.localStore,e,!0),Kl(i,e,r);break}default:G()}})}function HZ(n,e,t){return b(this,null,function*(){let r=uy(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){M(Bs,"Adding an already active target "+i);continue}let o=yield cB(r.localStore,i),a=yield jl(r.localStore,o);yield pI(r,DB(o),a.targetId,!1,a.resumeToken),cy(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield $l(r.localStore,i,!1).then(()=>{ic(r.remoteStore,i),Kl(r,i)}).catch(Ps))}})}function uy(n){let e=U(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=IB.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=VZ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=kZ.bind(null,e),e.syncEngineListener.onWatchChange=gZ.bind(null,e.eventManager),e.syncEngineListener.onWatchError=yZ.bind(null,e.eventManager),e}function vI(n){let e=U(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=NZ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=OZ.bind(null,e),e}function KZ(n,e,t){let r=U(n);QZ(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function QZ(n,e,t){return b(this,null,function*(){try{let r=yield e.getMetadata();if(yield fJ(n.localStore,r))return yield e.close(),t._completeWith(CZ(r)),Promise.resolve(new Set);t._updateProgress(bB(r));let s=new d0(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield vi(n,a.changedDocs,void 0),yield pJ(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return ir(Bs,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var m0=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return b(this,null,function*(){this.serializer=Xd(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return sB(this.persistence,new Dg,t.initialUser,this.serializer)}createPersistence(t){return new Ig(Ag.factory,this.serializer)}createSharedClientState(t){return new Ng}terminate(){return b(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var Ug=class n extends m0{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return b(this,null,function*(){yield Ny(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield vI(this.onlineComponentProvider.syncEngine),yield sc(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return sB(this.persistence,new Dg,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new xT(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Hb(t,this.persistence);return new $b(e.asyncQueue,r)}createPersistence(e){let t=oI(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Vn.withCacheSize(this.cacheSizeBytes):Vn.DEFAULT;return new KT(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,gB(),FJ(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Ng}},g0=class n extends Ug{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return b(this,null,function*(){yield Ny(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof _d&&(this.sharedClientState.syncEngine={applyBatchState:zZ.bind(null,t),applyTargetState:$Z.bind(null,t),applyActiveTargetsChange:HZ.bind(null,t),getActiveClients:jZ.bind(null,t),synchronizeWithChangedDocuments:qZ.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>b(this,null,function*(){yield GZ(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=gB();if(!_d.isAvailable(t))throw new N(D.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=oI(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new _d(t,e.asyncQueue,r,e.clientId,e.initialUser)}},EI=(()=>{class n{initialize(t,r){return b(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>SL(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=BZ.bind(null,this.syncEngine),yield o0(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return mZ()}createDatastore(t){let r=Xd(t.databaseInfo.databaseId),i=PJ(t.databaseInfo);return GJ(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return YJ(this.localStore,this.datastore,t.asyncQueue,r=>SL(this.syncEngine,r,0),MJ())}createSyncEngine(t,r){return bZ(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return b(this,null,function*(){var t,r;yield ZJ(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}n.provider={build:()=>new n};return n})(),YZ=10240;function XZ(n,e=YZ){let t=0;return{read(){return b(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return b(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function SI(n,e,t){if(!t)throw new N(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function CI(n,e,t,r){if(e===!0&&r===!0)throw new N(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function wL(n){if(!V.isDocumentKey(n))throw new N(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function bL(n){if(V.isDocumentKey(n))throw new N(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function JZ(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Zd(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=ZZ(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":G()}function ZZ(n){return n.constructor?n.constructor.name:null}function Se(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new N(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Zd(n);throw new N(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function RB(n,e){if(e<=0)throw new N(D.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function eee(n,e){if(!(n instanceof Uint8Array))throw new N(D.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${Zd(n)}`);return XZ(n,e)}var Ql=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):$e("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var y0=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var _0=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new ht,this.buffer=new Uint8Array,this.textDecoder=PQ(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return b(this,null,function*(){return this.metadata.promise})}nextElement(){return b(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return b(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new y0(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return b(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return b(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return b(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function tee(n,e){return new _0(n,e)}var v0=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return b(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new N(D.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield jJ(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ns(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return b(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=V.fromPath(r);this.mutations.push(new Ad(i,this.precondition(i)))}),yield WJ(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=X.min();else throw G();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new N(D.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(X.min())?Ze.exists(!1):Ze.updateTime(t):Ze.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(X.min()))throw new N(D.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ze.updateTime(t)}else return Ze.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var E0=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new Bd(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>b(this,null,function*(){let e=new v0(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return $d(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!M2(t)}return!1}};var Os="FirestoreClient",nee=100,ree=11,iee=20,see=22,S0=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=pt.UNAUTHENTICATED,this.clientId=sg.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>b(this,null,function*(){M(Os,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(M(Os,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:nee}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ht;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>b(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ac(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Mb(n,e){return b(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),M(Os,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>b(this,null,function*(){r.isEqual(i)||(yield oB(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function TL(n,e){return b(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield wI(n);M(Os,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>EL(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>EL(e.remoteStore,i)),n._onlineComponents=e})}function oee(n){return n.name==="FirebaseError"?n.code===D.FAILED_PRECONDITION||n.code===D.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===see||n.code===iee||n.code===ree:!0}function wI(n){return b(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){M(Os,"Using user provided OfflineComponentProvider");try{yield Mb(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!oee(t))throw t;ir("Error using user provided cache. Falling back to memory cache: "+t),yield Mb(n,new m0)}}else M(Os,"Using default OfflineComponentProvider"),yield Mb(n,new m0);return n._offlineComponents})}function dy(n){return b(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(M(Os,"Using user provided OnlineComponentProvider"),yield TL(n,n._uninitializedComponentsProvider._online)):(M(Os,"Using default OnlineComponentProvider"),yield TL(n,new EI))),n._onlineComponents})}function kB(n){return wI(n).then(e=>e.persistence)}function bI(n){return wI(n).then(e=>e.localStore)}function NB(n){return dy(n).then(e=>e.remoteStore)}function TI(n){return dy(n).then(e=>e.syncEngine)}function aee(n){return dy(n).then(e=>e.datastore)}function Yl(n){return b(this,null,function*(){let e=yield dy(n),t=e.eventManager;return t.onListen=TZ.bind(null,e.syncEngine),t.onUnlisten=AZ.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=IZ.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=DZ.bind(null,e.syncEngine),t})}function lee(n){return n.asyncQueue.enqueue(()=>b(this,null,function*(){let e=yield kB(n),t=yield NB(n);return e.setNetworkEnabled(!0),XJ(t)}))}function cee(n){return n.asyncQueue.enqueue(()=>b(this,null,function*(){let e=yield kB(n),t=yield NB(n);return e.setNetworkEnabled(!1),JJ(t)}))}function uee(n){let e=new ht;return n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){let t=yield TI(n);return xZ(t,e)})),e.promise}function dee(n,e,t,r){let i=new Ql(r),s=new Vd(e,i,t);return n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){let o=yield Yl(n);return dI(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){let o=yield Yl(n);return hI(o,s)}))}}function hee(n,e){let t=new ht;return n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){let r=yield bI(n);return yee(r,e,t)})),t.promise}function OB(n,e,t={}){let r=new ht;return n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){let i=yield Yl(n);return _ee(i,n.asyncQueue,e,t,r)})),r.promise}function fee(n,e){let t=new ht;return n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){let r=yield bI(n);return vee(r,e,t)})),t.promise}function xB(n,e,t={}){let r=new ht;return n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){let i=yield Yl(n);return Eee(i,n.asyncQueue,e,t,r)})),r.promise}function pee(n,e){let t=new ht;return n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){let r=yield TI(n);return RZ(r,e,t)})),t.promise}function mee(n,e){let t=new Ql(e);return n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){let r=yield Yl(n);return vZ(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){let r=yield Yl(n);return EZ(r,t)}))}}function gee(n,e,t){let r=new ht;return n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){let i=yield aee(n);new E0(n.asyncQueue,i,t,e,r).run()})),r.promise}function yee(n,e,t){return b(this,null,function*(){try{let r=yield sJ(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new N(D.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=ac(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function _ee(n,e,t,r,i){let s=new Ql({next:a=>{s.mute(),e.enqueueAndForget(()=>hI(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new N(D.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new N(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Vd(nc(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return dI(n,o)}function vee(n,e,t){return b(this,null,function*(){try{let r=yield ly(n,e,!0),i=new Vg(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=ac(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function Eee(n,e,t,r,i){let s=new Ql({next:a=>{s.mute(),e.enqueueAndForget(()=>hI(n,o)),a.fromCache&&r.source==="server"?i.reject(new N(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Vd(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return dI(n,o)}function See(n,e,t,r){let i=wee(t,Xd(e));n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){KZ(yield TI(n),i,r)}))}function Cee(n,e){return n.asyncQueue.enqueue(()=>b(this,null,function*(){return mJ(yield bI(n),e)}))}function wee(n,e){let t;return typeof n=="string"?t=F2().encode(n):t=n,tee(eee(t),e)}function bee(n,e){return n.timeoutSeconds===e.timeoutSeconds}function PB(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Tee="ComponentProvider",IL=new Map;function Iee(n){let e=IL.get(n);e&&(M(Tee,"Removing Datastore"),IL.delete(n),e.terminate())}function Aee(n,e,t,r){return new Zb(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,PB(r.experimentalLongPollingOptions),r.useFetchStreams)}var MB="firestore.googleapis.com",AL=!0,DL=5,RL=30,Dee=!0,qg=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new N(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=MB,this.ssl=AL}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:AL;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=nB;else{if(e.cacheSizeBytes!==Yd&&e.cacheSizeBytes<cL)throw new N(D.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${cL}`);this.cacheSizeBytes=e.cacheSizeBytes}CI("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=Dee:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=PB((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),Ree(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&bee(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function Ree(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new N(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<DL)throw new N(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${DL})`);if(n.timeoutSeconds>RL)throw new N(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${RL})`)}}var Go=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qg({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new N(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new N(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qg(e),e.credentials!==void 0&&(this._authCredentials=_8(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return b(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return Iee(this),Promise.resolve()}};function hy(n,e,t,r={}){var i;n=Se(n,Go);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==MB&&s.host!==o&&ir("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=pt.MOCK_USER;else{a=Eh(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new N(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new pt(c)}n._authCredentials=new Lb(new ig(a,l))}}var kt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Me=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Wr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Wr=class n extends kt{constructor(e,t,r){super(e,t,nc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Me(this.firestore,null,new V(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function fy(n,e,...t){if(n=fe(n),SI("collection","path",e),n instanceof Go){let r=ye.fromString(e,...t);return bL(r),new Wr(n,null,r)}else{if(!(n instanceof Me)&&!(n instanceof Wr))throw new N(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ye.fromString(e,...t));return bL(r),new Wr(n.firestore,null,r)}}function II(n,e){if(n=Se(n,Go),SI("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new N(D.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new kt(n,null,nQ(e))}function lc(n,e,...t){if(n=fe(n),arguments.length===1&&(e=sg.newId()),SI("doc","path",e),n instanceof Go){let r=ye.fromString(e,...t);return wL(r),new Me(n,null,new V(r))}else{if(!(n instanceof Me)&&!(n instanceof Wr))throw new N(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ye.fromString(e,...t));return wL(r),new Me(n.firestore,n instanceof Wr?n.converter:null,new V(r))}}function py(n,e){return n=fe(n),e=fe(e),(n instanceof Me||n instanceof Wr)&&(e instanceof Me||e instanceof Wr)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function my(n,e){return n=fe(n),e=fe(e),n instanceof kt&&e instanceof kt?n.firestore===e.firestore&&Kd(n._query,e._query)&&n.converter===e.converter:!1}var kee="AsyncQueue",zg=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Bd(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new ht;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return b(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Ms(e))M(kee,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=Nee(r);throw $e("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=a0.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&G()}verifyOperationInProgress(){}drain(){return b(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function Nee(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var C0=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new ht,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var FB=Yd,Ke=class extends Go{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new zg,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return b(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new zg(e),this._firestoreClient=void 0,yield e}})}};function LB(n,e){let t=typeof n=="object"?n:Ws(),r=typeof n=="string"?n:e||eT,i=Ec(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=vh("firestore");s&&hy(i,...s)}return i}function Nt(n){if(n._terminated)throw new N(D.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||BB(n),n._firestoreClient}function BB(n){var e,t,r;let i=n._freezeSettings(),s=Aee(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new S0(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&Oee(n._componentsProvider))}function Oee(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function AI(n,e){ir("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return VB(n,EI.provider,{build:r=>new Ug(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function DI(n){return b(this,null,function*(){ir("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();VB(n,EI.provider,{build:t=>new g0(t,e.cacheSizeBytes)})})}function VB(n,e,t){if(n=Se(n,Ke),n._firestoreClient||n._terminated)throw new N(D.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new N(D.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},BB(n)}function RI(n){if(n._initialized&&!n._terminated)throw new N(D.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new ht;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>b(this,null,function*(){try{yield HX(oI(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function kI(n){n=Se(n,Ke);let e=Nt(n);return uee(e)}function NI(n){n=Se(n,Ke);let e=Nt(n);return lee(e)}function OI(n){n=Se(n,Ke);let e=Nt(n);return cee(e)}function xI(n,e){n=Se(n,Ke);let t=Nt(n),r=new C0;return See(t,n._databaseId,e,r),r}function PI(n,e){n=Se(n,Ke);let t=Nt(n);return Cee(t,e).then(r=>r?new kt(n,null,r.query):null)}function xee(n,e=!0){g8(Th),Gs(new cn("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new Ke(new Bb(t.getProvider("auth-internal")),new zb(t.getProvider("app-check-internal")),m7(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),tt(CF,wF,n),tt(CF,wF,"esm2017")}var Hr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(ot.fromBase64String(e))}catch(t){throw new N(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(ot.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var lr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new N(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new st(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var gi=class{constructor(e){this._methodName=e}};var Wo=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new N(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new N(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return se(this._lat,e._lat)||se(this._long,e._long)}};var Ud=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return KX(this._values,e._values)}};var Pee=/^__.*__$/,w0=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ar(e,this.data,this.fieldMask,t,this.fieldTransforms):new ks(e,this.data,t,this.fieldTransforms)}},Gg=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ar(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function UB(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G()}}var Wg=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return jg(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(UB(this.dataSource)&&Pee.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},b0=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Xd(e)}createContext(e,t,r,i=!1){return new Wg({dataSource:e,methodName:t,targetDoc:r,path:st.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Qo(n){let e=n._freezeSettings(),t=Xd(n._databaseId);return new b0(n._databaseId,!!e.ignoreUndefinedProperties,t)}function gy(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);LI("Data must be an object, but it was:",o,r);let a=GB(r,o),l,c;if(s.merge)l=new Sn(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let h=R0(e,d,t);if(!o.contains(h))throw new N(D.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);jB(u,h)||u.push(h)}l=new Sn(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new w0(new Bt(a),l,c)}var qd=class n extends gi{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function qB(n,e,t){return new Wg({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var T0=class n extends gi{_toFieldTransform(e){return new Vo(e.path,new Ds)}isEqual(e){return e instanceof n}},I0=class n extends gi{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=qB(this,e,!0),r=this._elements.map(s=>Yo(s,t)),i=new pi(r);return new Vo(e.path,i)}isEqual(e){return e instanceof n&&Gy(this._elements,e._elements)}},A0=class n extends gi{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=qB(this,e,!0),r=this._elements.map(s=>Yo(s,t)),i=new mi(r);return new Vo(e.path,i)}isEqual(e){return e instanceof n&&Gy(this._elements,e._elements)}},D0=class n extends gi{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Rs(e.serializer,I2(e.serializer,this._operand));return new Vo(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function MI(n,e,t,r){let i=n.createContext(1,e,t);LI("Data must be an object, but it was:",i,r);let s=[],o=Bt.empty();Ko(r,(l,c)=>{let u=BI(e,l,t);c=fe(c);let d=i.childContextForFieldPath(u);if(c instanceof qd)s.push(u);else{let h=Yo(c,d);h!=null&&(s.push(u),o.set(u,h))}});let a=new Sn(s);return new Gg(o,a,i.fieldTransforms)}function FI(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[R0(e,r,t)],l=[i];if(s.length%2!==0)throw new N(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(R0(e,s[h])),l.push(s[h+1]);let c=[],u=Bt.empty();for(let h=a.length-1;h>=0;--h)if(!jB(c,a[h])){let p=a[h],E=l[h];E=fe(E);let w=o.childContextForFieldPath(p);if(E instanceof qd)c.push(p);else{let T=Yo(E,w);T!=null&&(c.push(p),u.set(p,T))}}let d=new Sn(c);return new Gg(u,d,o.fieldTransforms)}function zB(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return Yo(t,i)}function Yo(n,e){if(n=fe(n),WB(n))return LI("Unsupported field value:",e,n),GB(n,e);if(n instanceof gi)return Fee(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return Mee(n,e)}else return Lee(n,e)}function GB(n,e){let t={};return JL(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ko(n,(r,i)=>{let s=Yo(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function Mee(n,e){let t=[],r=0;for(let i of n){let s=Yo(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function Fee(n,e){if(!UB(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function Lee(n,e){if(n=fe(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return I2(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=He.fromDate(n);return{timestampValue:zl(e.serializer,t)}}else if(n instanceof He){let t=new He(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:zl(e.serializer,t)}}else{if(n instanceof Wo)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Hr)return{bytesValue:L2(e.serializer,n._byteString)};if(n instanceof Me){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:tI(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof Ud)return Bee(n,e);throw e.createError(`Unsupported field value: ${Zd(n)}`)}}}function Bee(n,e){return{mapValue:{fields:{[H0]:{stringValue:K0},[Fl]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return eI(e.serializer,r)})}}}}}}function WB(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof He)&&!(n instanceof Wo)&&!(n instanceof Hr)&&!(n instanceof Me)&&!(n instanceof gi)&&!(n instanceof Ud)}function LI(n,e,t){if(!WB(t)||!JZ(t)){let r=Zd(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function R0(n,e,t){if(e=fe(e),e instanceof lr)return e._internalPath;if(typeof e=="string")return BI(n,e);throw jg("Field path arguments must be of type string or ",n,!1,void 0,t)}var Vee=new RegExp("[~\\*/\\[\\]]");function BI(n,e,t){if(e.search(Vee)>=0)throw jg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new lr(...e.split("."))._internalPath}catch{throw jg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function jg(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new N(D.INVALID_ARGUMENT,a+n+l)}function jB(n,e){return n.some(t=>t.isEqual(e))}var jo=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Me(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new k0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(yy("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},k0=class extends jo{data(){return super.data()}};function yy(n,e){return typeof e=="string"?BI(n,e):e instanceof lr?e._internalPath:e._delegate._internalPath}function $B(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new N(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var zd=class{},$o=class extends zd{};function Kr(n,e,...t){let r=[];e instanceof zd&&r.push(e),r=r.concat(t),Hee(r);for(let i of r)n=i._apply(n);return n}var $g=class n extends $o{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return KB(e._query,t),new kt(e.firestore,e.converter,J0(e._query,t))}_parse(e){let t=Qo(e.firestore);return Uee(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function VI(n,e,t){let r=e,i=yy("where",n);return $g._create(i,r,t)}var N0=class n extends zd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ae.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(jee(e._query,t),new kt(e.firestore,e.converter,J0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var O0=class n extends $o{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=qee(e._query,this._field,this._direction);return new kt(e.firestore,e.converter,sQ(e._query,t))}};function UI(n,e="asc"){let t=e,r=yy("orderBy",n);return O0._create(r,t)}var Hg=class n extends $o{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new kt(e.firestore,e.converter,pg(e._query,this._limit,this._limitType))}};function qI(n){return RB("limit",n),Hg._create("limit",n,"F")}function zI(n){return RB("limitToLast",n),Hg._create("limitToLast",n,"L")}var Kg=class n extends $o{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=HB(e,this.type,this._docOrFields,this._inclusive);return new kt(e.firestore,e.converter,oQ(e._query,t))}};function GI(...n){return Kg._create("startAt",n,!0)}function WI(...n){return Kg._create("startAfter",n,!1)}var Qg=class n extends $o{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=HB(e,this.type,this._docOrFields,this._inclusive);return new kt(e.firestore,e.converter,aQ(e._query,t))}};function jI(...n){return Qg._create("endBefore",n,!1)}function $I(...n){return Qg._create("endAt",n,!0)}function HB(n,e,t,r){if(t[0]=fe(t[0]),t[0]instanceof jo)return zee(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Qo(n.firestore);return Gee(n._query,n.firestore._databaseId,i,e,t,r)}}function Uee(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new N(D.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){NL(o,s);let c=[];for(let u of o)c.push(kL(r,n,u));a={arrayValue:{values:c}}}else a=kL(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&NL(o,s),a=zB(t,e,o,s==="in"||s==="not-in");return pe.create(i,s,a)}function qee(n,e,t){if(n.startAt!==null)throw new N(D.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new N(D.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Lo(e,t)}function zee(n,e,t,r,i){if(!r)throw new N(D.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of Vl(n))if(o.field.isKeyField())s.push(Fo(e,r.key));else{let a=r.data.field(o.field);if(ry(a))throw new N(D.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new N(D.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new jr(s,i)}function Gee(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new N(D.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new N(D.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!X0(n)&&c.indexOf("/")!==-1)throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(ye.fromString(c));if(!V.isDocumentKey(d))throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let h=new V(d);a.push(Fo(e,h))}else{let d=zB(t,r,c);a.push(d)}}return new jr(a,s)}function kL(n,e,t){if(t=fe(t),typeof t=="string"){if(t==="")throw new N(D.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!X0(e)&&t.indexOf("/")!==-1)throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ye.fromString(t));if(!V.isDocumentKey(r))throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Fo(n,new V(r))}else{if(t instanceof Me)return Fo(n,t._key);throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zd(t)}.`)}}function NL(n,e){if(!Array.isArray(n)||n.length===0)throw new N(D.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Wee(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function KB(n,e){let t=$ee(n.filters,Wee(e.op));if(t!==null)throw t===e.op?new N(D.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new N(D.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function jee(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)KB(t,i),t=J0(t,i)}function $ee(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function Hee(n){let e=n.filter(r=>r instanceof N0).length,t=n.filter(r=>r instanceof $g).length;if(e>1||e>0&&t>0)throw new N(D.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var Xl=class{convertValue(e,t="none"){switch(Mo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ge(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ts(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw G()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Ko(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Fl].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Ge(o.doubleValue));return new Ud(s)}convertGeoPoint(e){return new Wo(Ge(e.latitude),Ge(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=$0(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Cd(e));default:return null}}convertTimestamp(e){let t=fi(e);return new He(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ye.fromString(e);$(K2(r));let i=new Is(r.get(1),r.get(3)),s=new V(r.popFirst(5));return i.isEqual(t)||$e(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function _y(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var x0=class extends Xl{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Me(this.firestore,null,t)}};function P0(n){return Kee(n,["next","error","complete"])}function Kee(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var yi=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},qn=class extends jo{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new xs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(yy("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},xs=class extends qn{data(e={}){return super.data(e)}},cr=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new yi(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new xs(this._firestore,this._userDataWriter,r.key,r,new yi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new N(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=Qee(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Qee(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new xs(n._firestore,n._userDataWriter,r.doc.key,r.doc,new yi(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new xs(n._firestore,n._userDataWriter,r.doc.key,r.doc,new yi(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:Yee(r.type),doc:i,oldIndex:s,newIndex:o}})}}function Yee(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return G()}}function vy(n,e){return n instanceof qn&&e instanceof qn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof cr&&e instanceof cr?n._firestore===e._firestore&&my(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function HI(n){n=Se(n,Me);let e=Se(n.firestore,Ke),t=Nt(e);return OB(t,n._key).then(r=>nA(e,n,r))}var _i=class extends Xl{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Me(this.firestore,null,t)}};function KI(n){n=Se(n,Me);let e=Se(n.firestore,Ke),t=Nt(e),r=new _i(e);return hee(t,n._key).then(i=>new qn(e,r,n._key,i,new yi(i!==null&&i.hasLocalMutations,!0),n.converter))}function QI(n){n=Se(n,Me);let e=Se(n.firestore,Ke),t=Nt(e);return OB(t,n._key,{source:"server"}).then(r=>nA(e,n,r))}function YI(n){n=Se(n,kt);let e=Se(n.firestore,Ke),t=Nt(e),r=new _i(e);return $B(n._query),xB(t,n._query).then(i=>new cr(e,r,n,i))}function XI(n){n=Se(n,kt);let e=Se(n.firestore,Ke),t=Nt(e),r=new _i(e);return fee(t,n._query).then(i=>new cr(e,r,n,i))}function JI(n){n=Se(n,kt);let e=Se(n.firestore,Ke),t=Nt(e),r=new _i(e);return xB(t,n._query,{source:"server"}).then(i=>new cr(e,r,n,i))}function Ey(n,e,t){n=Se(n,Me);let r=Se(n.firestore,Ke),i=_y(n.converter,e,t),s=Qo(r),a=gy(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ze.none());return cc(r,[a])}function Sy(n,e,t,...r){n=Se(n,Me);let i=Se(n.firestore,Ke),s=Qo(i);e=fe(e);let o;typeof e=="string"||e instanceof lr?o=FI(s,"updateDoc",n._key,e,t,r):o=MI(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,Ze.exists(!0));return cc(i,[a])}function ZI(n){let e=Se(n.firestore,Ke),t=[new Ns(n._key,Ze.none())];return cc(e,t)}function eA(n,e){let t=Se(n.firestore,Ke),r=lc(n),i=_y(n.converter,e),s=Qo(n.firestore),a=gy(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Ze.exists(!1));return cc(t,[a]).then(()=>r)}function Cy(n,...e){var t,r,i;n=fe(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!P0(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(P0(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let l,c,u;if(n instanceof Me)c=Se(n.firestore,Ke),u=nc(n._key.path),l={next:h=>{e[o]&&e[o](nA(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=Se(n,kt);c=Se(h.firestore,Ke),u=h._query;let p=new _i(c);l={next:E=>{e[o]&&e[o](new cr(c,p,h,E))},error:e[o+1],complete:e[o+2]},$B(n._query)}let d=Nt(c);return dee(d,u,a,l)}function tA(n,e){n=Se(n,Ke);let t=Nt(n),r=P0(e)?e:{next:e};return mee(t,r)}function cc(n,e){let t=Nt(n);return pee(t,e)}function nA(n,e,t){let r=t.docs.get(e._key),i=new _i(n);return new qn(n,i,e._key,r,new yi(t.hasPendingWrites,t.fromCache),e.converter)}var Xee={maxAttempts:5};function Jee(n){if(n.maxAttempts<1)throw new N(D.INVALID_ARGUMENT,"Max attempts must be at least 1")}var Yg=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Qo(e)}set(e,t,r){this._verifyNotCommitted();let i=Ss(e,this._firestore),s=_y(i.converter,t,r),o=gy(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Ze.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Ss(e,this._firestore);t=fe(t);let o;return typeof t=="string"||t instanceof lr?o=FI(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=MI(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Ze.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Ss(e,this._firestore);return this._mutations=this._mutations.concat(new Ns(t._key,Ze.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(D.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ss(n,e){if(n=fe(n),n.firestore!==e)throw new N(D.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var M0=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Qo(e)}get(e){let t=Ss(e,this._firestore),r=new x0(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return G();let s=i[0];if(s.isFoundDocument())return new jo(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new jo(this._firestore,r,t._key,null,t.converter);throw G()})}set(e,t,r){let i=Ss(e,this._firestore),s=_y(i.converter,t,r),o=gy(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=Ss(e,this._firestore);t=fe(t);let o;return typeof t=="string"||t instanceof lr?o=FI(this._dataReader,"Transaction.update",s._key,t,r,i):o=MI(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=Ss(e,this._firestore);return this._transaction.delete(t._key),this}};var F0=class extends M0{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Ss(e,this._firestore),r=new _i(this._firestore);return super.get(e).then(i=>new qn(this._firestore,r,t._key,i._document,new yi(!1,!1),t.converter))}};function rA(n,e,t){n=Se(n,Ke);let r=Object.assign(Object.assign({},Xee),t);Jee(r);let i=Nt(n);return gee(i,s=>e(new F0(n,s)),r)}function iA(){return new qd("deleteField")}function sA(){return new T0("serverTimestamp")}function oA(...n){return new I0("arrayUnion",n)}function aA(...n){return new A0("arrayRemove",n)}function lA(n){return new D0("increment",n)}xee("node");var eh=class{constructor(e){return e}},QB="firestore",cA=class{constructor(){return $s(QB)}};var uA=new ve("angularfire2.firestore-instances");function Zee(n,e){let t=sa(QB,n,e);return t&&new eh(t)}function ete(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new eh(r)}}var tte={provide:cA,deps:[[new mt,uA]]},nte={provide:eh,useFactory:Zee,deps:[[new mt,uA],jn]};function YB(n,...e){return tt("angularfire",Ct.full,"fst"),Ci([nte,tte,{provide:uA,useFactory:ete(n),multi:!0,deps:[Et,Jr,tn,Zr,[new mt,ho],[new mt,zt],...e]}])}var XB=Ii(LB,!0);var th=class{constructor(e){return e}},JB="database",dA=class{constructor(){return $s(JB)}};var hA=new ve("angularfire2.database-instances");function rte(n,e){let t=sa(JB,n,e);return t&&new th(t)}function ite(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new th(r)}}var ste={provide:dA,deps:[[new mt,hA]]},ote={provide:th,useFactory:rte,deps:[[new mt,hA],jn]};function ZB(n,...e){return tt("angularfire",Ct.full,"rtdb"),Ci([ote,ste,{provide:hA,useFactory:ite(n),multi:!0,deps:[Et,Jr,tn,Zr,[new mt,ho],[new mt,zt],...e]}])}var eV=Ii(H1,!0);var ate="@firebase/firestore-compat",lte="0.3.38";function _A(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new N("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function tV(){if(typeof Uint8Array>"u")throw new N("unimplemented","Uint8Arrays are not available in this environment.")}function nV(){if(!ZL())throw new N("unimplemented","Blobs are unavailable in Firestore in this environment.")}var wy=class n{constructor(e){this._delegate=e}static fromBase64String(e){return nV(),new n(Hr.fromBase64String(e))}static fromUint8Array(e){return tV(),new n(Hr.fromUint8Array(e))}toBase64(){return nV(),this._delegate.toBase64()}toUint8Array(){return tV(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function fA(n){return cte(n,["next","error","complete"])}function cte(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var pA=class{enableIndexedDbPersistence(e,t){return AI(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return DI(e._delegate)}clearIndexedDbPersistence(e){return RI(e._delegate)}},by=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Is||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&ir("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){hy(this._delegate,e,t,r)}enableNetwork(){return NI(this._delegate)}disableNetwork(){return OI(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,CI("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return kI(this._delegate)}onSnapshotsInSync(e){return tA(this._delegate,e)}get app(){if(!this._appCompat)throw new N("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new hc(this,fy(this._delegate,e))}catch(t){throw Zt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Qr(this,lc(this._delegate,e))}catch(t){throw Zt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ea(this,II(this._delegate,e))}catch(t){throw Zt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return rA(this._delegate,t=>e(new Ty(this,t)))}batch(){return Nt(this._delegate),new Iy(new Yg(this._delegate,e=>cc(this._delegate,e)))}loadBundle(e){return xI(this._delegate,e)}namedQuery(e){return PI(this._delegate,e).then(t=>t?new ea(this,t):null)}},uc=class extends Xl{constructor(e){super(),this.firestore=e}convertBytes(e){return new wy(new Hr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Qr.forKey(t,this.firestore,null)}};function ute(n){L0(n)}var Ty=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new uc(e)}get(e){let t=Xo(e);return this._delegate.get(t).then(r=>new Jo(this._firestore,new qn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Xo(e);return r?(_A("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Xo(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Xo(e);return this._delegate.delete(t),this}},Iy=class{constructor(e){this._delegate=e}set(e,t,r){let i=Xo(e);return r?(_A("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Xo(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Xo(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},dc=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new xs(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Zo(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new uc(e),t),i.set(t,s)),s}};dc.INSTANCES=new WeakMap;var Qr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new uc(e)}static forPath(e,t,r){if(e.length%2!==0)throw new N("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new Me(t._delegate,r,new V(e)))}static forKey(e,t,r){return new n(t,new Me(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new hc(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new hc(this.firestore,fy(this._delegate,e))}catch(t){throw Zt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=fe(e),e instanceof Me?py(this._delegate,e):!1}set(e,t){t=_A("DocumentReference.set",t);try{return t?Ey(this._delegate,e,t):Ey(this._delegate,e)}catch(r){throw Zt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Sy(this._delegate,e):Sy(this._delegate,e,t,...r)}catch(i){throw Zt(i,"updateDoc()","DocumentReference.update()")}}delete(){return ZI(this._delegate)}onSnapshot(...e){let t=rV(e),r=iV(e,i=>new Jo(this.firestore,new qn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Cy(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=KI(this._delegate):e?.source==="server"?t=QI(this._delegate):t=HI(this._delegate),t.then(r=>new Jo(this.firestore,new qn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(dc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Zt(n,e,t){return n.message=n.message.replace(e,t),n}function rV(n){for(let e of n)if(typeof e=="object"&&!fA(e))return e;return{}}function iV(n,e){var t,r;let i;return fA(n[0])?i=n[0]:fA(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Jo=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Qr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return vy(this._delegate,e._delegate)}},Zo=class extends Jo{data(e){let t=this._delegate.data(e);return this._delegate._converter||xL(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},ea=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new uc(e)}where(e,t,r){try{return new n(this.firestore,Kr(this._delegate,VI(e,t,r)))}catch(i){throw Zt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,Kr(this._delegate,UI(e,t)))}catch(r){throw Zt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,Kr(this._delegate,qI(e)))}catch(t){throw Zt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,Kr(this._delegate,zI(e)))}catch(t){throw Zt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,Kr(this._delegate,GI(...e)))}catch(t){throw Zt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,Kr(this._delegate,WI(...e)))}catch(t){throw Zt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,Kr(this._delegate,jI(...e)))}catch(t){throw Zt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,Kr(this._delegate,$I(...e)))}catch(t){throw Zt(t,"endAt()","Query.endAt()")}}isEqual(e){return my(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=XI(this._delegate):e?.source==="server"?t=JI(this._delegate):t=YI(this._delegate),t.then(r=>new nh(this.firestore,new cr(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=rV(e),r=iV(e,i=>new nh(this.firestore,new cr(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Cy(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(dc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},mA=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Zo(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},nh=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ea(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Zo(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new mA(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Zo(this._firestore,r))})}isEqual(e){return vy(this._delegate,e._delegate)}},hc=class n extends ea{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Qr(this.firestore,e):null}doc(e){try{return e===void 0?new Qr(this.firestore,lc(this._delegate)):new Qr(this.firestore,lc(this._delegate,e))}catch(t){throw Zt(t,"doc()","CollectionReference.doc()")}}add(e){return eA(this._delegate,e).then(t=>new Qr(this.firestore,t))}isEqual(e){return py(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(dc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Xo(n){return Se(n,Me)}var gA=class n{constructor(...e){this._delegate=new lr(...e)}static documentId(){return new n(st.keyField().canonicalString())}isEqual(e){return e=fe(e),e instanceof lr?this._delegate._internalPath.isEqual(e._internalPath):!1}};var yA=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=sA();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=iA();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=oA(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=aA(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=lA(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var dte={Firestore:by,GeoPoint:Wo,Timestamp:He,Blob:wy,Transaction:Ty,WriteBatch:Iy,DocumentReference:Qr,DocumentSnapshot:Jo,Query:ea,QueryDocumentSnapshot:Zo,QuerySnapshot:nh,CollectionReference:hc,FieldPath:gA,FieldValue:yA,setLogLevel:ute,CACHE_SIZE_UNLIMITED:FB};function hte(n,e){n.INTERNAL.registerComponent(new cn("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},dte)))}function fte(n){hte(n,(e,t)=>new by(e,t,new pA)),n.registerVersion(ate,lte,"node")}fte(yt);function pte(n,e=na){return new ur(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function sV(n,e){return pte(n,e)}function mte(n,e){return sV(n,e).pipe(ah(void 0),oh(),Ve(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function SA(n,e){return sV(n,e).pipe(Ve(t=>({payload:t,type:"query"})))}var Ay=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=uV(r,t);return new Ry(i,s,this.afs)}snapshotChanges(){return mte(this.ref,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return this.snapshotChanges().pipe(Ve(({payload:t})=>e.idField?Cn(qt({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return dr(this.ref.get(e)).pipe(Xe)}};function Dy(n,e){return SA(n,e).pipe(ah(void 0),oh(),Ve(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function oV(n,e,t){return Dy(n,t).pipe(Us((r,i)=>gte(r,i.map(s=>s.payload),e),[]),sh(),Ve(r=>r.map(i=>({type:i.type,payload:i}))))}function gte(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=yte(n,r))}),n}function vA(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function yte(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return vA(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return vA(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return vA(n,e.oldIndex,1);break}return n}function aV(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Ry=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Dy(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ve(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(ah(void 0),oh(),pc(([r,i])=>i.length>0||!r),Ve(([,r])=>r),Xe)}auditTrail(e){return this.stateChanges(e).pipe(Us((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=aV(e);return oV(this.query,t,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return SA(this.query,this.afs.schedulers.outsideAngular).pipe(Ve(t=>t.payload.docs.map(r=>e.idField?Cn(qt({},r.data()),{[e.idField]:r.id}):r.data())),Xe)}get(e){return dr(this.query.get(e)).pipe(Xe)}add(e){return this.ref.add(e)}doc(e){return new Ay(this.ref.doc(e),this.afs)}},EA=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Dy(this.query,this.afs.schedulers.outsideAngular).pipe(Xe):Dy(this.query,this.afs.schedulers.outsideAngular).pipe(Ve(t=>t.filter(r=>e.indexOf(r.type)>-1)),pc(t=>t.length>0),Xe)}auditTrail(e){return this.stateChanges(e).pipe(Us((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=aV(e);return oV(this.query,t,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return SA(this.query,this.afs.schedulers.outsideAngular).pipe(Ve(r=>r.payload.docs.map(i=>e.idField?qt({[e.idField]:i.id},i.data()):i.data())),Xe)}get(e){return dr(this.query.get(e)).pipe(Xe)}},lV=new ve("angularfire2.enableFirestorePersistence"),cV=new ve("angularfire2.firestore.persistenceSettings"),_te=new ve("angularfire2.firestore.settings"),vte=new ve("angularfire2.firestore.use-emulator");function uV(n,e=t=>t){return{query:e(n),ref:n}}var Ete=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,d,h,p,E,w,T,k,R){this.schedulers=l;let O=Hs(t,a,r),F=u;d&&Dc(O,a,h,E,w,T,p,k),[this.firestore,this.persistenceEnabled$]=oa(`${O.name}.firestore`,"AngularFirestore",O.name,()=>{let W=a.runOutsideAngular(()=>O.firestore());if(s&&W.settings(s),F&&W.useEmulator(...F),i&&!mh(o)){let ee=()=>{try{return dr(W.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(S){return typeof console<"u"&&console.warn(S),hr(!1)}};return[W,a.runOutsideAngular(ee)]}else return[W,hr(!1)]},[s,F,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=uV(i,r),a=this.schedulers.ngZone.run(()=>s);return new Ry(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new EA(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Ay(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(te(Di),te(Ri,8),te(lV,8),te(_te,8),te(pr),te(Et),te(tn),te(cV,8),te(vte,8),te(Rc,8),te(Cc,8),te(wc,8),te(bc,8),te(Tc,8),te(Ic,8),te(Ac,8),te(zt,8))};static \u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),dV=(()=>{class n{constructor(){yt.registerVersion("angularfire",Ct.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:lV,useValue:!0},{provide:cV,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Gn({type:n});static \u0275inj=zn({providers:[Ete]})}return n})();var hV={apiKey:"AIzaSyAR1vRlux6tvsqbsvsejQGpoJ9w7VxBlOE",authDomain:"zuu-makup-shop.firebaseapp.com",databaseURL:"https://zuu-makup-shop-default-rtdb.firebaseio.com",projectId:"zuu-makup-shop",storageBucket:"zuu-makup-shop.firebasestorage.app",messagingSenderId:"13943401966",appId:"1:13943401966:web:c944415f1aca6be35a32ff",measurementId:"G-PW0KK53GE8"};var fV={providers:[KA(WN),kA([wD.initializeApp(hV),bD,sN,dV]),jA(),lD(()=>cD({projectId:"zuu-makup-shop",appId:"1:13943401966:web:c944415f1aca6be35a32ff",databaseURL:"https://zuu-makup-shop-default-rtdb.firebaseio.com",storageBucket:"zuu-makup-shop.firebasestorage.app",apiKey:"AIzaSyAR1vRlux6tvsqbsvsejQGpoJ9w7VxBlOE",authDomain:"zuu-makup-shop.firebaseapp.com",messagingSenderId:"13943401966",measurementId:"G-PW0KK53GE8"})),$N(()=>HN()),YB(()=>XB()),ZB(()=>eV())]};var Ste={providers:[$A()]},pV=GA(fV,Ste);var Cte=()=>WA(aD,pV),pce=Cte;export{_r as a,pce as b};
